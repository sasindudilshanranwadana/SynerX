const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/auto-1tSkAajP.js","assets/chart-vendor-B-lHHOac.js","assets/react-vendor-Dte2jnjL.js"])))=>i.map(i=>d[i]);
import{r as ot,b as En,a as Cn,c as Ie,R as y,L as at,g as Tn,u as va,d as $n,B as On,e as Rn,f as He,N as et}from"./react-vendor-Dte2jnjL.js";import{_ as Ut,G as mr,S as wa,M as ja,X as ze,a as _a,T as An,b as Na,C as Sa,B as Pn,E as jr,c as Dn,d as as,A as Ye,D as ns,L as In,e as Fn,f as Ln,g as Un,H as ka,h as Mn,U as Bn,P as is,i as os,j as Wn,k as tr,l as Qe,m as Dt,n as zn,o as Bs,p as Vn,I as Pt,F as lt,R as rr,q as ls,r as cs,s as ds,t as qn,u as Hn,v as Kn,w as Jn,x as Gn,K as Yn,y as Qn,z as Xn,J as vr,N as us,O as Je,Q as Zn}from"./ui-vendor-7h6oQL_N.js";import{P as Ae,C as nt,r as Ea}from"./chart-vendor-B-lHHOac.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var Ca={exports:{}},Tr={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ei=ot,ti=Symbol.for("react.element"),ri=Symbol.for("react.fragment"),si=Object.prototype.hasOwnProperty,ai=ei.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ni={key:!0,ref:!0,__self:!0,__source:!0};function Ta(r,e,t){var s,n={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)si.call(e,s)&&!ni.hasOwnProperty(s)&&(n[s]=e[s]);if(r&&r.defaultProps)for(s in e=r.defaultProps,e)n[s]===void 0&&(n[s]=e[s]);return{$$typeof:ti,type:r,key:i,ref:o,props:n,_owner:ai.current}}Tr.Fragment=ri;Tr.jsx=Ta;Tr.jsxs=Ta;Ca.exports=Tr;var a=Ca.exports,$a,Ws=En;$a=Ws.createRoot,Ws.hydrateRoot;const ii=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Ut(async()=>{const{default:s}=await Promise.resolve().then(()=>Mt);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class Cs extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class zs extends Cs{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Vs extends Cs{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class qs extends Cs{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var hs;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(hs||(hs={}));var oi=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(s.next(u))}catch(h){o(h)}}function d(u){try{c(s.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,d)}c((s=s.apply(r,e||[])).next())})};class li{constructor(e,{headers:t={},customFetch:s,region:n=hs.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=ii(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return oi(this,arguments,void 0,function*(t,s={}){var n;try{const{headers:i,method:o,body:l,signal:d}=s;let c={},{region:u}=s;u||(u=this.region);const h=new URL(`${this.url}/${t}`);u&&u!=="any"&&(c["x-region"]=u,h.searchParams.set("forceFunctionRegion",u));let f;l&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&l instanceof Blob||l instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",f=l):typeof l=="string"?(c["Content-Type"]="text/plain",f=l):typeof FormData<"u"&&l instanceof FormData?f=l:(c["Content-Type"]="application/json",f=JSON.stringify(l)));const x=yield this.fetch(h.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),i),body:f,signal:d}).catch(I=>{throw I.name==="AbortError"?I:new zs(I)}),b=x.headers.get("x-relay-error");if(b&&b==="true")throw new Vs(x);if(!x.ok)throw new qs(x);let N=((n=x.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),_;return N==="application/json"?_=yield x.json():N==="application/octet-stream"?_=yield x.blob():N==="text/event-stream"?_=x:N==="multipart/form-data"?_=yield x.formData():_=yield x.text(),{data:_,error:null,response:x}}catch(i){return i instanceof Error&&i.name==="AbortError"?{data:null,error:new zs(i)}:{data:null,error:i,response:i instanceof qs||i instanceof Vs?i.context:void 0}}})}}var Pe={},Ts={},$r={},ir={},Or={},Rr={},ci=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof globalThis<"u")return globalThis;throw new Error("unable to locate global object")},Lt=ci();const di=Lt.fetch,Oa=Lt.fetch.bind(Lt),Ra=Lt.Headers,ui=Lt.Request,hi=Lt.Response,Mt=Object.freeze(Object.defineProperty({__proto__:null,Headers:Ra,Request:ui,Response:hi,default:Oa,fetch:di},Symbol.toStringTag,{value:"Module"})),mi=Cn(Mt);var Ar={};Object.defineProperty(Ar,"__esModule",{value:!0});let fi=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Ar.default=fi;var Aa=Ie&&Ie.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Rr,"__esModule",{value:!0});const gi=Aa(mi),pi=Aa(Ar);let xi=class{constructor(e){var t,s;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(s=e.isMaybeSingle)!==null&&s!==void 0?s:!1,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=gi.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const s=this.fetch;let n=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,l,d,c;let u=null,h=null,f=null,x=i.status,b=i.statusText;if(i.ok){if(this.method!=="HEAD"){const k=await i.text();k===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((o=this.headers.get("Accept"))===null||o===void 0)&&o.includes("application/vnd.pgrst.plan+text"))?h=k:h=JSON.parse(k))}const _=(l=this.headers.get("Prefer"))===null||l===void 0?void 0:l.match(/count=(exact|planned|estimated)/),I=(d=i.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");_&&I&&I.length>1&&(f=parseInt(I[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(h)&&(h.length>1?(u={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,f=null,x=406,b="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{const _=await i.text();try{u=JSON.parse(_),Array.isArray(u)&&i.status===404&&(h=[],u=null,x=200,b="OK")}catch{i.status===404&&_===""?(x=204,b="No Content"):u={message:_}}if(u&&this.isMaybeSingle&&(!((c=u==null?void 0:u.details)===null||c===void 0)&&c.includes("0 rows"))&&(u=null,x=200,b="OK"),u&&this.shouldThrowOnError)throw new pi.default(u)}return{error:u,data:h,count:f,status:x,statusText:b}});return this.shouldThrowOnError||(n=n.catch(i=>{var o,l,d;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(l=i==null?void 0:i.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(d=i==null?void 0:i.code)!==null&&d!==void 0?d:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}};Rr.default=xi;var yi=Ie&&Ie.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Or,"__esModule",{value:!0});const bi=yi(Rr);let vi=class extends bi.default{select(e){let t=!1;const s=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:n,referencedTable:i=n}={}){const o=i?`${i}.order`:"order",l=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${l?`${l},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const n=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:n=s}={}){const i=typeof n>"u"?"offset":`${n}.offset`,o=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:n=!1,wal:i=!1,format:o="text"}={}){var l;const d=[e?"analyze":null,t?"verbose":null,s?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=(l=this.headers.get("Accept"))!==null&&l!==void 0?l:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${o}; for="${c}"; options=${d};`),o==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};Or.default=vi;var wi=Ie&&Ie.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ir,"__esModule",{value:!0});const ji=wi(Or);let _i=class extends ji.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const o=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const n=s?`${s}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};ir.default=_i;var Ni=Ie&&Ie.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty($r,"__esModule",{value:!0});const Ht=Ni(ir);let Si=class{constructor(e,{headers:t={},schema:s,fetch:n}){this.url=e,this.headers=new Headers(t),this.schema=s,this.fetch=n}select(e,t){const{head:s=!1,count:n}=t??{},i=s?"HEAD":"GET";let o=!1;const l=(e??"*").split("").map(d=>/\s/.test(d)&&!o?"":(d==='"'&&(o=!o),d)).join("");return this.url.searchParams.set("select",l),n&&this.headers.append("Prefer",`count=${n}`),new Ht.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:s=!0}={}){var n;const i="POST";if(t&&this.headers.append("Prefer",`count=${t}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const o=e.reduce((l,d)=>l.concat(Object.keys(d)),[]);if(o.length>0){const l=[...new Set(o)].map(d=>`"${d}"`);this.url.searchParams.set("columns",l.join(","))}}return new Ht.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:n,defaultToNull:i=!0}={}){var o;const l="POST";if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),n&&this.headers.append("Prefer",`count=${n}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const d=e.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(d.length>0){const c=[...new Set(d)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new Ht.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}update(e,{count:t}={}){var s;const n="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new Ht.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}delete({count:e}={}){var t;const s="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new Ht.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}};$r.default=Si;var Pa=Ie&&Ie.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ts,"__esModule",{value:!0});const ki=Pa($r),Ei=Pa(ir);let Ci=class Da{constructor(e,{headers:t={},schema:s,fetch:n}={}){this.url=e,this.headers=new Headers(t),this.schemaName=s,this.fetch=n}from(e){const t=new URL(`${this.url}/${e}`);return new ki.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Da(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:n=!1,count:i}={}){var o;let l;const d=new URL(`${this.url}/rpc/${e}`);let c;s||n?(l=s?"HEAD":"GET",Object.entries(t).filter(([h,f])=>f!==void 0).map(([h,f])=>[h,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([h,f])=>{d.searchParams.append(h,f)})):(l="POST",c=t);const u=new Headers(this.headers);return i&&u.set("Prefer",`count=${i}`),new Ei.default({method:l,url:d,headers:u,schema:this.schemaName,body:c,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};Ts.default=Ci;var Bt=Ie&&Ie.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Pe,"__esModule",{value:!0});Pe.PostgrestError=Pe.PostgrestBuilder=Pe.PostgrestTransformBuilder=Pe.PostgrestFilterBuilder=Pe.PostgrestQueryBuilder=Pe.PostgrestClient=void 0;const Ia=Bt(Ts);Pe.PostgrestClient=Ia.default;const Fa=Bt($r);Pe.PostgrestQueryBuilder=Fa.default;const La=Bt(ir);Pe.PostgrestFilterBuilder=La.default;const Ua=Bt(Or);Pe.PostgrestTransformBuilder=Ua.default;const Ma=Bt(Rr);Pe.PostgrestBuilder=Ma.default;const Ba=Bt(Ar);Pe.PostgrestError=Ba.default;var Ti=Pe.default={PostgrestClient:Ia.default,PostgrestQueryBuilder:Fa.default,PostgrestFilterBuilder:La.default,PostgrestTransformBuilder:Ua.default,PostgrestBuilder:Ma.default,PostgrestError:Ba.default};const{PostgrestClient:$i,PostgrestQueryBuilder:Ou,PostgrestFilterBuilder:Ru,PostgrestTransformBuilder:Au,PostgrestBuilder:Pu,PostgrestError:Du}=Ti;class Oi{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const s=t.node,n=parseInt(s.replace(/^v/,"").split(".")[0]);return n>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const s=this.getWebSocketConstructor();return new s(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Ri="2.75.1",Ai=`realtime-js/${Ri}`,Pi="1.0.0",ms=1e4,Di=1e3,Ii=100;var Qt;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Qt||(Qt={}));var Ee;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(Ee||(Ee={}));var We;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(We||(We={}));var fs;(function(r){r.websocket="websocket"})(fs||(fs={}));var yt;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(yt||(yt={}));class Fi{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const n=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const l=s.decode(e.slice(o,o+n));o=o+n;const d=s.decode(e.slice(o,o+i));o=o+i;const c=JSON.parse(s.decode(e.slice(o,e.byteLength)));return{ref:null,topic:l,event:d,payload:c}}}class Wa{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var we;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(we||(we={}));const Hs=(r,e,t={})=>{var s;const n=(s=t.skipTypes)!==null&&s!==void 0?s:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=Li(o,r,e,n),i),{}):{}},Li=(r,e,t,s)=>{const n=e.find(l=>l.name===r),i=n==null?void 0:n.type,o=t[r];return i&&!s.includes(i)?za(i,o):gs(o)},za=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return Wi(e,t)}switch(r){case we.bool:return Ui(e);case we.float4:case we.float8:case we.int2:case we.int4:case we.int8:case we.numeric:case we.oid:return Mi(e);case we.json:case we.jsonb:return Bi(e);case we.timestamp:return zi(e);case we.abstime:case we.date:case we.daterange:case we.int4range:case we.int8range:case we.money:case we.reltime:case we.text:case we.time:case we.timestamptz:case we.timetz:case we.tsrange:case we.tstzrange:return gs(e);default:return gs(e)}},gs=r=>r,Ui=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},Mi=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},Bi=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},Wi=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i;const o=r.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>za(e,l))}return r},zi=r=>typeof r=="string"?r.replace(" ","T"):r,Va=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Kr{constructor(e,t,s={},n=ms){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ks;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Ks||(Ks={}));class Xt{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Xt.syncState(this.state,n,i,o),this.pendingDiffs.forEach(d=>{this.state=Xt.syncDiff(this.state,d,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(s.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Xt.syncDiff(this.state,n,i,o),l())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){const i=this.cloneDeep(e),o=this.transformState(t),l={},d={};return this.map(i,(c,u)=>{o[c]||(d[c]=u)}),this.map(o,(c,u)=>{const h=i[c];if(h){const f=u.map(_=>_.presence_ref),x=h.map(_=>_.presence_ref),b=u.filter(_=>x.indexOf(_.presence_ref)<0),N=h.filter(_=>f.indexOf(_.presence_ref)<0);b.length>0&&(l[c]=b),N.length>0&&(d[c]=N)}else l[c]=u}),this.syncDiff(i,{joins:l,leaves:d},s,n)}static syncDiff(e,t,s,n){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(l,d)=>{var c;const u=(c=e[l])!==null&&c!==void 0?c:[];if(e[l]=this.cloneDeep(d),u.length>0){const h=e[l].map(x=>x.presence_ref),f=u.filter(x=>h.indexOf(x.presence_ref)<0);e[l].unshift(...f)}s(l,u,d)}),this.map(o,(l,d)=>{let c=e[l];if(!c)return;const u=d.map(h=>h.presence_ref);c=c.filter(h=>u.indexOf(h.presence_ref)<0),e[l]=c,n(l,c,d),c.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const n=e[s];return"metas"in n?t[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Js;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Js||(Js={}));var Zt;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(Zt||(Zt={}));var Ge;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Ge||(Ge={}));class $s{constructor(e,t={config:{}},s){var n,i;if(this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=Ee.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Kr(this,We.join,this.params,this.timeout),this.rejoinTimer=new Wa(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ee.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ee.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Ee.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ee.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Ee.errored,this.rejoinTimer.scheduleTimeout())}),this._on(We.reply,{},(o,l)=>{this._trigger(this._replyEventName(l),o)}),this.presence=new Xt(this),this.broadcastEndpointURL=Va(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(n=this.params.config)===null||n===void 0?void 0:n.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var s,n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Ee.closed){const{config:{broadcast:o,presence:l,private:d}}=this.params,c=(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(x=>x.filter))!==null&&n!==void 0?n:[],u=!!this.bindings[Zt.PRESENCE]&&this.bindings[Zt.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,h={},f={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:u}),postgres_changes:c,private:d};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(x=>e==null?void 0:e(Ge.CHANNEL_ERROR,x)),this._onClose(()=>e==null?void 0:e(Ge.CLOSED)),this.updateJoinPayload(Object.assign({config:f},h)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:x})=>{var b;if(this.socket.setAuth(),x===void 0){e==null||e(Ge.SUBSCRIBED);return}else{const N=this.bindings.postgres_changes,_=(b=N==null?void 0:N.length)!==null&&b!==void 0?b:0,I=[];for(let k=0;k<_;k++){const E=N[k],{filter:{event:P,schema:W,table:V,filter:A}}=E,g=x&&x[k];if(g&&g.event===P&&g.schema===W&&g.table===V&&g.filter===A)I.push(Object.assign(Object.assign({},E),{id:g.id}));else{this.unsubscribe(),this.state=Ee.errored,e==null||e(Ge.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=I,e&&e(Ge.SUBSCRIBED);return}}).receive("error",x=>{this.state=Ee.errored,e==null||e(Ge.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(x).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Ge.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===Ee.joined&&e===Zt.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}async send(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,d={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=c.body)===null||n===void 0?void 0:n.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,d;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((d=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||d===void 0)&&d.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ee.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(We.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(n=>{s=new Kr(this,We.leave,{},e),s.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ee.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){const n=new AbortController,i=setTimeout(()=>n.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Kr(this,e,t,s);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Ii){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,i;const o=e.toLocaleLowerCase(),{close:l,error:d,leave:c,join:u}=We;if(s&&[l,d,c,u].indexOf(o)>=0&&s!==this._joinRef())return;let f=this._onMessage(o,t,s);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(x=>{var b,N,_;return((b=x.filter)===null||b===void 0?void 0:b.event)==="*"||((_=(N=x.filter)===null||N===void 0?void 0:N.event)===null||_===void 0?void 0:_.toLocaleLowerCase())===o}).map(x=>x.callback(f,s)):(i=this.bindings[o])===null||i===void 0||i.filter(x=>{var b,N,_,I,k,E;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in x){const P=x.id,W=(b=x.filter)===null||b===void 0?void 0:b.event;return P&&((N=t.ids)===null||N===void 0?void 0:N.includes(P))&&(W==="*"||(W==null?void 0:W.toLocaleLowerCase())===((_=t.data)===null||_===void 0?void 0:_.type.toLocaleLowerCase()))}else{const P=(k=(I=x==null?void 0:x.filter)===null||I===void 0?void 0:I.event)===null||k===void 0?void 0:k.toLocaleLowerCase();return P==="*"||P===((E=t==null?void 0:t.event)===null||E===void 0?void 0:E.toLocaleLowerCase())}else return x.type.toLocaleLowerCase()===o}).map(x=>{if(typeof f=="object"&&"ids"in f){const b=f.data,{schema:N,table:_,commit_timestamp:I,type:k,errors:E}=b;f=Object.assign(Object.assign({},{schema:N,table:_,commit_timestamp:I,eventType:k,new:{},old:{},errors:E}),this._getPayloadRecords(b))}x.callback(f,s)})}_isClosed(){return this.state===Ee.closed}_isJoined(){return this.state===Ee.joined}_isJoining(){return this.state===Ee.joining}_isLeaving(){return this.state===Ee.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&$s.isEqual(n.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(We.close,{},e)}_onError(e){this._on(We.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ee.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Hs(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Hs(e.columns,e.old_record)),t}}const Jr=()=>{},fr={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Vi=[1e3,2e3,5e3,1e4],qi=1e4,Hi=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Ki{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ms,this.transport=null,this.heartbeatIntervalMs=fr.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Jr,this.ref=0,this.reconnectTimer=null,this.logger=Jr,this.conn=null,this.sendBuffer=[],this.serializer=new Fi,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>{let i;return n?i=n:typeof fetch>"u"?i=(...o)=>Ut(async()=>{const{default:l}=await Promise.resolve().then(()=>Mt);return{default:l}},void 0).then(({default:l})=>l(...o)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):i=fetch,(...o)=>i(...o)},!(!((s=t==null?void 0:t.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${fs.websocket}`,this.httpEndpoint=Va(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Oi.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Pi}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Qt.connecting:return yt.Connecting;case Qt.open:return yt.Open;case Qt.closing:return yt.Closing;default:return yt.Closed}}isConnected(){return this.connectionState()===yt.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const s=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===s);if(n)return n;{const i=new $s(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:s,payload:n,ref:i}=e,o=()=>{this.encode(e,l=>{var d;(d=this.conn)===null||d===void 0||d.send(l)})};this.log("push",`${t} ${s} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Di,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},fr.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:s,event:n,payload:i,ref:o}=t,l=o?`(${o})`:"",d=i.status||"";this.log("receive",`${d} ${s} ${n} ${l}`.trim(),i),this.channels.filter(c=>c._isMember(s)).forEach(c=>c._trigger(n,i,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(We.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${s}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([Hi],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const n={access_token:t,version:Ai};t&&s.updateJoinPayload(n),s.joinedOnce&&s._isJoined()&&s._push(We.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new Wa(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},fr.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,n,i,o,l,d,c,u;if(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(s=e==null?void 0:e.timeout)!==null&&s!==void 0?s:ms,this.heartbeatIntervalMs=(n=e==null?void 0:e.heartbeatIntervalMs)!==null&&n!==void 0?n:fr.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=e==null?void 0:e.heartbeatCallback)!==null&&l!==void 0?l:Jr,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(d=e==null?void 0:e.reconnectAfterMs)!==null&&d!==void 0?d:h=>Vi[h-1]||qi,this.encode=(c=e==null?void 0:e.encode)!==null&&c!==void 0?c:(h,f)=>f(JSON.stringify(h)),this.decode=(u=e==null?void 0:e.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class Os extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ke(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Ji extends Os{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class ps extends Os{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Gi=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(s.next(u))}catch(h){o(h)}}function d(u){try{c(s.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,d)}c((s=s.apply(r,e||[])).next())})};const qa=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Ut(async()=>{const{default:s}=await Promise.resolve().then(()=>Mt);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Yi=()=>Gi(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ut(()=>Promise.resolve().then(()=>Mt),void 0)).Response:Response}),xs=r=>{if(Array.isArray(r))return r.map(t=>xs(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=xs(s)}),e},Qi=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};var _t=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(s.next(u))}catch(h){o(h)}}function d(u){try{c(s.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,d)}c((s=s.apply(r,e||[])).next())})};const Gr=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Xi=(r,e,t)=>_t(void 0,void 0,void 0,function*(){const s=yield Yi();r instanceof s&&!(t!=null&&t.noResolveJson)?r.json().then(n=>{const i=r.status||500,o=(n==null?void 0:n.statusCode)||i+"";e(new Ji(Gr(n),i,o))}).catch(n=>{e(new ps(Gr(n),n))}):e(new ps(Gr(r),r))}),Zi=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"||!s?n:(Qi(s)?(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),n.body=JSON.stringify(s)):n.body=s,e!=null&&e.duplex&&(n.duplex=e.duplex),Object.assign(Object.assign({},n),t))};function or(r,e,t,s,n,i){return _t(this,void 0,void 0,function*(){return new Promise((o,l)=>{r(t,Zi(e,s,n,i)).then(d=>{if(!d.ok)throw d;return s!=null&&s.noResolveJson?d:d.json()}).then(d=>o(d)).catch(d=>Xi(d,l,s))})})}function _r(r,e,t,s){return _t(this,void 0,void 0,function*(){return or(r,"GET",e,t,s)})}function Ke(r,e,t,s,n){return _t(this,void 0,void 0,function*(){return or(r,"POST",e,s,n,t)})}function ys(r,e,t,s,n){return _t(this,void 0,void 0,function*(){return or(r,"PUT",e,s,n,t)})}function eo(r,e,t,s){return _t(this,void 0,void 0,function*(){return or(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function Ha(r,e,t,s,n){return _t(this,void 0,void 0,function*(){return or(r,"DELETE",e,s,n,t)})}var to=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(s.next(u))}catch(h){o(h)}}function d(u){try{c(s.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,d)}c((s=s.apply(r,e||[])).next())})};class ro{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return to(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ke(e))return{data:null,error:e};throw e}})}}var so=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(s.next(u))}catch(h){o(h)}}function d(u){try{c(s.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,d)}c((s=s.apply(r,e||[])).next())})},Ka;class ao{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[Ka]="BlobDownloadBuilder",this.promise=null}asStream(){return new ro(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return so(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ke(e))return{data:null,error:e};throw e}})}}Ka=Symbol.toStringTag;var Re=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(s.next(u))}catch(h){o(h)}}function d(u){try{c(s.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,d)}c((s=s.apply(r,e||[])).next())})};const no={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Gs={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class io{constructor(e,t={},s,n){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=s,this.fetch=qa(n)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,s,n){return Re(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Gs),n);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const d=o.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),d&&i.append("metadata",this.encodeMetadata(d)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",o.cacheControl),d&&i.append("metadata",this.encodeMetadata(d))):(i=s,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,d&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(d)))),n!=null&&n.headers&&(l=Object.assign(Object.assign({},l),n.headers));const c=this._removeEmptyFolders(t),u=this._getFinalPath(c),h=yield(e=="PUT"?ys:Ke)(this.fetch,`${this.url}/object/${u}`,i,Object.assign({headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:c,id:h.Id,fullPath:h.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(ke(i))return{data:null,error:i};throw i}})}upload(e,t,s){return Re(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,n){return Re(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",t);try{let d;const c=Object.assign({upsert:Gs.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&s instanceof Blob?(d=new FormData,d.append("cacheControl",c.cacheControl),d.append("",s)):typeof FormData<"u"&&s instanceof FormData?(d=s,d.append("cacheControl",c.cacheControl)):(d=s,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const h=yield ys(this.fetch,l.toString(),d,{headers:u});return{data:{path:i,fullPath:h.Key},error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(ke(d))return{data:null,error:d};throw d}})}createSignedUploadUrl(e,t){return Re(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield Ke(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:n}),o=new URL(this.url+i.url),l=o.searchParams.get("token");if(!l)throw new Os("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:l},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ke(s))return{data:null,error:s};throw s}})}update(e,t,s){return Re(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return Re(this,void 0,void 0,function*(){try{return{data:yield Ke(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ke(n))return{data:null,error:n};throw n}})}copy(e,t,s){return Re(this,void 0,void 0,function*(){try{return{data:{path:(yield Ke(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ke(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,s){return Re(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield Ke(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const o=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ke(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,s){return Re(this,void 0,void 0,function*(){try{const n=yield Ke(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ke(n))return{data:null,error:n};throw n}})}download(e,t){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"",l=this._getFinalPath(e),d=()=>_r(this.fetch,`${this.url}/${n}/${l}${o}`,{headers:this.headers,noResolveJson:!0});return new ao(d,this.shouldThrowOnError)}info(e){return Re(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield _r(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:xs(s),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ke(s))return{data:null,error:s};throw s}})}exists(e){return Re(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield eo(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ke(s)&&s instanceof ps){const n=s.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const l=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",d=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});d!==""&&n.push(d);let c=n.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${s}${c}`)}}}remove(e){return Re(this,void 0,void 0,function*(){try{return{data:yield Ha(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ke(t))return{data:null,error:t};throw t}})}list(e,t,s){return Re(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},no),t),{prefix:e||""});return{data:yield Ke(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ke(n))return{data:null,error:n};throw n}})}listV2(e,t){return Re(this,void 0,void 0,function*(){try{const s=Object.assign({},e);return{data:yield Ke(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ke(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const oo="2.75.1",lo={"X-Client-Info":`storage-js/${oo}`};var St=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(s.next(u))}catch(h){o(h)}}function d(u){try{c(s.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,d)}c((s=s.apply(r,e||[])).next())})};class co{constructor(e,t={},s,n){this.shouldThrowOnError=!1;const i=new URL(e);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},lo),t),this.fetch=qa(s)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return St(this,void 0,void 0,function*(){try{return{data:yield _r(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ke(e))return{data:null,error:e};throw e}})}getBucket(e){return St(this,void 0,void 0,function*(){try{return{data:yield _r(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ke(t))return{data:null,error:t};throw t}})}createBucket(e){return St(this,arguments,void 0,function*(t,s={public:!1}){try{return{data:yield Ke(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ke(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return St(this,void 0,void 0,function*(){try{return{data:yield ys(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ke(s))return{data:null,error:s};throw s}})}emptyBucket(e){return St(this,void 0,void 0,function*(){try{return{data:yield Ke(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ke(t))return{data:null,error:t};throw t}})}deleteBucket(e){return St(this,void 0,void 0,function*(){try{return{data:yield Ha(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ke(t))return{data:null,error:t};throw t}})}}class uo extends co{constructor(e,t={},s,n){super(e,t,s,n)}from(e){return new io(this.url,this.headers,e,this.fetch)}}const ho="2.75.1";let Yt="";typeof Deno<"u"?Yt="deno":typeof document<"u"?Yt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Yt="react-native":Yt="node";const mo={"X-Client-Info":`supabase-js-${Yt}/${ho}`},fo={headers:mo},go={schema:"public"},po={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},xo={};var yo=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(s.next(u))}catch(h){o(h)}}function d(u){try{c(s.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,d)}c((s=s.apply(r,e||[])).next())})};const bo=r=>{let e;return r?e=r:typeof fetch>"u"?e=Oa:e=fetch,(...t)=>e(...t)},vo=()=>typeof Headers>"u"?Ra:Headers,wo=(r,e,t)=>{const s=bo(t),n=vo();return(i,o)=>yo(void 0,void 0,void 0,function*(){var l;const d=(l=yield e())!==null&&l!==void 0?l:r;let c=new n(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",r),c.has("Authorization")||c.set("Authorization",`Bearer ${d}`),s(i,Object.assign(Object.assign({},o),{headers:c}))})};var jo=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(s.next(u))}catch(h){o(h)}}function d(u){try{c(s.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,d)}c((s=s.apply(r,[])).next())})};function _o(r){return r.endsWith("/")?r:r+"/"}function No(r,e){var t,s;const{db:n,auth:i,realtime:o,global:l}=r,{db:d,auth:c,realtime:u,global:h}=e,f={db:Object.assign(Object.assign({},d),n),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},u),o),storage:{},global:Object.assign(Object.assign(Object.assign({},h),l),{headers:Object.assign(Object.assign({},(t=h==null?void 0:h.headers)!==null&&t!==void 0?t:{}),(s=l==null?void 0:l.headers)!==null&&s!==void 0?s:{})}),accessToken:()=>jo(this,void 0,void 0,function*(){return""})};return r.accessToken?f.accessToken=r.accessToken:delete f.accessToken,f}function So(r){const e=r==null?void 0:r.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(_o(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const Ja="2.75.1",Rt=30*1e3,bs=3,Yr=bs*Rt,ko="http://localhost:9999",Eo="supabase.auth.token",Co={"X-Client-Info":`gotrue-js/${Ja}`},vs="X-Supabase-Api-Version",Ga={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},To=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,$o=10*60*1e3;class sr extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function se(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Oo extends sr{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function Ro(r){return se(r)&&r.name==="AuthApiError"}class bt extends sr{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class dt extends sr{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}}class st extends dt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Ao(r){return se(r)&&r.name==="AuthSessionMissingError"}class kt extends dt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class gr extends dt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class pr extends dt{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Po(r){return se(r)&&r.name==="AuthImplicitGrantRedirectError"}class Ys extends dt{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ws extends dt{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Qr(r){return se(r)&&r.name==="AuthRetryableFetchError"}class Qs extends dt{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class js extends dt{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Nr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Xs=` 	
\r=`.split(""),Do=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<Xs.length;e+=1)r[Xs[e].charCodeAt(0)]=-2;for(let e=0;e<Nr.length;e+=1)r[Nr[e].charCodeAt(0)]=e;return r})();function Zs(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(Nr[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(Nr[s]),e.queuedBits-=6}}function Ya(r,e,t){const s=Do[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function ea(r){const e=[],t=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{Lo(o,s,t)};for(let o=0;o<r.length;o+=1)Ya(r.charCodeAt(o),n,i);return e.join("")}function Io(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function Fo(r,e){for(let t=0;t<r.length;t+=1){let s=r.charCodeAt(t);if(s>55295&&s<=56319){const n=(s-55296)*1024&65535;s=(r.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}Io(s,e)}}function Lo(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let s=1;s<6;s+=1)if(!(r>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function It(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};for(let n=0;n<r.length;n+=1)Ya(r.charCodeAt(n),t,s);return new Uint8Array(e)}function Uo(r){const e=[];return Fo(r,t=>e.push(t)),new Uint8Array(e)}function vt(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};return r.forEach(n=>Zs(n,t,s)),Zs(null,t,s),e.join("")}function Mo(r){return Math.round(Date.now()/1e3)+r}function Bo(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const De=()=>typeof window<"u"&&typeof document<"u",mt={tested:!1,writable:!1},Qa=()=>{if(!De())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(mt.tested)return mt.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),mt.tested=!0,mt.writable=!0}catch{mt.tested=!0,mt.writable=!1}return mt.writable};function Wo(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((s,n)=>{e[n]=s}),e}const Xa=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Ut(async()=>{const{default:s}=await Promise.resolve().then(()=>Mt);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},zo=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",At=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},ft=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},tt=async(r,e)=>{await r.removeItem(e)};class Pr{constructor(){this.promise=new Pr.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Pr.promiseConstructor=Promise;function Xr(r){const e=r.split(".");if(e.length!==3)throw new js("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!To.test(e[s]))throw new js("JWT not in base64url format");return{header:JSON.parse(ea(e[0])),payload:JSON.parse(ea(e[1])),signature:It(e[2]),raw:{header:e[0],payload:e[1]}}}async function Vo(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function qo(r,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await r(i);if(!e(i,null,o)){s(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function Ho(r){return("0"+r.toString(16)).substr(-2)}function Ko(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,Ho).join("")}async function Jo(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function Go(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await Jo(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Et(r,e,t=!1){const s=Ko();let n=s;t&&(n+="/PASSWORD_RECOVERY"),await At(r,`${e}-code-verifier`,n);const i=await Go(s);return[i,s===i?"plain":"s256"]}const Yo=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Qo(r){const e=r.headers.get(vs);if(!e||!e.match(Yo))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Xo(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function Zo(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const el=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ct(r){if(!el.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Zr(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const s=t.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function ta(r){return JSON.parse(JSON.stringify(r))}var tl=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};const pt=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),rl=[502,503,504];async function ra(r){var e;if(!zo(r))throw new ws(pt(r),0);if(rl.includes(r.status))throw new ws(pt(r),r.status);let t;try{t=await r.json()}catch(i){throw new bt(pt(i),i)}let s;const n=Qo(r);if(n&&n.getTime()>=Ga["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new Qs(pt(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new st}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Qs(pt(t),r.status,t.weak_password.reasons);throw new Oo(pt(t),r.status||500,s)}const sl=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),t))};async function ne(r,e,t,s){var n;const i=Object.assign({},s==null?void 0:s.headers);i[vs]||(i[vs]=Ga["2024-01-01"].name),s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const o=(n=s==null?void 0:s.query)!==null&&n!==void 0?n:{};s!=null&&s.redirectTo&&(o.redirect_to=s.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",d=await al(r,e,t+l,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(d):{data:Object.assign({},d),error:null}}async function al(r,e,t,s,n,i){const o=sl(e,s,n,i);let l;try{l=await r(t,Object.assign({},o))}catch(d){throw console.error(d),new ws(pt(d),0)}if(l.ok||await ra(l),s!=null&&s.noResolveJson)return l;try{return await l.json()}catch(d){await ra(d)}}function Be(r){var e;let t=null;ol(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=Mo(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function sa(r){const e=Be(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function it(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function nl(r){return{data:r,error:null}}function il(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i}=r,o=tl(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i},d=Object.assign({},o);return{data:{properties:l,user:d},error:null}}function aa(r){return r}function ol(r){return r.access_token&&r.refresh_token&&r.expires_in}const es=["global","local","others"];var ll=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};class cl{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Xa(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=es[0]){if(es.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${es.join(", ")}`);try{return await ne(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(se(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await ne(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:it})}catch(s){if(se(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=ll(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=s==null?void 0:s.newEmail,delete n.newEmail),await ne(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:il,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(se(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await ne(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:it})}catch(t){if(se(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,n,i,o,l,d;try{const c={nextPage:null,lastPage:0,total:0},u=await ne(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:aa});if(u.error)throw u.error;const h=await u.json(),f=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,x=(d=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&d!==void 0?d:[];return x.length>0&&(x.forEach(b=>{const N=parseInt(b.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(b.split(";")[1].split("=")[1]);c[`${_}Page`]=N}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(se(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){Ct(e);try{return await ne(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:it})}catch(t){if(se(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Ct(e);try{return await ne(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:it})}catch(s){if(se(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){Ct(e);try{return await ne(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:it})}catch(s){if(se(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){Ct(e.userId);try{const{data:t,error:s}=await ne(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:s}}catch(t){if(se(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Ct(e.userId),Ct(e.id);try{return{data:await ne(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(se(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,s,n,i,o,l,d;try{const c={nextPage:null,lastPage:0,total:0},u=await ne(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:aa});if(u.error)throw u.error;const h=await u.json(),f=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,x=(d=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&d!==void 0?d:[];return x.length>0&&(x.forEach(b=>{const N=parseInt(b.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(b.split(";")[1].split("=")[1]);c[`${_}Page`]=N}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(se(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(e){try{return await ne(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(se(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await ne(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(se(t))return{data:null,error:t};throw t}}async _deleteOAuthClient(e){try{return await ne(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(se(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await ne(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(se(t))return{data:null,error:t};throw t}}}function na(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}const Tt={debug:!!(globalThis&&Qa()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Za extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class dl extends Za{}async function ul(r,e,t){Tt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),Tt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){Tt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{Tt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw Tt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new dl(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Tt.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function hl(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function en(r){if(!/^0x[a-fA-F0-9]{40}$/.test(r))throw new Error(`@supabase/auth-js: Address "${r}" is invalid.`);return r.toLowerCase()}function ml(r){return parseInt(r,16)}function fl(r){const e=new TextEncoder().encode(r);return"0x"+Array.from(e,s=>s.toString(16).padStart(2,"0")).join("")}function gl(r){var e;const{chainId:t,domain:s,expirationTime:n,issuedAt:i=new Date,nonce:o,notBefore:l,requestId:d,resources:c,scheme:u,uri:h,version:f}=r;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(f!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${f}`);if(!((e=r.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${r.statement}`)}const x=en(r.address),b=u?`${u}://${s}`:s,N=r.statement?`${r.statement}
`:"",_=`${b} wants you to sign in with your Ethereum account:
${x}

${N}`;let I=`URI: ${h}
Version: ${f}
Chain ID: ${t}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(n&&(I+=`
Expiration Time: ${n.toISOString()}`),l&&(I+=`
Not Before: ${l.toISOString()}`),d&&(I+=`
Request ID: ${d}`),c){let k=`
Resources:`;for(const E of c){if(!E||typeof E!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${E}`);k+=`
- ${E}`}I+=k}return`${_}
${I}`}class Se extends Error{constructor({message:e,code:t,cause:s,name:n}){var i;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=(i=n??(s instanceof Error?s.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=t}}class Sr extends Se{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function pl({error:r,options:e}){var t,s,n;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Se({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else if(r.name==="ConstraintError"){if(((t=i.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new Se({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:r});if(e.mediation==="conditional"&&((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Se({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:r});if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Se({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:r})}else{if(r.name==="InvalidStateError")return new Se({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:r});if(r.name==="NotAllowedError")return new Se({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="NotSupportedError")return i.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?new Se({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:r}):new Se({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:r});if(r.name==="SecurityError"){const o=window.location.hostname;if(rn(o)){if(i.rp.id!==o)return new Se({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new Se({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Se({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:r})}else if(r.name==="UnknownError")return new Se({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new Se({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}function xl({error:r,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Se({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else{if(r.name==="NotAllowedError")return new Se({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="SecurityError"){const s=window.location.hostname;if(rn(s)){if(t.rpId!==s)return new Se({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new Se({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="UnknownError")return new Se({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new Se({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}var tn=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};class yl{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const bl=new yl;function vl(r){if(!r)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(r);const{challenge:e,user:t,excludeCredentials:s}=r,n=tn(r,["challenge","user","excludeCredentials"]),i=It(e).buffer,o=Object.assign(Object.assign({},t),{id:It(t.id).buffer}),l=Object.assign(Object.assign({},n),{challenge:i,user:o});if(s&&s.length>0){l.excludeCredentials=new Array(s.length);for(let d=0;d<s.length;d++){const c=s[d];l.excludeCredentials[d]=Object.assign(Object.assign({},c),{id:It(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return l}function wl(r){if(!r)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(r);const{challenge:e,allowCredentials:t}=r,s=tn(r,["challenge","allowCredentials"]),n=It(e).buffer,i=Object.assign(Object.assign({},s),{challenge:n});if(t&&t.length>0){i.allowCredentials=new Array(t.length);for(let o=0;o<t.length;o++){const l=t[o];i.allowCredentials[o]=Object.assign(Object.assign({},l),{id:It(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return i}function jl(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r;return{id:r.id,rawId:r.id,response:{attestationObject:vt(new Uint8Array(r.response.attestationObject)),clientDataJSON:vt(new Uint8Array(r.response.clientDataJSON))},type:"public-key",clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function _l(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r,s=r.getClientExtensionResults(),n=r.response;return{id:r.id,rawId:r.id,response:{authenticatorData:vt(new Uint8Array(n.authenticatorData)),clientDataJSON:vt(new Uint8Array(n.clientDataJSON)),signature:vt(new Uint8Array(n.signature)),userHandle:n.userHandle?vt(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function rn(r){return r==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(r)}function ia(){var r,e;return!!(De()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((r=navigator==null?void 0:navigator.credentials)===null||r===void 0?void 0:r.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function Nl(r){try{const e=await navigator.credentials.create(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Sr("Browser returned unexpected credential type",e)}:{data:null,error:new Sr("Empty credential response",e)}}catch(e){return{data:null,error:pl({error:e,options:r})}}}async function Sl(r){try{const e=await navigator.credentials.get(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Sr("Browser returned unexpected credential type",e)}:{data:null,error:new Sr("Empty credential response",e)}}catch(e){return{data:null,error:xl({error:e,options:r})}}}const kl={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},El={userVerification:"preferred",hints:["security-key"]};function kr(...r){const e=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),t=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),s={};for(const n of r)if(n)for(const i in n){const o=n[i];if(o!==void 0)if(Array.isArray(o))s[i]=o;else if(t(o))s[i]=o;else if(e(o)){const l=s[i];e(l)?s[i]=kr(l,o):s[i]=kr(o)}else s[i]=o}return s}function Cl(r,e){return kr(kl,r,e||{})}function Tl(r,e){return kr(El,r,e||{})}class $l{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:s,signal:n},i){try{const{data:o,error:l}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!o)return{data:null,error:l};const d=n??bl.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:c}=o.webauthn.credential_options.publicKey;c.name||(c.name=`${c.id}:${s}`),c.displayName||(c.displayName=c.name)}switch(o.webauthn.type){case"create":{const c=Cl(o.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:u,error:h}=await Nl({publicKey:c,signal:d});return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}case"request":{const c=Tl(o.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:u,error:h}=await Sl(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:c,signal:d}));return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}}}catch(o){return se(o)?{data:null,error:o}:{data:null,error:new bt("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:t,webauthn:s}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}},i){if(!t)return{data:null,error:new sr("rpId is required for WebAuthn authentication")};try{if(!ia())return{data:null,error:new bt("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:s},signal:n},{request:i});if(!o)return{data:null,error:l};const{webauthn:d}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:d.type,rpId:t,rpOrigins:s,credential_response:d.credential_response}})}catch(o){return se(o)?{data:null,error:o}:{data:null,error:new bt("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n},i){if(!t)return{data:null,error:new sr("rpId is required for WebAuthn registration")};try{if(!ia())return{data:null,error:new bt("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(u=>{var h;return(h=u.data)===null||h===void 0?void 0:h.all.find(f=>f.factor_type==="webauthn"&&f.friendly_name===e&&f.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u==null?void 0:u.id}):void 0),{data:null,error:l};const{data:d,error:c}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:t,rpOrigins:s},signal:n},{create:i});return d?this._verify({factorId:o.id,challengeId:d.challengeId,webauthn:{rpId:t,rpOrigins:s,type:d.webauthn.type,credential_response:d.webauthn.credential_response}}):{data:null,error:c}}catch(o){return se(o)?{data:null,error:o}:{data:null,error:new bt("Unexpected error in register",o)}}}}hl();const Ol={url:ko,storageKey:Eo,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Co,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function oa(r,e,t){return await t()}const $t={};class ar{get jwks(){var e,t;return(t=(e=$t[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){$t[this.storageKey]=Object.assign(Object.assign({},$t[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=$t[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){$t[this.storageKey]=Object.assign(Object.assign({},$t[this.storageKey]),{cachedAt:e})}constructor(e){var t,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ar.nextInstanceID,ar.nextInstanceID+=1,this.instanceID>0&&De()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},Ol),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new cl({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Xa(n.fetch),this.lock=n.lock||oa,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:De()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=ul:this.lock=oa,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new $l(this)},this.persistSession?(n.storage?this.storage=n.storage:Qa()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=na(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=na(this.memoryStorage)),De()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Ja}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Wo(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),De()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Po(i)){const d=(e=i.details)===null||e===void 0?void 0:e.code;if(d==="identity_already_exists"||d==="identity_not_found"||d==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:l}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return se(t)?{error:t}:{error:new bt("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,n;try{const i=await ne(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:Be}),{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const d=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",d)),{data:{user:c,session:d},error:null}}catch(i){if(se(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,n;try{let i;if("email"in e){const{email:u,password:h,options:f}=e;let x=null,b=null;this.flowType==="pkce"&&([x,b]=await Et(this.storage,this.storageKey)),i=await ne(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:u,password:h,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:x,code_challenge_method:b},xform:Be})}else if("phone"in e){const{phone:u,password:h,options:f}=e;i=await ne(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(s=f==null?void 0:f.data)!==null&&s!==void 0?s:{},channel:(n=f==null?void 0:f.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:Be})}else throw new gr("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const d=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",d)),{data:{user:c,session:d},error:null}}catch(i){if(se(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:l}=e;t=await ne(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:sa})}else if("phone"in e){const{phone:i,password:o,options:l}=e;t=await ne(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:sa})}else throw new gr("You must provide either an email or phone number and a password");const{data:s,error:n}=t;return n?{data:{user:null,session:null},error:n}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new kt}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(t){if(se(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,s,n,i,o,l,d,c,u,h,f;let x,b;if("message"in e)x=e.message,b=e.signature;else{const{chain:N,wallet:_,statement:I,options:k}=e;let E;if(De())if(typeof _=="object")E=_;else{const m=window;if("ethereum"in m&&typeof m.ethereum=="object"&&"request"in m.ethereum&&typeof m.ethereum.request=="function")E=m.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof _!="object"||!(k!=null&&k.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=_}const P=new URL((t=k==null?void 0:k.url)!==null&&t!==void 0?t:window.location.href),W=await E.request({method:"eth_requestAccounts"}).then(m=>m).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!W||W.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const V=en(W[0]);let A=(s=k==null?void 0:k.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!A){const m=await E.request({method:"eth_chainId"});A=ml(m)}const g={domain:P.host,address:V,statement:I,uri:P.href,version:"1",chainId:A,nonce:(n=k==null?void 0:k.signInWithEthereum)===null||n===void 0?void 0:n.nonce,issuedAt:(o=(i=k==null?void 0:k.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(l=k==null?void 0:k.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(d=k==null?void 0:k.signInWithEthereum)===null||d===void 0?void 0:d.notBefore,requestId:(c=k==null?void 0:k.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(u=k==null?void 0:k.signInWithEthereum)===null||u===void 0?void 0:u.resources};x=gl(g),b=await E.request({method:"personal_sign",params:[fl(x),V]})}try{const{data:N,error:_}=await ne(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:x,signature:b},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:Be});if(_)throw _;return!N||!N.session||!N.user?{data:{user:null,session:null},error:new kt}:(N.session&&(await this._saveSession(N.session),await this._notifyAllSubscribers("SIGNED_IN",N.session)),{data:Object.assign({},N),error:_})}catch(N){if(se(N))return{data:{user:null,session:null},error:N};throw N}}async signInWithSolana(e){var t,s,n,i,o,l,d,c,u,h,f,x;let b,N;if("message"in e)b=e.message,N=e.signature;else{const{chain:_,wallet:I,statement:k,options:E}=e;let P;if(De())if(typeof I=="object")P=I;else{const V=window;if("solana"in V&&typeof V.solana=="object"&&("signIn"in V.solana&&typeof V.solana.signIn=="function"||"signMessage"in V.solana&&typeof V.solana.signMessage=="function"))P=V.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof I!="object"||!(E!=null&&E.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");P=I}const W=new URL((t=E==null?void 0:E.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in P&&P.signIn){const V=await P.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},E==null?void 0:E.signInWithSolana),{version:"1",domain:W.host,uri:W.href}),k?{statement:k}:null));let A;if(Array.isArray(V)&&V[0]&&typeof V[0]=="object")A=V[0];else if(V&&typeof V=="object"&&"signedMessage"in V&&"signature"in V)A=V;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in A&&"signature"in A&&(typeof A.signedMessage=="string"||A.signedMessage instanceof Uint8Array)&&A.signature instanceof Uint8Array)b=typeof A.signedMessage=="string"?A.signedMessage:new TextDecoder().decode(A.signedMessage),N=A.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in P)||typeof P.signMessage!="function"||!("publicKey"in P)||typeof P!="object"||!P.publicKey||!("toBase58"in P.publicKey)||typeof P.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");b=[`${W.host} wants you to sign in with your Solana account:`,P.publicKey.toBase58(),...k?["",k,""]:[""],"Version: 1",`URI: ${W.href}`,`Issued At: ${(n=(s=E==null?void 0:E.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=E==null?void 0:E.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${E.signInWithSolana.notBefore}`]:[],...!((o=E==null?void 0:E.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${E.signInWithSolana.expirationTime}`]:[],...!((l=E==null?void 0:E.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${E.signInWithSolana.chainId}`]:[],...!((d=E==null?void 0:E.signInWithSolana)===null||d===void 0)&&d.nonce?[`Nonce: ${E.signInWithSolana.nonce}`]:[],...!((c=E==null?void 0:E.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${E.signInWithSolana.requestId}`]:[],...!((h=(u=E==null?void 0:E.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...E.signInWithSolana.resources.map(A=>`- ${A}`)]:[]].join(`
`);const V=await P.signMessage(new TextEncoder().encode(b),"utf8");if(!V||!(V instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");N=V}}try{const{data:_,error:I}=await ne(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:b,signature:vt(N)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(x=e.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:Be});if(I)throw I;return!_||!_.session||!_.user?{data:{user:null,session:null},error:new kt}:(_.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),{data:Object.assign({},_),error:I})}catch(_){if(se(_))return{data:{user:null,session:null},error:_};throw _}}async _exchangeCodeForSession(e){const t=await ft(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(t??"").split("/");try{const{data:i,error:o}=await ne(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Be});if(await tt(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new kt}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(se(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:n,access_token:i,nonce:o}=e,l=await ne(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Be}),{data:d,error:c}=l;return c?{data:{user:null,session:null},error:c}:!d||!d.session||!d.user?{data:{user:null,session:null},error:new kt}:(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",d.session)),{data:d,error:c})}catch(t){if(se(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,n,i,o;try{if("email"in e){const{email:l,options:d}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await Et(this.storage,this.storageKey));const{error:h}=await ne(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},create_user:(s=d==null?void 0:d.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:d==null?void 0:d.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:l,options:d}=e,{data:c,error:u}=await ne(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(n=d==null?void 0:d.data)!==null&&n!==void 0?n:{},create_user:(i=d==null?void 0:d.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},channel:(o=d==null?void 0:d.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u}}throw new gr("You must provide either an email or phone number.")}catch(l){if(se(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var t,s;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:l}=await ne(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:Be});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const d=o.session,c=o.user;return d!=null&&d.access_token&&(await this._saveSession(d),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",d)),{data:{user:c,session:d},error:null}}catch(n){if(se(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,s,n;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await Et(this.storage,this.storageKey)),await ne(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:nl})}catch(i){if(se(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new st;const{error:n}=await ne(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(se(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:i}=e,{error:o}=await ne(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:s,type:n,options:i}=e,{data:o,error:l}=await ne(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l}}throw new gr("You must provide either an email or phone number and a type")}catch(t){if(se(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await ft(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Yr:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const o=await ft(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=Zr()}if(this.storage.isServer&&e.user){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(d,c,u)=>(!o&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(d,c,u))})}return{data:{session:e},error:null}}const{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await ne(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:it}):await this._useSession(async t=>{var s,n,i;const{data:o,error:l}=t;if(l)throw l;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new st}:await ne(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:it})})}catch(t){if(se(t))return Ao(t)&&(await this._removeSession(),await tt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new st;const o=n.session;let l=null,d=null;this.flowType==="pkce"&&e.email!=null&&([l,d]=await Et(this.storage,this.storageKey));const{data:c,error:u}=await ne(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:d}),jwt:o.access_token,xform:it});if(u)throw u;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(s){if(se(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new st;const t=Date.now()/1e3;let s=t,n=!0,i=null;const{payload:o}=Xr(e.access_token);if(o.exp&&(s=o.exp,n=s<=t),n){const{data:l,error:d}=await this._callRefreshToken(e.refresh_token);if(d)return{data:{user:null,session:null},error:d};if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:d}=await this._getUser(e.access_token);if(d)throw d;i={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(se(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:o,error:l}=t;if(l)throw l;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new st;const{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(se(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!De())throw new pr("No browser detected.");if(e.error||e.error_description||e.error_code)throw new pr(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Ys("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new pr("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ys("No code detected.");const{data:k,error:E}=await this._exchangeCodeForSession(e.code);if(E)throw E;const P=new URL(window.location.href);return P.searchParams.delete("code"),window.history.replaceState(window.history.state,"",P.toString()),{data:{session:k.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:l,expires_at:d,token_type:c}=e;if(!i||!l||!o||!c)throw new pr("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(l);let f=u+h;d&&(f=parseInt(d));const x=f-u;x*1e3<=Rt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${x}s, should have been closer to ${h}s`);const b=f-h;u-b>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",b,f,u):u-b<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",b,f,u);const{data:N,error:_}=await this._getUser(i);if(_)throw _;const I={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:f,refresh_token:o,token_type:c,user:N.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:I,redirectType:e.type},error:null}}catch(s){if(se(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await ft(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{error:i};const o=(s=n.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(Ro(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await tt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Bo(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,n;try{const{data:{session:i},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await Et(this.storage,this.storageKey,!0));try{return await ne(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(se(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(se(t))return{data:null,error:t};throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:s,error:n}=await this._useSession(async i=>{var o,l,d,c,u;const{data:h,error:f}=i;if(f)throw f;const x=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(d=e.options)===null||d===void 0?void 0:d.queryParams,skipBrowserRedirect:!0});return await ne(this.fetch,"GET",x,{headers:this.headers,jwt:(u=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return De()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(se(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var s;try{const{error:n,data:{session:i}}=t;if(n)throw n;const{options:o,provider:l,token:d,access_token:c,nonce:u}=e,h=await ne(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=i==null?void 0:i.access_token)!==null&&s!==void 0?s:void 0,body:{provider:l,id_token:d,access_token:c,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Be}),{data:f,error:x}=h;return x?{data:{user:null,session:null},error:x}:!f||!f.session||!f.user?{data:{user:null,session:null},error:new kt}:(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("USER_UPDATED",f.session)),{data:f,error:x})}catch(n){if(se(n))return{data:{user:null,session:null},error:n};throw n}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)throw o;return await ne(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(se(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await qo(async n=>(n>0&&await Vo(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await ne(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Be})),(n,i)=>{const o=200*Math.pow(2,n);return i&&Qr(i)&&Date.now()+o-s<Rt})}catch(s){if(this._debug(t,"error",s),se(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),De()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const n=await ft(this.storage,this.storageKey);if(n&&this.userStorage){let o=await ft(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},await At(this.userStorage,this.storageKey+"-user",o)),n.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:Zr()}else if(n&&!n.user&&!n.user){const o=await ft(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(n.user=o.user,await tt(this.storage,this.storageKey+"-user"),await At(this.storage,this.storageKey,n)):n.user=Zr()}if(this._debug(s,"session from storage",n),!this._isValidSession(n)){this._debug(s,"session is not valid"),n!==null&&await this._removeSession();return}const i=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Yr;if(this._debug(s,`session has${i?"":" not"} expired with margin of ${Yr}s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),Qr(o)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(n.access_token);!l&&(o!=null&&o.user)?(n.user=o.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(s,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(s,"error",n),console.error(n);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new st;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Pr;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new st;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={data:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(n,"error",i),se(i)){const o={data:null,error:i};return Qr(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(d){i.push(d)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&t.user&&await At(this.userStorage,this.storageKey+"-user",{user:t.user});const n=Object.assign({},t);delete n.user;const i=ta(n);await At(this.storage,this.storageKey,i)}else{const n=ta(t);await At(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),await tt(this.storage,this.storageKey),await tt(this.storage,this.storageKey+"-code-verifier"),await tt(this.storage,this.storageKey+"-user"),this.userStorage&&await tt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&De()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Rt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/Rt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${Rt}ms, refresh threshold is ${bs} ticks`),n<=bs&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Za)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!De()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const n=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,o]=await Et(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(l.toString())}if(s!=null&&s.queryParams){const i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s!=null&&s.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await ne(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(se(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:d,error:c}=await ne(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&d.type==="totp"&&(!((n=d==null?void 0:d.totp)===null||n===void 0)&&n.qr_code)&&(d.totp.qr_code=`data:image/svg+xml;utf-8,${d.totp.qr_code}`),{data:d,error:null})})}catch(t){if(se(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?jl(e.webauthn.credential_response):_l(e.webauthn.credential_response)})}:{code:e.code}),{data:l,error:d}=await ne(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return d?{data:null,error:d}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),{data:l,error:d})})}catch(t){if(se(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const o=await ne(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});if(o.error)return o;const{data:l}=o;if(l.type!=="webauthn")return{data:l,error:null};switch(l.webauthn.type){case"create":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:vl(l.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:wl(l.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(se(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};const n={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=t==null?void 0:t.factors)!==null&&e!==void 0?e:[])n.all.push(i),i.status==="verified"&&n[i.factor_type].push(i);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Xr(n.access_token);let l=null;o.aal&&(l=o.aal);let d=l;((s=(t=n.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(d="aal2");const u=o.amr||[];return{data:{currentLevel:l,nextLevel:d,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(l=>l.kid===e);if(s)return s;const n=Date.now();if(s=this.jwks.keys.find(l=>l.kid===e),s&&this.jwks_cached_at+$o>n)return s;const{data:i,error:o}=await ne(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=n,s=i.keys.find(l=>l.kid===e),!s)?null:s}async getClaims(e,t={}){try{let s=e;if(!s){const{data:x,error:b}=await this.getSession();if(b||!x.session)return{data:null,error:b};s=x.session.access_token}const{header:n,payload:i,signature:o,raw:{header:l,payload:d}}=Xr(s);t!=null&&t.allowExpired||Xo(i.exp);const c=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!c){const{error:x}=await this.getUser(s);if(x)throw x;return{data:{claims:i,header:n,signature:o},error:null}}const u=Zo(n.alg),h=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,o,Uo(`${l}.${d}`)))throw new js("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(s){if(se(s))return{data:null,error:s};throw s}}}ar.nextInstanceID=0;const Rl=ar;class Al extends Rl{constructor(e){super(e)}}var Pl=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(s.next(u))}catch(h){o(h)}}function d(u){try{c(s.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,d)}c((s=s.apply(r,[])).next())})};class Dl{constructor(e,t,s){var n,i,o;this.supabaseUrl=e,this.supabaseKey=t;const l=So(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const d=`sb-${l.hostname.split(".")[0]}-auth-token`,c={db:go,realtime:xo,auth:Object.assign(Object.assign({},po),{storageKey:d}),global:fo},u=No(s??{},c);this.storageKey=(n=u.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(h,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=u.auth)!==null&&o!==void 0?o:{},this.headers,u.global.fetch),this.fetch=wo(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new $i(new URL("rest/v1",l).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new uo(this.storageUrl.href,this.headers,this.fetch,s==null?void 0:s.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new li(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return Pl(this,void 0,void 0,function*(){var e,t;if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,userStorage:i,storageKey:o,flowType:l,lock:d,debug:c},u,h){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Al({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),u),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,userStorage:i,flowType:l,lock:d,debug:c,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(x=>x.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new Ki(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Il=(r,e,t)=>new Dl(r,e,t);function Fl(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Fl()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Ll="https://iqehkneolpesaqznkqjm.supabase.co",Ul="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlxZWhrbmVvbHBlc2Fxem5rcWptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA5MzkxNjgsImV4cCI6MjA2NjUxNTE2OH0.4N69aEfiQdcwW0Jw7061fRlSTF6QtPQQiQybUDFZsIg",ge=Il(Ll,Ul),sn="app-theme",Ne=()=>{const r=localStorage.getItem(sn);return r==="light"||r==="dark"?r:"dark"},Ml=r=>{localStorage.setItem(sn,r)},an=r=>{const e=document.documentElement,t=document.body;r==="dark"?(e.classList.add("dark"),t.className="bg-[#0B1121] text-white"):(e.classList.remove("dark"),t.className="bg-white text-gray-900")},Bl=()=>{const r=Ne();return an(r),r},nn=r=>{const e=r==="dark"?"light":"dark";return Ml(e),an(e),window.dispatchEvent(new CustomEvent("themeChanged")),e};function Wl(){const[r,e]=y.useState(()=>Ne()==="dark"),[t,s]=y.useState(null),[n,i]=y.useState(!1);y.useEffect(()=>{ge.auth.getUser().then(({data:{user:x}})=>{s(x)});const{data:{subscription:f}}=ge.auth.onAuthStateChange((x,b)=>{s((b==null?void 0:b.user)??null)});return()=>f.unsubscribe()},[]);const o=()=>{const f=nn(r?"dark":"light");e(f==="dark")},l=t!==null,d=[{icon:a.jsx(Sa,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"Video Analysis",description:"Advanced vehicle detection and tracking at level crossings using YOLOv8 and computer vision"},{icon:a.jsx(Pn,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"Behavior Analysis",description:"Monitor and analyze driver compliance with safety measures and signage"},{icon:a.jsx(jr,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"Real-time Monitoring",description:"Process and analyze traffic footage in real-time for immediate insights"},{icon:a.jsx(Dn,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"Privacy Protection",description:"Ensure data privacy through automated anonymization of sensitive information"}],c=[{icon:a.jsx(as,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"YOLOv8 Integration",description:"State-of-the-art object detection for accurate vehicle tracking"},{icon:a.jsx(Ye,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"Statistical Analysis",description:"Advanced analytics for traffic patterns and behavior"},{icon:a.jsx(ns,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"Edge Processing",description:"Local processing for enhanced privacy and reduced latency"},{icon:a.jsx(In,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"Data Security",description:"Robust security measures for sensitive information"},{icon:a.jsx(Fn,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"Interactive Dashboard",description:"Real-time visualization of traffic analytics"},{icon:a.jsx(Ln,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"API Integration",description:"Seamless integration with external systems"}],u=[{name:"Sasindu Dilshan Ranwadana",role:"Team Leader, Scrum Master, Developer",id:"104509653",github:"https://github.com/sasindudilshanranwadana"},{name:"Quang Vinh Le",role:"QA, Developer, Documentation",id:"104097488",github:"https://github.com/quangvinhlee"},{name:"Franco Octavio Jimenez Perez",role:"QA, Developer, Documentation, Communications",id:"104173896",github:"https://github.com/Osovich"},{name:"Janith Athuluwage",role:"Developer, Documentation, QA",id:"104798312",github:"https://github.com/janith14"},{name:"Thiviru Thejan",role:"Developer, Documentation, QA",id:"104321637",github:"https://github.com/tthejan"},{name:"Risinu Cooray",role:"Developer, Documentation, QA",id:"104333137",github:"https://github.com/risinu-c"}],h=[{quarter:"Sprint 1",title:"Project Setup & Planning",status:"Completed",tasks:"Repository setup, requirements gathering, and team organization"},{quarter:"Sprint 2",title:"Data Collection & Processing",status:"Completed",tasks:"Video data collection, preprocessing, and initial model training"},{quarter:"Sprint 3",title:"Core Development",status:"Completed",tasks:"YOLOv8 integration, dashboard development, and API implementation"},{quarter:"Sprint 4",title:"Testing & Optimization",status:"Completed",tasks:"System testing, performance optimization, and stakeholder feedback"},{quarter:"Sprint 5",title:"Deployment",status:"In Progress",tasks:"Production deployment, final testing, and system go-live"}];return a.jsxs("div",{className:`min-h-screen ${r?"bg-neural-900 text-white":"bg-neural-100 text-gray-900"}`,children:[a.jsxs("nav",{className:`fixed w-full z-50 backdrop-blur-sm border-b ${r?"bg-neural-900/80 border-primary-500/10":"bg-white/80 border-gray-200"}`,children:[a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"flex items-center justify-between h-16",children:[a.jsxs("div",{className:"flex items-center space-x-4 sm:space-x-8",children:[a.jsx("span",{className:`text-lg sm:text-xl font-bold ${r?"text-primary-400":"text-primary-600"} animate-float`,children:"Project 49"}),a.jsxs("div",{className:"hidden md:flex space-x-4 lg:space-x-6",children:[a.jsx("a",{href:"#about",className:`text-sm lg:text-base ${r?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-900"} transition-colors duration-300`,children:"About"}),a.jsx("a",{href:"#objectives",className:`text-sm lg:text-base ${r?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-900"} transition-colors duration-300`,children:"Objectives"}),a.jsx("a",{href:"#features",className:`text-sm lg:text-base ${r?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-900"} transition-colors duration-300`,children:"Features"}),a.jsx("a",{href:"#team",className:`text-sm lg:text-base ${r?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-900"} transition-colors duration-300`,children:"Team"}),a.jsx("a",{href:"#timeline",className:`text-sm lg:text-base ${r?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-900"} transition-colors duration-300`,children:"Timeline"})]})]}),a.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[a.jsx("a",{href:"https://github.com/sasindudilshanranwadana/SynerX",target:"_blank",rel:"noopener noreferrer",className:`hidden sm:block p-2 rounded-lg transition-all duration-300 ${r?"text-gray-300 hover:text-white hover:bg-neural-800":"text-gray-600 hover:text-gray-900 hover:bg-gray-200"}`,children:a.jsx(mr,{className:"w-5 h-5"})}),a.jsx("button",{onClick:o,"aria-label":"Toggle theme",className:`p-2 rounded-lg transition-all duration-300 ${r?"bg-neural-800 text-gray-200 hover:bg-neural-700":"bg-gray-200 text-gray-800 hover:bg-gray-300"}`,children:r?a.jsx(wa,{className:"w-5 h-5 animate-pulse-glow"}):a.jsx(ja,{className:"w-5 h-5 animate-pulse-glow"})}),l?a.jsx(at,{to:"/dashboard",className:`hidden sm:inline-block px-4 lg:px-6 py-2 rounded-lg text-sm lg:text-base font-medium transition-all duration-300 animate-glow ${r?"bg-primary-500 hover:bg-primary-600 text-white":"bg-primary-600 hover:bg-primary-700 text-white"}`,children:"Dashboard"}):a.jsx(at,{to:"/auth",className:`hidden sm:inline-block px-4 lg:px-6 py-2 rounded-lg text-sm lg:text-base font-medium transition-all duration-300 animate-glow ${r?"bg-primary-500 hover:bg-primary-600 text-white":"bg-primary-600 hover:bg-primary-700 text-white"}`,children:"Sign In"}),a.jsx("button",{onClick:()=>i(!n),"aria-label":n?"Close mobile menu":"Open mobile menu",className:`md:hidden p-2 rounded-lg transition-all duration-300 ${r?"text-gray-300 hover:text-white hover:bg-neural-800":"text-gray-600 hover:text-gray-900 hover:bg-gray-200"}`,children:n?a.jsx(ze,{className:"w-6 h-6"}):a.jsx(_a,{className:"w-6 h-6"})})]})]})}),n&&a.jsx("div",{className:`md:hidden border-t ${r?"border-primary-500/10 bg-neural-900":"border-gray-200 bg-white"}`,children:a.jsxs("div",{className:"px-4 py-4 space-y-3",children:[a.jsx("a",{href:"#about",onClick:()=>i(!1),className:`block px-4 py-3 rounded-lg text-base font-medium transition-colors ${r?"text-gray-300 hover:text-white hover:bg-neural-800":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"About"}),a.jsx("a",{href:"#objectives",onClick:()=>i(!1),className:`block px-4 py-3 rounded-lg text-base font-medium transition-colors ${r?"text-gray-300 hover:text-white hover:bg-neural-800":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"Objectives"}),a.jsx("a",{href:"#features",onClick:()=>i(!1),className:`block px-4 py-3 rounded-lg text-base font-medium transition-colors ${r?"text-gray-300 hover:text-white hover:bg-neural-800":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"Features"}),a.jsx("a",{href:"#team",onClick:()=>i(!1),className:`block px-4 py-3 rounded-lg text-base font-medium transition-colors ${r?"text-gray-300 hover:text-white hover:bg-neural-800":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"Team"}),a.jsx("a",{href:"#timeline",onClick:()=>i(!1),className:`block px-4 py-3 rounded-lg text-base font-medium transition-colors ${r?"text-gray-300 hover:text-white hover:bg-neural-800":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"Timeline"}),a.jsxs("a",{href:"https://github.com/sasindudilshanranwadana/SynerX",target:"_blank",rel:"noopener noreferrer",onClick:()=>i(!1),className:`flex items-center gap-2 px-4 py-3 rounded-lg text-base font-medium transition-colors ${r?"text-gray-300 hover:text-white hover:bg-neural-800":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:[a.jsx(mr,{className:"w-5 h-5"}),"GitHub"]}),l?a.jsx(at,{to:"/dashboard",onClick:()=>i(!1),className:`block text-center px-4 py-3 rounded-lg text-base font-medium transition-all duration-300 ${r?"bg-primary-500 hover:bg-primary-600 text-white":"bg-primary-600 hover:bg-primary-700 text-white"}`,children:"Dashboard"}):a.jsx(at,{to:"/auth",onClick:()=>i(!1),className:`block text-center px-4 py-3 rounded-lg text-base font-medium transition-all duration-300 ${r?"bg-primary-500 hover:bg-primary-600 text-white":"bg-primary-600 hover:bg-primary-700 text-white"}`,children:"Sign In"})]})})]}),a.jsxs("section",{className:"relative pt-20 sm:pt-24 md:pt-32 pb-16 sm:pb-20 md:pb-24 neural-background",children:[a.jsx("div",{className:"absolute inset-0 grid-pattern opacity-20"}),a.jsx("div",{className:"absolute inset-0 neural-grid"}),a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative",children:[a.jsx("div",{className:`inline-block px-4 sm:px-6 py-2 rounded-full text-xs sm:text-sm font-medium mb-6 sm:mb-8 animate-float ${r?"bg-primary-500/10 text-primary-400":"bg-primary-600/10 text-primary-600"}`,children:"AI-Powered Road Safety Analysis"}),a.jsx("h1",{className:"text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold mb-4 sm:mb-6 animate-float leading-tight",children:"Project 49"}),a.jsx("h2",{className:`text-lg sm:text-xl md:text-2xl lg:text-3xl font-semibold mb-4 sm:mb-6 animate-float animation-delay-2000 ${r?"text-primary-400":"text-primary-600"} leading-tight px-2`,children:"Road-User Behaviour Analysis Using AI & Computer Vision"}),a.jsx("p",{className:`text-base sm:text-lg md:text-xl mb-6 sm:mb-8 md:mb-10 max-w-3xl mx-auto animate-float animation-delay-4000 ${r?"text-gray-400":"text-gray-600"} px-4`,children:"Enhancing road safety through intelligent video analytics at level crossings"}),a.jsx("div",{className:"flex justify-center px-4",children:l?a.jsx(at,{to:"/dashboard",className:`w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-3 rounded-lg text-base sm:text-lg font-medium transition-all duration-300 animate-glow ${r?"bg-primary-500 hover:bg-primary-600 text-white":"bg-primary-600 hover:bg-primary-700 text-white"}`,children:"Go to Dashboard"}):a.jsx(at,{to:"/auth",className:`w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-3 rounded-lg text-base sm:text-lg font-medium transition-all duration-300 animate-glow ${r?"bg-primary-500 hover:bg-primary-600 text-white":"bg-primary-600 hover:bg-primary-700 text-white"}`,children:"Get Started"})})]})]}),a.jsx("section",{id:"about",className:"py-12 sm:py-16 md:py-20 lg:py-24",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8 md:gap-12 items-center",children:[a.jsxs("div",{children:[a.jsx("div",{className:`inline-block px-4 py-1 rounded-full text-xs sm:text-sm font-medium mb-4 sm:mb-6 animate-float ${r?"bg-primary-500/10 text-primary-400":"bg-primary-600/10 text-primary-600"}`,children:"About the Project"}),a.jsx("h2",{className:"text-2xl sm:text-3xl font-bold mb-4 sm:mb-6 animate-float animation-delay-2000",children:"Revolutionizing Road Safety with AI"}),a.jsx("p",{className:`mb-4 sm:mb-6 text-sm sm:text-base animate-float animation-delay-4000 ${r?"text-gray-400":"text-gray-600"}`,children:"Project 49 addresses the critical need for effective analysis of driver behavior at level crossings. Working with key stakeholders like VicRoads, Department of Transport, and V/Line, we're developing an innovative solution that provides meaningful insights from real-world traffic footage."}),a.jsx("p",{className:`text-sm sm:text-base animate-float animation-delay-4000 ${r?"text-gray-400":"text-gray-600"}`,children:"Our system processes traffic camera footage to detect vehicles, measure speed profiles, assess compliance behavior, and visualize data through an interactive dashboard, enabling data-driven decisions for road safety improvements."})]}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:`absolute inset-0 rounded-xl ${r?"bg-primary-500/10":"bg-primary-600/10"} blur-3xl -z-10 animate-pulse-glow`}),a.jsx("img",{src:"https://iqehkneolpesaqznkqjm.supabase.co/storage/v1/object/sign/assets/m6-motorway-trim-result.gif?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV83YmM1YjM5OS00ZDQwLTRiMDktOGE3Yi1kOWMxNzlkNjcyM2UiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJhc3NldHMvbTYtbW90b3J3YXktdHJpbS1yZXN1bHQuZ2lmIiwiaWF0IjoxNzU4NzMwMDYyLCJleHAiOjMxNTUzNTg3MzAwNjJ9.pKZVb8o3SVRrZ_N5WGWNcrRI59hyZ-tcNongThzTQs4",alt:"Traffic Analysis with AI Detection",className:"rounded-xl shadow-2xl relative z-10 animate-float object-cover h-[250px] sm:h-[300px] md:h-[400px] w-full max-w-full"}),a.jsxs("div",{className:"mt-4 sm:mt-6 md:mt-8 text-center relative z-10 text-gray-300",children:[a.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-2 sm:mb-4",children:"Project 49"}),a.jsx("p",{className:"text-sm sm:text-base text-gray-400",children:"Road-User Behaviour Analysis Using AI & Computer Vision"})]})]})]})})}),a.jsx("section",{id:"objectives",className:`py-12 sm:py-16 md:py-20 lg:py-24 ${r?"bg-neural-800/50":"bg-gray-100"}`,children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"text-center mb-8 sm:mb-12 md:mb-16",children:[a.jsx("div",{className:`inline-block px-4 py-1 rounded-full text-xs sm:text-sm font-medium mb-4 sm:mb-6 animate-float ${r?"bg-primary-500/10 text-primary-400":"bg-primary-600/10 text-primary-600"}`,children:"Project Goals"}),a.jsx("h2",{className:"text-2xl sm:text-3xl font-bold animate-float animation-delay-2000",children:"Key Objectives"})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 lg:gap-8",children:d.map((f,x)=>a.jsxs("div",{className:`p-4 sm:p-6 rounded-xl transition-all duration-300 hover:scale-105 animate-float ${r?"bg-neural-800/50 hover:bg-neural-700/50":"bg-white hover:bg-gray-50 shadow-lg"}`,style:{animationDelay:`${x*200}ms`},children:[a.jsx("div",{className:`p-3 rounded-lg inline-block mb-4 animate-pulse-glow ${r?"bg-primary-500/10 text-primary-400":"bg-primary-600/10 text-primary-600"}`,children:f.icon}),a.jsx("h3",{className:"text-base sm:text-lg lg:text-xl font-semibold mb-2",children:f.title}),a.jsx("p",{className:`text-sm sm:text-base ${r?"text-gray-400":"text-gray-600"}`,children:f.description})]},x))})]})}),a.jsx("section",{id:"features",className:"py-12 sm:py-16 md:py-20 lg:py-24 neural-background",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"text-center mb-8 sm:mb-12 md:mb-16",children:[a.jsx("div",{className:`inline-block px-4 py-1 rounded-full text-xs sm:text-sm font-medium mb-4 sm:mb-6 animate-float ${r?"bg-primary-500/10 text-primary-400":"bg-primary-600/10 text-primary-600"}`,children:"System Features"}),a.jsx("h2",{className:"text-2xl sm:text-3xl font-bold animate-float animation-delay-2000",children:"Technical Capabilities"})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8",children:c.map((f,x)=>a.jsxs("div",{className:`p-4 sm:p-6 rounded-xl transition-all duration-300 hover:scale-105 animate-float ${r?"bg-neural-800/50 hover:bg-neural-700/50":"bg-white hover:bg-gray-50 shadow-lg"}`,style:{animationDelay:`${x*200}ms`},children:[a.jsx("div",{className:`p-3 rounded-lg inline-block mb-4 animate-pulse-glow ${r?"bg-primary-500/10 text-primary-400":"bg-primary-600/10 text-primary-600"}`,children:f.icon}),a.jsx("h3",{className:"text-base sm:text-lg lg:text-xl font-semibold mb-2",children:f.title}),a.jsx("p",{className:`text-sm sm:text-base ${r?"text-gray-400":"text-gray-600"}`,children:f.description})]},x))})]})}),a.jsx("section",{id:"team",className:`py-12 sm:py-16 md:py-20 lg:py-24 ${r?"bg-neural-800/50":"bg-gray-100"}`,children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"text-center mb-8 sm:mb-12 md:mb-16",children:[a.jsx("div",{className:`inline-block px-4 py-1 rounded-full text-xs sm:text-sm font-medium mb-4 sm:mb-6 animate-float ${r?"bg-primary-500/10 text-primary-400":"bg-primary-600/10 text-primary-600"}`,children:"Meet SynerX"}),a.jsx("h2",{className:"text-2xl sm:text-3xl font-bold animate-float animation-delay-2000",children:"Our Team"})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8",children:u.map((f,x)=>a.jsxs("div",{className:`text-center p-4 sm:p-6 rounded-xl transition-all duration-300 hover:scale-105 animate-float ${r?"bg-neural-800/50 hover:bg-neural-700/50":"bg-white hover:bg-gray-50 shadow-lg"}`,style:{animationDelay:`${x*200}ms`},children:[a.jsxs("div",{className:"relative mx-auto w-20 h-20 sm:w-24 sm:h-24 lg:w-32 lg:h-32 mb-4",children:[a.jsx("div",{className:`absolute inset-0 rounded-full blur-xl animate-pulse-glow ${r?"bg-primary-500/20":"bg-primary-600/20"}`}),a.jsx("div",{className:`w-full h-full rounded-full bg-gradient-to-br ${r?"from-neural-700 to-neural-800":"from-gray-100 to-gray-200"} flex items-center justify-center text-2xl sm:text-3xl font-bold relative z-10`,children:f.name.charAt(0)}),a.jsx("div",{className:`absolute inset-0 rounded-full ring-2 animate-glow ${r?"ring-primary-500":"ring-primary-600"}`})]}),a.jsx("h3",{className:"text-sm sm:text-base lg:text-lg font-semibold",children:f.name}),a.jsx("p",{className:`text-xs sm:text-sm mb-2 ${r?"text-primary-400":"text-primary-600"}`,children:f.id}),a.jsx("p",{className:`text-xs sm:text-sm mb-4 ${r?"text-gray-400":"text-gray-600"}`,children:f.role}),a.jsx("div",{className:"flex justify-center",children:a.jsx("a",{href:f.github,target:"_blank",rel:"noopener noreferrer",className:`transition-colors duration-300 ${r?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"}`,children:a.jsx(mr,{className:"w-5 h-5"})})})]},x))})]})}),a.jsx("section",{id:"timeline",className:"py-12 sm:py-16 md:py-20 lg:py-24 neural-background",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"text-center mb-8 sm:mb-12 md:mb-16",children:[a.jsx("div",{className:`inline-block px-4 py-1 rounded-full text-xs sm:text-sm font-medium mb-4 sm:mb-6 animate-float ${r?"bg-primary-500/10 text-primary-400":"bg-primary-600/10 text-primary-600"}`,children:"Development Progress"}),a.jsx("h2",{className:"text-2xl sm:text-3xl font-bold animate-float animation-delay-2000",children:"Project Timeline"})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 sm:gap-6 lg:gap-8",children:h.map((f,x)=>a.jsxs("div",{className:`p-4 sm:p-6 rounded-xl transition-all duration-300 hover:scale-105 animate-float ${r?"bg-neural-800/50 hover:bg-neural-700/50":"bg-white hover:bg-gray-50 shadow-lg"}`,style:{animationDelay:`${x*200}ms`},children:[a.jsx("div",{className:`text-base sm:text-lg font-semibold mb-2 ${r?"text-primary-400":"text-primary-600"}`,children:f.quarter}),a.jsx("h3",{className:"text-base sm:text-lg lg:text-xl font-semibold mb-2",children:f.title}),a.jsx("p",{className:`text-xs sm:text-sm mb-3 ${r?"text-gray-400":"text-gray-600"}`,children:f.tasks}),a.jsx("p",{className:`text-xs sm:text-sm font-medium ${f.status==="Completed"?"text-green-500":f.status==="In Progress"?r?"text-primary-400":"text-primary-600":r?"text-gray-400":"text-gray-600"}`,children:f.status})]},x))})]})}),a.jsx("footer",{className:`py-8 sm:py-10 md:py-12 ${r?"bg-neural-800/50":"bg-gray-100"}`,children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 sm:gap-8 md:gap-12",children:[a.jsxs("div",{className:"animate-float",children:[a.jsx("h3",{className:"text-lg sm:text-xl font-bold mb-3 sm:mb-4",children:"Swinburne"}),a.jsx("p",{className:`text-sm sm:text-base ${r?"text-gray-400":"text-gray-600"}`,children:"A research project by Swinburne University of Technology"})]}),a.jsxs("div",{className:"animate-float animation-delay-2000",children:[a.jsx("h3",{className:"text-lg sm:text-xl font-bold mb-3 sm:mb-4",children:"Quick Links"}),a.jsxs("ul",{className:"space-y-2",children:[a.jsx("li",{children:a.jsx("a",{href:"#about",className:`text-sm sm:text-base transition-colors duration-300 ${r?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"}`,children:"About"})}),a.jsx("li",{children:a.jsx("a",{href:"#objectives",className:`text-sm sm:text-base transition-colors duration-300 ${r?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"}`,children:"Objectives"})}),a.jsx("li",{children:a.jsx("a",{href:"#features",className:`text-sm sm:text-base transition-colors duration-300 ${r?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"}`,children:"Features"})}),a.jsx("li",{children:a.jsx("a",{href:"#team",className:`text-sm sm:text-base transition-colors duration-300 ${r?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"}`,children:"Team"})})]})]}),a.jsxs("div",{className:"animate-float animation-delay-4000",children:[a.jsx("h3",{className:"text-lg sm:text-xl font-bold mb-3 sm:mb-4",children:"Contact"}),a.jsx("p",{className:`mb-4 text-sm sm:text-base ${r?"text-gray-400":"text-gray-600"}`,children:"For inquiries, please contact our team at Swinburne University"}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsx("a",{href:"#",className:`transition-colors duration-300 ${r?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"}`,children:a.jsx(An,{className:"w-5 h-5"})}),a.jsx("a",{href:"#",className:`transition-colors duration-300 ${r?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"}`,children:a.jsx(Na,{className:"w-5 h-5"})}),a.jsx("a",{href:"https://github.com/sasindudilshanranwadana/SynerX",target:"_blank",rel:"noopener noreferrer",className:`transition-colors duration-300 ${r?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"}`,children:a.jsx(mr,{className:"w-5 h-5"})})]})]})]}),a.jsx("div",{className:`mt-6 sm:mt-8 md:mt-12 pt-6 sm:pt-8 border-t ${r?"border-neural-700":"border-gray-200"} text-center ${r?"text-gray-400":"text-gray-600"}`,children:a.jsx("p",{className:"text-sm sm:text-base",children:"© 2024 Project 49. All rights reserved."})})]})})]})}const zl=async r=>{try{const{data:e,error:t}=await ge.from("videos").insert([r]).select().single();if(t)throw t;return e}catch(e){throw console.error("Error inserting video:",e),e}},Vl=async()=>{try{const{data:r,error:e}=await ge.from("videos").select("*").order("created_at",{ascending:!1});if(e)throw e;return r||[]}catch(r){throw console.error("Error fetching videos:",r),r}},on=async()=>{try{const{data:r,error:e}=await ge.from("tracking_results").select("*").order("created_at",{ascending:!1});if(e)throw e;return r||[]}catch(r){throw console.error("Error fetching all tracking results:",r),r}},ql=async()=>{try{const{data:r,error:e}=await ge.from("vehicle_counts").select("*").order("created_at",{ascending:!1});if(e)throw e;return r||[]}catch(r){throw console.error("Error fetching all vehicle counts:",r),r}},Hl=async()=>{try{const[r,e,t]=await Promise.all([Vl(),on(),ql()]),s=r.length,n=r.filter(h=>h.status==="completed").length,i=e.length,o=e.filter(h=>h.compliance===0).length,l=e.filter(h=>h.compliance===1),d=i>0?l.length/i*100:0,c=l.map(h=>h.reaction_time).filter(h=>h!=null&&h>0),u=c.length>0?c.reduce((h,f)=>h+f,0)/c.length:0;return{totalVideos:s,processedVideos:n,totalVehicles:i,violations:o,complianceRate:d,avgReactionTime:u,trackingResults:e,vehicleCounts:t,videos:r}}catch(r){throw console.error("Error getting overall analytics:",r),r}};function Wt({className:r=""}){const[e,t]=y.useState(()=>Ne()==="dark"),[s,n]=y.useState("connecting"),[i,o]=y.useState(0);y.useEffect(()=>{const h=()=>{t(Ne()==="dark")};window.addEventListener("themeChanged",h),l();const f=setInterval(l,3e4);return()=>{window.removeEventListener("themeChanged",h),clearInterval(f)}},[]);const l=async(h=0)=>{var x;h===0&&(n("connecting"),o(0));try{const b="https://alxrkajk60i0df-8000.proxy.runpod.net",N={"Content-Type":"application/json"};N.Authorization="Bearer rpa_1K6BW22JFGU3D3AI8XRSQ7YBSPE7XHDKTMBR2Q211nzdtd";const _=h===0?1e4:3e4+h*5e3,I=await fetch(`${b}/`,{method:"GET",headers:N,signal:AbortSignal.timeout(_)}),k=await I.text();if(I.ok)try{const E=JSON.parse(k);if(E.message==="SynerX API is running!"&&E.status==="ok"){n("connected"),o(0),console.log("[ServerStatus] Successfully connected to RunPod!");return}}catch(E){console.error("[ServerStatus] Failed to parse response:",E)}if((k.includes("no workers available")||k.includes("worker")||I.status===503)&&h<5){n("warming"),o(h+1);const E=Math.min(3e3*Math.pow(2,h),48e3);console.log(`[ServerStatus] Cold start detected, retrying in ${E}ms (attempt ${h+1}/5)`),setTimeout(()=>l(h+1),E);return}console.error(`[ServerStatus] Connection failed: ${I.status} - ${k}`),n("error")}catch(b){if((b.name==="TimeoutError"||(x=b.message)!=null&&x.includes("timeout"))&&h<5){n("warming"),o(h+1);const N=Math.min(3e3*Math.pow(2,h),48e3);console.log(`[ServerStatus] Timeout during warm-up, retrying in ${N}ms (attempt ${h+1}/5)`),setTimeout(()=>l(h+1),N);return}n("error")}},d=h=>{switch(h){case"connected":return"bg-green-500";case"connecting":return"bg-yellow-500";case"warming":return"bg-orange-500";case"error":return"bg-red-500";case"disconnected":return"bg-gray-500";default:return"bg-gray-500"}},c=h=>{switch(h){case"connected":return"animate-ping";case"connecting":return"animate-pulse";case"warming":return"animate-pulse";default:return""}},u=h=>{switch(h){case"connected":return"RunPod Connected";case"connecting":return"Connecting...";case"warming":return i>0?`Warming up... (${i}/5)`:"Warming up...";case"error":return"RunPod Disconnected";case"disconnected":return"RunPod Disconnected";default:return"Unknown Status"}};return a.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-2 px-3 py-2 rounded-lg backdrop-blur-sm ${e?"bg-[#151F32]/90 border border-[#1E293B]":"bg-white/90 border border-gray-200"} ${r}`,children:[a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:`w-3 h-3 rounded-full ${d(s)}`}),s==="connected"&&a.jsx("div",{className:`absolute inset-0 w-3 h-3 rounded-full ${d(s)} ${c(s)} opacity-75`}),(s==="connecting"||s==="warming")&&a.jsx("div",{className:`absolute inset-0 w-3 h-3 rounded-full ${d(s)} ${c(s)}`})]}),a.jsx("span",{className:`text-xs font-medium ${e?"text-gray-300":"text-gray-700"}`,children:u(s)})]})}function wt({title:r,onToggleSidebar:e,isSidebarOpen:t}){var l;const[s,n]=y.useState(null),[i,o]=y.useState(()=>Ne()==="dark");return y.useEffect(()=>{ge.auth.getUser().then(({data:{user:c}})=>{n(c)});const{data:{subscription:d}}=ge.auth.onAuthStateChange((c,u)=>{n((u==null?void 0:u.user)??null)});return()=>d.unsubscribe()},[]),y.useEffect(()=>{const d=()=>{o(Ne()==="dark")};return window.addEventListener("themeChanged",d),()=>window.removeEventListener("themeChanged",d)},[]),a.jsx("div",{className:`lg:hidden fixed top-0 left-0 right-0 z-50 px-4 py-3 border-b ${i?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200"}`,children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("button",{onClick:e,className:"p-1 sm:p-2",children:t?a.jsx(ze,{"data-testid":"x-icon",className:"w-6 h-6"}):a.jsx(_a,{"data-testid":"menu-icon",className:"w-6 h-6"})}),a.jsx("span",{className:"text-lg sm:text-xl font-bold truncate px-4",children:r}),a.jsx("img",{src:((l=s==null?void 0:s.user_metadata)==null?void 0:l.avatar_url)||`https://ui-avatars.com/api/?name=${(s==null?void 0:s.email)||"User"}&background=0B1121&color=fff`,alt:"Profile",className:"w-8 h-8 sm:w-10 sm:h-10 rounded-full border-2 border-primary-500 flex-shrink-0"})]})})}const Kl=[{icon:a.jsx(ka,{className:"w-5 h-5"}),label:"Home",path:"/"},{icon:a.jsx(Mn,{className:"w-5 h-5"}),label:"Dashboard",path:"/dashboard"},{icon:a.jsx(Bn,{className:"w-5 h-5"}),label:"Video Upload",path:"/upload"},{icon:a.jsx(Ye,{className:"w-5 h-5"}),label:"Analytics",path:"/analytics"},{icon:a.jsx(is,{className:"w-5 h-5"}),label:"Video Playback",path:"/playback"},{icon:a.jsx(os,{className:"w-5 h-5"}),label:"Storage",path:"/storage"},{icon:a.jsx(Wn,{className:"w-5 h-5"}),label:"Settings",path:"/settings"}];function Jl({activePath:r,onCloseSidebar:e}){var l,d;const[t,s]=y.useState(null),[n,i]=y.useState(()=>Ne()==="dark");y.useEffect(()=>{ge.auth.getUser().then(({data:{user:u}})=>{s(u)}).catch(()=>{s(null)});const{data:{subscription:c}}=ge.auth.onAuthStateChange((u,h)=>{s((h==null?void 0:h.user)??null)});return()=>c.unsubscribe()},[]),y.useEffect(()=>{const c=()=>{i(Ne()==="dark")};return window.addEventListener("themeChanged",c),()=>window.removeEventListener("themeChanged",c)},[]);const o=async()=>{try{await ge.auth.signOut()}catch(c){console.error("Error signing out:",c)}};return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:`p-4 sm:p-6 mt-14 lg:mt-0 border-b ${n?"border-[#1E293B]":"border-gray-200"}`,children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("img",{src:((l=t==null?void 0:t.user_metadata)==null?void 0:l.avatar_url)||`https://ui-avatars.com/api/?name=${(t==null?void 0:t.email)||"User"}&background=0B1121&color=fff`,alt:"Profile",className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full border-2 border-primary-500 flex-shrink-0"}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("h2",{className:"font-semibold text-sm sm:text-base truncate",children:((d=t==null?void 0:t.user_metadata)==null?void 0:d.full_name)||"User"}),a.jsx("p",{className:`text-xs sm:text-sm truncate ${n?"text-gray-400":"text-gray-600"}`,children:t==null?void 0:t.email})]})]})}),a.jsx("nav",{className:"p-3 sm:p-4 overflow-y-auto h-[calc(100vh-180px)] sm:h-[calc(100vh-200px)]",children:Kl.map((c,u)=>a.jsxs(at,{to:c.path,onClick:e,className:`flex items-center gap-2 sm:gap-3 px-3 sm:px-4 py-2 sm:py-3 rounded-lg mb-1 transition-colors text-sm sm:text-base ${c.path===r?"bg-primary-500/20 text-primary-500":n?"hover:bg-[#1E293B] text-gray-400 hover:text-white":"hover:bg-gray-100 text-gray-600 hover:text-gray-900"}`,style:{opacity:1,visibility:"visible"},children:[c.icon,c.label]},u))}),a.jsx("div",{className:"absolute bottom-0 w-full p-3 sm:p-4",children:a.jsxs("button",{onClick:o,className:`flex items-center gap-2 w-full px-3 sm:px-4 py-2 rounded-lg text-red-500 transition-colors text-sm sm:text-base ${n?"hover:bg-red-500/10":"hover:bg-red-50"}`,children:[a.jsx(Un,{className:"w-5 h-5"}),"Sign Out"]})})]})}function jt({activePath:r,isOpen:e,onClose:t}){const[s,n]=y.useState(()=>Ne()==="dark");return y.useEffect(()=>{const i=()=>{n(Ne()==="dark")};return window.addEventListener("themeChanged",i),()=>window.removeEventListener("themeChanged",i)},[]),a.jsxs(a.Fragment,{children:[a.jsx("aside",{className:`fixed top-0 left-0 h-full w-64 z-40 border-r ${s?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200"} ${e?"translate-x-0":"-translate-x-full"} lg:translate-x-0 lg:block`,style:{display:"block",visibility:"visible",opacity:1,transform:"translateX(0)"},children:a.jsx(Jl,{activePath:r,onCloseSidebar:t})}),e&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:t,role:"dialog"})]})}function Gl(){var A,g;const[r,e]=y.useState(!1),[t,s]=y.useState(null),[n,i]=y.useState(()=>Ne()==="dark"),[o,l]=y.useState({videosProcessed:0,violations:0,complianceRate:0,avgReactionTime:0}),[d,c]=y.useState(!0),[u,h]=y.useState([{name:"YOLOv8 Model",status:"Down",icon:a.jsx(as,{className:"w-5 h-5"})},{name:"Video Processing",status:"Down",icon:a.jsx(Ye,{className:"w-5 h-5"})},{name:"Database Sync",status:"Down",icon:a.jsx(ns,{className:"w-5 h-5"})}]),[f,x]=y.useState([{event:"Loading recent activity...",time:"Just now",type:"info"}]);y.useEffect(()=>{(async()=>{const{data:{user:C}}=await ge.auth.getUser();s(C)})(),b();const p=setInterval(b,3e4);return()=>clearInterval(p)},[]),y.useEffect(()=>{const m=()=>{i(Ne()==="dark")};return window.addEventListener("themeChanged",m),()=>window.removeEventListener("themeChanged",m)},[]);const b=async()=>{try{await Promise.all([N(),I(),P()])}catch(m){console.error("Error loading dashboard data:",m)}finally{c(!1)}},N=async()=>{try{const m="https://alxrkajk60i0df-8000.proxy.runpod.net",p={"Content-Type":"application/json"};p.Authorization="Bearer rpa_1K6BW22JFGU3D3AI8XRSQ7YBSPE7XHDKTMBR2Q211nzdtd";const v=(await fetch(`${m}/`,{method:"GET",headers:p,signal:AbortSignal.timeout(1e4)})).ok,U=v,Y=await _();h([{name:"YOLOv8 Model",status:v?"Operational":"Down",icon:a.jsx(as,{className:"w-5 h-5"}),lastChecked:new Date().toLocaleTimeString()},{name:"Video Processing",status:U?"Operational":"Down",icon:a.jsx(Ye,{className:"w-5 h-5"}),lastChecked:new Date().toLocaleTimeString()},{name:"Database Sync",status:Y?"Operational":"Down",icon:a.jsx(ns,{className:"w-5 h-5"}),lastChecked:new Date().toLocaleTimeString()}])}catch(m){console.error("Error checking system status:",m),h(p=>p.map(C=>({...C,status:"Down"})))}},_=async()=>{try{const{data:m,error:p}=await ge.from("videos").select("count").limit(1);return!p}catch{return!1}},I=async()=>{try{try{const C="http://127.0.0.1:8000",v={"Content-Type":"application/json"};v.Authorization="Bearer rpa_1K6BW22JFGU3D3AI8XRSQ7YBSPE7XHDKTMBR2Q211nzdtd";const U=await fetch(`${C}/recent-activity`,{method:"GET",headers:v,signal:AbortSignal.timeout(1e4)});if(U.ok){const Y=await U.json();if(Y.activities&&Array.isArray(Y.activities)){x(Y.activities);return}}}catch{console.log("Backend recent activity not available, using database fallback")}const{data:m}=await ge.from("videos").select("*").order("created_at",{ascending:!1}).limit(5),p=[];m==null||m.forEach(C=>{const v=k(C.created_at);p.push({event:`New video uploaded: ${C.video_name}`,time:v,type:"info"})}),p.sort((C,v)=>{const U=E(C.time),Y=E(v.time);return U-Y}),x(p.slice(0,5))}catch(m){console.error("Error loading recent activity:",m),x([{event:"Unable to load recent activity",time:"Just now",type:"error"}])}},k=m=>{const p=new Date,C=new Date(m),v=Math.floor((p.getTime()-C.getTime())/(1e3*60));if(v<1)return"Just now";if(v<60)return`${v} minute${v>1?"s":""} ago`;const U=Math.floor(v/60);if(U<24)return`${U} hour${U>1?"s":""} ago`;const Y=Math.floor(U/24);return`${Y} day${Y>1?"s":""} ago`},E=m=>{if(m==="Just now")return 0;const p=m.match(/(\d+)\s+(minute|hour|day)/);if(!p)return 0;const C=parseInt(p[1]);switch(p[2]){case"minute":return C;case"hour":return C*60;case"day":return C*60*24;default:return 0}},P=async()=>{try{try{const C=await fetch("http://127.0.0.1:8000/analysis/complete",{method:"GET",headers:{"Content-Type":"application/json"},signal:AbortSignal.timeout(1e4)});if(C.ok){const v=await C.json();if(v.stats){l({videosProcessed:v.stats.videosProcessed||0,violations:v.stats.violations||0,complianceRate:v.stats.complianceRate||0,avgReactionTime:v.stats.avgReactionTime||0});return}}}catch{console.log("Backend analytics not available, using database fallback")}const m=await Hl();l({videosProcessed:m.processedVideos,violations:m.violations,complianceRate:m.complianceRate,avgReactionTime:m.avgReactionTime})}catch(m){console.error("Error loading analytics:",m),l({videosProcessed:0,violations:0,complianceRate:0,avgReactionTime:0})}finally{c(!1)}},W=m=>{switch(m){case"Operational":return"text-green-400";case"Degraded":return"text-yellow-400";case"Down":return"text-red-400";default:return"text-gray-400"}},V=m=>{switch(m){case"success":return"bg-green-500";case"warning":return"bg-yellow-500";case"error":return"bg-red-500";default:return"bg-primary-500"}};return a.jsxs("div",{className:`min-h-screen ${n?"bg-[#0B1121] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx(Wt,{}),a.jsx(wt,{title:"Dashboard",onToggleSidebar:()=>e(m=>!m),isSidebarOpen:r}),a.jsx(jt,{activePath:"/dashboard",isOpen:r,onClose:()=>e(!1)}),a.jsxs("main",{className:"lg:ml-64 p-4 lg:p-8 mt-16 lg:mt-0",children:[a.jsxs("div",{className:"mb-8",children:[a.jsxs("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-2",children:["Welcome back, ",((g=(A=t==null?void 0:t.user_metadata)==null?void 0:A.full_name)==null?void 0:g.split(" ")[0])||"User"]}),a.jsx("p",{className:`text-sm lg:text-base ${n?"text-gray-400":"text-gray-600"}`,children:"Here's what's happening with your monitoring system"})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 lg:gap-6 mb-8",children:d?Array(4).fill(null).map((m,p)=>a.jsxs("div",{"data-testid":"loading-skeleton",className:`p-6 rounded-xl animate-pulse border ${n?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200 shadow-lg"}`,children:[a.jsx("div",{className:"h-10 w-10 bg-primary-500/10 rounded-lg mb-4"}),a.jsx("div",{className:`h-8 w-24 rounded mb-2 ${n?"bg-gray-700":"bg-gray-300"}`}),a.jsx("div",{className:`h-4 w-32 rounded ${n?"bg-gray-700":"bg-gray-300"}`})]},p)):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:`p-4 lg:p-6 rounded-xl border ${n?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200 shadow-lg"}`,children:[a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-2 sm:gap-0",children:[a.jsx("div",{className:"p-2 lg:p-3 bg-primary-500/10 rounded-lg text-primary-500",children:a.jsx(Sa,{className:"w-6 h-6"})}),a.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-blue-500/10 text-blue-400 whitespace-nowrap",children:"Active"})]}),a.jsx("h3",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-1",children:o.videosProcessed}),a.jsx("p",{className:`text-sm ${n?"text-gray-400":"text-gray-600"}`,children:"Videos Processed"})]}),a.jsxs("div",{className:`p-4 lg:p-6 rounded-xl border ${n?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200 shadow-lg"}`,children:[a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-2 sm:gap-0",children:[a.jsx("div",{className:"p-2 lg:p-3 bg-primary-500/10 rounded-lg text-primary-500",children:a.jsx(Ye,{className:"w-6 h-6"})}),a.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-orange-500/10 text-orange-400 whitespace-nowrap",children:"Alert"})]}),a.jsx("h3",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-1",children:o.violations}),a.jsx("p",{className:`text-sm ${n?"text-gray-400":"text-gray-600"}`,children:"Violations Detected"})]}),a.jsxs("div",{className:`p-4 lg:p-6 rounded-xl border ${n?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200 shadow-lg"}`,children:[a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-2 sm:gap-0",children:[a.jsx("div",{className:"p-2 lg:p-3 bg-primary-500/10 rounded-lg text-primary-500",children:a.jsx(Ye,{className:"w-6 h-6"})}),a.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-green-500/10 text-green-400 whitespace-nowrap",children:"Stable"})]}),a.jsxs("h3",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-1",children:[o.complianceRate.toFixed(1),"%"]}),a.jsx("p",{className:`text-sm ${n?"text-gray-400":"text-gray-600"}`,children:"Compliance Rate"})]}),a.jsxs("div",{className:`p-4 lg:p-6 rounded-xl border ${n?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200 shadow-lg"}`,children:[a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-2 sm:gap-0",children:[a.jsx("div",{className:"p-2 lg:p-3 bg-primary-500/10 rounded-lg text-primary-500",children:a.jsx(tr,{className:"w-6 h-6"})}),a.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-blue-500/10 text-blue-400 whitespace-nowrap",children:"per vehicle"})]}),a.jsxs("h3",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-1",children:[o.avgReactionTime.toFixed(2),"s"]}),a.jsx("p",{className:`text-sm ${n?"text-gray-400":"text-gray-600"}`,children:"Avg. Reaction Time"})]})]})}),a.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4 lg:gap-6",children:[a.jsxs("div",{className:`p-4 lg:p-6 rounded-xl border ${n?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200 shadow-lg"}`,children:[a.jsx("h2",{className:"text-lg lg:text-xl font-semibold mb-4 lg:mb-6",children:"System Status"}),a.jsxs("div",{className:"space-y-3 lg:space-y-4",children:[a.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2 sm:gap-0",children:a.jsxs("span",{className:`text-sm ${n?"text-gray-400":"text-gray-600"}`,children:["Last updated: ",new Date().toLocaleTimeString()]})}),u.map((m,p)=>a.jsxs("div",{className:`flex items-center justify-between p-3 lg:p-4 rounded-lg ${n?"bg-[#1E293B]":"bg-gray-50"}`,children:[a.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[a.jsx("div",{className:"text-primary-500",children:m.icon}),a.jsx("span",{className:"text-sm lg:text-base truncate",children:m.name})]}),a.jsxs("div",{className:"text-right flex-shrink-0",children:[a.jsx("span",{className:`text-sm lg:text-base ${W(m.status)}`,children:m.status}),m.lastChecked&&a.jsx("div",{className:`text-xs ${n?"text-gray-500":"text-gray-400"}`,children:m.lastChecked})]})]},p))]})]}),a.jsxs("div",{className:`p-4 lg:p-6 rounded-xl border ${n?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200 shadow-lg"}`,children:[a.jsx("h2",{className:"text-lg lg:text-xl font-semibold mb-4 lg:mb-6",children:"Recent Activity"}),a.jsx("div",{className:"space-y-3 lg:space-y-4",children:f.map((m,p)=>a.jsxs("div",{className:`flex items-center gap-3 lg:gap-4 p-3 lg:p-4 rounded-lg ${n?"bg-[#1E293B]":"bg-gray-50"}`,children:[a.jsx("div",{className:`w-2 h-2 rounded-full flex-shrink-0 ${V(m.type)}`}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("p",{className:"text-sm lg:text-base truncate",children:m.event}),a.jsx("p",{className:`text-xs mt-1 ${n?"text-gray-400":"text-gray-600"}`,children:m.time})]})]},p))})]})]})]})]})}var Yl=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function _s(){return _s=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},_s.apply(this,arguments)}function Ql(r,e){if(r==null)return{};var t={},s=Object.keys(r),n,i;for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&(t[n]=r[n]);return t}function xr(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function Xl(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,Ns(r,e)}function Ns(r,e){return Ns=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,n){return s.__proto__=n,s},Ns(r,e)}var Dr=function(r){Xl(e,r);function e(){var s;return s=r.call(this)||this,s.handleExpired=s.handleExpired.bind(xr(s)),s.handleErrored=s.handleErrored.bind(xr(s)),s.handleChange=s.handleChange.bind(xr(s)),s.handleRecaptchaRef=s.handleRecaptchaRef.bind(xr(s)),s}var t=e.prototype;return t.getCaptchaFunction=function(n){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[n]:this.props.grecaptcha[n]:null},t.getValue=function(){var n=this.getCaptchaFunction("getResponse");return n&&this._widgetId!==void 0?n(this._widgetId):null},t.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},t.execute=function(){var n=this.getCaptchaFunction("execute");if(n&&this._widgetId!==void 0)return n(this._widgetId);this._executeRequested=!0},t.executeAsync=function(){var n=this;return new Promise(function(i,o){n.executionResolve=i,n.executionReject=o,n.execute()})},t.reset=function(){var n=this.getCaptchaFunction("reset");n&&this._widgetId!==void 0&&n(this._widgetId)},t.forceReset=function(){var n=this.getCaptchaFunction("reset");n&&n()},t.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},t.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},t.handleChange=function(n){this.props.onChange&&this.props.onChange(n),this.executionResolve&&(this.executionResolve(n),delete this.executionReject,delete this.executionResolve)},t.explicitRender=function(){var n=this.getCaptchaFunction("render");if(n&&this._widgetId===void 0){var i=document.createElement("div");this._widgetId=n(i,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(i)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},t.componentDidMount=function(){this.explicitRender()},t.componentDidUpdate=function(){this.explicitRender()},t.handleRecaptchaRef=function(n){this.captcha=n},t.render=function(){var n=this.props;n.sitekey,n.onChange,n.theme,n.type,n.tabindex,n.onExpired,n.onErrored,n.size,n.stoken,n.grecaptcha,n.badge,n.hl,n.isolated;var i=Ql(n,Yl);return ot.createElement("div",_s({},i,{ref:this.handleRecaptchaRef}))},e}(ot.Component);Dr.displayName="ReCAPTCHA";Dr.propTypes={sitekey:Ae.string.isRequired,onChange:Ae.func,grecaptcha:Ae.object,theme:Ae.oneOf(["dark","light"]),type:Ae.oneOf(["image","audio"]),tabindex:Ae.number,onExpired:Ae.func,onErrored:Ae.func,size:Ae.oneOf(["compact","normal","invisible"]),stoken:Ae.string,hl:Ae.string,badge:Ae.oneOf(["bottomright","bottomleft","inline"]),isolated:Ae.bool};Dr.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};var ln={exports:{}},xe={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ce=typeof Symbol=="function"&&Symbol.for,Rs=Ce?Symbol.for("react.element"):60103,As=Ce?Symbol.for("react.portal"):60106,Ir=Ce?Symbol.for("react.fragment"):60107,Fr=Ce?Symbol.for("react.strict_mode"):60108,Lr=Ce?Symbol.for("react.profiler"):60114,Ur=Ce?Symbol.for("react.provider"):60109,Mr=Ce?Symbol.for("react.context"):60110,Ps=Ce?Symbol.for("react.async_mode"):60111,Br=Ce?Symbol.for("react.concurrent_mode"):60111,Wr=Ce?Symbol.for("react.forward_ref"):60112,zr=Ce?Symbol.for("react.suspense"):60113,Zl=Ce?Symbol.for("react.suspense_list"):60120,Vr=Ce?Symbol.for("react.memo"):60115,qr=Ce?Symbol.for("react.lazy"):60116,ec=Ce?Symbol.for("react.block"):60121,tc=Ce?Symbol.for("react.fundamental"):60117,rc=Ce?Symbol.for("react.responder"):60118,sc=Ce?Symbol.for("react.scope"):60119;function Fe(r){if(typeof r=="object"&&r!==null){var e=r.$$typeof;switch(e){case Rs:switch(r=r.type,r){case Ps:case Br:case Ir:case Lr:case Fr:case zr:return r;default:switch(r=r&&r.$$typeof,r){case Mr:case Wr:case qr:case Vr:case Ur:return r;default:return e}}case As:return e}}}function cn(r){return Fe(r)===Br}xe.AsyncMode=Ps;xe.ConcurrentMode=Br;xe.ContextConsumer=Mr;xe.ContextProvider=Ur;xe.Element=Rs;xe.ForwardRef=Wr;xe.Fragment=Ir;xe.Lazy=qr;xe.Memo=Vr;xe.Portal=As;xe.Profiler=Lr;xe.StrictMode=Fr;xe.Suspense=zr;xe.isAsyncMode=function(r){return cn(r)||Fe(r)===Ps};xe.isConcurrentMode=cn;xe.isContextConsumer=function(r){return Fe(r)===Mr};xe.isContextProvider=function(r){return Fe(r)===Ur};xe.isElement=function(r){return typeof r=="object"&&r!==null&&r.$$typeof===Rs};xe.isForwardRef=function(r){return Fe(r)===Wr};xe.isFragment=function(r){return Fe(r)===Ir};xe.isLazy=function(r){return Fe(r)===qr};xe.isMemo=function(r){return Fe(r)===Vr};xe.isPortal=function(r){return Fe(r)===As};xe.isProfiler=function(r){return Fe(r)===Lr};xe.isStrictMode=function(r){return Fe(r)===Fr};xe.isSuspense=function(r){return Fe(r)===zr};xe.isValidElementType=function(r){return typeof r=="string"||typeof r=="function"||r===Ir||r===Br||r===Lr||r===Fr||r===zr||r===Zl||typeof r=="object"&&r!==null&&(r.$$typeof===qr||r.$$typeof===Vr||r.$$typeof===Ur||r.$$typeof===Mr||r.$$typeof===Wr||r.$$typeof===tc||r.$$typeof===rc||r.$$typeof===sc||r.$$typeof===ec)};xe.typeOf=Fe;ln.exports=xe;var ac=ln.exports,Ds=ac,nc={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},ic={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},oc={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},dn={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Is={};Is[Ds.ForwardRef]=oc;Is[Ds.Memo]=dn;function la(r){return Ds.isMemo(r)?dn:Is[r.$$typeof]||nc}var lc=Object.defineProperty,cc=Object.getOwnPropertyNames,ca=Object.getOwnPropertySymbols,dc=Object.getOwnPropertyDescriptor,uc=Object.getPrototypeOf,da=Object.prototype;function un(r,e,t){if(typeof e!="string"){if(da){var s=uc(e);s&&s!==da&&un(r,s,t)}var n=cc(e);ca&&(n=n.concat(ca(e)));for(var i=la(r),o=la(e),l=0;l<n.length;++l){var d=n[l];if(!ic[d]&&!(t&&t[d])&&!(o&&o[d])&&!(i&&i[d])){var c=dc(e,d);try{lc(r,d,c)}catch{}}}}return r}var hc=un;const mc=Tn(hc);function Ss(){return Ss=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},Ss.apply(this,arguments)}function fc(r,e){if(r==null)return{};var t={},s=Object.keys(r),n,i;for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&(t[n]=r[n]);return t}function gc(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.__proto__=e}var Me={},pc=0;function xc(r,e){return e=e||{},function(s){var n=s.displayName||s.name||"Component",i=function(l){gc(d,l);function d(u,h){var f;return f=l.call(this,u,h)||this,f.state={},f.__scriptURL="",f}var c=d.prototype;return c.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+pc++),this.__scriptLoaderID},c.setupScriptURL=function(){return this.__scriptURL=typeof r=="function"?r():r,this.__scriptURL},c.asyncScriptLoaderHandleLoad=function(h){var f=this;this.setState(h,function(){return f.props.asyncScriptOnLoad&&f.props.asyncScriptOnLoad(f.state)})},c.asyncScriptLoaderTriggerOnScriptLoaded=function(){var h=Me[this.__scriptURL];if(!h||!h.loaded)throw new Error("Script is not loaded.");for(var f in h.observers)h.observers[f](h);delete window[e.callbackName]},c.componentDidMount=function(){var h=this,f=this.setupScriptURL(),x=this.asyncScriptLoaderGetScriptLoaderID(),b=e,N=b.globalName,_=b.callbackName,I=b.scriptId;if(N&&typeof window[N]<"u"&&(Me[f]={loaded:!0,observers:{}}),Me[f]){var k=Me[f];if(k&&(k.loaded||k.errored)){this.asyncScriptLoaderHandleLoad(k);return}k.observers[x]=function(A){return h.asyncScriptLoaderHandleLoad(A)};return}var E={};E[x]=function(A){return h.asyncScriptLoaderHandleLoad(A)},Me[f]={loaded:!1,observers:E};var P=document.createElement("script");P.src=f,P.async=!0;for(var W in e.attributes)P.setAttribute(W,e.attributes[W]);I&&(P.id=I);var V=function(g){if(Me[f]){var m=Me[f],p=m.observers;for(var C in p)g(p[C])&&delete p[C]}};_&&typeof window<"u"&&(window[_]=function(){return h.asyncScriptLoaderTriggerOnScriptLoaded()}),P.onload=function(){var A=Me[f];A&&(A.loaded=!0,V(function(g){return _?!1:(g(A),!0)}))},P.onerror=function(){var A=Me[f];A&&(A.errored=!0,V(function(g){return g(A),!0}))},document.body.appendChild(P)},c.componentWillUnmount=function(){var h=this.__scriptURL;if(e.removeOnUnmount===!0)for(var f=document.getElementsByTagName("script"),x=0;x<f.length;x+=1)f[x].src.indexOf(h)>-1&&f[x].parentNode&&f[x].parentNode.removeChild(f[x]);var b=Me[h];b&&(delete b.observers[this.asyncScriptLoaderGetScriptLoaderID()],e.removeOnUnmount===!0&&delete Me[h])},c.render=function(){var h=e.globalName,f=this.props;f.asyncScriptOnLoad;var x=f.forwardedRef,b=fc(f,["asyncScriptOnLoad","forwardedRef"]);return h&&typeof window<"u"&&(b[h]=typeof window[h]<"u"?window[h]:void 0),b.ref=x,ot.createElement(s,b)},d}(ot.Component),o=ot.forwardRef(function(l,d){return ot.createElement(i,Ss({},l,{forwardedRef:d}))});return o.displayName="AsyncScriptLoader("+n+")",o.propTypes={asyncScriptOnLoad:Ae.func},mc(o,s)}}var ks="onloadcallback",yc="grecaptcha";function Es(){return typeof window<"u"&&window.recaptchaOptions||{}}function bc(){var r=Es(),e=r.useRecaptchaNet?"recaptcha.net":"www.google.com";return r.enterprise?"https://"+e+"/recaptcha/enterprise.js?onload="+ks+"&render=explicit":"https://"+e+"/recaptcha/api.js?onload="+ks+"&render=explicit"}const vc=xc(bc,{callbackName:ks,globalName:yc,attributes:Es().nonce?{nonce:Es().nonce}:{}})(Dr);function wc(){const r=va(),[e]=$n(),[t,s]=y.useState(!1),[n,i]=y.useState(!1),[o,l]=y.useState(!1),[d,c]=y.useState(!1),[u,h]=y.useState(null),[f,x]=y.useState(!1),[b,N]=y.useState(""),[_,I]=y.useState(null),[k,E]=y.useState({email:"",password:"",confirmPassword:""}),P=y.useRef(null);y.useEffect(()=>{const{data:{subscription:m}}=ge.auth.onAuthStateChange((v,U)=>{v==="SIGNED_UP"&&console.log("User signed up, waiting for email confirmation"),v==="SIGNED_IN"&&U&&(W("success","Welcome! You have successfully signed in to your account."),setTimeout(()=>r("/dashboard"),2e3))}),p=e.get("access_token"),C=e.get("refresh_token");return p&&C&&r("/dashboard"),()=>m.unsubscribe()},[r,e]);const W=(m,p)=>{I({type:m,message:p}),setTimeout(()=>I(null),5e3)},V=async()=>{if(!b){W("error","No email address found. Please try signing up again.");return}i(!0);try{const{error:m}=await ge.auth.resend({type:"signup",email:b,options:{emailRedirectTo:`${window.location.origin}/dashboard`}});if(m)throw m;W("success","Confirmation email has been resent. Please check your inbox.")}catch(m){W("error",m.message)}finally{i(!1)}},A=async m=>{var p,C;if(m.preventDefault(),!u){W("error","Please complete the reCAPTCHA verification.");return}if(t&&k.password!==k.confirmPassword){W("error","Passwords do not match. Please ensure both password fields are identical.");return}if(k.password.length<6){W("error","Password must be at least 6 characters long for security purposes.");return}i(!0);try{if(t){const{error:v}=await ge.auth.signUp({email:k.email,password:k.password,options:{emailRedirectTo:`${window.location.origin}/dashboard`}});if(v)throw v;N(k.email),x(!0),W("success","Account created successfully! We've sent a confirmation email to your inbox. Please check your email and click the confirmation link to activate your account."),E({email:"",password:"",confirmPassword:""}),(p=P.current)==null||p.reset(),h(null)}else{const{error:v}=await ge.auth.signInWithPassword({email:k.email,password:k.password});if(v)throw v.message.includes("Invalid login credentials")?new Error("The email or password you entered is incorrect. Please check your credentials and try again."):v.message.includes("Email not confirmed")?new Error("Please check your email and click the confirmation link to activate your account before signing in."):v}}catch(v){W("error",v.message),(C=P.current)==null||C.reset(),h(null)}finally{i(!1)}},g=m=>{E({...k,[m.target.name]:m.target.value})};return f?a.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-[#0B1121] relative overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 neural-grid opacity-10"}),a.jsxs("div",{className:"absolute inset-0",children:[a.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 h-64 bg-primary-500/10 rounded-full blur-3xl animate-pulse"}),a.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-64 h-64 bg-primary-500/10 rounded-full blur-3xl animate-pulse animation-delay-2000"})]}),_&&a.jsxs("div",{className:`fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg flex items-center space-x-3 max-w-md ${_.type==="success"?"bg-green-500":_.type==="error"?"bg-red-500":"bg-blue-500"}`,children:[_.type==="success"?a.jsx(Qe,{className:"w-5 h-5 flex-shrink-0"}):a.jsx(Dt,{className:"w-5 h-5 flex-shrink-0"}),a.jsx("span",{className:"text-white text-sm",children:_.message})]}),a.jsxs("div",{className:"bg-[#151F32]/50 p-8 rounded-2xl border border-[#1E293B] backdrop-blur-sm max-w-md w-full mx-4 relative",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("div",{className:"mx-auto w-16 h-16 bg-primary-500/10 rounded-full flex items-center justify-center mb-4",children:a.jsx(Qe,{className:"w-8 h-8 text-primary-500"})}),a.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Check Your Email"}),a.jsx("p",{className:"text-gray-300 mb-4 leading-relaxed",children:"We've sent a confirmation email to:"}),a.jsx("div",{className:"bg-[#1E293B] rounded-lg p-3 mb-4",children:a.jsx("p",{className:"text-primary-400 font-medium",children:b})}),a.jsx("p",{className:"text-gray-400 text-sm mb-6",children:"Click the confirmation link in the email to activate your account. The link will expire in 24 hours for security."})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("button",{onClick:V,disabled:n,className:"w-full py-3 px-4 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-all duration-200",children:n?"Sending...":"Resend Confirmation Email"}),a.jsx("button",{onClick:()=>{x(!1),N(""),s(!1)},className:"w-full py-3 px-4 bg-[#1E293B] hover:bg-[#2D3B4E] text-gray-300 font-medium rounded-lg transition-all duration-200",children:"Back to Sign In"})]}),a.jsx("div",{className:"mt-6 text-center",children:a.jsx("p",{className:"text-gray-400 text-sm",children:"Didn't receive the email? Check your spam folder or try resending."})})]})]}):a.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-[#0B1121] relative overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 neural-grid opacity-10"}),a.jsxs("div",{className:"absolute inset-0",children:[a.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 h-64 bg-primary-500/10 rounded-full blur-3xl animate-pulse"}),a.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-64 h-64 bg-primary-500/10 rounded-full blur-3xl animate-pulse animation-delay-2000"})]}),_&&a.jsxs("div",{className:`fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg flex items-center space-x-3 max-w-md ${_.type==="success"?"bg-green-500":_.type==="error"?"bg-red-500":"bg-blue-500"}`,children:[_.type==="success"?a.jsx(Qe,{className:"w-5 h-5 flex-shrink-0"}):a.jsx(Dt,{className:"w-5 h-5 flex-shrink-0"}),a.jsx("span",{className:"text-white text-sm",children:_.message})]}),a.jsxs("div",{className:"w-full max-w-6xl grid grid-cols-1 md:grid-cols-2 gap-8 p-4 relative",children:[a.jsxs("div",{className:"hidden md:flex flex-col items-center justify-center p-6 lg:p-8 relative overflow-hidden bg-[#151F32]/50 rounded-2xl border border-[#1E293B]",children:[a.jsx("div",{className:"absolute inset-0 neural-grid opacity-20"}),a.jsx("img",{src:"https://iqehkneolpesaqznkqjm.supabase.co/storage/v1/object/sign/assets/m6-motorway-trim-result.gif?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV83YmM1YjM5OS00ZDQwLTRiMDktOGE3Yi1kOWMxNzlkNjcyM2UiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJhc3NldHMvbTYtbW90b3J3YXktdHJpbS1yZXN1bHQuZ2lmIiwiaWF0IjoxNzU4NzMwMDYyLCJleHAiOjMxNTUzNTg3MzAwNjJ9.pKZVb8o3SVRrZ_N5WGWNcrRI59hyZ-tcNongThzTQs4",alt:"AI Traffic Analysis",className:"rounded-xl shadow-2xl relative z-10 animate-float object-cover h-[300px] lg:h-[400px] w-full max-w-full"}),a.jsxs("div",{className:"mt-6 lg:mt-8 text-center relative z-10 text-gray-300",children:[a.jsx("h2",{className:"text-xl lg:text-2xl font-bold mb-2 lg:mb-4",children:"Project 49"}),a.jsx("p",{className:"text-sm lg:text-base text-gray-400",children:"Road-User Behaviour Analysis Using AI & Computer Vision"})]})]}),a.jsxs("div",{className:"bg-[#151F32]/50 p-6 sm:p-8 rounded-2xl border border-[#1E293B] backdrop-blur-sm",children:[a.jsx("div",{className:"flex justify-between items-center mb-8",children:a.jsxs(at,{to:"/",className:"flex items-center text-gray-300 hover:text-white transition-colors",children:[a.jsx(zn,{className:"w-5 h-5 mr-2"}),"Back to Home"]})}),a.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-2 text-white",children:t?"Create Account":"Welcome Back"}),a.jsx("p",{className:"text-sm sm:text-base text-gray-400 mb-6 sm:mb-8",children:t?"Join Project 49 to access advanced traffic analysis tools":"Sign in to your account to continue"}),a.jsxs("form",{onSubmit:A,className:"space-y-4 sm:space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email Address"}),a.jsx("input",{type:"email",name:"email",value:k.email,onChange:g,required:!0,className:"w-full px-3 sm:px-4 py-2 sm:py-3 bg-[#1E293B] border border-[#334155] rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-primary-400 focus:ring-2 focus:ring-primary-400/20 transition-all text-sm sm:text-base",placeholder:"Enter your email address"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:o?"text":"password",name:"password",value:k.password,onChange:g,required:!0,minLength:6,className:"w-full px-3 sm:px-4 py-2 sm:py-3 bg-[#1E293B] border border-[#334155] rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-primary-400 focus:ring-2 focus:ring-primary-400/20 transition-all pr-10 sm:pr-12 text-sm sm:text-base",placeholder:"Enter your password"}),a.jsx("button",{type:"button",onClick:()=>l(!o),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white transition-colors",children:o?a.jsx(Bs,{className:"w-5 h-5"}):a.jsx(jr,{className:"w-5 h-5"})})]})]}),t&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Confirm Password"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:d?"text":"password",name:"confirmPassword",value:k.confirmPassword,onChange:g,required:!0,minLength:6,className:"w-full px-3 sm:px-4 py-2 sm:py-3 bg-[#1E293B] border border-[#334155] rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-primary-400 focus:ring-2 focus:ring-primary-400/20 transition-all pr-10 sm:pr-12 text-sm sm:text-base",placeholder:"Confirm your password"}),a.jsx("button",{type:"button",onClick:()=>c(!d),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white transition-colors",children:d?a.jsx(Bs,{className:"w-5 h-5"}):a.jsx(jr,{className:"w-5 h-5"})})]})]}),a.jsx("div",{className:"flex justify-center",children:a.jsx(vc,{ref:P,sitekey:"6Le0Q7wrAAAAAABAh2pXfgRl2nCAWyhvY40ns4Ye",onChange:h,theme:"dark"})}),a.jsx("button",{type:"submit",disabled:n||!u,className:"w-full py-2 sm:py-3 px-4 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-400/20 text-sm sm:text-base",children:n?a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),t?"Creating Account...":"Signing In..."]}):t?"Create Account":"Sign In"}),a.jsx("div",{className:"text-center",children:a.jsx("button",{type:"button",onClick:()=>{var m;s(!t),E({email:"",password:"",confirmPassword:""}),I(null),(m=P.current)==null||m.reset(),h(null)},className:"text-sm sm:text-base text-primary-400 hover:text-primary-300 transition-colors",children:t?"Already have an account? Sign in here":"Need an account? Create one here"})})]})]})]})]})}function be(r){const e=Object.prototype.toString.call(r);return r instanceof Date||typeof r=="object"&&e==="[object Date]"?new r.constructor(+r):typeof r=="number"||e==="[object Number]"||typeof r=="string"||e==="[object String]"?new Date(r):new Date(NaN)}function ct(r,e){return r instanceof Date?new r.constructor(e):new Date(e)}const hn=6048e5,jc=864e5,mn=6e4,fn=36e5,yr=43200,ua=1440;let _c={};function lr(){return _c}function nr(r,e){var l,d,c,u;const t=lr(),s=(e==null?void 0:e.weekStartsOn)??((d=(l=e==null?void 0:e.locale)==null?void 0:l.options)==null?void 0:d.weekStartsOn)??t.weekStartsOn??((u=(c=t.locale)==null?void 0:c.options)==null?void 0:u.weekStartsOn)??0,n=be(r),i=n.getDay(),o=(i<s?7:0)+i-s;return n.setDate(n.getDate()-o),n.setHours(0,0,0,0),n}function Er(r){return nr(r,{weekStartsOn:1})}function gn(r){const e=be(r),t=e.getFullYear(),s=ct(r,0);s.setFullYear(t+1,0,4),s.setHours(0,0,0,0);const n=Er(s),i=ct(r,0);i.setFullYear(t,0,4),i.setHours(0,0,0,0);const o=Er(i);return e.getTime()>=n.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function ha(r){const e=be(r);return e.setHours(0,0,0,0),e}function Cr(r){const e=be(r),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+r-+t}function Nc(r,e){const t=ha(r),s=ha(e),n=+t-Cr(t),i=+s-Cr(s);return Math.round((n-i)/jc)}function Sc(r){const e=gn(r),t=ct(r,0);return t.setFullYear(e,0,4),t.setHours(0,0,0,0),Er(t)}function wr(r,e){const t=be(r),s=be(e),n=t.getTime()-s.getTime();return n<0?-1:n>0?1:n}function kc(r){return ct(r,Date.now())}function Ec(r){return r instanceof Date||typeof r=="object"&&Object.prototype.toString.call(r)==="[object Date]"}function Cc(r){if(!Ec(r)&&typeof r!="number")return!1;const e=be(r);return!isNaN(Number(e))}function Tc(r,e){const t=be(r),s=be(e),n=t.getFullYear()-s.getFullYear(),i=t.getMonth()-s.getMonth();return n*12+i}function $c(r){return e=>{const s=(r?Math[r]:Math.trunc)(e);return s===0?0:s}}function Oc(r,e){return+be(r)-+be(e)}function Rc(r){const e=be(r);return e.setHours(23,59,59,999),e}function Ac(r){const e=be(r),t=e.getMonth();return e.setFullYear(e.getFullYear(),t+1,0),e.setHours(23,59,59,999),e}function Pc(r){const e=be(r);return+Rc(e)==+Ac(e)}function Dc(r,e){const t=be(r),s=be(e),n=wr(t,s),i=Math.abs(Tc(t,s));let o;if(i<1)o=0;else{t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-n*i);let l=wr(t,s)===-n;Pc(be(r))&&i===1&&wr(r,s)===1&&(l=!1),o=n*(i-Number(l))}return o===0?0:o}function Ic(r,e,t){const s=Oc(r,e)/1e3;return $c(t==null?void 0:t.roundingMethod)(s)}function Fc(r){const e=be(r),t=ct(r,0);return t.setFullYear(e.getFullYear(),0,1),t.setHours(0,0,0,0),t}const Lc={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Uc=(r,e,t)=>{let s;const n=Lc[r];return typeof n=="string"?s=n:e===1?s=n.one:s=n.other.replace("{{count}}",e.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+s:s+" ago":s};function ts(r){return(e={})=>{const t=e.width?String(e.width):r.defaultWidth;return r.formats[t]||r.formats[r.defaultWidth]}}const Mc={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Bc={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Wc={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},zc={date:ts({formats:Mc,defaultWidth:"full"}),time:ts({formats:Bc,defaultWidth:"full"}),dateTime:ts({formats:Wc,defaultWidth:"full"})},Vc={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},qc=(r,e,t,s)=>Vc[r];function Kt(r){return(e,t)=>{const s=t!=null&&t.context?String(t.context):"standalone";let n;if(s==="formatting"&&r.formattingValues){const o=r.defaultFormattingWidth||r.defaultWidth,l=t!=null&&t.width?String(t.width):o;n=r.formattingValues[l]||r.formattingValues[o]}else{const o=r.defaultWidth,l=t!=null&&t.width?String(t.width):r.defaultWidth;n=r.values[l]||r.values[o]}const i=r.argumentCallback?r.argumentCallback(e):e;return n[i]}}const Hc={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Kc={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Jc={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Gc={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Yc={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Qc={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Xc=(r,e)=>{const t=Number(r),s=t%100;if(s>20||s<10)switch(s%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},Zc={ordinalNumber:Xc,era:Kt({values:Hc,defaultWidth:"wide"}),quarter:Kt({values:Kc,defaultWidth:"wide",argumentCallback:r=>r-1}),month:Kt({values:Jc,defaultWidth:"wide"}),day:Kt({values:Gc,defaultWidth:"wide"}),dayPeriod:Kt({values:Yc,defaultWidth:"wide",formattingValues:Qc,defaultFormattingWidth:"wide"})};function Jt(r){return(e,t={})=>{const s=t.width,n=s&&r.matchPatterns[s]||r.matchPatterns[r.defaultMatchWidth],i=e.match(n);if(!i)return null;const o=i[0],l=s&&r.parsePatterns[s]||r.parsePatterns[r.defaultParseWidth],d=Array.isArray(l)?td(l,h=>h.test(o)):ed(l,h=>h.test(o));let c;c=r.valueCallback?r.valueCallback(d):d,c=t.valueCallback?t.valueCallback(c):c;const u=e.slice(o.length);return{value:c,rest:u}}}function ed(r,e){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&e(r[t]))return t}function td(r,e){for(let t=0;t<r.length;t++)if(e(r[t]))return t}function rd(r){return(e,t={})=>{const s=e.match(r.matchPattern);if(!s)return null;const n=s[0],i=e.match(r.parsePattern);if(!i)return null;let o=r.valueCallback?r.valueCallback(i[0]):i[0];o=t.valueCallback?t.valueCallback(o):o;const l=e.slice(n.length);return{value:o,rest:l}}}const sd=/^(\d+)(th|st|nd|rd)?/i,ad=/\d+/i,nd={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},id={any:[/^b/i,/^(a|c)/i]},od={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},ld={any:[/1/i,/2/i,/3/i,/4/i]},cd={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},dd={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},ud={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},hd={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},md={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},fd={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},gd={ordinalNumber:rd({matchPattern:sd,parsePattern:ad,valueCallback:r=>parseInt(r,10)}),era:Jt({matchPatterns:nd,defaultMatchWidth:"wide",parsePatterns:id,defaultParseWidth:"any"}),quarter:Jt({matchPatterns:od,defaultMatchWidth:"wide",parsePatterns:ld,defaultParseWidth:"any",valueCallback:r=>r+1}),month:Jt({matchPatterns:cd,defaultMatchWidth:"wide",parsePatterns:dd,defaultParseWidth:"any"}),day:Jt({matchPatterns:ud,defaultMatchWidth:"wide",parsePatterns:hd,defaultParseWidth:"any"}),dayPeriod:Jt({matchPatterns:md,defaultMatchWidth:"any",parsePatterns:fd,defaultParseWidth:"any"})},pn={code:"en-US",formatDistance:Uc,formatLong:zc,formatRelative:qc,localize:Zc,match:gd,options:{weekStartsOn:0,firstWeekContainsDate:1}};function pd(r){const e=be(r);return Nc(e,Fc(e))+1}function xd(r){const e=be(r),t=+Er(e)-+Sc(e);return Math.round(t/hn)+1}function xn(r,e){var u,h,f,x;const t=be(r),s=t.getFullYear(),n=lr(),i=(e==null?void 0:e.firstWeekContainsDate)??((h=(u=e==null?void 0:e.locale)==null?void 0:u.options)==null?void 0:h.firstWeekContainsDate)??n.firstWeekContainsDate??((x=(f=n.locale)==null?void 0:f.options)==null?void 0:x.firstWeekContainsDate)??1,o=ct(r,0);o.setFullYear(s+1,0,i),o.setHours(0,0,0,0);const l=nr(o,e),d=ct(r,0);d.setFullYear(s,0,i),d.setHours(0,0,0,0);const c=nr(d,e);return t.getTime()>=l.getTime()?s+1:t.getTime()>=c.getTime()?s:s-1}function yd(r,e){var l,d,c,u;const t=lr(),s=(e==null?void 0:e.firstWeekContainsDate)??((d=(l=e==null?void 0:e.locale)==null?void 0:l.options)==null?void 0:d.firstWeekContainsDate)??t.firstWeekContainsDate??((u=(c=t.locale)==null?void 0:c.options)==null?void 0:u.firstWeekContainsDate)??1,n=xn(r,e),i=ct(r,0);return i.setFullYear(n,0,s),i.setHours(0,0,0,0),nr(i,e)}function bd(r,e){const t=be(r),s=+nr(t,e)-+yd(t,e);return Math.round(s/hn)+1}function pe(r,e){const t=r<0?"-":"",s=Math.abs(r).toString().padStart(e,"0");return t+s}const rt={y(r,e){const t=r.getFullYear(),s=t>0?t:1-t;return pe(e==="yy"?s%100:s,e.length)},M(r,e){const t=r.getMonth();return e==="M"?String(t+1):pe(t+1,2)},d(r,e){return pe(r.getDate(),e.length)},a(r,e){const t=r.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(r,e){return pe(r.getHours()%12||12,e.length)},H(r,e){return pe(r.getHours(),e.length)},m(r,e){return pe(r.getMinutes(),e.length)},s(r,e){return pe(r.getSeconds(),e.length)},S(r,e){const t=e.length,s=r.getMilliseconds(),n=Math.trunc(s*Math.pow(10,t-3));return pe(n,e.length)}},Ot={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},ma={G:function(r,e,t){const s=r.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(s,{width:"abbreviated"});case"GGGGG":return t.era(s,{width:"narrow"});case"GGGG":default:return t.era(s,{width:"wide"})}},y:function(r,e,t){if(e==="yo"){const s=r.getFullYear(),n=s>0?s:1-s;return t.ordinalNumber(n,{unit:"year"})}return rt.y(r,e)},Y:function(r,e,t,s){const n=xn(r,s),i=n>0?n:1-n;if(e==="YY"){const o=i%100;return pe(o,2)}return e==="Yo"?t.ordinalNumber(i,{unit:"year"}):pe(i,e.length)},R:function(r,e){const t=gn(r);return pe(t,e.length)},u:function(r,e){const t=r.getFullYear();return pe(t,e.length)},Q:function(r,e,t){const s=Math.ceil((r.getMonth()+1)/3);switch(e){case"Q":return String(s);case"QQ":return pe(s,2);case"Qo":return t.ordinalNumber(s,{unit:"quarter"});case"QQQ":return t.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(s,{width:"wide",context:"formatting"})}},q:function(r,e,t){const s=Math.ceil((r.getMonth()+1)/3);switch(e){case"q":return String(s);case"qq":return pe(s,2);case"qo":return t.ordinalNumber(s,{unit:"quarter"});case"qqq":return t.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(s,{width:"wide",context:"standalone"})}},M:function(r,e,t){const s=r.getMonth();switch(e){case"M":case"MM":return rt.M(r,e);case"Mo":return t.ordinalNumber(s+1,{unit:"month"});case"MMM":return t.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(s,{width:"wide",context:"formatting"})}},L:function(r,e,t){const s=r.getMonth();switch(e){case"L":return String(s+1);case"LL":return pe(s+1,2);case"Lo":return t.ordinalNumber(s+1,{unit:"month"});case"LLL":return t.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(s,{width:"wide",context:"standalone"})}},w:function(r,e,t,s){const n=bd(r,s);return e==="wo"?t.ordinalNumber(n,{unit:"week"}):pe(n,e.length)},I:function(r,e,t){const s=xd(r);return e==="Io"?t.ordinalNumber(s,{unit:"week"}):pe(s,e.length)},d:function(r,e,t){return e==="do"?t.ordinalNumber(r.getDate(),{unit:"date"}):rt.d(r,e)},D:function(r,e,t){const s=pd(r);return e==="Do"?t.ordinalNumber(s,{unit:"dayOfYear"}):pe(s,e.length)},E:function(r,e,t){const s=r.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(s,{width:"short",context:"formatting"});case"EEEE":default:return t.day(s,{width:"wide",context:"formatting"})}},e:function(r,e,t,s){const n=r.getDay(),i=(n-s.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return pe(i,2);case"eo":return t.ordinalNumber(i,{unit:"day"});case"eee":return t.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(n,{width:"short",context:"formatting"});case"eeee":default:return t.day(n,{width:"wide",context:"formatting"})}},c:function(r,e,t,s){const n=r.getDay(),i=(n-s.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return pe(i,e.length);case"co":return t.ordinalNumber(i,{unit:"day"});case"ccc":return t.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(n,{width:"narrow",context:"standalone"});case"cccccc":return t.day(n,{width:"short",context:"standalone"});case"cccc":default:return t.day(n,{width:"wide",context:"standalone"})}},i:function(r,e,t){const s=r.getDay(),n=s===0?7:s;switch(e){case"i":return String(n);case"ii":return pe(n,e.length);case"io":return t.ordinalNumber(n,{unit:"day"});case"iii":return t.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(s,{width:"short",context:"formatting"});case"iiii":default:return t.day(s,{width:"wide",context:"formatting"})}},a:function(r,e,t){const n=r.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(r,e,t){const s=r.getHours();let n;switch(s===12?n=Ot.noon:s===0?n=Ot.midnight:n=s/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(r,e,t){const s=r.getHours();let n;switch(s>=17?n=Ot.evening:s>=12?n=Ot.afternoon:s>=4?n=Ot.morning:n=Ot.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(r,e,t){if(e==="ho"){let s=r.getHours()%12;return s===0&&(s=12),t.ordinalNumber(s,{unit:"hour"})}return rt.h(r,e)},H:function(r,e,t){return e==="Ho"?t.ordinalNumber(r.getHours(),{unit:"hour"}):rt.H(r,e)},K:function(r,e,t){const s=r.getHours()%12;return e==="Ko"?t.ordinalNumber(s,{unit:"hour"}):pe(s,e.length)},k:function(r,e,t){let s=r.getHours();return s===0&&(s=24),e==="ko"?t.ordinalNumber(s,{unit:"hour"}):pe(s,e.length)},m:function(r,e,t){return e==="mo"?t.ordinalNumber(r.getMinutes(),{unit:"minute"}):rt.m(r,e)},s:function(r,e,t){return e==="so"?t.ordinalNumber(r.getSeconds(),{unit:"second"}):rt.s(r,e)},S:function(r,e){return rt.S(r,e)},X:function(r,e,t){const s=r.getTimezoneOffset();if(s===0)return"Z";switch(e){case"X":return ga(s);case"XXXX":case"XX":return xt(s);case"XXXXX":case"XXX":default:return xt(s,":")}},x:function(r,e,t){const s=r.getTimezoneOffset();switch(e){case"x":return ga(s);case"xxxx":case"xx":return xt(s);case"xxxxx":case"xxx":default:return xt(s,":")}},O:function(r,e,t){const s=r.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+fa(s,":");case"OOOO":default:return"GMT"+xt(s,":")}},z:function(r,e,t){const s=r.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+fa(s,":");case"zzzz":default:return"GMT"+xt(s,":")}},t:function(r,e,t){const s=Math.trunc(r.getTime()/1e3);return pe(s,e.length)},T:function(r,e,t){const s=r.getTime();return pe(s,e.length)}};function fa(r,e=""){const t=r>0?"-":"+",s=Math.abs(r),n=Math.trunc(s/60),i=s%60;return i===0?t+String(n):t+String(n)+e+pe(i,2)}function ga(r,e){return r%60===0?(r>0?"-":"+")+pe(Math.abs(r)/60,2):xt(r,e)}function xt(r,e=""){const t=r>0?"-":"+",s=Math.abs(r),n=pe(Math.trunc(s/60),2),i=pe(s%60,2);return t+n+e+i}const pa=(r,e)=>{switch(r){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},yn=(r,e)=>{switch(r){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},vd=(r,e)=>{const t=r.match(/(P+)(p+)?/)||[],s=t[1],n=t[2];if(!n)return pa(r,e);let i;switch(s){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",pa(s,e)).replace("{{time}}",yn(n,e))},wd={p:yn,P:vd},jd=/^D+$/,_d=/^Y+$/,Nd=["D","DD","YY","YYYY"];function Sd(r){return jd.test(r)}function kd(r){return _d.test(r)}function Ed(r,e,t){const s=Cd(r,e,t);if(console.warn(s),Nd.includes(r))throw new RangeError(s)}function Cd(r,e,t){const s=r[0]==="Y"?"years":"days of the month";return`Use \`${r.toLowerCase()}\` instead of \`${r}\` (in \`${e}\`) for formatting ${s} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Td=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,$d=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Od=/^'([^]*?)'?$/,Rd=/''/g,Ad=/[a-zA-Z]/;function er(r,e,t){var u,h,f,x;const s=lr(),n=s.locale??pn,i=s.firstWeekContainsDate??((h=(u=s.locale)==null?void 0:u.options)==null?void 0:h.firstWeekContainsDate)??1,o=s.weekStartsOn??((x=(f=s.locale)==null?void 0:f.options)==null?void 0:x.weekStartsOn)??0,l=be(r);if(!Cc(l))throw new RangeError("Invalid time value");let d=e.match($d).map(b=>{const N=b[0];if(N==="p"||N==="P"){const _=wd[N];return _(b,n.formatLong)}return b}).join("").match(Td).map(b=>{if(b==="''")return{isToken:!1,value:"'"};const N=b[0];if(N==="'")return{isToken:!1,value:Pd(b)};if(ma[N])return{isToken:!0,value:b};if(N.match(Ad))throw new RangeError("Format string contains an unescaped latin alphabet character `"+N+"`");return{isToken:!1,value:b}});n.localize.preprocessor&&(d=n.localize.preprocessor(l,d));const c={firstWeekContainsDate:i,weekStartsOn:o,locale:n};return d.map(b=>{if(!b.isToken)return b.value;const N=b.value;(kd(N)||Sd(N))&&Ed(N,e,String(r));const _=ma[N[0]];return _(l,N,n.localize,c)}).join("")}function Pd(r){const e=r.match(Od);return e?e[1].replace(Rd,"'"):r}function Dd(r,e,t){const s=lr(),n=(t==null?void 0:t.locale)??s.locale??pn,i=2520,o=wr(r,e);if(isNaN(o))throw new RangeError("Invalid time value");const l=Object.assign({},t,{addSuffix:t==null?void 0:t.addSuffix,comparison:o});let d,c;o>0?(d=be(e),c=be(r)):(d=be(r),c=be(e));const u=Ic(c,d),h=(Cr(c)-Cr(d))/1e3,f=Math.round((u-h)/60);let x;if(f<2)return t!=null&&t.includeSeconds?u<5?n.formatDistance("lessThanXSeconds",5,l):u<10?n.formatDistance("lessThanXSeconds",10,l):u<20?n.formatDistance("lessThanXSeconds",20,l):u<40?n.formatDistance("halfAMinute",0,l):u<60?n.formatDistance("lessThanXMinutes",1,l):n.formatDistance("xMinutes",1,l):f===0?n.formatDistance("lessThanXMinutes",1,l):n.formatDistance("xMinutes",f,l);if(f<45)return n.formatDistance("xMinutes",f,l);if(f<90)return n.formatDistance("aboutXHours",1,l);if(f<ua){const b=Math.round(f/60);return n.formatDistance("aboutXHours",b,l)}else{if(f<i)return n.formatDistance("xDays",1,l);if(f<yr){const b=Math.round(f/ua);return n.formatDistance("xDays",b,l)}else if(f<yr*2)return x=Math.round(f/yr),n.formatDistance("aboutXMonths",x,l)}if(x=Dc(c,d),x<12){const b=Math.round(f/yr);return n.formatDistance("xMonths",b,l)}else{const b=x%12,N=Math.trunc(x/12);return b<3?n.formatDistance("aboutXYears",N,l):b<9?n.formatDistance("overXYears",N,l):n.formatDistance("almostXYears",N+1,l)}}function Id(r,e){return Dd(r,kc(r),e)}function Ft(r,e){const s=Md(r);let n;if(s.date){const d=Bd(s.date,2);n=Wd(d.restDateString,d.year)}if(!n||isNaN(n.getTime()))return new Date(NaN);const i=n.getTime();let o=0,l;if(s.time&&(o=zd(s.time),isNaN(o)))return new Date(NaN);if(s.timezone){if(l=Vd(s.timezone),isNaN(l))return new Date(NaN)}else{const d=new Date(i+o),c=new Date(0);return c.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),c.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),c}return new Date(i+o+l)}const br={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Fd=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Ld=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Ud=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Md(r){const e={},t=r.split(br.dateTimeDelimiter);let s;if(t.length>2)return e;if(/:/.test(t[0])?s=t[0]:(e.date=t[0],s=t[1],br.timeZoneDelimiter.test(e.date)&&(e.date=r.split(br.timeZoneDelimiter)[0],s=r.substr(e.date.length,r.length))),s){const n=br.timezone.exec(s);n?(e.time=s.replace(n[1],""),e.timezone=n[1]):e.time=s}return e}function Bd(r,e){const t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),s=r.match(t);if(!s)return{year:NaN,restDateString:""};const n=s[1]?parseInt(s[1]):null,i=s[2]?parseInt(s[2]):null;return{year:i===null?n:i*100,restDateString:r.slice((s[1]||s[2]).length)}}function Wd(r,e){if(e===null)return new Date(NaN);const t=r.match(Fd);if(!t)return new Date(NaN);const s=!!t[4],n=Gt(t[1]),i=Gt(t[2])-1,o=Gt(t[3]),l=Gt(t[4]),d=Gt(t[5])-1;if(s)return Gd(e,l,d)?qd(e,l,d):new Date(NaN);{const c=new Date(0);return!Kd(e,i,o)||!Jd(e,n)?new Date(NaN):(c.setUTCFullYear(e,i,Math.max(n,o)),c)}}function Gt(r){return r?parseInt(r):1}function zd(r){const e=r.match(Ld);if(!e)return NaN;const t=rs(e[1]),s=rs(e[2]),n=rs(e[3]);return Yd(t,s,n)?t*fn+s*mn+n*1e3:NaN}function rs(r){return r&&parseFloat(r.replace(",","."))||0}function Vd(r){if(r==="Z")return 0;const e=r.match(Ud);if(!e)return 0;const t=e[1]==="+"?-1:1,s=parseInt(e[2]),n=e[3]&&parseInt(e[3])||0;return Qd(s,n)?t*(s*fn+n*mn):NaN}function qd(r,e,t){const s=new Date(0);s.setUTCFullYear(r,0,4);const n=s.getUTCDay()||7,i=(e-1)*7+t+1-n;return s.setUTCDate(s.getUTCDate()+i),s}const Hd=[31,null,31,30,31,30,31,31,30,31,30,31];function bn(r){return r%400===0||r%4===0&&r%100!==0}function Kd(r,e,t){return e>=0&&e<=11&&t>=1&&t<=(Hd[e]||(bn(r)?29:28))}function Jd(r,e){return e>=1&&e<=(bn(r)?366:365)}function Gd(r,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function Yd(r,e,t){return r===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&r>=0&&r<25}function Qd(r,e){return e>=0&&e<=59}var Xd={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/(function(r,e){((t,s)=>{r.exports=s()})(Ie,function t(){var s=typeof self<"u"?self:typeof window<"u"?window:s!==void 0?s:{},n,i=!s.document&&!!s.postMessage,o=s.IS_PAPA_WORKER||!1,l={},d=0,c={};function u(g){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(m){var p=W(m);p.chunkSize=parseInt(p.chunkSize),m.step||m.chunk||(p.chunkSize=null),this._handle=new N(p),(this._handle.streamer=this)._config=p}).call(this,g),this.parseChunk=function(m,p){var C=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<C){let U=this._config.newline;U||(v=this._config.quoteChar||'"',U=this._handle.guessLineEndings(m,v)),m=[...m.split(U).slice(C)].join(U)}this.isFirstChunk&&A(this._config.beforeFirstChunk)&&(v=this._config.beforeFirstChunk(m))!==void 0&&(m=v),this.isFirstChunk=!1,this._halted=!1;var C=this._partialLine+m,v=(this._partialLine="",this._handle.parse(C,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(m=v.meta.cursor,C=(this._finished||(this._partialLine=C.substring(m-this._baseIndex),this._baseIndex=m),v&&v.data&&(this._rowCount+=v.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),o)s.postMessage({results:v,workerId:c.WORKER_ID,finished:C});else if(A(this._config.chunk)&&!p){if(this._config.chunk(v,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=v=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(v.data),this._completeResults.errors=this._completeResults.errors.concat(v.errors),this._completeResults.meta=v.meta),this._completed||!C||!A(this._config.complete)||v&&v.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),C||v&&v.meta.paused||this._nextChunk(),v}this._halted=!0},this._sendError=function(m){A(this._config.error)?this._config.error(m):o&&this._config.error&&s.postMessage({workerId:c.WORKER_ID,error:m,finished:!1})}}function h(g){var m;(g=g||{}).chunkSize||(g.chunkSize=c.RemoteChunkSize),u.call(this,g),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(p){this._input=p,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(m=new XMLHttpRequest,this._config.withCredentials&&(m.withCredentials=this._config.withCredentials),i||(m.onload=V(this._chunkLoaded,this),m.onerror=V(this._chunkError,this)),m.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var p,C=this._config.downloadRequestHeaders;for(p in C)m.setRequestHeader(p,C[p])}var v;this._config.chunkSize&&(v=this._start+this._config.chunkSize-1,m.setRequestHeader("Range","bytes="+this._start+"-"+v));try{m.send(this._config.downloadRequestBody)}catch(U){this._chunkError(U.message)}i&&m.status===0&&this._chunkError()}},this._chunkLoaded=function(){m.readyState===4&&(m.status<200||400<=m.status?this._chunkError():(this._start+=this._config.chunkSize||m.responseText.length,this._finished=!this._config.chunkSize||this._start>=(p=>(p=p.getResponseHeader("Content-Range"))!==null?parseInt(p.substring(p.lastIndexOf("/")+1)):-1)(m),this.parseChunk(m.responseText)))},this._chunkError=function(p){p=m.statusText||p,this._sendError(new Error(p))}}function f(g){(g=g||{}).chunkSize||(g.chunkSize=c.LocalChunkSize),u.call(this,g);var m,p,C=typeof FileReader<"u";this.stream=function(v){this._input=v,p=v.slice||v.webkitSlice||v.mozSlice,C?((m=new FileReader).onload=V(this._chunkLoaded,this),m.onerror=V(this._chunkError,this)):m=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var v=this._input,U=(this._config.chunkSize&&(U=Math.min(this._start+this._config.chunkSize,this._input.size),v=p.call(v,this._start,U)),m.readAsText(v,this._config.encoding));C||this._chunkLoaded({target:{result:U}})},this._chunkLoaded=function(v){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(v.target.result)},this._chunkError=function(){this._sendError(m.error)}}function x(g){var m;u.call(this,g=g||{}),this.stream=function(p){return m=p,this._nextChunk()},this._nextChunk=function(){var p,C;if(!this._finished)return p=this._config.chunkSize,m=p?(C=m.substring(0,p),m.substring(p)):(C=m,""),this._finished=!m,this.parseChunk(C)}}function b(g){u.call(this,g=g||{});var m=[],p=!0,C=!1;this.pause=function(){u.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){u.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(v){this._input=v,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){C&&m.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),m.length?this.parseChunk(m.shift()):p=!0},this._streamData=V(function(v){try{m.push(typeof v=="string"?v:v.toString(this._config.encoding)),p&&(p=!1,this._checkIsFinished(),this.parseChunk(m.shift()))}catch(U){this._streamError(U)}},this),this._streamError=V(function(v){this._streamCleanUp(),this._sendError(v)},this),this._streamEnd=V(function(){this._streamCleanUp(),C=!0,this._streamData("")},this),this._streamCleanUp=V(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function N(g){var m,p,C,v,U=Math.pow(2,53),Y=-U,ve=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,de=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,re=this,he=0,G=0,me=!1,te=!1,Q=[],M={data:[],errors:[],meta:{}};function ae(S){return g.skipEmptyLines==="greedy"?S.join("").trim()==="":S.length===1&&S[0].length===0}function w(){if(M&&C&&(q("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+c.DefaultDelimiter+"'"),C=!1),g.skipEmptyLines&&(M.data=M.data.filter(function(B){return!ae(B)})),D()){let B=function(j,O){A(g.transformHeader)&&(j=g.transformHeader(j,O)),Q.push(j)};if(M)if(Array.isArray(M.data[0])){for(var S=0;D()&&S<M.data.length;S++)M.data[S].forEach(B);M.data.splice(0,1)}else M.data.forEach(B)}function F(B,j){for(var O=g.header?{}:[],R=0;R<B.length;R++){var H=R,Z=B[R],Z=((J,ee)=>(ue=>(g.dynamicTypingFunction&&g.dynamicTyping[ue]===void 0&&(g.dynamicTyping[ue]=g.dynamicTypingFunction(ue)),(g.dynamicTyping[ue]||g.dynamicTyping)===!0))(J)?ee==="true"||ee==="TRUE"||ee!=="false"&&ee!=="FALSE"&&((ue=>{if(ve.test(ue)&&(ue=parseFloat(ue),Y<ue&&ue<U))return 1})(ee)?parseFloat(ee):de.test(ee)?new Date(ee):ee===""?null:ee):ee)(H=g.header?R>=Q.length?"__parsed_extra":Q[R]:H,Z=g.transform?g.transform(Z,H):Z);H==="__parsed_extra"?(O[H]=O[H]||[],O[H].push(Z)):O[H]=Z}return g.header&&(R>Q.length?q("FieldMismatch","TooManyFields","Too many fields: expected "+Q.length+" fields but parsed "+R,G+j):R<Q.length&&q("FieldMismatch","TooFewFields","Too few fields: expected "+Q.length+" fields but parsed "+R,G+j)),O}var X;M&&(g.header||g.dynamicTyping||g.transform)&&(X=1,!M.data.length||Array.isArray(M.data[0])?(M.data=M.data.map(F),X=M.data.length):M.data=F(M.data,0),g.header&&M.meta&&(M.meta.fields=Q),G+=X)}function D(){return g.header&&Q.length===0}function q(S,F,X,B){S={type:S,code:F,message:X},B!==void 0&&(S.row=B),M.errors.push(S)}A(g.step)&&(v=g.step,g.step=function(S){M=S,D()?w():(w(),M.data.length!==0&&(he+=S.data.length,g.preview&&he>g.preview?p.abort():(M.data=M.data[0],v(M,re))))}),this.parse=function(S,F,X){var B=g.quoteChar||'"',B=(g.newline||(g.newline=this.guessLineEndings(S,B)),C=!1,g.delimiter?A(g.delimiter)&&(g.delimiter=g.delimiter(S),M.meta.delimiter=g.delimiter):((B=((j,O,R,H,Z)=>{var J,ee,ue,je;Z=Z||[",","	","|",";",c.RECORD_SEP,c.UNIT_SEP];for(var $=0;$<Z.length;$++){for(var K,ce=Z[$],L=0,oe=0,z=0,ye=(ue=void 0,new I({comments:H,delimiter:ce,newline:O,preview:10}).parse(j)),Te=0;Te<ye.data.length;Te++)R&&ae(ye.data[Te])?z++:(K=ye.data[Te].length,oe+=K,ue===void 0?ue=K:0<K&&(L+=Math.abs(K-ue),ue=K));0<ye.data.length&&(oe/=ye.data.length-z),(ee===void 0||L<=ee)&&(je===void 0||je<oe)&&1.99<oe&&(ee=L,J=ce,je=oe)}return{successful:!!(g.delimiter=J),bestDelimiter:J}})(S,g.newline,g.skipEmptyLines,g.comments,g.delimitersToGuess)).successful?g.delimiter=B.bestDelimiter:(C=!0,g.delimiter=c.DefaultDelimiter),M.meta.delimiter=g.delimiter),W(g));return g.preview&&g.header&&B.preview++,m=S,p=new I(B),M=p.parse(m,F,X),w(),me?{meta:{paused:!0}}:M||{meta:{paused:!1}}},this.paused=function(){return me},this.pause=function(){me=!0,p.abort(),m=A(g.chunk)?"":m.substring(p.getCharIndex())},this.resume=function(){re.streamer._halted?(me=!1,re.streamer.parseChunk(m,!0)):setTimeout(re.resume,3)},this.aborted=function(){return te},this.abort=function(){te=!0,p.abort(),M.meta.aborted=!0,A(g.complete)&&g.complete(M),m=""},this.guessLineEndings=function(j,B){j=j.substring(0,1048576);var B=new RegExp(_(B)+"([^]*?)"+_(B),"gm"),X=(j=j.replace(B,"")).split("\r"),B=j.split(`
`),j=1<B.length&&B[0].length<X[0].length;if(X.length===1||j)return`
`;for(var O=0,R=0;R<X.length;R++)X[R][0]===`
`&&O++;return O>=X.length/2?`\r
`:"\r"}}function _(g){return g.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function I(g){var m=(g=g||{}).delimiter,p=g.newline,C=g.comments,v=g.step,U=g.preview,Y=g.fastMode,ve=null,de=!1,re=g.quoteChar==null?'"':g.quoteChar,he=re;if(g.escapeChar!==void 0&&(he=g.escapeChar),(typeof m!="string"||-1<c.BAD_DELIMITERS.indexOf(m))&&(m=","),C===m)throw new Error("Comment character same as delimiter");C===!0?C="#":(typeof C!="string"||-1<c.BAD_DELIMITERS.indexOf(C))&&(C=!1),p!==`
`&&p!=="\r"&&p!==`\r
`&&(p=`
`);var G=0,me=!1;this.parse=function(te,Q,M){if(typeof te!="string")throw new Error("Input must be a string");var ae=te.length,w=m.length,D=p.length,q=C.length,S=A(v),F=[],X=[],B=[],j=G=0;if(!te)return L();if(Y||Y!==!1&&te.indexOf(re)===-1){for(var O=te.split(p),R=0;R<O.length;R++){if(B=O[R],G+=B.length,R!==O.length-1)G+=p.length;else if(M)return L();if(!C||B.substring(0,q)!==C){if(S){if(F=[],je(B.split(m)),oe(),me)return L()}else je(B.split(m));if(U&&U<=R)return F=F.slice(0,U),L(!0)}}return L()}for(var H=te.indexOf(m,G),Z=te.indexOf(p,G),J=new RegExp(_(he)+_(re),"g"),ee=te.indexOf(re,G);;)if(te[G]===re)for(ee=G,G++;;){if((ee=te.indexOf(re,ee+1))===-1)return M||X.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:F.length,index:G}),K();if(ee===ae-1)return K(te.substring(G,ee).replace(J,re));if(re===he&&te[ee+1]===he)ee++;else if(re===he||ee===0||te[ee-1]!==he){H!==-1&&H<ee+1&&(H=te.indexOf(m,ee+1));var ue=$((Z=Z!==-1&&Z<ee+1?te.indexOf(p,ee+1):Z)===-1?H:Math.min(H,Z));if(te.substr(ee+1+ue,w)===m){B.push(te.substring(G,ee).replace(J,re)),te[G=ee+1+ue+w]!==re&&(ee=te.indexOf(re,G)),H=te.indexOf(m,G),Z=te.indexOf(p,G);break}if(ue=$(Z),te.substring(ee+1+ue,ee+1+ue+D)===p){if(B.push(te.substring(G,ee).replace(J,re)),ce(ee+1+ue+D),H=te.indexOf(m,G),ee=te.indexOf(re,G),S&&(oe(),me))return L();if(U&&F.length>=U)return L(!0);break}X.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:F.length,index:G}),ee++}}else if(C&&B.length===0&&te.substring(G,G+q)===C){if(Z===-1)return L();G=Z+D,Z=te.indexOf(p,G),H=te.indexOf(m,G)}else if(H!==-1&&(H<Z||Z===-1))B.push(te.substring(G,H)),G=H+w,H=te.indexOf(m,G);else{if(Z===-1)break;if(B.push(te.substring(G,Z)),ce(Z+D),S&&(oe(),me))return L();if(U&&F.length>=U)return L(!0)}return K();function je(z){F.push(z),j=G}function $(z){var ye=0;return ye=z!==-1&&(z=te.substring(ee+1,z))&&z.trim()===""?z.length:ye}function K(z){return M||(z===void 0&&(z=te.substring(G)),B.push(z),G=ae,je(B),S&&oe()),L()}function ce(z){G=z,je(B),B=[],Z=te.indexOf(p,G)}function L(z){if(g.header&&!Q&&F.length&&!de){var ye=F[0],Te=Object.create(null),zt=new Set(ye);let dr=!1;for(let Xe=0;Xe<ye.length;Xe++){let Le=ye[Xe];if(Te[Le=A(g.transformHeader)?g.transformHeader(Le,Xe):Le]){let ut,ur=Te[Le];for(;ut=Le+"_"+ur,ur++,zt.has(ut););zt.add(ut),ye[Xe]=ut,Te[Le]++,dr=!0,(ve=ve===null?{}:ve)[ut]=Le}else Te[Le]=1,ye[Xe]=Le;zt.add(Le)}dr&&console.warn("Duplicate headers found and renamed."),de=!0}return{data:F,errors:X,meta:{delimiter:m,linebreak:p,aborted:me,truncated:!!z,cursor:j+(Q||0),renamedHeaders:ve}}}function oe(){v(L()),F=[],X=[]}},this.abort=function(){me=!0},this.getCharIndex=function(){return G}}function k(g){var m=g.data,p=l[m.workerId],C=!1;if(m.error)p.userError(m.error,m.file);else if(m.results&&m.results.data){var v={abort:function(){C=!0,E(m.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:P,resume:P};if(A(p.userStep)){for(var U=0;U<m.results.data.length&&(p.userStep({data:m.results.data[U],errors:m.results.errors,meta:m.results.meta},v),!C);U++);delete m.results}else A(p.userChunk)&&(p.userChunk(m.results,v,m.file),delete m.results)}m.finished&&!C&&E(m.workerId,m.results)}function E(g,m){var p=l[g];A(p.userComplete)&&p.userComplete(m),p.terminate(),delete l[g]}function P(){throw new Error("Not implemented.")}function W(g){if(typeof g!="object"||g===null)return g;var m,p=Array.isArray(g)?[]:{};for(m in g)p[m]=W(g[m]);return p}function V(g,m){return function(){g.apply(m,arguments)}}function A(g){return typeof g=="function"}return c.parse=function(g,m){var p=(m=m||{}).dynamicTyping||!1;if(A(p)&&(m.dynamicTypingFunction=p,p={}),m.dynamicTyping=p,m.transform=!!A(m.transform)&&m.transform,!m.worker||!c.WORKERS_SUPPORTED)return p=null,c.NODE_STREAM_INPUT,typeof g=="string"?(g=(C=>C.charCodeAt(0)!==65279?C:C.slice(1))(g),p=new(m.download?h:x)(m)):g.readable===!0&&A(g.read)&&A(g.on)?p=new b(m):(s.File&&g instanceof File||g instanceof Object)&&(p=new f(m)),p.stream(g);(p=(()=>{var C;return!!c.WORKERS_SUPPORTED&&(C=(()=>{var v=s.URL||s.webkitURL||null,U=t.toString();return c.BLOB_URL||(c.BLOB_URL=v.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",U,")();"],{type:"text/javascript"})))})(),(C=new s.Worker(C)).onmessage=k,C.id=d++,l[C.id]=C)})()).userStep=m.step,p.userChunk=m.chunk,p.userComplete=m.complete,p.userError=m.error,m.step=A(m.step),m.chunk=A(m.chunk),m.complete=A(m.complete),m.error=A(m.error),delete m.worker,p.postMessage({input:g,config:m,workerId:p.id})},c.unparse=function(g,m){var p=!1,C=!0,v=",",U=`\r
`,Y='"',ve=Y+Y,de=!1,re=null,he=!1,G=((()=>{if(typeof m=="object"){if(typeof m.delimiter!="string"||c.BAD_DELIMITERS.filter(function(Q){return m.delimiter.indexOf(Q)!==-1}).length||(v=m.delimiter),typeof m.quotes!="boolean"&&typeof m.quotes!="function"&&!Array.isArray(m.quotes)||(p=m.quotes),typeof m.skipEmptyLines!="boolean"&&typeof m.skipEmptyLines!="string"||(de=m.skipEmptyLines),typeof m.newline=="string"&&(U=m.newline),typeof m.quoteChar=="string"&&(Y=m.quoteChar),typeof m.header=="boolean"&&(C=m.header),Array.isArray(m.columns)){if(m.columns.length===0)throw new Error("Option columns is empty");re=m.columns}m.escapeChar!==void 0&&(ve=m.escapeChar+Y),m.escapeFormulae instanceof RegExp?he=m.escapeFormulae:typeof m.escapeFormulae=="boolean"&&m.escapeFormulae&&(he=/^[=+\-@\t\r].*$/)}})(),new RegExp(_(Y),"g"));if(typeof g=="string"&&(g=JSON.parse(g)),Array.isArray(g)){if(!g.length||Array.isArray(g[0]))return me(null,g,de);if(typeof g[0]=="object")return me(re||Object.keys(g[0]),g,de)}else if(typeof g=="object")return typeof g.data=="string"&&(g.data=JSON.parse(g.data)),Array.isArray(g.data)&&(g.fields||(g.fields=g.meta&&g.meta.fields||re),g.fields||(g.fields=Array.isArray(g.data[0])?g.fields:typeof g.data[0]=="object"?Object.keys(g.data[0]):[]),Array.isArray(g.data[0])||typeof g.data[0]=="object"||(g.data=[g.data])),me(g.fields||[],g.data||[],de);throw new Error("Unable to serialize unrecognized input");function me(Q,M,ae){var w="",D=(typeof Q=="string"&&(Q=JSON.parse(Q)),typeof M=="string"&&(M=JSON.parse(M)),Array.isArray(Q)&&0<Q.length),q=!Array.isArray(M[0]);if(D&&C){for(var S=0;S<Q.length;S++)0<S&&(w+=v),w+=te(Q[S],S);0<M.length&&(w+=U)}for(var F=0;F<M.length;F++){var X=(D?Q:M[F]).length,B=!1,j=D?Object.keys(M[F]).length===0:M[F].length===0;if(ae&&!D&&(B=ae==="greedy"?M[F].join("").trim()==="":M[F].length===1&&M[F][0].length===0),ae==="greedy"&&D){for(var O=[],R=0;R<X;R++){var H=q?Q[R]:R;O.push(M[F][H])}B=O.join("").trim()===""}if(!B){for(var Z=0;Z<X;Z++){0<Z&&!j&&(w+=v);var J=D&&q?Q[Z]:Z;w+=te(M[F][J],Z)}F<M.length-1&&(!ae||0<X&&!j)&&(w+=U)}}return w}function te(Q,M){var ae,w;return Q==null?"":Q.constructor===Date?JSON.stringify(Q).slice(1,25):(w=!1,he&&typeof Q=="string"&&he.test(Q)&&(Q="'"+Q,w=!0),ae=Q.toString().replace(G,ve),(w=w||p===!0||typeof p=="function"&&p(Q,M)||Array.isArray(p)&&p[M]||((D,q)=>{for(var S=0;S<q.length;S++)if(-1<D.indexOf(q[S]))return!0;return!1})(ae,c.BAD_DELIMITERS)||-1<ae.indexOf(v)||ae.charAt(0)===" "||ae.charAt(ae.length-1)===" ")?Y+ae+Y:ae)}},c.RECORD_SEP="",c.UNIT_SEP="",c.BYTE_ORDER_MARK="\uFEFF",c.BAD_DELIMITERS=["\r",`
`,'"',c.BYTE_ORDER_MARK],c.WORKERS_SUPPORTED=!i&&!!s.Worker,c.NODE_STREAM_INPUT=1,c.LocalChunkSize=10485760,c.RemoteChunkSize=5242880,c.DefaultDelimiter=",",c.Parser=I,c.ParserHandle=N,c.NetworkStreamer=h,c.FileStreamer=f,c.StringStreamer=x,c.ReadableStreamStreamer=b,s.jQuery&&((n=s.jQuery).fn.parse=function(g){var m=g.config||{},p=[];return this.each(function(U){if(!(n(this).prop("tagName").toUpperCase()==="INPUT"&&n(this).attr("type").toLowerCase()==="file"&&s.FileReader)||!this.files||this.files.length===0)return!0;for(var Y=0;Y<this.files.length;Y++)p.push({file:this.files[Y],inputElem:this,instanceConfig:n.extend({},m)})}),C(),this;function C(){if(p.length===0)A(g.complete)&&g.complete();else{var U,Y,ve,de,re=p[0];if(A(g.before)){var he=g.before(re.file,re.inputElem);if(typeof he=="object"){if(he.action==="abort")return U="AbortError",Y=re.file,ve=re.inputElem,de=he.reason,void(A(g.error)&&g.error({name:U},Y,ve,de));if(he.action==="skip")return void v();typeof he.config=="object"&&(re.instanceConfig=n.extend(re.instanceConfig,he.config))}else if(he==="skip")return void v()}var G=re.instanceConfig.complete;re.instanceConfig.complete=function(me){A(G)&&G(me,re.file,re.inputElem),v()},c.parse(re.file,re.instanceConfig)}}function v(){p.splice(0,1),C()}}),o&&(s.onmessage=function(g){g=g.data,c.WORKER_ID===void 0&&g&&(c.WORKER_ID=g.workerId),typeof g.input=="string"?s.postMessage({workerId:c.WORKER_ID,results:c.parse(g.input,g.config),finished:!0}):(s.File&&g.input instanceof File||g.input instanceof Object)&&(g=c.parse(g.input,g.config))&&s.postMessage({workerId:c.WORKER_ID,results:g,finished:!0})}),(h.prototype=Object.create(u.prototype)).constructor=h,(f.prototype=Object.create(u.prototype)).constructor=f,(x.prototype=Object.create(x.prototype)).constructor=x,(b.prototype=Object.create(u.prototype)).constructor=b,c})})(Xd);nt.register(...Ea);const Zd=async(r={})=>{try{let e="/data/videos/filter";const t=new URLSearchParams;return r.dateFrom&&t.set("date_from",r.dateFrom),r.dateTo&&t.set("date_to",r.dateTo),r.orderBy&&t.set("order_by",r.orderBy),r.orderDesc&&t.set("order_desc",r.orderDesc),typeof r.limit=="number"&&t.set("limit",String(r.limit)),typeof r.offset=="number"&&t.set("offset",String(r.offset)),t.toString()&&(e+="?"+t.toString()),await Ue(e)}catch(e){throw console.error("Error fetching filtered videos:",e),e}},eu=async r=>{try{return await Ue(`/data/summary/by-video/${r}`)}catch(e){throw console.error("Error fetching video summary:",e),e}},tu=async r=>{try{const e=await fetch(`${cr}/data/videos/${r}`,{method:"DELETE"}),t=await e.text(),s=t?JSON.parse(t):{};if(!e.ok||s.status!=="success")throw new Error(s.error||e.statusText);return s}catch(e){throw console.error("Error deleting video:",e),e}},ru=r=>`${cr}/data/video/${r}`,su=async(r,e=300)=>{const t=await Ue(`/data/video/${r}/signed?expires_in=${e}`);if(t.status!=="success"||!t.url)throw new Error("Failed to get signed URL");return t.url},gt=async(r,e,t={},s=400,n=400)=>new Promise(i=>{var o;try{const l=document.createElement("canvas");l.width=s,l.height=n;const d=l.getContext("2d");if(!d){console.warn("Could not get canvas context for chart"),i(null);return}const c=new nt(d,{type:r,data:e,options:{...t,animation:!1,responsive:!1,maintainAspectRatio:!1,plugins:{...t.plugins,legend:{...(o=t.plugins)==null?void 0:o.legend,display:!0}}}});setTimeout(()=>{try{const u=c.toBase64Image();c.destroy(),i(u)}catch(u){console.warn("Could not capture chart image:",u),c.destroy(),i(null)}},100)}catch(l){console.warn("Error creating chart:",l),i(null)}}),cr="https://alxrkajk60i0df-8000.proxy.runpod.net",au=(r,e="")=>{var n;const t=((n=r==null?void 0:r.message)==null?void 0:n.toLowerCase())||"",s=e.toLowerCase();return s.includes("no workers available")||s.includes("worker")||t.includes("503")||t.includes("timeout")||t.includes("timed out")},nu=async(r,e=5,t)=>{let s;for(let n=0;n<=e;n++)try{return await r()}catch(i){s=i;const o=(i==null?void 0:i.response)||(i==null?void 0:i.message)||"";if(au(i,o)&&n<e){const d=Math.min(3e3*Math.pow(2,n),48e3);console.log(`[API Retry] Cold start detected, retrying in ${d}ms (attempt ${n+1}/${e})`),await new Promise(c=>setTimeout(c,d));continue}throw s}throw s},Ue=async(r,e,t=!0)=>{const s=r.startsWith("http")?r:`${cr}${r.startsWith("/")?r:"/"+r}`,n=async()=>{const i=new Headers(e==null?void 0:e.headers);i.set("Authorization","Bearer rpa_1K6BW22JFGU3D3AI8XRSQ7YBSPE7XHDKTMBR2Q211nzdtd");try{const{data:{session:d}}=await ge.auth.getSession(),c=d==null?void 0:d.access_token;c&&i.set("Authorization",`Bearer ${c}`)}catch{}const o=await fetch(s,{...e,headers:i}),l=await o.text();o.ok||(console.error(`HTTP ${o.status} Error for ${s}:`),console.error("Response headers:",Object.fromEntries(o.headers.entries())),console.error("Raw response text:",l));try{const d=l?JSON.parse(l):{};if(!o.ok){const c=new Error(`${o.status} ${d.detail||d.error||o.statusText}`);if(c.response=l,c.status=o.status,o.status===401){try{await ge.auth.signOut()}catch{}typeof window<"u"&&(window.location.href="/auth")}throw c}return d}catch(d){if(!o.ok){const c=new Error(`${o.status} ${o.statusText}`);if(c.response=l,c.status=o.status,o.status===401&&typeof window<"u"){try{await ge.auth.signOut()}catch{}window.location.href="/auth"}throw c}throw d}};return t?nu(n):n()},iu=async(r,e,t)=>{try{const s=new FormData;s.append("file",r),s.append("video_name",e);const n=`${cr}/video/upload`,i=await new Promise((l,d)=>{const c=new XMLHttpRequest;c.upload.addEventListener("progress",u=>{if(u.lengthComputable&&t){const h=u.loaded/u.total*100;t(h)}}),c.addEventListener("load",()=>{if(c.status>=200&&c.status<300)try{const u=JSON.parse(c.responseText);l(u)}catch{d(new Error("Failed to parse server response"))}else d(new Error(`Upload failed with status ${c.status}`))}),c.addEventListener("error",()=>{d(new Error("Network error during upload"))}),c.addEventListener("abort",()=>{d(new Error("Upload cancelled"))}),c.open("POST",n),c.setRequestHeader("Authorization","Bearer rpa_1K6BW22JFGU3D3AI8XRSQ7YBSPE7XHDKTMBR2Q211nzdtd"),c.send(s)});t&&t(100);const o=await Ue(`/video/process/${i.job_id}`,{method:"POST"});return{job_id:i.job_id,video_id:i.video_id,queue_position:o.queue_position??i.queue_position??0,original_url:i.original_url||i.video_url||""}}catch(s){throw console.error("Error starting RunPod processing:",s),s}},ou=async(r,e,t)=>{try{const s={video_name:e,original_filename:r.name,original_url:t,file_size:r.size,status:"uploaded"};return await zl(s)}catch(s){throw console.error("Error creating video metadata record:",s),s}},lu=async()=>{try{await fetch(`${cr}/jobs/clear-completed`,{method:"POST"})}catch(r){throw console.error("Error clearing completed jobs:",r),r}},cu=async(r,e)=>{var re,he,G,me,te,Q,M,ae;const t=new Vn,s=t.internal.pageSize.width,n=t.internal.pageSize.height,i="Traffic Analysis Report",o=new Date().toLocaleDateString();t.setFontSize(24),t.setTextColor(6,182,212),t.text(i,s/2,40,{align:"center"}),t.setFontSize(14),t.setTextColor(100,100,100),t.text(`Generated on: ${o}`,s/2,55,{align:"center"}),t.setFontSize(12),t.setTextColor(6,182,212),t.text("Project 49 - Road Safety Analysis Platform",s/2,70,{align:"center"}),t.addPage(),t.setFontSize(20),t.setTextColor(0,0,0),t.text("Executive Summary",20,20),t.setFontSize(12),t.setTextColor(60,60,60);const l=Number(e.complianceRate)||0,d=Number(e.avgReactionTime)||0,c=Number(e.totalVehicles)||0,u=Number(e.violations)||0,h=l>=85?"Excellent":l>=70?"Good":l>=50?"Fair":"Poor",f=d<=2?"Excellent":d<=3?"Good":d<=4?"Fair":"Needs Improvement",x=["Analysis Overview:",`This comprehensive traffic analysis report examines ${c} vehicles across multiple`,"monitoring sessions, providing insights into road user behavior and compliance patterns.","","Key Findings:",`• Overall Compliance Rate: ${l.toFixed(1)}% (${h})`,`• Average Reaction Time: ${d.toFixed(2)}s (${f})`,`• Total Violations Detected: ${u}`,`• Peak Violation Period: ${e.peakViolationHour||"Not determined"}`,`• Analysis Period: ${e.analysisStartDate||"N/A"} to ${e.analysisEndDate||"N/A"}`,"","Performance Assessment:",l>=85?`The compliance rate of ${l.toFixed(1)}% indicates excellent road safety performance,`:l>=70?`The compliance rate of ${l.toFixed(1)}% shows good safety performance with room for improvement.`:`The compliance rate of ${l.toFixed(1)}% indicates significant safety concerns requiring immediate attention.`,"",d<=3?"Average reaction times are within acceptable safety parameters.":"Reaction times exceed recommended thresholds, suggesting potential safety risks."];let b=40;x.forEach(w=>{w.startsWith("•")?(t.setFontSize(11),t.text(w,25,b)):w.includes(":")&&!w.includes("•")?(t.setFontSize(12),t.setTextColor(6,182,212),t.text(w,20,b),t.setTextColor(60,60,60)):(t.setFontSize(11),t.text(w,20,b)),b+=w===""?5:7}),t.addPage(),t.setFontSize(20),t.text("Traffic Flow Patterns",20,20);const N=r.reduce((w,D)=>{if(!D.date)return w;const q=er(Ft(D.date),"EEEE");return w[q]||(w[q]={total:0,violations:0}),w[q].total++,D.compliance===0&&w[q].violations++,w},{});if(Object.keys(N).length>0){const w=await gt("bar",{labels:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],datasets:[{label:"Total Traffic Volume",data:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(D=>{var q;return((q=N[D])==null?void 0:q.total)||0}),backgroundColor:"#06B6D4",borderColor:"#0891B2",borderWidth:1},{label:"Violations",data:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(D=>{var q;return((q=N[D])==null?void 0:q.violations)||0}),backgroundColor:"#EF4444",borderColor:"#DC2626",borderWidth:1}]},{plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Weekly Traffic Flow and Violations"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Vehicles"}},x:{title:{display:!0,text:"Day of Week"}}}},700,400);w&&t.addImage(w,"PNG",10,40,190,110)}t.setFontSize(12),t.setTextColor(60,60,60);let _=160;const I=Object.keys(N).reduce((w,D)=>{var q,S;return(((q=N[w])==null?void 0:q.total)||0)>(((S=N[D])==null?void 0:S.total)||0)?w:D},"Monday"),k=Object.keys(N).reduce((w,D)=>{var q,S;return(((q=N[w])==null?void 0:q.total)||0)<(((S=N[D])==null?void 0:S.total)||0)?w:D},"Monday");["Traffic Flow Analysis:",`• Peak Traffic Day: ${I} (${((re=N[I])==null?void 0:re.total)||0} vehicles)`,`• Lowest Traffic Day: ${k} (${((he=N[k])==null?void 0:he.total)||0} vehicles)`,`• Weekend vs Weekday Pattern: ${(((G=N.Saturday)==null?void 0:G.total)||0)+(((me=N.Sunday)==null?void 0:me.total)||0)>(((te=N.Monday)==null?void 0:te.total)||0)+(((Q=N.Tuesday)==null?void 0:Q.total)||0)?"Higher weekend traffic observed":"Higher weekday traffic observed"}`].forEach(w=>{w.includes(":")&&!w.includes("•")?(t.setFontSize(12),t.setTextColor(6,182,212),t.text(w,20,_),t.setTextColor(60,60,60)):(t.setFontSize(11),t.text(w,20,_)),_+=8}),t.addPage(),t.setFontSize(20),t.text("Compliance Overview",20,20);const P=await gt("pie",{labels:["Compliant","Violations"],datasets:[{data:[e.totalVehicles-e.violations,e.violations],backgroundColor:["#10B981","#EF4444"],borderWidth:2,borderColor:"#ffffff"}]},{plugins:{legend:{display:!0,position:"bottom"},title:{display:!0,text:"Overall Compliance Rate"}}});P&&t.addImage(P,"PNG",20,40,100,100),t.setFontSize(12),t.setTextColor(60,60,60);const W=c>0?((c-u)/c*100).toFixed(1):"0.0";if(t.text(`Compliance Rate: ${W}%`,130,60),t.text(`Total Compliant: ${c-u}`,130,75),t.text(`Total Violations: ${u}`,130,90),t.text(`Sample Size: ${c} vehicles`,130,105),t.addPage(),t.setFontSize(20),t.text("Vehicle Type Analysis",20,20),e.vehicleTypeStats&&e.vehicleTypeStats.length>0){const w=await gt("bar",{labels:e.vehicleTypeStats.map(D=>D.type),datasets:[{label:"Total Vehicles",data:e.vehicleTypeStats.map(D=>D.total),backgroundColor:"#06B6D4",borderColor:"#0891B2",borderWidth:1},{label:"Violations",data:e.vehicleTypeStats.map(D=>D.violations),backgroundColor:"#EF4444",borderColor:"#DC2626",borderWidth:1}]},{plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Vehicle Types: Total vs Violations"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Vehicles"}},x:{title:{display:!0,text:"Vehicle Type"}}}},700,400);w&&t.addImage(w,"PNG",10,40,190,110)}if(t.addPage(),t.setFontSize(20),t.text("Reaction Time Analysis",20,20),e.vehicleTypeStats&&e.vehicleTypeStats.length>0){const w=await gt("bar",{labels:e.vehicleTypeStats.map(D=>D.type),datasets:[{label:"Average Reaction Time (seconds)",data:e.vehicleTypeStats.map(D=>D.avgReactionTime),backgroundColor:"#8B5CF6",borderColor:"#7C3AED",borderWidth:1}]},{plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Average Reaction Time by Vehicle Type"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Reaction Time (seconds)"}},x:{title:{display:!0,text:"Vehicle Type"}}}},700,400);w&&t.addImage(w,"PNG",10,40,190,110)}t.addPage(),t.setFontSize(20),t.text("Hourly Analysis",20,20);const V=r.reduce((w,D)=>{if(!D.date)return w;const q=er(Ft(D.date),"HH:00");return w[q]||(w[q]={total:0,violations:0}),w[q].total++,D.compliance===0&&w[q].violations++,w},{});if(Object.keys(V).length>0){const w=await gt("line",{labels:Object.keys(V),datasets:[{label:"Total Vehicles",data:Object.values(V).map(D=>D.total),borderColor:"#06B6D4",backgroundColor:"rgba(6, 182, 212, 0.1)",fill:!1,tension:.4},{label:"Violations",data:Object.values(V).map(D=>D.violations),borderColor:"#EF4444",backgroundColor:"rgba(239, 68, 68, 0.1)",fill:!1,tension:.4}]},{plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Traffic Volume and Violations by Hour"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Vehicles"}},x:{title:{display:!0,text:"Hour of Day"}}}},700,400);w&&t.addImage(w,"PNG",10,40,190,110)}const A=r.filter(w=>w.weather_condition);if(A.length>0){t.addPage(),t.setFontSize(20),t.text("Weather Impact Analysis",20,20);const w=A.reduce((q,S)=>{const F=S.weather_condition;return q[F]||(q[F]={total:0,violations:0}),q[F].total++,S.compliance===0&&q[F].violations++,q},{}),D=await gt("bar",{labels:Object.keys(w),datasets:[{label:"Total Vehicles",data:Object.values(w).map(q=>q.total),backgroundColor:"#06B6D4",borderWidth:1},{label:"Violations",data:Object.values(w).map(q=>q.violations),backgroundColor:"#EF4444",borderWidth:1}]},{plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Traffic Behavior by Weather Condition"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Vehicles"}},x:{title:{display:!0,text:"Weather Condition"}}}},700,400);D&&t.addImage(D,"PNG",10,40,190,110)}const g=r.reduce((w,D)=>{if(!D.date)return w;const q=er(Ft(D.date),"MMM yyyy");return w[q]||(w[q]={total:0,violations:0}),w[q].total++,D.compliance===0&&w[q].violations++,w},{});if(Object.keys(g).length>1){t.addPage(),t.setFontSize(20),t.text("Monthly Trend Analysis",20,20);const w=await gt("line",{labels:Object.keys(g),datasets:[{label:"Compliance Rate (%)",data:Object.values(g).map(D=>((D.total-D.violations)/D.total*100).toFixed(1)),borderColor:"#10B981",backgroundColor:"rgba(16, 185, 129, 0.1)",fill:!0,tension:.4}]},{plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Compliance Rate Trend Over Time"}},scales:{y:{beginAtZero:!0,max:100,title:{display:!0,text:"Compliance Rate (%)"}},x:{title:{display:!0,text:"Month"}}}},700,400);w&&t.addImage(w,"PNG",10,40,190,110)}t.addPage(),t.setFontSize(20),t.text("Methodology and Data Sources",20,20),t.setFontSize(12),t.setTextColor(60,60,60);const m=["Data Collection Methodology:","","This analysis is based on advanced computer vision technology and artificial intelligence","algorithms designed to monitor and analyze road user behavior at level crossings.","","Key Technologies:","• YOLOv8 (You Only Look Once) - State-of-the-art object detection algorithm","• Computer Vision Processing - Real-time video analysis and tracking","• Machine Learning Classification - Automated behavior pattern recognition","• Statistical Analysis - Comprehensive data processing and trend identification","","Data Sources:","• High-definition traffic monitoring cameras","• Continuous 24/7 video surveillance systems","• Weather monitoring stations (when available)","• Automated vehicle detection and classification systems","","Analysis Parameters:","• Vehicle Detection: Automated identification of cars, trucks, motorcycles, and other vehicles","• Compliance Monitoring: Real-time assessment of traffic rule adherence","• Reaction Time Measurement: Precise calculation of driver response times","• Behavioral Classification: Categorization of compliant vs. non-compliant behavior","","Quality Assurance:","• Multi-stage validation of detection accuracy","• Statistical significance testing for all reported metrics","• Continuous calibration of detection algorithms","• Regular validation against manual observation samples"];let p=40;m.forEach(w=>{w.includes(":")&&!w.includes("•")?(t.setFontSize(12),t.setTextColor(6,182,212),t.text(w,20,p),t.setTextColor(60,60,60)):w.startsWith("•")?(t.setFontSize(11),t.text(w,25,p)):(t.setFontSize(11),t.text(w,20,p)),p+=w===""?5:7}),t.addPage(),t.setFontSize(20),t.text("Detailed Statistics",20,20);const C=e.vehicleTypeStats&&e.vehicleTypeStats.length>0?e.vehicleTypeStats.map(w=>[w.type,w.total,w.compliant,w.violations,`${w.avgReactionTime.toFixed(2)}s`,`${(w.compliant/w.total*100).toFixed(1)}%`]):[["No data","0","0","0","0s","0%"]];t.autoTable({startY:30,head:[["Vehicle Type","Total","Compliant","Violations","Avg RT","Compliance"]],body:C,theme:"grid",headStyles:{fillColor:[6,182,212]},styles:{fontSize:10},columnStyles:{0:{cellWidth:30},1:{cellWidth:20},2:{cellWidth:25},3:{cellWidth:25},4:{cellWidth:25},5:{cellWidth:25}}}),t.addPage(),t.setFontSize(20),t.text("Key Performance Indicators",20,20);const v=[{metric:"Overall Compliance Rate",value:`${l.toFixed(1)}%`,target:"≥85%",status:l>=85?"Good":"Needs Improvement"},{metric:"Average Reaction Time",value:`${d.toFixed(2)}s`,target:"≤3.0s",status:d<=3?"Good":"Needs Improvement"},{metric:"Total Violations",value:u.toString(),target:"Minimize",status:"Monitor"},{metric:"Sample Size",value:c.toString(),target:"≥1000",status:c>=1e3?"Adequate":"Limited"}];t.autoTable({startY:40,head:[["KPI","Current Value","Target","Status"]],body:v.map(w=>[w.metric,w.value,w.target,w.status]),theme:"grid",headStyles:{fillColor:[6,182,212]},styles:{fontSize:11},columnStyles:{3:{cellWidth:30,fontStyle:"bold"}}}),t.addPage(),t.setFontSize(20),t.text("Analysis & Recommendations",20,20);const U=e.vehicleTypeStats&&e.vehicleTypeStats.length>0?e.vehicleTypeStats.reduce((w,D)=>D.complianceRate<w.complianceRate?D:w):null,Y=e.vehicleTypeStats&&e.vehicleTypeStats.length>0?e.vehicleTypeStats.reduce((w,D)=>D.complianceRate>w.complianceRate?D:w):null,ve=[{finding:"Overall Safety Performance Assessment",description:`Current compliance rate of ${l.toFixed(1)}% ${l>=85?"exceeds industry safety standards":l>=70?"meets basic safety requirements but has room for improvement":"falls below recommended safety thresholds and requires immediate attention"}. Average reaction time of ${d.toFixed(2)}s ${d<=3?"is within acceptable parameters":"exceeds recommended response times"}.`,recommendation:l>=85?"Maintain current safety protocols and continue regular monitoring to sustain high performance levels.":l>=70?"Implement targeted safety improvements focusing on the identified risk areas. Consider enhanced signage and driver education programs.":"Urgent intervention required. Implement comprehensive safety measures including enhanced enforcement, improved signage, and immediate driver awareness campaigns."},{finding:"Vehicle Type Performance Analysis",description:U&&Y?`${U.type} vehicles show the lowest compliance rate at ${(U.complianceRate||0).toFixed(1)}%, while ${Y.type} vehicles demonstrate the highest compliance at ${(Y.complianceRate||0).toFixed(1)}%. This ${((Y.complianceRate||0)-(U.complianceRate||0)).toFixed(1)}% difference indicates significant behavioral variations between vehicle types.`:"Vehicle type analysis requires additional data for comprehensive assessment.",recommendation:U?`Develop targeted safety interventions specifically for ${U.type} operators. Consider vehicle-specific signage, enhanced training programs, and focused enforcement during peak ${U.type} traffic periods. Study successful compliance strategies used for ${(Y==null?void 0:Y.type)||"high-performing"} vehicles and adapt them for ${U.type} operators.`:"Collect additional vehicle type data to enable targeted safety interventions."},{finding:"Peak Risk Period Identification",description:`Analysis reveals ${e.peakViolationHour?`peak violation activity at ${e.peakViolationHour}`:"distributed violation patterns throughout monitoring periods"}. ${Object.keys(N).length>0?`Weekly patterns show ${I} as the highest risk day with ${((M=N[I])==null?void 0:M.violations)||0} violations out of ${((ae=N[I])==null?void 0:ae.total)||0} total vehicles.`:"Additional temporal data needed for comprehensive risk period analysis."}`,recommendation:e.peakViolationHour?`Implement enhanced monitoring and enforcement protocols during ${e.peakViolationHour} and surrounding peak periods. Deploy additional safety personnel and consider dynamic warning systems that activate during high-risk timeframes. Analyze traffic flow patterns to understand underlying causes of increased violations during these periods.`:"Establish continuous monitoring to identify peak risk periods and develop time-specific safety interventions."},{finding:"Reaction Time and Warning System Effectiveness",description:`Current average reaction time of ${d.toFixed(2)}s ${d<=2?"demonstrates excellent driver responsiveness to warning systems":d<=3?"indicates adequate but improvable driver response times":"suggests potential issues with warning system visibility, timing, or driver awareness"}. ${U?`${U.type} vehicles show the slowest average reaction time of ${(U.avgReactionTime||0).toFixed(2)}s.`:""}`,recommendation:d<=3?"Current warning systems are performing effectively. Continue regular maintenance and consider minor optimizations based on vehicle-specific response patterns.":`Warning system requires immediate evaluation and enhancement. Consider: 1) Increasing warning signal visibility and audibility, 2) Implementing earlier warning activation, 3) Adding redundant warning methods, 4) Conducting driver education on proper response procedures. ${U?`Special attention needed for ${U.type} vehicle operators.`:""}`},{finding:"Data Quality and Monitoring Coverage",description:`Analysis based on ${c} vehicle observations ${c>=1e3?"provides statistically significant insights":c>=500?"offers meaningful trends but would benefit from larger sample size":"represents limited data that may not capture full behavioral patterns"}. ${A.length>0?"Weather impact data available for enhanced analysis.":"Weather correlation data not available for this period."}`,recommendation:c>=1e3?"Current monitoring coverage is adequate. Maintain consistent data collection protocols and consider expanding analysis to include seasonal variations and weather impact studies.":"Expand monitoring duration and coverage to achieve statistically robust sample sizes (target: >1000 observations). Implement weather monitoring integration to understand environmental impact on driver behavior. Consider additional monitoring locations for comprehensive area coverage."}];let de=40;return ve.forEach(w=>{t.setFontSize(14),t.setTextColor(6,182,212),t.text(w.finding,20,de),t.setFontSize(12),t.setTextColor(60,60,60);const D=t.splitTextToSize(w.description,s-40);t.text(D,20,de+7),t.setFontSize(11),t.setTextColor(40,40,40),t.text("Recommended Actions:",20,de+7+D.length*5+5);const q=t.splitTextToSize(w.recommendation,s-40);t.text(q,20,de+7+D.length*5+12),de+=40+D.length*5+q.length*5,de>n-40&&(t.addPage(),de=20)}),t.setFontSize(10),t.setTextColor(100,100,100),t.text("Generated by Project 49 - Road Safety Analysis Platform",s/2,n-10,{align:"center"}),t.text(`Report generated on ${new Date().toLocaleString()}`,s/2,n-5,{align:"center"}),t},xa=["video/mp4","video/quicktime","video/x-msvideo","video/x-matroska","video/webm"],ss=r=>{if(!r)return"An unexpected error occurred";const e=r.message||r.toString();return e.includes("Failed to fetch")||e.includes("NetworkError")?"Unable to connect to the processing server. Please check your internet connection and try again.":e.includes("timeout")||e.includes("TIMEOUT")?"The request took too long to complete. Please try again.":e.includes("500")||e.includes("Internal Server Error")?"The processing server is experiencing issues. Please try again in a few minutes.":e.includes("404")||e.includes("Not Found")?"The requested service is not available. Please contact support if this continues.":e.includes("403")||e.includes("Forbidden")?"Access denied. Please check your permissions or contact support.":e.includes("WebSocket")?"Connection to the processing server was lost. Attempting to reconnect...":e.includes("file")||e.includes("upload")?"Failed to upload the file. Please check the file format and try again.":"Something went wrong. Please try again or contact support if the problem continues."};function du(){const[r,e]=y.useState(!1),[t,s]=y.useState(!1),[n,i]=y.useState(()=>Ne()==="dark"),[o,l]=y.useState([]),[d,c]=y.useState(!1),[u,h]=y.useState({show:!1,message:"",type:"info"}),[f,x]=y.useState([]),[b,N]=y.useState({total_jobs:0,queue_length:0,queue_processor_running:!1}),[_,I]=y.useState(""),[k,E]=y.useState(""),[P,W]=y.useState(0),[V,A]=y.useState(!1),[g,m]=y.useState(null),[p,C]=y.useState(null),[v,U]=y.useState("Connecting..."),[Y,ve]=y.useState(!1),[de,re]=y.useState(!1),[he,G]=y.useState("connecting"),[me,te]=y.useState(""),Q=y.useRef(null),M=y.useRef(null),ae=y.useRef(!0),w=y.useRef(null);y.useEffect(()=>{const $=()=>{i(Ne()==="dark")},K=L=>{if(d)return L.preventDefault(),L.returnValue="Your video is still uploading. Are you sure you want to leave? The upload will be cancelled.",L.returnValue};window.addEventListener("themeChanged",$),window.addEventListener("beforeunload",K),S(),X();const ce=setInterval(S,3e4);return()=>{window.removeEventListener("themeChanged",$),window.removeEventListener("beforeunload",K),ae.current=!1,q(),clearInterval(ce),Q.current&&Q.current.close(),M.current&&M.current.close()}},[d]);const D=y.useRef(),q=()=>{D.current&&clearTimeout(D.current)},S=async()=>{try{(await fetch("https://alxrkajk60i0df-8000.proxy.runpod.net/",{method:"GET",headers:{"Content-Type":"application/json"}})).ok?(re(!0),console.log("RunPod URL is available")):(re(!1),console.log("RunPod URL is not responding"))}catch($){re(!1),console.log("RunPod URL is not available:",$)}},F=($,K="info",ce=5e3)=>{q(),h({show:!0,message:$,type:K,duration:ce}),D.current=setTimeout(()=>{h(L=>({...L,show:!1}))},ce)},X=()=>{G("connecting"),ve(!1),te("");try{Q.current&&(Q.current.close(),Q.current=null)}catch(ce){console.error("Error closing existing WebSocket:",ce)}const K="https://alxrkajk60i0df-8000.proxy.runpod.net".replace(/^http/,"ws")+"/ws/jobs";Q.current=new WebSocket(K),Q.current.onopen=()=>{console.log("Jobs WebSocket connected"),G("connected"),ve(!0),te(""),F("Successfully connected to processing server","success",3e3)},Q.current.onmessage=ce=>{try{const L=JSON.parse(ce.data);L&&L.status==="success"&&(N(L.summary),x(L.all_jobs||[]))}catch(L){console.error("Error parsing WebSocket message:",L)}},Q.current.onerror=ce=>{const L=ss(ce);G("error"),ve(!1),te(L),ae.current&&setTimeout(()=>{ae.current&&(console.log("Attempting to reconnect to jobs WebSocket..."),X())},3e3)},Q.current.onclose=()=>{console.log("Jobs WebSocket closed"),G("disconnected"),ve(!1),ae.current&&te("Connection lost. Attempting to reconnect..."),ae.current&&setTimeout(()=>{ae.current&&(console.log("Attempting to reconnect to jobs WebSocket..."),X())},3e3)}},B=()=>{A(!1),m(null),C(null);try{M.current&&(M.current.close(),M.current=null)}catch($){console.error("Error closing stream WebSocket:",$)}},j=async()=>{try{await lu(),F("Completed jobs cleared successfully","success")}catch($){const K=ss($);console.error("Error clearing completed jobs:",K),F(K,"error")}},O=$=>{const K=Math.floor($%60),ce=Math.floor($/60)%60,L=Math.floor($/3600);return`${L>0?L+":":""}${String(ce).padStart(2,"0")}:${String(K).padStart(2,"0")}`},R=($,K)=>$&&$.length>K?$.slice(0,K-1)+"…":$||"",H=$=>{if($===0)return"0 Bytes";const K=1024,ce=["Bytes","KB","MB","GB"],L=Math.floor(Math.log($)/Math.log(K));return Math.round($/Math.pow(K,L)*100)/100+" "+ce[L]},Z=$=>{const K={queued:"bg-blue-500/10 text-blue-400",processing:"bg-yellow-500/10 text-yellow-400",completed:"bg-green-500/10 text-green-400",failed:"bg-red-500/10 text-red-400",cancelled:"bg-gray-500/10 text-gray-400"};return K[$]||K.queued},J=async $=>{if($.length!==0){if(!Y){F("Cannot upload files because the processing server is not connected. Please wait for the connection to be restored or refresh the page.","error");return}c(!0),I("Preparing upload..."),E(""),W(0);try{for(const K of $){if(!xa.includes(K.type)){const z=`The file "${K.name}" is not a supported video format. Please use MP4, MOV, AVI, MKV, or WebM files.`;F(z,"error"),I(z);continue}const ce=K.name.replace(/\.[^/.]+$/,"");E(K.name),W(K.size),I("Uploading video to server...");const L=await iu(K,ce,()=>{}),oe=await ou(K,ce,L.original_url);l(z=>[oe,...z]),I(`Successfully queued job ${L.job_id}`),F(`Successfully uploaded "${K.name}" and added to processing queue`,"success",5e3),E(""),W(0)}}catch(K){const ce=ss(K);console.error("Processing error:",ce),F(`Upload failed: ${ce}`,"error",8e3),I(`Upload failed: ${ce}`)}finally{c(!1),E(""),W(0),I("")}}},ee=$=>{$.preventDefault(),e(!0)},ue=$=>{$.preventDefault(),e(!1)},je=$=>{$.preventDefault(),e(!1);const K=Array.from($.dataTransfer.files);J(K)};return a.jsxs("div",{className:`min-h-screen ${n?"bg-[#0B1121] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx(Wt,{}),u.show&&a.jsxs("div",{className:`fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg flex items-start space-x-3 max-w-md ${u.type==="success"?"bg-green-500":u.type==="error"?"bg-red-500":u.type==="warning"?"bg-yellow-500":"bg-blue-500"}`,children:[a.jsx("div",{className:"flex-shrink-0 mt-0.5",children:u.type==="success"?a.jsx(Qe,{className:"w-5 h-5"}):u.type==="error"?a.jsx(Dt,{className:"w-5 h-5"}):u.type==="warning"?a.jsx(Dt,{className:"w-5 h-5"}):a.jsx(Pt,{className:"w-5 h-5"})}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{className:"text-white text-sm leading-relaxed",children:u.message})}),a.jsx("button",{onClick:()=>h($=>({...$,show:!1})),className:"flex-shrink-0 text-white hover:text-gray-200 transition-colors",children:a.jsx(ze,{className:"w-4 h-4"})})]}),a.jsx(wt,{title:"Video Upload",onToggleSidebar:()=>s(!t),isSidebarOpen:t}),a.jsx(jt,{activePath:"/upload",isOpen:t,onClose:()=>s(!1)}),d&&a.jsx("div",{className:"lg:ml-64 mt-16 lg:mt-0",children:a.jsx("div",{className:`px-4 py-3 ${n?"bg-yellow-500/20 border-yellow-500/40":"bg-yellow-100 border-yellow-300"} border-b`,children:a.jsxs("div",{className:"max-w-6xl mx-auto flex items-center gap-3",children:[a.jsx(Dt,{className:"w-5 h-5 text-yellow-600 flex-shrink-0"}),a.jsx("div",{className:"flex-1",children:a.jsx("p",{className:`text-sm font-medium ${n?"text-yellow-300":"text-yellow-800"}`,children:"Upload in Progress - Please do not close or refresh this page"})})]})})}),a.jsx("main",{className:"lg:ml-64 p-4 lg:p-8 mt-16 lg:mt-0",children:a.jsxs("div",{className:"max-w-6xl mx-auto",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-2",children:"Upload Video for Analysis"}),a.jsx("p",{className:n?"text-gray-400":"text-gray-600",children:"Supported formats: MP4, MOV, AVI, MKV, WebM"})]}),a.jsxs("div",{className:`border-2 border-dashed rounded-xl p-6 sm:p-8 md:p-12 mb-8 text-center transition-colors ${r?"border-primary-500 bg-primary-500/10":d?"border-yellow-400 bg-yellow-400/10":n?"border-gray-600 bg-gray-800/20 hover:border-gray-500":"border-gray-300 bg-gray-100/50 hover:border-gray-400"}`,onDragOver:ee,onDragLeave:ue,onDrop:je,children:[a.jsx("input",{ref:w,type:"file",accept:xa.join(","),multiple:!0,onChange:$=>{J($.target.files?Array.from($.target.files):[])},disabled:d,hidden:!0}),d?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-t-4 border-yellow-400 mx-auto mb-6"}),a.jsx("h3",{className:"text-xl sm:text-2xl font-bold mb-3 text-yellow-400",children:"Uploading Video..."}),k&&a.jsxs("p",{className:`mb-2 text-sm sm:text-base ${n?"text-gray-400":"text-gray-600"}`,children:[a.jsx("span",{className:"font-medium",children:k}),P>0&&a.jsxs("span",{children:[" (",H(P),")"]})]}),a.jsx("p",{className:`mb-2 text-base sm:text-lg font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Video is uploading. Please stay tuned!"}),a.jsx("p",{className:`mb-4 text-sm sm:text-base ${n?"text-gray-400":"text-gray-600"}`,children:"Do not close or refresh this page while uploading."}),a.jsx("div",{className:`mt-4 px-4 py-3 rounded-lg ${n?"bg-yellow-500/10":"bg-yellow-50"} border ${n?"border-yellow-500/20":"border-yellow-200"}`,children:a.jsxs("p",{className:`text-sm ${n?"text-yellow-300":"text-yellow-800"}`,children:[a.jsx("strong",{children:"Please wait:"})," Large files may take several minutes to upload. Your video will be automatically added to the processing queue once complete."]})})]}):r?a.jsxs(a.Fragment,{children:[a.jsx(lt,{className:"w-12 h-12 mx-auto mb-4 text-primary-500"}),a.jsx("h3",{className:"text-lg sm:text-xl font-semibold mb-2 text-primary-500",children:"Drop your videos here"}),a.jsx("p",{className:`mb-4 ${n?"text-gray-400":"text-gray-600"}`,children:"Release to upload your video files"})]}):a.jsxs(a.Fragment,{children:[a.jsx(lt,{className:`w-12 h-12 mx-auto mb-4 ${n?"text-gray-400":"text-gray-500"}`}),a.jsx("h3",{className:"text-lg sm:text-xl font-semibold mb-2",children:"Upload Videos for Analysis"}),a.jsx("p",{className:`mb-4 ${n?"text-gray-400":"text-gray-600"}`,children:"Drag and drop your video files here, or click to browse"})]}),!d&&a.jsx("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:a.jsx("button",{onClick:()=>{var $;return($=w.current)==null?void 0:$.click()},className:`px-4 sm:px-6 py-2 rounded-lg transition-colors text-sm sm:text-base ${!Y||!de?"bg-gray-600 cursor-not-allowed opacity-50":"bg-primary-500 hover:bg-primary-600 text-white"}`,disabled:!Y||!de,title:Y?de?"":"RunPod URL not available":"WebSocket not connected",children:Y?de?"Select Video to Upload":"RunPod URL Unavailable":"WebSocket Disconnected"})})]}),a.jsxs("div",{className:`rounded-xl p-6 mb-8 ${n?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-4 sm:gap-0",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx("h2",{className:"text-lg sm:text-xl font-semibold",children:"Jobs"}),a.jsxs("span",{className:`text-xs sm:text-sm ${n?"text-gray-400":"text-gray-600"}`,children:["Total: ",b.total_jobs," | Queue: ",b.queue_length," | Running: ",b.queue_processor_running?"Yes":"No"]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2",children:[a.jsxs("span",{className:`text-xs sm:text-sm ${n?"text-gray-400":"text-gray-600"}`,children:["Auto-refresh: ",a.jsx("span",{className:"text-green-400",children:"On"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:X,className:`p-2 rounded-lg transition-colors ${n?"bg-[#1E293B] hover:bg-[#2D3B4E] text-gray-300":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,title:"Refresh",children:a.jsx(rr,{className:"w-4 h-4"})}),a.jsx("button",{onClick:j,className:`px-2 sm:px-3 py-2 text-xs sm:text-sm rounded-lg transition-colors ${n?"bg-[#1E293B] hover:bg-[#2D3B4E] text-gray-300":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:"Clear Completed"})]})]})]}),a.jsxs("div",{className:"overflow-x-auto",children:[a.jsxs("table",{className:"w-full min-w-[600px]",children:[a.jsx("thead",{children:a.jsxs("tr",{className:`border-b ${n?"border-gray-700":"border-gray-200"}`,children:[a.jsx("th",{className:`text-left py-2 sm:py-3 px-2 sm:px-4 font-medium text-xs sm:text-sm ${n?"text-gray-300":"text-gray-700"}`,children:"Job ID"}),a.jsx("th",{className:`text-left py-2 sm:py-3 px-2 sm:px-4 font-medium text-xs sm:text-sm ${n?"text-gray-300":"text-gray-700"}`,children:"File"}),a.jsx("th",{className:`text-left py-2 sm:py-3 px-2 sm:px-4 font-medium text-xs sm:text-sm ${n?"text-gray-300":"text-gray-700"}`,children:"Status"}),a.jsx("th",{className:`text-left py-2 sm:py-3 px-2 sm:px-4 font-medium text-xs sm:text-sm ${n?"text-gray-300":"text-gray-700"}`,children:"Progress"}),a.jsx("th",{className:`text-left py-2 sm:py-3 px-2 sm:px-4 font-medium text-xs sm:text-sm ${n?"text-gray-300":"text-gray-700"}`,children:"Message"}),a.jsx("th",{className:`text-left py-2 sm:py-3 px-2 sm:px-4 font-medium text-xs sm:text-sm ${n?"text-gray-300":"text-gray-700"}`,children:"Elapsed"})]})}),a.jsx("tbody",{children:f.sort(($,K)=>$.status==="processing"?-1:1).map($=>{const K=Math.max(0,Math.min(100,Math.round($.progress||0)));return a.jsxs("tr",{className:`border-b ${n?"border-gray-700":"border-gray-200"}`,children:[a.jsx("td",{className:`py-2 sm:py-3 px-2 sm:px-4 font-mono text-xs sm:text-sm ${n?"text-gray-300":"text-gray-700"}`,children:$.job_id}),a.jsx("td",{className:`py-2 sm:py-3 px-2 sm:px-4 text-xs sm:text-sm ${n?"text-gray-300":"text-gray-700"}`,title:$.file_name,children:R($.file_name,36)}),a.jsx("td",{className:"py-2 sm:py-3 px-2 sm:px-4",children:a.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Z($.status)}`,children:$.status})}),a.jsx("td",{className:"py-2 sm:py-3 px-2 sm:px-4",children:a.jsx("div",{className:`w-full bg-gray-200 rounded-full h-2 ${n?"bg-gray-700":"bg-gray-200"}`,children:a.jsx("div",{className:"bg-primary-500 h-2 rounded-full transition-all duration-300",style:{width:`${K}%`}})})}),a.jsx("td",{className:`py-2 sm:py-3 px-2 sm:px-4 text-xs sm:text-sm ${n?"text-gray-400":"text-gray-600"}`,title:$.message||"",children:R($.message||"",40)}),a.jsx("td",{className:`py-2 sm:py-3 px-2 sm:px-4 text-xs sm:text-sm ${n?"text-gray-400":"text-gray-600"}`,children:O($.elapsed_time)})]},$.job_id)})})]}),f.length===0&&a.jsx("div",{className:`text-center py-6 sm:py-8 text-sm sm:text-base ${n?"text-gray-400":"text-gray-600"}`,children:"No jobs found. Upload a video to get started."})]})]}),V&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-xl p-4 sm:p-6 w-full max-w-4xl ${n?"bg-[#151F32] border border-[#1E293B]":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("h3",{className:"text-base sm:text-lg font-semibold truncate pr-4",children:["Live Stream - Job ",g]}),a.jsx("button",{onClick:B,className:`p-2 rounded-lg transition-colors ${n?"hover:bg-[#1E293B] text-gray-300":"hover:bg-gray-100 text-gray-700"}`,children:a.jsx(ze,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"bg-black rounded-lg flex items-center justify-center min-h-[200px] sm:min-h-[300px] md:min-h-[360px]",children:p?a.jsx("img",{src:`data:image/jpeg;base64,${p}`,alt:"Live stream",className:"max-w-full max-h-full h-auto rounded object-contain"}):a.jsx("div",{className:`text-center text-sm sm:text-base ${n?"text-gray-400":"text-gray-600"}`,children:v})})]})}),o.length>0&&a.jsxs("div",{className:`rounded-xl p-6 ${n?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("h2",{className:"text-lg sm:text-xl font-semibold mb-4",children:"Recently Uploaded Videos"}),a.jsx("div",{className:"space-y-3",children:o.map($=>{var K,ce;return a.jsxs("div",{className:`flex items-center justify-between p-4 rounded-lg ${n?"bg-[#1E293B]":"bg-gray-50"}`,children:[a.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[a.jsx(lt,{className:"w-5 h-5 text-primary-500"}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("h3",{className:"font-medium text-sm sm:text-base truncate",children:$.video_name}),a.jsxs("p",{className:`text-xs sm:text-sm ${n?"text-gray-400":"text-gray-600"}`,children:[$.original_filename," • ",$.file_size?`${($.file_size/1024/1024).toFixed(1)} MB`:"Unknown size"]})]})]}),a.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:a.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${$.status==="uploaded"?"bg-blue-500/10 text-blue-400":$.status==="processing"?"bg-yellow-500/10 text-yellow-400":$.status==="completed"?"bg-green-500/10 text-green-400":$.status==="failed"?"bg-red-500/10 text-red-400":n?"bg-gray-500/10 text-gray-400":"bg-gray-500/10 text-gray-600"} whitespace-nowrap`,children:((K=$.status)==null?void 0:K.charAt(0).toUpperCase())+((ce=$.status)==null?void 0:ce.slice(1))||"Unknown"})})]},$.id)})})]})]})})]})}const uu=r=>{if(!r)return"-";try{const e=Ft(r);return er(e,"MMM dd, yyyy h:mm a")}catch(e){return console.error("Error formatting date:",e),"-"}},hu=r=>{if(!r)return"-";try{const e=Ft(r);return er(e,"yyyy-MM-dd HH:mm")}catch(e){return console.error("Error formatting date:",e),"-"}},mu=r=>{if(!r)return"-";try{const e=Ft(r);return Id(e,{addSuffix:!0})}catch(e){return console.error("Error formatting relative time:",e),"-"}},fu=()=>{const r=-new Date().getTimezoneOffset(),e=Math.floor(Math.abs(r)/60),t=Math.abs(r)%60;return`UTC${r>=0?"+":"-"}${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`},vn=()=>{try{const r=Intl.DateTimeFormat().resolvedOptions().timeZone,e=new Date,s=new Intl.DateTimeFormat("en-US",{timeZone:r,timeZoneName:"short"}).format(e).split(" ");return s[s.length-1]}catch{return fu()}};function gu(){const[r,e]=y.useState(!1),[t,s]=y.useState(()=>Ne()==="dark"),[n,i]=y.useState([]),[o,l]=y.useState(null),[d,c]=y.useState(null),[u,h]=y.useState(!0),[f,x]=y.useState(!1),[b,N]=y.useState("all"),[_,I]=y.useState(""),[k,E]=y.useState(""),[P,W]=y.useState(""),[V,A]=y.useState(""),[g,m]=y.useState(""),[p,C]=y.useState(1),[v,U]=y.useState(10),[Y,ve]=y.useState({totalVehicles:0,overallCompliance:0,avgReactionTime:0,weatherConditions:0}),de=j=>{const O=j.reduce((L,oe)=>{const z=oe.weather_condition||"unknown";return L[z]||(L[z]={compliant:0,total:0,reactionTimes:[]}),L[z].total++,oe.compliance===1&&(L[z].compliant++,oe.reaction_time&&L[z].reactionTimes.push(oe.reaction_time)),L},{}),R=Object.entries(O).reduce((L,[oe,z])=>(L[oe]={mean:z.total>0?z.compliant/z.total:0,count:z.total},L),{}),H=Object.entries(O).reduce((L,[oe,z])=>(L[oe]={mean:z.reactionTimes.length>0?z.reactionTimes.reduce((ye,Te)=>ye+Te,0)/z.reactionTimes.length:0,count:z.reactionTimes.length},L),{}),Z=j.reduce((L,oe)=>{const z=oe.vehicle_type||"unknown";return L[z]||(L[z]={compliant:0,total:0}),L[z].total++,oe.compliance===1&&L[z].compliant++,L},{}),J=Object.entries(Z).reduce((L,[oe,z])=>(L[oe]={mean:z.total>0?z.compliant/z.total:0,count:z.total},L),{}),ee=j.reduce((L,oe)=>{if(!oe.date)return L;const z=new Date(oe.date).getHours().toString();return L[z]||(L[z]={compliant:0,total:0}),L[z].total++,oe.compliance===1&&L[z].compliant++,L},{}),ue=Object.entries(ee).reduce((L,[oe,z])=>(L[oe]={mean:z.total>0?z.compliant/z.total:0,count:z.total},L),{}),je=[],$=Object.entries(R).sort(([,L],[,oe])=>L.mean-oe.mean)[0];$&&$[1].mean<.8&&je.push({category:"weather",type:"warning",message:`${$[0]} weather shows lowest compliance rate at ${($[1].mean*100).toFixed(1)}%`,suggestion:"Consider enhanced warning systems during adverse weather conditions"});const K=Object.entries(J).sort(([,L],[,oe])=>L.mean-oe.mean)[0];K&&K[1].mean<.8&&je.push({category:"vehicle_type",type:"critical",message:`${K[0]} vehicles show lowest compliance rate at ${(K[1].mean*100).toFixed(1)}%`,suggestion:"Target awareness campaigns for specific vehicle types with lower compliance"});const ce=Object.entries(ue).sort(([,L],[,oe])=>L.mean-oe.mean)[0];return ce&&ce[1].mean<.8&&je.push({category:"time",type:"info",message:`Hour ${ce[0]}:00 shows lowest compliance rate at ${(ce[1].mean*100).toFixed(1)}%`,suggestion:"Consider increased monitoring during peak violation hours"}),{weather_analysis:{weather_compliance:R,weather_reaction_time:H},basic_correlations:{speed_compliance_correlation:0,weather_compliance_correlation:0,vehicle_type_compliance:J,hour_compliance:ue},recommendations:je}};y.useEffect(()=>{G();const j=()=>{s(Ne()==="dark")};return window.addEventListener("themeChanged",j),()=>window.removeEventListener("themeChanged",j)},[]),y.useEffect(()=>{b!=="all"&&G()},[b,_,k]);const re=()=>{const j=new Date,O=new Date(j.getFullYear(),j.getMonth(),j.getDate());switch(b){case"7days":const R=new Date(O);return R.setDate(O.getDate()-7),{start:R,end:j};case"30days":const H=new Date(O);return H.setDate(O.getDate()-30),{start:H,end:j};case"90days":const Z=new Date(O);return Z.setDate(O.getDate()-90),{start:Z,end:j};case"custom":return _&&k?{start:new Date(_),end:new Date(k+"T23:59:59")}:null;default:return null}},he=j=>{const O=re();return O?j.filter(R=>{if(!R.date)return!1;const H=new Date(R.date);return H>=O.start&&H<=O.end}):j},G=async()=>{try{h(!0);try{const R=await Ue("/analysis/complete");if(R.status==="success"&&R.tracking_results){let H=R.tracking_results;H=he(H),i(H);const Z=await Ue("/analysis/correlation");Z.status==="success"&&(l(Z.analysis),me(H.length,H,Z.analysis)),c(null);return}}catch{console.log("Backend not available, falling back to database")}const j=await on();let O=he(j);if(i(O),O.length>0){const R=de(O);l(R),me(O.length,O,R)}else i([]),l(null),me(0,[],null);c(null)}catch(j){console.error("Error loading analytics:",j),c("Failed to load analytics data. Please try again."),i([]),l(null),me(0,[])}finally{h(!1)}},me=(j,O,R)=>{const H=O.length,Z=O.filter($=>$.compliance===1).length,J=H>0?Z/H*100:0,ee=O.filter($=>$.compliance===1&&$.reaction_time!==null&&$.reaction_time!==void 0).map($=>$.reaction_time),ue=ee.length>0?ee.reduce(($,K)=>$+K,0)/ee.length:0,je=new Set(O.map($=>$.weather_condition).filter(Boolean)).size;ve({totalVehicles:H,overallCompliance:J,avgReactionTime:ue,weatherConditions:je})},te=async()=>{try{h(!0);const j=new URLSearchParams;if(j.append("limit","1000"),P&&j.append("weather_condition",P),V&&j.append("vehicle_type",V),g!==""&&j.append("compliance",g),b!=="all"){const R=re();R.start&&j.append("date_from",R.start.toISOString().split("T")[0]),R.end&&j.append("date_to",R.end.toISOString().split("T")[0])}try{const R=await Ue(`/data/tracking/filter?${j.toString()}`);if(R.status==="success"){if(i(R.data),R.data.length>0){const H=de(R.data);l(H),me(R.data.length,R.data,H)}else l(null),me(0,[],null);c(null);return}}catch{console.log("Backend filtering not available, falling back to client-side filtering")}let O=[...n];if(P&&(O=O.filter(R=>R.weather_condition===P)),V&&(O=O.filter(R=>R.vehicle_type===V)),g!==""&&(O=O.filter(R=>R.compliance===parseInt(g))),i(O),O.length>0){const R=de(O);l(R),me(O.length,O,R)}else l(null),me(0,[],null);c(null)}catch{c("Unable to apply filters. Please try again.")}finally{h(!1)}},Q=()=>{W(""),A(""),m(""),N("all"),I(""),E(""),C(1),G()},M=()=>{const j=(p-1)*v,O=j+v;return n.slice(j,O)},ae=Math.ceil(n.length/v),w=j=>{C(Math.max(1,Math.min(j,ae)))},D=j=>j===1?a.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[a.jsx("span",{className:"w-1.5 h-1.5 bg-green-400 rounded-full mr-1.5"}),"Compliant"]}):a.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[a.jsx("span",{className:"w-1.5 h-1.5 bg-red-400 rounded-full mr-1.5"}),"Non-Compliant"]}),q=j=>{const O={car:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",truck:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",bus:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",motorcycle:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-200"};return a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${O[j]||"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}`,children:j.charAt(0).toUpperCase()+j.slice(1)})},S=j=>{const O={clear:"☀️",cloudy:"☁️",foggy:"🌫️",rainy:"🌧️",snowy:"❄️"};return a.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200",children:[O[j]||"🌤️"," ",j||"Unknown"]})},F=j=>{const O={moving:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",stationary:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",stopped:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"};return a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${O[j]||"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}`,children:j.charAt(0).toUpperCase()+j.slice(1)})},X=j=>({weather:"🌤️",vehicle_type:"🚛",time:"⏰"})[j]||"💡",B=async()=>{try{x(!0);const j=n,O={totalVehicles:Y.totalVehicles,complianceRate:Y.overallCompliance,avgReactionTime:Y.avgReactionTime,violations:Y.totalVehicles-Math.round(Y.totalVehicles*Y.overallCompliance/100),peakViolationHour:"N/A",vehicleTypeStats:n.length>0?[{type:"car",total:n.filter(J=>J.vehicle_type==="car").length,compliant:n.filter(J=>J.vehicle_type==="car"&&J.compliance===1).length,violations:n.filter(J=>J.vehicle_type==="car"&&J.compliance===0).length,avgReactionTime:n.filter(J=>J.vehicle_type==="car"&&J.reaction_time).reduce((J,ee)=>J+(ee.reaction_time||0),0)/Math.max(1,n.filter(J=>J.vehicle_type==="car"&&J.reaction_time).length)},{type:"truck",total:n.filter(J=>J.vehicle_type==="truck").length,compliant:n.filter(J=>J.vehicle_type==="truck"&&J.compliance===1).length,violations:n.filter(J=>J.vehicle_type==="truck"&&J.compliance===0).length,avgReactionTime:n.filter(J=>J.vehicle_type==="truck"&&J.reaction_time).reduce((J,ee)=>J+(ee.reaction_time||0),0)/Math.max(1,n.filter(J=>J.vehicle_type==="truck"&&J.reaction_time).length)}].filter(J=>J.total>0):[]};console.log("Generating PDF report with metrics:",O);const R=await cu(j,O),Z=`Project49_Traffic_Analysis_Report_${new Date().toISOString().split("T")[0]}.pdf`;R.save(Z)}catch(j){console.error("Error generating report:",j),c(`Failed to generate PDF report: ${j instanceof Error?j.message:"Unknown error"}`)}finally{x(!1)}};return a.jsxs("div",{className:`min-h-screen ${t?"bg-[#0B1121] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx(Wt,{}),a.jsx(wt,{title:"Analytics",onToggleSidebar:()=>e(!r),isSidebarOpen:r}),a.jsx(jt,{activePath:"/analytics",isOpen:r,onClose:()=>e(!1)}),a.jsx("main",{className:"lg:ml-64 p-4 lg:p-8 mt-16 lg:mt-0",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-2xl lg:text-3xl font-bold mb-2",children:"Road Safety Analytics Dashboard"}),a.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"Analyze traffic patterns and generate comprehensive safety reports"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 mb-8",children:[a.jsxs("div",{className:`p-6 rounded-xl text-center ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("div",{className:"text-3xl font-bold text-primary-500 mb-2",children:Y.totalVehicles}),a.jsx("div",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Total Vehicles"})]}),a.jsxs("div",{className:`p-6 rounded-xl text-center ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsxs("div",{className:"text-3xl font-bold text-green-500 mb-2",children:[Y.overallCompliance.toFixed(1),"%"]}),a.jsx("div",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Overall Compliance"})]}),a.jsxs("div",{className:`p-6 rounded-xl text-center ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsxs("div",{className:"text-3xl font-bold text-blue-500 mb-2",children:[Y.avgReactionTime.toFixed(1),"s"]}),a.jsx("div",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Avg Reaction Time"})]}),a.jsxs("div",{className:`p-6 rounded-xl text-center ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("div",{className:"text-3xl font-bold text-purple-500 mb-2",children:Y.weatherConditions}),a.jsx("div",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Weather Conditions"})]})]}),a.jsxs("div",{className:`p-8 rounded-xl mb-8 ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[a.jsx("div",{className:"p-3 bg-primary-500/10 rounded-lg",children:a.jsx(ls,{className:"w-6 h-6 text-primary-500"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Data Analysis Controls"}),a.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"Filter and analyze traffic data by date range and conditions"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Date Range:"}),a.jsxs("select",{value:b,onChange:j=>N(j.target.value),className:`w-full px-3 py-2 rounded-lg border ${t?"bg-[#1E293B] border-[#334155] text-white":"bg-white border-gray-300 text-gray-900"}`,children:[a.jsx("option",{value:"all",children:"All Time"}),a.jsx("option",{value:"7days",children:"Last 7 Days"}),a.jsx("option",{value:"30days",children:"Last 30 Days"}),a.jsx("option",{value:"90days",children:"Last 90 Days"}),a.jsx("option",{value:"custom",children:"Custom Range"})]})]}),b==="custom"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Start Date:"}),a.jsx("input",{type:"date",value:_,onChange:j=>I(j.target.value),className:`w-full px-3 py-2 rounded-lg border ${t?"bg-[#1E293B] border-[#334155] text-white":"bg-white border-gray-300 text-gray-900"}`})]}),a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"End Date:"}),a.jsx("input",{type:"date",value:k,onChange:j=>E(j.target.value),className:`w-full px-3 py-2 rounded-lg border ${t?"bg-[#1E293B] border-[#334155] text-white":"bg-white border-gray-300 text-gray-900"}`})]})]})]}),a.jsxs("div",{className:"flex flex-wrap gap-4",children:[a.jsxs("button",{onClick:G,className:"flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg transition-colors",disabled:u,children:[a.jsx(rr,{className:"w-5 h-5"}),u?"Loading...":"Refresh Data"]}),a.jsx("button",{onClick:Q,className:`px-4 py-2 rounded-lg border ${t?"bg-[#1E293B] border-[#334155] text-white":"bg-white border-gray-300 text-gray-900"} hover:bg-opacity-80 transition-colors`,disabled:u,children:"Reset All Filters"}),n.length>0&&a.jsxs("button",{onClick:B,className:"flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 rounded-lg transition-colors",disabled:u||f,children:[a.jsx(cs,{className:"w-5 h-5"}),f?"Generating...":"Generate Report"]})]}),d&&a.jsx("div",{className:`mt-4 p-4 rounded-lg ${t?"bg-red-500/10 text-red-400":"bg-red-50 text-red-600"}`,children:d})]}),u?a.jsxs("div",{className:`p-8 rounded-xl text-center ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Loading Data"}),a.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"Loading job analytics..."})]}):n.length>0&&o?a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx(ds,{className:"w-5 h-5 text-primary-500"}),a.jsx("h2",{className:"text-lg font-semibold",children:"Advanced Filters"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Weather Condition:"}),a.jsxs("select",{value:P,onChange:j=>W(j.target.value),className:`w-full px-3 py-2 rounded-lg border ${t?"bg-[#1E293B] border-[#334155] text-white":"bg-white border-gray-300 text-gray-900"}`,children:[a.jsx("option",{value:"",children:"All Weather"}),a.jsx("option",{value:"clear",children:"Clear"}),a.jsx("option",{value:"cloudy",children:"Cloudy"}),a.jsx("option",{value:"foggy",children:"Foggy"}),a.jsx("option",{value:"rainy",children:"Rainy"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Vehicle Type:"}),a.jsxs("select",{value:V,onChange:j=>A(j.target.value),className:`w-full px-3 py-2 rounded-lg border ${t?"bg-[#1E293B] border-[#334155] text-white":"bg-white border-gray-300 text-gray-900"}`,children:[a.jsx("option",{value:"",children:"All Vehicles"}),a.jsx("option",{value:"car",children:"Car"}),a.jsx("option",{value:"truck",children:"Truck"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Compliance:"}),a.jsxs("select",{value:g,onChange:j=>m(j.target.value),className:`w-full px-3 py-2 rounded-lg border ${t?"bg-[#1E293B] border-[#334155] text-white":"bg-white border-gray-300 text-gray-900"}`,children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"1",children:"Compliant"}),a.jsx("option",{value:"0",children:"Non-Compliant"})]})]}),a.jsx("div",{className:"flex items-end",children:a.jsx("button",{onClick:te,className:"w-full px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg transition-colors",children:"Apply Filters"})})]})]}),a.jsxs("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("h2",{className:"text-lg font-semibold mb-6",children:"🌤️ Weather Impact Analysis"}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-md font-medium mb-4",children:"Weather Compliance Rates"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"weatherComplianceChart"})})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-md font-medium mb-4",children:"Weather Reaction Times"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"weatherReactionChart"})})]})]})]}),a.jsxs("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("h2",{className:"text-lg font-semibold mb-6",children:"🚛 Vehicle Type Analysis"}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-md font-medium mb-4",children:"Vehicle Compliance Comparison"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"vehicleChart"})})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-md font-medium mb-4",children:"Vehicle Distribution"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"vehicleDistributionChart"})})]})]})]}),a.jsxs("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("h2",{className:"text-lg font-semibold mb-6",children:"⏰ Time-based Analysis"}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-md font-medium mb-4",children:"Hourly Compliance Rates"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"hourlyChart"})})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-md font-medium mb-4",children:"Traffic Volume by Hour"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"trafficVolumeChart"})})]})]})]}),a.jsxs("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h2",{className:"text-lg font-semibold",children:"🔥 Advanced Correlation Heatmaps"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${t?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-600"}`,children:"Interactive"}),a.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${t?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-600"}`,children:"Real-time"})]})]}),a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-md font-medium",children:"Weather vs Vehicle Type Compliance"}),a.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),a.jsx("span",{children:"High Compliance"})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded"}),a.jsx("span",{children:"Medium"})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),a.jsx("span",{children:"Low Compliance"})]})]})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsx("div",{id:"weatherVehicleHeatmap",className:"min-h-[300px] min-w-[500px] border rounded-lg p-4 bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900"})})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-md font-medium",children:"Hourly Compliance Patterns"}),a.jsx("div",{className:"text-xs text-gray-500",children:"Shows compliance rates by hour and weather conditions"})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsx("div",{id:"timeWeatherHeatmap",className:"min-h-[300px] min-w-[700px] border rounded-lg p-4 bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900"})})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-md font-medium",children:"Vehicle Type vs Hour Analysis"}),a.jsx("div",{className:"text-xs text-gray-500",children:"Compliance rates by vehicle type and time of day"})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsx("div",{id:"vehicleHourHeatmap",className:"min-h-[300px] min-w-[600px] border rounded-lg p-4 bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900"})})]})]})]}),o.recommendations&&a.jsxs("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("h2",{className:"text-lg font-semibold mb-6",children:"💡 Actionable Insights"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.recommendations.map((j,O)=>a.jsxs("div",{className:`p-4 rounded-lg border-l-4 ${j.type==="warning"?"border-yellow-500 bg-yellow-500/10":j.type==="critical"?"border-red-500 bg-red-500/10":"border-blue-500 bg-blue-500/10"}`,children:[a.jsxs("div",{className:"font-semibold mb-2",children:[X(j.category)," ",j.category.toUpperCase()]}),a.jsx("div",{className:`text-sm mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:j.message}),a.jsxs("div",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:["💡 ",j.suggestion]})]},O))})]}),a.jsxs("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h2",{className:"text-lg font-semibold",children:"📊 Raw Data"}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("label",{className:`text-sm font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Show:"}),a.jsxs("select",{value:v,onChange:j=>{U(Number(j.target.value)),C(1)},className:`px-3 py-1 rounded-lg border text-sm ${t?"bg-[#1E293B] border-[#334155] text-white":"bg-white border-gray-300 text-gray-900"}`,children:[a.jsx("option",{value:5,children:"5"}),a.jsx("option",{value:10,children:"10"}),a.jsx("option",{value:25,children:"25"}),a.jsx("option",{value:50,children:"50"}),a.jsx("option",{value:100,children:"100"})]})]}),a.jsxs("div",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:["Showing ",(p-1)*v+1," to ",Math.min(p*v,n.length)," of ",n.length," entries"]})]})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("div",{className:"min-w-[1200px]",children:[a.jsxs("div",{className:`grid grid-cols-12 gap-2 px-6 py-4 border-b-2 ${t?"border-gray-600":"border-gray-300"} font-bold text-sm uppercase tracking-wide`,children:[a.jsx("div",{className:"col-span-2 text-left",children:"ID"}),a.jsx("div",{className:"col-span-2 text-left",children:"Vehicle"}),a.jsx("div",{className:"col-span-1 text-center",children:"Status"}),a.jsx("div",{className:"col-span-2 text-center",children:"Compliance"}),a.jsx("div",{className:"col-span-1 text-center",children:"Time"}),a.jsx("div",{className:"col-span-1 text-center",children:"Weather"}),a.jsx("div",{className:"col-span-1 text-center",children:"Temp"}),a.jsx("div",{className:"col-span-2 text-left",children:"Date"})]}),a.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:M().map((j,O)=>a.jsxs("div",{className:`grid grid-cols-12 gap-2 px-6 py-4 hover:bg-opacity-50 transition-all duration-200 ${t?"hover:bg-gray-800":"hover:bg-gray-50"}`,children:[a.jsx("div",{className:"col-span-2 flex items-center",children:a.jsxs("div",{className:`font-mono text-sm font-medium ${t?"text-gray-200":"text-gray-800"}`,children:["#",j.tracker_id]})}),a.jsx("div",{className:"col-span-2 flex items-center",children:q(j.vehicle_type)}),a.jsx("div",{className:"col-span-1 flex items-center justify-center",children:F(j.status)}),a.jsx("div",{className:"col-span-2 flex items-center justify-center",children:D(j.compliance)}),a.jsx("div",{className:"col-span-1 flex items-center justify-center",children:j.reaction_time?a.jsxs("div",{className:`text-center font-mono text-sm font-medium ${t?"text-gray-200":"text-gray-800"}`,children:[j.reaction_time.toFixed(2),"s"]}):a.jsx("div",{className:`text-center text-sm ${t?"text-gray-500":"text-gray-400"}`,children:"-"})}),a.jsx("div",{className:"col-span-1 flex items-center justify-center",children:S(j.weather_condition)}),a.jsx("div",{className:"col-span-1 flex items-center justify-center",children:j.temperature?a.jsxs("div",{className:`text-center font-mono text-sm font-medium ${t?"text-gray-200":"text-gray-800"}`,children:[j.temperature,"°C"]}):a.jsx("div",{className:`text-center text-sm ${t?"text-gray-500":"text-gray-400"}`,children:"-"})}),a.jsx("div",{className:"col-span-2 flex items-center",children:a.jsxs("div",{className:"flex flex-col",children:[a.jsx("div",{className:`text-sm font-medium ${t?"text-gray-200":"text-gray-800"}`,children:uu(j.date)}),a.jsx("div",{className:`text-xs ${t?"text-gray-500":"text-gray-400"}`,children:vn()})]})})]},O))})]})}),ae>1&&a.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[a.jsxs("div",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:["Page ",p," of ",ae]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>w(1),disabled:p===1,className:`p-2 rounded-lg transition-colors ${p===1?`${t?"bg-gray-800 text-gray-600":"bg-gray-100 text-gray-400"} cursor-not-allowed`:`${t?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-white hover:bg-gray-50 text-gray-700"} border border-gray-300 dark:border-gray-600`}`,children:a.jsx(qn,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>w(p-1),disabled:p===1,className:`p-2 rounded-lg transition-colors ${p===1?`${t?"bg-gray-800 text-gray-600":"bg-gray-100 text-gray-400"} cursor-not-allowed`:`${t?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-white hover:bg-gray-50 text-gray-700"} border border-gray-300 dark:border-gray-600`}`,children:a.jsx(Hn,{className:"w-4 h-4"})}),a.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,ae)},(j,O)=>{const R=Math.max(1,Math.min(ae-4,p-2))+O;return R>ae?null:a.jsx("button",{onClick:()=>w(R),className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${p===R?"bg-primary-500 text-white":`${t?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-white hover:bg-gray-50 text-gray-700"} border border-gray-300 dark:border-gray-600`}`,children:R},R)})}),a.jsx("button",{onClick:()=>w(p+1),disabled:p===ae,className:`p-2 rounded-lg transition-colors ${p===ae?`${t?"bg-gray-800 text-gray-600":"bg-gray-100 text-gray-400"} cursor-not-allowed`:`${t?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-white hover:bg-gray-50 text-gray-700"} border border-gray-300 dark:border-gray-600`}`,children:a.jsx(Kn,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>w(ae),disabled:p===ae,className:`p-2 rounded-lg transition-colors ${p===ae?`${t?"bg-gray-800 text-gray-600":"bg-gray-100 text-gray-400"} cursor-not-allowed`:`${t?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-white hover:bg-gray-50 text-gray-700"} border border-gray-300 dark:border-gray-600`}`,children:a.jsx(Jn,{className:"w-4 h-4"})})]})]})]})]}):a.jsxs("div",{className:`p-8 rounded-xl text-center ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx(Ye,{className:`w-12 h-12 mx-auto mb-4 ${t?"text-gray-400":"text-gray-500"}`}),a.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No Data Available"}),a.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"No tracking data found for the selected date range. Try adjusting your filters or upload some videos for analysis."})]})]})}),n.length>0&&o&&a.jsx(pu,{analysisData:o,isDark:t})]})}function pu({analysisData:r,isDark:e}){return y.useEffect(()=>{(async()=>{const s=(await Ut(async()=>{const{default:u}=await import("./auto-1tSkAajP.js");return{default:u}},__vite__mapDeps([0,1,2]))).default,n=document.getElementById("weatherComplianceChart");if(n){const u=s.getChart(n);u&&u.destroy(),new s(n,{type:"bar",data:{labels:Object.keys(r.weather_analysis.weather_compliance),datasets:[{label:"Compliance Rate (%)",data:Object.values(r.weather_analysis.weather_compliance).map(h=>h.mean*100),backgroundColor:["#4CAF50","#FF9800","#9C27B0","#2196F3"],borderColor:["#388E3C","#F57C00","#7B1FA2","#1976D2"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,max:100,ticks:{callback:function(h){return h+"%"},color:e?"#9CA3AF":"#6B7280"},grid:{color:e?"#374151":"#E5E7EB"}},x:{ticks:{color:e?"#9CA3AF":"#6B7280"},grid:{color:e?"#374151":"#E5E7EB"}}}}})}const i=document.getElementById("weatherReactionChart");if(i){const u=s.getChart(i);u&&u.destroy(),new s(i,{type:"line",data:{labels:Object.keys(r.weather_analysis.weather_reaction_time),datasets:[{label:"Average Reaction Time (seconds)",data:Object.values(r.weather_analysis.weather_reaction_time).map(h=>h.mean),borderColor:"#FF5722",backgroundColor:"rgba(255, 87, 34, 0.1)",borderWidth:3,fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Seconds",color:e?"#9CA3AF":"#6B7280"},ticks:{color:e?"#9CA3AF":"#6B7280"},grid:{color:e?"#374151":"#E5E7EB"}},x:{ticks:{color:e?"#9CA3AF":"#6B7280"},grid:{color:e?"#374151":"#E5E7EB"}}}}})}const o=document.getElementById("vehicleChart");if(o){const u=s.getChart(o);u&&u.destroy(),new s(o,{type:"doughnut",data:{labels:Object.keys(r.basic_correlations.vehicle_type_compliance).map(h=>`${h.charAt(0).toUpperCase()+h.slice(1)} (${(r.basic_correlations.vehicle_type_compliance[h].mean*100).toFixed(1)}%)`),datasets:[{data:Object.values(r.basic_correlations.vehicle_type_compliance).map(h=>h.mean*100),backgroundColor:["#4CAF50","#F44336"],borderWidth:2,borderColor:e?"#1F2937":"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:e?"#9CA3AF":"#6B7280"}}}}})}const l=document.getElementById("vehicleDistributionChart");if(l){const u=s.getChart(l);u&&u.destroy(),new s(l,{type:"pie",data:{labels:Object.keys(r.basic_correlations.vehicle_type_compliance),datasets:[{data:Object.values(r.basic_correlations.vehicle_type_compliance).map(h=>h.count),backgroundColor:["#2196F3","#FF9800"],borderWidth:2,borderColor:e?"#1F2937":"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:e?"#9CA3AF":"#6B7280"}}}}})}const d=document.getElementById("hourlyChart");if(d){const u=s.getChart(d);u&&u.destroy(),new s(d,{type:"bar",data:{labels:Object.keys(r.basic_correlations.hour_compliance),datasets:[{label:"Compliance Rate (%)",data:Object.values(r.basic_correlations.hour_compliance).map(h=>h.mean*100),backgroundColor:"rgba(52, 152, 219, 0.8)",borderColor:"#3498db",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,max:100,ticks:{callback:function(h){return h+"%"},color:e?"#9CA3AF":"#6B7280"},grid:{color:e?"#374151":"#E5E7EB"}},x:{title:{display:!0,text:"Hour of Day",color:e?"#9CA3AF":"#6B7280"},ticks:{color:e?"#9CA3AF":"#6B7280"},grid:{color:e?"#374151":"#E5E7EB"}}}}})}const c=document.getElementById("trafficVolumeChart");if(c){const u=s.getChart(c);u&&u.destroy(),new s(c,{type:"line",data:{labels:Object.keys(r.basic_correlations.hour_compliance),datasets:[{label:"Traffic Volume",data:Object.values(r.basic_correlations.hour_compliance).map(h=>h.count),borderColor:"#27AE60",backgroundColor:"rgba(39, 174, 96, 0.1)",borderWidth:3,fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Vehicles",color:e?"#9CA3AF":"#6B7280"},ticks:{color:e?"#9CA3AF":"#6B7280"},grid:{color:e?"#374151":"#E5E7EB"}},x:{title:{display:!0,text:"Hour of Day",color:e?"#9CA3AF":"#6B7280"},ticks:{color:e?"#9CA3AF":"#6B7280"},grid:{color:e?"#374151":"#E5E7EB"}}}}})}})()},[r,e]),y.useEffect(()=>{if(!r)return;const t=l=>l>=.8?{bg:"bg-green-500",text:"text-white",intensity:1}:l>=.6?{bg:"bg-yellow-500",text:"text-white",intensity:.8}:l>=.4?{bg:"bg-orange-500",text:"text-white",intensity:.6}:{bg:"bg-red-500",text:"text-white",intensity:.4},s=(l,d,c)=>{const u=document.createElement("div"),h=t(l);return u.className=`${h.bg} ${h.text} text-xs font-medium p-3 text-center rounded-lg min-w-[60px] min-h-[50px] flex items-center justify-center cursor-pointer hover:scale-105 transition-all duration-200 shadow-sm hover:shadow-md`,u.textContent=`${(l*100).toFixed(0)}%`,u.title=c,u.addEventListener("mouseenter",()=>{u.style.transform="scale(1.05)",u.style.zIndex="10"}),u.addEventListener("mouseleave",()=>{u.style.transform="scale(1)",u.style.zIndex="1"}),u},n=document.getElementById("weatherVehicleHeatmap");if(n){n.innerHTML="";const l=Object.keys(r.weather_analysis.weather_compliance),d=Object.keys(r.basic_correlations.vehicle_type_compliance),c=document.createElement("div");c.className="grid gap-2",c.style.gridTemplateColumns=`120px repeat(${l.length}, 1fr)`;const u=document.createElement("div");u.className="flex items-center justify-center p-2",c.appendChild(u),l.forEach(h=>{const f=document.createElement("div");f.className=`text-xs font-bold p-2 text-center rounded-lg ${e?"bg-gray-700 text-gray-200":"bg-gray-200 text-gray-800"} min-w-[80px]`,f.textContent=h.charAt(0).toUpperCase()+h.slice(1),c.appendChild(f)}),d.forEach(h=>{const f=document.createElement("div");f.className=`text-xs font-bold p-2 text-center ${e?"text-gray-200":"text-gray-800"} flex items-center justify-center`,f.textContent=h.charAt(0).toUpperCase()+h.slice(1),c.appendChild(f),l.forEach(x=>{var k,E;const b=((k=r.weather_analysis.weather_compliance[x])==null?void 0:k.mean)||0,N=((E=r.basic_correlations.vehicle_type_compliance[h])==null?void 0:E.mean)||0,_=(b+N)/2,I=s(_,`${(_*100).toFixed(0)}%`,`${h} in ${x}: ${(_*100).toFixed(1)}% compliance`);c.appendChild(I)})}),n.appendChild(c)}const i=document.getElementById("timeWeatherHeatmap");if(i){i.innerHTML="";const l=Object.keys(r.basic_correlations.hour_compliance).sort((h,f)=>parseInt(h)-parseInt(f)),d=Object.keys(r.weather_analysis.weather_compliance),c=document.createElement("div");c.className="grid gap-2",c.style.gridTemplateColumns=`120px repeat(${Math.min(l.length,12)}, 1fr)`;const u=document.createElement("div");u.className="flex items-center justify-center p-2",c.appendChild(u),l.slice(0,12).forEach(h=>{const f=document.createElement("div");f.className=`text-xs font-bold p-2 text-center rounded-lg ${e?"bg-gray-700 text-gray-200":"bg-gray-200 text-gray-800"} min-w-[60px]`,f.textContent=`${h}:00`,c.appendChild(f)}),d.forEach(h=>{const f=document.createElement("div");f.className=`text-xs font-bold p-2 text-center ${e?"text-gray-200":"text-gray-800"} flex items-center justify-center`,f.textContent=h.charAt(0).toUpperCase()+h.slice(1),c.appendChild(f),l.slice(0,12).forEach(x=>{var k,E;const b=((k=r.basic_correlations.hour_compliance[x])==null?void 0:k.mean)||0,N=((E=r.weather_analysis.weather_compliance[h])==null?void 0:E.mean)||0,_=(b+N)/2,I=s(_,`${(_*100).toFixed(0)}%`,`${h} at ${x}:00: ${(_*100).toFixed(1)}% compliance`);c.appendChild(I)})}),i.appendChild(c)}const o=document.getElementById("vehicleHourHeatmap");if(o){o.innerHTML="";const l=Object.keys(r.basic_correlations.hour_compliance).sort((h,f)=>parseInt(h)-parseInt(f)),d=Object.keys(r.basic_correlations.vehicle_type_compliance),c=document.createElement("div");c.className="grid gap-2",c.style.gridTemplateColumns=`120px repeat(${Math.min(l.length,12)}, 1fr)`;const u=document.createElement("div");u.className="flex items-center justify-center p-2",c.appendChild(u),l.slice(0,12).forEach(h=>{const f=document.createElement("div");f.className=`text-xs font-bold p-2 text-center rounded-lg ${e?"bg-gray-700 text-gray-200":"bg-gray-200 text-gray-800"} min-w-[60px]`,f.textContent=`${h}:00`,c.appendChild(f)}),d.forEach(h=>{const f=document.createElement("div");f.className=`text-xs font-bold p-2 text-center ${e?"text-gray-200":"text-gray-800"} flex items-center justify-center`,f.textContent=h.charAt(0).toUpperCase()+h.slice(1),c.appendChild(f),l.slice(0,12).forEach(x=>{var k,E;const b=((k=r.basic_correlations.hour_compliance[x])==null?void 0:k.mean)||0,N=((E=r.basic_correlations.vehicle_type_compliance[h])==null?void 0:E.mean)||0,_=(b+N)/2,I=s(_,`${(_*100).toFixed(0)}%`,`${h} at ${x}:00: ${(_*100).toFixed(1)}% compliance`);c.appendChild(I)})}),o.appendChild(c)}},[r,e]),null}function xu(){const[r,e]=y.useState(null),[t,s]=y.useState(()=>Ne()==="dark"),[n,i]=y.useState(!1),[o,l]=y.useState(""),[d,c]=y.useState("success"),[u,h]=y.useState(!1),[f,x]=y.useState(!1),[b,N]=y.useState({displayName:"",email:""});y.useEffect(()=>{ge.auth.getUser().then(({data:{user:W}})=>{e(W),N(V=>{var A;return{...V,displayName:((A=W==null?void 0:W.user_metadata)==null?void 0:A.full_name)||"",email:(W==null?void 0:W.email)||""}})});const{data:{subscription:P}}=ge.auth.onAuthStateChange((W,V)=>{const A=V==null?void 0:V.user;e(A),A&&N(g=>{var m;return{...g,displayName:((m=A.user_metadata)==null?void 0:m.full_name)||"",email:A.email||""}})});return()=>P.unsubscribe()},[]);const _=(P,W)=>{l(P),c(W),i(!0),setTimeout(()=>i(!1),3e3)},I=async P=>{P.preventDefault(),h(!0);try{const{error:W}=await ge.auth.updateUser({email:b.email,data:{full_name:b.displayName}});if(W)throw W;_("Profile updated successfully","success")}catch(W){_(W.message,"error")}finally{h(!1)}},k=async()=>{if(!b.email){_("Please enter your email address first","error");return}h(!0);try{const{error:P}=await ge.auth.resetPasswordForEmail(b.email,{redirectTo:`${window.location.origin}/auth`});if(P)throw P;_("Password reset email sent successfully","success")}catch(P){_(P.message,"error")}finally{h(!1)}},E=()=>{const P=nn(t?"dark":"light");s(P==="dark")};return a.jsxs("div",{className:`min-h-screen ${t?"bg-[#0B1121] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx(Wt,{}),n&&a.jsxs("div",{className:`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg flex items-center space-x-2 ${d==="success"?"bg-green-500":"bg-red-500"}`,children:[d==="success"?a.jsx(Qe,{className:"w-5 h-5 text-white"}):a.jsx(Dt,{className:"w-5 h-5 text-white"}),a.jsx("span",{className:"text-white",children:o})]}),a.jsx(wt,{title:"Settings",onToggleSidebar:()=>x(!f),isSidebarOpen:f}),a.jsx(jt,{activePath:"/settings",isOpen:f,onClose:()=>x(!1)}),a.jsx("main",{className:"lg:ml-64 p-4 lg:p-8 mt-16 lg:mt-0",children:a.jsxs("div",{className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-2",children:"Settings"}),a.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"Manage your account and preferences"})]}),a.jsxs("form",{onSubmit:I,className:"space-y-6",children:[a.jsxs("div",{className:`${t?"bg-[#151F32]":"bg-white"} rounded-xl p-4 sm:p-6 ${t?"":"shadow-lg border border-gray-200"}`,children:[a.jsxs("h2",{className:"text-lg sm:text-xl font-semibold mb-4 sm:mb-6 flex items-center gap-2",children:[a.jsx(Gn,{className:"w-5 h-5"}),"Profile Information"]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-400":"text-gray-700"} mb-2`,children:"Display Name"}),a.jsx("input",{type:"text",value:b.displayName,onChange:P=>N({...b,displayName:P.target.value}),className:`w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base ${t?"bg-[#1E293B] border-[#2D3B4E] text-white":"bg-gray-50 border-gray-300 text-gray-900"} border rounded-lg focus:outline-none focus:border-primary-400`,placeholder:"Enter your display name"})]}),a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-400":"text-gray-700"} mb-2`,children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(Na,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${t?"text-gray-400":"text-gray-500"}`}),a.jsx("input",{type:"email",value:b.email,onChange:P=>N({...b,email:P.target.value}),className:`w-full pl-10 sm:pl-12 pr-3 sm:pr-4 py-2 sm:py-3 text-sm sm:text-base ${t?"bg-[#1E293B] border-[#2D3B4E] text-white":"bg-gray-50 border-gray-300 text-gray-900"} border rounded-lg focus:outline-none focus:border-primary-400`,placeholder:"Enter your email address"})]})]})]})]}),a.jsxs("div",{className:`${t?"bg-[#151F32]":"bg-white"} rounded-xl p-4 sm:p-6 ${t?"":"shadow-lg border border-gray-200"}`,children:[a.jsxs("h2",{className:"text-lg sm:text-xl font-semibold mb-4 sm:mb-6 flex items-center gap-2",children:[t?a.jsx(ja,{className:"w-5 h-5"}):a.jsx(wa,{className:"w-5 h-5"}),"Appearance"]}),a.jsxs("div",{className:`flex items-center justify-between p-4 ${t?"bg-[#1E293B]":"bg-gray-50"} rounded-lg`,children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-sm sm:text-base",children:"Dark Mode"}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Use dark theme for better viewing experience"})]}),a.jsx("button",{type:"button",onClick:E,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${t?"bg-primary-500":"bg-gray-300"}`,children:a.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${t?"translate-x-6":"translate-x-1"}`})})]})]}),a.jsxs("div",{className:`${t?"bg-[#151F32]":"bg-white"} rounded-xl p-4 sm:p-6 ${t?"":"shadow-lg border border-gray-200"}`,children:[a.jsxs("h2",{className:"text-lg sm:text-xl font-semibold mb-4 sm:mb-6 flex items-center gap-2",children:[a.jsx(Yn,{className:"w-5 h-5"}),"Password"]}),a.jsx("div",{className:`p-4 ${t?"bg-[#1E293B]":"bg-gray-50"} rounded-lg`,children:a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 sm:gap-0",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-sm sm:text-base",children:"Reset Password"}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Send a password reset email to your registered email address"})]}),a.jsx("button",{type:"button",onClick:k,disabled:u,className:"bg-red-500 hover:bg-red-600 disabled:bg-gray-600 disabled:cursor-not-allowed text-white px-3 sm:px-4 py-2 rounded-lg transition-colors text-xs sm:text-sm font-medium whitespace-nowrap",children:u?"Sending...":"Reset Password"})]})})]}),a.jsx("div",{className:"flex justify-center sm:justify-end",children:a.jsxs("button",{type:"submit",disabled:u,className:"bg-primary-500 hover:bg-primary-600 disabled:bg-gray-600 disabled:cursor-not-allowed text-white px-6 sm:px-8 py-2 sm:py-3 rounded-lg transition-colors flex items-center gap-2 font-medium text-sm sm:text-base",children:[a.jsx(Qn,{className:"w-5 h-5"}),u?"Saving...":"Save Changes"]})})]})]})})]})}nt.register(...Ea);const ya=r=>{if(!r)return"An unexpected error occurred";const e=r.message||r.toString();return e.includes("Failed to fetch")||e.includes("NetworkError")?"Unable to connect to the processing server. Please check your internet connection and try again.":e.includes("timeout")||e.includes("TIMEOUT")?"The request took too long to complete. Please try again.":e.includes("500")||e.includes("Internal Server Error")?"The processing server is experiencing issues. Please try again in a few minutes.":e.includes("404")||e.includes("Not Found")?"The requested service is not available. Please contact support if this continues.":e.includes("403")||e.includes("Forbidden")?"Access denied. Please check your permissions or contact support.":"Something went wrong. Please try again or contact support if the problem continues."};function yu(){const[r,e]=y.useState(!1),[t,s]=y.useState(()=>Ne()==="dark"),[n,i]=y.useState([]),[o,l]=y.useState(!1),[d,c]=y.useState(""),[u,h]=y.useState(0),[f,x]=y.useState(25),[b,N]=y.useState(0),[_,I]=y.useState(""),[k,E]=y.useState(""),[P,W]=y.useState("created_at"),[V,A]=y.useState("true"),[g,m]=y.useState(""),[p,C]=y.useState(!1),[v,U]=y.useState(null),[Y,ve]=y.useState(!1),[de,re]=y.useState(""),[he,G]=y.useState(!1),[me,te]=y.useState(null),[Q,M]=y.useState(""),[ae,w]=y.useState(!1),[D,q]=y.useState({id:null,name:null}),S=y.useRef(null),F=y.useRef(null),X=y.useRef(null),B=y.useRef(null),j=y.useRef(null),O=y.useRef(null),R=y.useRef(null),H=y.useRef(null),Z=y.useRef(null),[J,ee]=y.useState({show:!1,message:"",type:"info"}),ue=y.useRef(),je=y.useRef(new Map);y.useEffect(()=>{const T=()=>{s(Ne()==="dark")};return window.addEventListener("themeChanged",T),L(0),()=>{window.removeEventListener("themeChanged",T),$(),Fs()}},[]);const $=()=>{ue.current&&clearTimeout(ue.current)},K=(T,le="info",ie=5e3)=>{$(),ee({show:!0,message:T,type:le}),ue.current=setTimeout(()=>{ee(fe=>({...fe,show:!1}))},ie)},ce=T=>JSON.stringify({dateFrom:_,dateTo:k,orderBy:P,orderDesc:V,limit:f,offset:T}),L=async(T,le=!1)=>{const ie=ce(T),fe=je.current.get(ie);fe&&(i(fe.data||[]),h(fe.count||0)),l(!0),c("Loading videos...");try{const _e=await Zd({dateFrom:_||void 0,dateTo:k||void 0,orderBy:P,orderDesc:V,limit:f,offset:T});if(_e.status!=="success")throw new Error(_e.error||"Failed to load videos");i(_e.data||[]),h(_e.count||0),N(T),je.current.set(ie,{data:_e.data||[],count:_e.count||0}),c(""),le&&K("Filters applied successfully","success",3e3)}catch(_e){const Ve=ya(_e);c(`Error: ${Ve}`),K(Ve,"error")}finally{l(!1)}},oe=async()=>{je.current.clear(),await L(0,!0)},z=Math.max(1,Math.ceil((u||0)/(f||1))),ye=Math.min(z,Math.floor((b||0)/(f||1))+1),Te=async T=>{const ie=(Math.max(1,Math.min(z,T))-1)*f;await L(ie)},zt=y.useMemo(()=>{const le=[];let ie=Math.max(1,ye-Math.floor(2.5)),fe=Math.min(z,ie+5-1);ie=Math.max(1,Math.min(ie,Math.max(1,fe-5+1)));for(let _e=ie;_e<=fe;_e++)le.push(_e);return le},[ye,z]),dr=async(T,le)=>{C(!0),ve(!0),re(le),U(null);try{const ie=await eu(T);if(ie.status!=="success")throw new Error(ie.error||"Failed to load video summary");U(ie),setTimeout(async()=>{try{const fe=await su(T);O.current&&(O.current.src=fe)}catch{_n(T,"summary")}},100)}catch(ie){const fe=ya(ie);K(fe,"error")}finally{ve(!1)}},Xe=()=>{C(!1),U(null),re(""),Fs(),O.current&&(O.current.pause(),O.current.src=""),H.current&&(URL.revokeObjectURL(H.current),H.current=null)},Le=()=>{G(!1),te(null),re(""),M(""),R.current&&(R.current.pause(),R.current.src=""),Z.current&&(URL.revokeObjectURL(Z.current),Z.current=null)},ut=(T,le)=>{q({id:T,name:le}),w(!0)},ur=async()=>{if(D.id!==null){c("Deleting..."),w(!1);try{const T=await tu(D.id);if(T.status!=="success")throw new Error(T.error||"Failed to delete video");c("Video deleted successfully"),K("Video deleted successfully","success"),await oe(),setTimeout(()=>{c("")},2e3)}catch(T){c(`Error: ${T.message}`),console.error("Error deleting video:",T)}finally{q({id:null,name:null})}}},wn=()=>{w(!1),q({id:null,name:null})},Fs=()=>{S.current&&(S.current.destroy(),S.current=null),F.current&&(F.current.destroy(),F.current=null),X.current&&(X.current.destroy(),X.current=null),B.current&&(B.current.destroy(),B.current=null),j.current&&(j.current.destroy(),j.current=null)},jn=async()=>{const T=new Headers;T.set("Authorization","Bearer rpa_1K6BW22JFGU3D3AI8XRSQ7YBSPE7XHDKTMBR2Q211nzdtd");try{const{data:{session:le}}=await ge.auth.getSession(),ie=le==null?void 0:le.access_token;ie&&T.set("Authorization",`Bearer ${ie}`)}catch{}return T},_n=async(T,le)=>{try{const ie=ru(T),fe=await jn(),_e=await fetch(ie,{headers:fe});if(!_e.ok)throw new Error(`HTTP ${_e.status}`);const Ve=await _e.blob(),$e=URL.createObjectURL(Ve);le==="summary"&&(H.current&&URL.revokeObjectURL(H.current),H.current=$e,O.current&&(O.current.src=$e))}catch(ie){M("Error loading video. Please check the URL."),console.error("Error loading video with auth:",ie)}},Nn=(T,le)=>{if(!le||le.length===0)return;const ie={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:t?"#E5E7EB":"#374151",font:{family:"Inter, system-ui, sans-serif"}}}},scales:{x:{ticks:{color:t?"#9CA3AF":"#6B7280"},grid:{color:t?"#374151":"#E5E7EB"}},y:{ticks:{color:t?"#9CA3AF":"#6B7280"},grid:{color:t?"#374151":"#E5E7EB"}}}},fe={};for(const Ze of le){const Nt=Ze.vehicle_type||"unknown";fe[Nt]=(fe[Nt]||0)+(Ze.count||0)}const _e=Object.keys(fe),Ve=_e.map(Ze=>fe[Ze]),$e=document.getElementById("vcChart");$e&&S.current&&S.current.destroy(),$e&&(S.current=new nt($e.getContext("2d"),{type:"bar",data:{labels:_e,datasets:[{label:"Vehicle Count",data:Ve,backgroundColor:"#06B6D4",borderColor:"#0891B2",borderWidth:1,borderRadius:4}]},options:{...ie,plugins:{...ie.plugins,legend:{display:!1}}}}));let qt=0,hr=0;for(const Ze of T||[])Ze.compliance===1?qt++:hr++;const ht=document.getElementById("complianceChart");ht&&F.current&&F.current.destroy(),ht&&(F.current=new nt(ht.getContext("2d"),{type:"doughnut",data:{labels:["Compliant","Non-Compliant"],datasets:[{data:[qt,hr],backgroundColor:["#10B981","#EF4444"],borderWidth:2,borderColor:t?"#1F2937":"#FFFFFF"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:t?"#E5E7EB":"#374151",font:{family:"Inter, system-ui, sans-serif"},padding:20}}}}}))},Sn=T=>{var Ms;const le={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:t?"#9CA3AF":"#6B7280"},grid:{color:t?"#374151":"#E5E7EB"}},y:{ticks:{color:t?"#9CA3AF":"#6B7280"},grid:{color:t?"#374151":"#E5E7EB"}}}},ie={};for(const Oe of T||[]){const qe=(Oe.weather_condition||"unknown").toLowerCase();ie[qe]||(ie[qe]={count:0,compliant:0,non:0}),ie[qe].count+=1,Oe.compliance===1?ie[qe].compliant+=1:ie[qe].non+=1}const fe=Object.keys(ie);if(fe.length===0)return;const _e=fe.map(Oe=>ie[Oe].count),Ve=document.getElementById("weatherCountsChart");Ve&&X.current&&X.current.destroy(),Ve&&(X.current=new nt(Ve.getContext("2d"),{type:"bar",data:{labels:fe,datasets:[{label:"Detections",data:_e,backgroundColor:"#38BDF8",borderColor:"#0EA5E9",borderWidth:1,borderRadius:4}]},options:le}));const $e={};for(const Oe of T||[]){const qe=(Oe.weather_condition||"unknown").toLowerCase(),Hr=parseFloat(((Ms=Oe.reaction_time)==null?void 0:Ms.toString())||"0");!isNaN(Hr)&&Hr>0&&($e[qe]||($e[qe]={sum:0,n:0}),$e[qe].sum+=Hr,$e[qe].n+=1)}const qt=Object.keys($e),hr=qt.map(Oe=>$e[Oe].n>0?$e[Oe].sum/$e[Oe].n:0),ht=document.getElementById("weatherReactionChart");ht&&B.current&&B.current.destroy(),ht&&(B.current=new nt(ht.getContext("2d"),{type:"bar",data:{labels:qt,datasets:[{label:"Avg Reaction Time (s)",data:hr,backgroundColor:"#F59E0B",borderColor:"#D97706",borderWidth:1,borderRadius:4}]},options:le}));const Ze=fe.map(Oe=>ie[Oe].count>0?ie[Oe].compliant/ie[Oe].count*100:0),Nt=document.getElementById("weatherComplianceRateChart");Nt&&j.current&&j.current.destroy(),Nt&&(j.current=new nt(Nt.getContext("2d"),{type:"bar",data:{labels:fe,datasets:[{label:"Compliance Rate (%)",data:Ze,backgroundColor:"#10B981",borderColor:"#059669",borderWidth:1,borderRadius:4}]},options:{...le,scales:{...le.scales,y:{...le.scales.y,beginAtZero:!0,max:100}}}}))};y.useEffect(()=>{v&&p&&setTimeout(()=>{try{Nn(v.tracking_data,v.vehicle_counts),Sn(v.tracking_data)}catch(T){console.error("Error building charts:",T)}},100)},[v,p,t]);const kn=(T,le)=>T&&T.length>le?T.slice(0,le-1)+"…":T||"",Ls=T=>{const le=Math.floor(T%60),ie=Math.floor(T/60)%60,fe=Math.floor(T/3600);return`${fe>0?fe+":":""}${String(ie).padStart(2,"0")}:${String(le).padStart(2,"0")}`},Us=T=>{const le={uploaded:"bg-blue-500/10 text-blue-400 border border-blue-500/20",processing:"bg-yellow-500/10 text-yellow-400 border border-yellow-500/20",completed:"bg-green-500/10 text-green-400 border border-green-500/20",failed:"bg-red-500/10 text-red-400 border border-red-500/20",cancelled:"bg-gray-500/10 text-gray-400 border border-gray-500/20"};return le[T]||le.uploaded},Vt=n.filter(T=>T.video_name.toLowerCase().includes(g.toLowerCase()));return a.jsxs("div",{className:`min-h-screen ${t?"bg-[#0B1121] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx(Wt,{}),J.show&&a.jsxs("div",{className:`fixed top-4 right-4 z-50 px-6 py-4 rounded-xl shadow-2xl flex items-start space-x-3 max-w-md backdrop-blur-sm border ${J.type==="success"?"bg-green-500/90 border-green-400/20":J.type==="error"?"bg-red-500/90 border-red-400/20":J.type==="warning"?"bg-yellow-500/90 border-yellow-400/20":"bg-blue-500/90 border-blue-400/20"}`,children:[a.jsx("div",{className:"flex-shrink-0 mt-0.5",children:J.type==="success"?a.jsx(Ye,{className:"w-5 h-5"}):J.type==="error"?a.jsx(ze,{className:"w-5 h-5"}):J.type==="warning"?a.jsx(Pt,{className:"w-5 h-5"}):a.jsx(Pt,{className:"w-5 h-5"})}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{className:"text-white text-sm leading-relaxed font-medium",children:J.message})}),a.jsx("button",{onClick:()=>ee(T=>({...T,show:!1})),className:"flex-shrink-0 text-white/80 hover:text-white transition-colors",children:a.jsx(ze,{className:"w-4 h-4"})})]}),a.jsx(wt,{title:"Video Playback",onToggleSidebar:()=>e(!r),isSidebarOpen:r}),a.jsx(jt,{activePath:"/playback",isOpen:r,onClose:()=>e(!1)}),a.jsx("main",{className:"lg:ml-64 p-4 lg:p-8 mt-16 lg:mt-0",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-2xl font-bold mb-2 text-white",children:"Video Playback & Analytics"}),a.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"Browse and analyze your processed videos"})]}),a.jsxs("div",{className:`rounded-2xl p-6 mb-8 backdrop-blur-sm border ${t?"bg-[#151F32]/80 border-[#1E293B]":"bg-white/80 shadow-xl border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-primary-500/10 rounded-lg",children:a.jsx(ds,{className:"w-5 h-5 text-primary-500"})}),a.jsx("h2",{className:"text-xl font-semibold",children:"Advanced Filters"})]}),a.jsxs("div",{className:`text-xs px-3 py-1.5 rounded-lg ${t?"bg-[#1E293B] text-gray-400":"bg-gray-100 text-gray-600"}`,children:[a.jsx(tr,{className:"w-3 h-3 inline mr-1"}),"Timezone: ",vn()]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 mb-4",children:[a.jsxs("div",{className:"lg:col-span-2",children:[a.jsxs("label",{htmlFor:"video-search",className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:[a.jsx(Xn,{className:"w-4 h-4 inline mr-2"}),"Search Videos"]}),a.jsx("input",{id:"video-search",type:"text",value:g,onChange:T=>m(T.target.value),placeholder:"Search by video name...",className:`w-full px-4 py-3 rounded-lg border transition-all duration-200 ${t?"bg-[#1E293B] border-[#2D3B4E] text-white placeholder-gray-400 focus:border-primary-400 focus:ring-2 focus:ring-primary-400/20":"bg-gray-50 border-gray-300 text-gray-900 placeholder-gray-500 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20"}`})]}),a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"date-from",className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:[a.jsx(ls,{className:"w-4 h-4 inline mr-2"}),"From Date"]}),a.jsx("input",{id:"date-from",type:"date",value:_,onChange:T=>I(T.target.value),className:`w-full px-4 py-3 rounded-lg border transition-all duration-200 ${t?"bg-[#1E293B] border-[#2D3B4E] text-white focus:border-primary-400 focus:ring-2 focus:ring-primary-400/20":"bg-gray-50 border-gray-300 text-gray-900 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20"}`})]}),a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"date-to",className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:[a.jsx(ls,{className:"w-4 h-4 inline mr-2"}),"To Date"]}),a.jsx("input",{id:"date-to",type:"date",value:k,onChange:T=>E(T.target.value),className:`w-full px-4 py-3 rounded-lg border transition-all duration-200 ${t?"bg-[#1E293B] border-[#2D3B4E] text-white focus:border-primary-400 focus:ring-2 focus:ring-primary-400/20":"bg-gray-50 border-gray-300 text-gray-900 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20"}`})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"sort-by",className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Sort By"}),a.jsxs("select",{id:"sort-by",value:P,onChange:T=>W(T.target.value),className:`w-full px-4 py-3 rounded-lg border transition-all duration-200 ${t?"bg-[#1E293B] border-[#2D3B4E] text-white focus:border-primary-400 focus:ring-2 focus:ring-primary-400/20":"bg-gray-50 border-gray-300 text-gray-900 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20"}`,children:[a.jsx("option",{value:"created_at",children:"Created Date"}),a.jsx("option",{value:"upload_date",children:"Upload Date"}),a.jsx("option",{value:"duration_seconds",children:"Duration"})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"order",className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Order"}),a.jsxs("select",{id:"order",value:V,onChange:T=>A(T.target.value),className:`w-full px-4 py-3 rounded-lg border transition-all duration-200 ${t?"bg-[#1E293B] border-[#2D3B4E] text-white focus:border-primary-400 focus:ring-2 focus:ring-primary-400/20":"bg-gray-50 border-gray-300 text-gray-900 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20"}`,children:[a.jsx("option",{value:"true",children:"Newest First"}),a.jsx("option",{value:"false",children:"Oldest First"})]})]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("button",{onClick:oe,disabled:o,className:"px-6 py-3 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-600 text-white rounded-lg transition-all duration-200 flex items-center gap-2 font-medium shadow-lg hover:shadow-xl",children:[a.jsx(ds,{className:"w-4 h-4"}),"Apply Filters"]}),a.jsxs("button",{onClick:()=>{je.current.clear(),L(0)},disabled:o,className:`px-6 py-3 rounded-lg transition-all duration-200 flex items-center gap-2 font-medium ${t?"bg-[#1E293B] hover:bg-[#2D3B4E] text-gray-300 border border-[#2D3B4E]":"bg-gray-100 hover:bg-gray-200 text-gray-700 border border-gray-300"}`,children:[a.jsx(rr,{className:`w-4 h-4 ${o?"animate-spin":""}`}),"Refresh"]})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>Te(1),disabled:ye<=1||o,className:`px-3 py-2 rounded-lg text-sm font-medium ${t?"bg-[#1E293B] text-gray-300 border border-[#2D3B4E]":"bg-gray-100 text-gray-700 border border-gray-300"} disabled:opacity-50`,children:"First"}),a.jsx("button",{onClick:()=>Te(ye-1),disabled:ye<=1||o,className:`px-3 py-2 rounded-lg text-sm font-medium ${t?"bg-[#1E293B] text-gray-300 border border-[#2D3B4E]":"bg-gray-100 text-gray-700 border border-gray-300"} disabled:opacity-50`,children:"Prev"}),zt.map(T=>a.jsx("button",{onClick:()=>Te(T),disabled:o,className:`px-3 py-2 rounded-lg text-sm font-medium border ${T===ye?"bg-primary-500 text-white border-primary-500":t?"bg-[#1E293B] text-gray-300 border-[#2D3B4E]":"bg-gray-100 text-gray-700 border-gray-300"}`,children:T},T)),a.jsx("button",{onClick:()=>Te(ye+1),disabled:ye>=z||o,className:`px-3 py-2 rounded-lg text-sm font-medium ${t?"bg-[#1E293B] text-gray-300 border border-[#2D3B4E]":"bg-gray-100 text-gray-700 border border-gray-300"} disabled:opacity-50`,children:"Next"}),a.jsx("button",{onClick:()=>Te(z),disabled:ye>=z||o,className:`px-3 py-2 rounded-lg text-sm font-medium ${t?"bg-[#1E293B] text-gray-300 border border-[#2D3B4E]":"bg-gray-100 text-gray-700 border border-gray-300"} disabled:opacity-50`,children:"Last"})]}),a.jsx("div",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:u>0?`Page ${ye} of ${z} • Showing ${Math.min(b+1,u)}–${Math.min(b+((n==null?void 0:n.length)||0),u)} of ${u}`:""})]}),d&&a.jsx("div",{className:`text-sm font-medium ${d.includes("Error")?"text-red-400":d.includes("success")?"text-green-400":t?"text-gray-400":"text-gray-600"}`,children:d})]})]}),a.jsxs("div",{className:`rounded-2xl backdrop-blur-sm border overflow-hidden ${t?"bg-[#151F32]/80 border-[#1E293B]":"bg-white/80 shadow-xl border-gray-200"}`,children:[a.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-primary-500/10 rounded-lg",children:a.jsx(lt,{className:"w-5 h-5 text-primary-500"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Video Library"}),a.jsxs("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:[Math.min(b+((Vt==null?void 0:Vt.length)||0),u)," of ",u," videos ",g&&`matching "${g}"`]})]})]}),o&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary-500"}),a.jsx("span",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Loading..."})]})]})}),a.jsxs("div",{className:"overflow-x-auto",children:[a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:`${t?"bg-[#1E293B]":"bg-gray-50"}`,children:a.jsxs("tr",{children:[a.jsx("th",{className:`text-left py-4 px-6 font-semibold ${t?"text-gray-300":"text-gray-700"}`,children:"Video Details"}),a.jsx("th",{className:`text-left py-4 px-6 font-semibold ${t?"text-gray-300":"text-gray-700"}`,children:"Status"}),a.jsx("th",{className:`text-left py-4 px-6 font-semibold ${t?"text-gray-300":"text-gray-700"}`,children:"Duration"}),a.jsx("th",{className:`text-left py-4 px-6 font-semibold ${t?"text-gray-300":"text-gray-700"}`,children:"Analytics"}),a.jsx("th",{className:`text-left py-4 px-6 font-semibold ${t?"text-gray-300":"text-gray-700"}`,children:"Created"}),a.jsx("th",{className:`text-left py-4 px-6 font-semibold ${t?"text-gray-300":"text-gray-700"}`,children:"Actions"})]})}),a.jsx("tbody",{children:Vt.map((T,le)=>{var ie,fe;return a.jsxs("tr",{className:`border-b transition-colors hover:bg-opacity-50 ${t?"border-gray-700 hover:bg-[#1E293B]":"border-gray-200 hover:bg-gray-50"}`,children:[a.jsx("td",{className:"py-4 px-6",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${t?"bg-[#1E293B]":"bg-gray-100"}`,children:a.jsx(lt,{className:"w-6 h-6 text-primary-500"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",title:T.video_name,children:kn(T.video_name||"Untitled Video",40)}),a.jsxs("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:["ID: ",T.id]})]})]})}),a.jsx("td",{className:"py-4 px-6",children:a.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${Us(T.status)}`,children:((ie=T.status)==null?void 0:ie.charAt(0).toUpperCase())+((fe=T.status)==null?void 0:fe.slice(1))})}),a.jsx("td",{className:"py-4 px-6",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(tr,{className:"w-4 h-4 text-gray-400"}),a.jsx("span",{className:`font-medium ${t?"text-gray-300":"text-gray-700"}`,children:T.duration_seconds!=null?Ls(T.duration_seconds):"-"})]})}),a.jsx("td",{className:"py-4 px-6",children:a.jsxs("div",{className:"space-y-1",children:[T.total_vehicles!=null&&a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("span",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:["Vehicles: ",a.jsx("span",{className:"font-medium text-primary-500",children:T.total_vehicles})]})}),T.compliance_rate!=null&&a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("span",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:["Compliance: ",a.jsxs("span",{className:`font-medium ${T.compliance_rate>=80?"text-green-400":T.compliance_rate>=60?"text-yellow-400":"text-red-400"}`,children:[T.compliance_rate,"%"]})]})})]})}),a.jsx("td",{className:"py-4 px-6",children:a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{className:`text-sm ${t?"text-gray-300":"text-gray-700"}`,children:hu(T.created_at)}),a.jsx("span",{className:"text-xs text-gray-500",children:mu(T.created_at)})]})}),a.jsx("td",{className:"py-4 px-6",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>dr(T.id,T.video_name),className:"px-3 py-2 text-xs bg-primary-500 hover:bg-primary-600 text-white rounded-lg transition-all duration-200 flex items-center gap-1 font-medium shadow-sm hover:shadow-md",children:[a.jsx(vr,{className:"w-3 h-3"}),"Analytics"]}),a.jsxs("button",{onClick:()=>ut(T.id,T.video_name),className:"px-3 py-2 text-xs bg-red-500 hover:bg-red-600 text-white rounded-lg transition-all duration-200 flex items-center gap-1 font-medium shadow-sm hover:shadow-md",children:[a.jsx(us,{className:"w-3 h-3"}),"Delete"]})]})})]},T.id)})})]}),Vt.length===0&&!o&&a.jsxs("div",{className:`text-center py-12 ${t?"text-gray-400":"text-gray-600"}`,children:[a.jsx(lt,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),a.jsx("h3",{className:"text-lg font-medium mb-2",children:"No videos found"}),a.jsx("p",{className:"text-sm",children:g?`No videos match "${g}"`:"Upload a video to get started"})]})]})]})]})}),p&&a.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-2xl w-full max-w-7xl mx-auto max-h-[95vh] overflow-auto border shadow-2xl ${t?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200"}`,children:[a.jsxs("div",{className:`flex items-center justify-between p-6 border-b sticky top-0 backdrop-blur-sm ${t?"border-[#1E293B] bg-[#151F32]/95":"border-gray-200 bg-white/95"}`,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-primary-500/10 rounded-lg",children:a.jsx(vr,{className:"w-5 h-5 text-primary-500"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-semibold",children:"Video Analytics Dashboard"}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:de})]})]}),a.jsx("button",{onClick:Xe,"aria-label":"Close summary modal",className:`p-2 rounded-lg transition-colors ${t?"hover:bg-[#1E293B] text-gray-300":"hover:bg-gray-100 text-gray-700"}`,children:a.jsx(ze,{className:"w-6 h-6"})})]}),a.jsx("div",{className:"p-6",children:Y?a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),a.jsx("p",{className:"text-lg font-medium",children:"Loading analytics..."}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Processing video data and generating insights"})]}):v?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mb-8",children:a.jsxs("div",{className:`rounded-xl p-6 ${t?"bg-[#1E293B]":"bg-gray-50"}`,children:[a.jsxs("h4",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[a.jsx(is,{className:"w-5 h-5 text-primary-500"}),"Video Playback"]}),a.jsx("div",{className:"text-center",children:a.jsx("video",{ref:O,controls:!0,autoPlay:!0,className:"w-full max-w-4xl h-auto rounded-xl bg-black shadow-2xl",children:"Your browser does not support the video tag."})})]})}),a.jsxs("div",{className:`mb-8 p-6 rounded-xl ${t?"bg-[#1E293B]":"bg-gray-50"}`,children:[a.jsxs("h4",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[a.jsx(Pt,{className:"w-5 h-5 text-primary-500"}),"Video Information"]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-[#0B1220]":"bg-white"} border ${t?"border-[#2D3B4E]":"border-gray-200"}`,children:[a.jsx("div",{className:`text-xs font-medium mb-2 uppercase tracking-wide ${t?"text-gray-400":"text-gray-600"}`,children:"Status"}),a.jsx("div",{className:"font-semibold text-lg",children:a.jsx("span",{className:`px-3 py-1 rounded-full text-sm ${Us(v.video.status||"unknown")}`,children:v.video.status||"-"})})]}),a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-[#0B1220]":"bg-white"} border ${t?"border-[#2D3B4E]":"border-gray-200"}`,children:[a.jsx("div",{className:`text-xs font-medium mb-2 uppercase tracking-wide ${t?"text-gray-400":"text-gray-600"}`,children:"Duration"}),a.jsx("div",{className:"font-semibold text-lg",children:v.video.duration_seconds!=null?Ls(v.video.duration_seconds):"-"})]}),a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-[#0B1220]":"bg-white"} border ${t?"border-[#2D3B4E]":"border-gray-200"}`,children:[a.jsx("div",{className:`text-xs font-medium mb-2 uppercase tracking-wide ${t?"text-gray-400":"text-gray-600"}`,children:"Total Vehicles"}),a.jsx("div",{className:"font-semibold text-lg text-primary-500",children:v.video.total_vehicles||"-"})]}),a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-[#0B1220]":"bg-white"} border ${t?"border-[#2D3B4E]":"border-gray-200"}`,children:[a.jsx("div",{className:`text-xs font-medium mb-2 uppercase tracking-wide ${t?"text-gray-400":"text-gray-600"}`,children:"Compliance Rate"}),a.jsx("div",{className:`font-semibold text-lg ${(v.video.compliance_rate||0)>=80?"text-green-400":(v.video.compliance_rate||0)>=60?"text-yellow-400":"text-red-400"}`,children:v.video.compliance_rate!=null?v.video.compliance_rate+"%":"-"})]})]})]}),a.jsxs("div",{className:"mb-8",children:[a.jsxs("h4",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[a.jsx(Ye,{className:"w-5 h-5 text-primary-500"}),"Raw Data Analysis"]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{className:`rounded-xl border ${t?"bg-[#1E293B] border-[#2D3B4E]":"bg-white border-gray-200"}`,children:[a.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:a.jsxs("h5",{className:"font-semibold flex items-center gap-2",children:["Tracking Data (",v.tracking_data.length,")"]})}),a.jsxs("div",{className:"max-h-80 overflow-y-auto",children:[a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:`sticky top-0 ${t?"bg-[#1E293B]":"bg-gray-50"}`,children:a.jsxs("tr",{children:[a.jsx("th",{className:"p-3 text-left font-medium",children:"ID"}),a.jsx("th",{className:"p-3 text-left font-medium",children:"Type"}),a.jsx("th",{className:"p-3 text-left font-medium",children:"Status"}),a.jsx("th",{className:"p-3 text-left font-medium",children:"Compliance"})]})}),a.jsx("tbody",{children:v.tracking_data.slice(0,100).map((T,le)=>a.jsxs("tr",{className:`border-b ${t?"border-gray-700":"border-gray-200"}`,children:[a.jsx("td",{className:"p-3 font-mono text-xs",children:T.tracker_id}),a.jsx("td",{className:"p-3",children:T.vehicle_type}),a.jsx("td",{className:"p-3",children:a.jsx("span",{className:`px-2 py-1 rounded text-xs ${T.status==="moving"?"bg-blue-500/10 text-blue-400":"bg-gray-500/10 text-gray-400"}`,children:T.status})}),a.jsx("td",{className:"p-3",children:a.jsx("span",{className:`text-lg ${T.compliance===1?"text-green-400":"text-red-400"}`,children:T.compliance===1?"✅":"❌"})})]},le))})]}),v.tracking_data.length>100&&a.jsxs("div",{className:`p-3 text-center text-xs border-t ${t?"bg-[#1E293B] text-gray-400 border-gray-700":"bg-gray-50 text-gray-600 border-gray-200"}`,children:["Showing first 100 of ",v.tracking_data.length," records"]})]})]}),a.jsxs("div",{className:`rounded-xl border ${t?"bg-[#1E293B] border-[#2D3B4E]":"bg-white border-gray-200"}`,children:[a.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:a.jsxs("h5",{className:"font-semibold flex items-center gap-2",children:["Vehicle Counts (",v.vehicle_counts.length,")"]})}),a.jsxs("div",{className:"max-h-80 overflow-y-auto",children:[a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:`sticky top-0 ${t?"bg-[#1E293B]":"bg-gray-50"}`,children:a.jsxs("tr",{children:[a.jsx("th",{className:"p-3 text-left font-medium",children:"Type"}),a.jsx("th",{className:"p-3 text-left font-medium",children:"Count"}),a.jsx("th",{className:"p-3 text-left font-medium",children:"Date"})]})}),a.jsx("tbody",{children:v.vehicle_counts.slice(0,100).map((T,le)=>a.jsxs("tr",{className:`border-b ${t?"border-gray-700":"border-gray-200"}`,children:[a.jsx("td",{className:"p-3 font-medium",children:T.vehicle_type}),a.jsx("td",{className:"p-3",children:a.jsx("span",{className:"px-2 py-1 bg-primary-500/10 text-primary-400 rounded text-xs font-medium",children:T.count})}),a.jsx("td",{className:"p-3 text-xs font-mono",children:T.date})]},le))})]}),v.vehicle_counts.length>100&&a.jsxs("div",{className:`p-3 text-center text-xs border-t ${t?"bg-[#1E293B] text-gray-400 border-gray-700":"bg-gray-50 text-gray-600 border-gray-200"}`,children:["Showing first 100 of ",v.vehicle_counts.length," records"]})]})]})]})]}),v.vehicle_counts.length>0&&a.jsx("div",{className:"space-y-8",children:a.jsxs("div",{children:[a.jsxs("h4",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[a.jsx(vr,{className:"w-5 h-5 text-primary-500"}),"Visual Analytics"]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[a.jsxs("div",{className:`p-6 rounded-xl border ${t?"bg-[#0B1220] border-[#1E293B]":"bg-gray-50 border-gray-200"}`,children:[a.jsx("div",{className:`text-sm font-medium mb-4 ${t?"text-gray-400":"text-gray-600"}`,children:"Vehicle Distribution"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"vcChart"})})]}),a.jsxs("div",{className:`p-6 rounded-xl border ${t?"bg-[#0B1220] border-[#1E293B]":"bg-gray-50 border-gray-200"}`,children:[a.jsx("div",{className:`text-sm font-medium mb-4 ${t?"text-gray-400":"text-gray-600"}`,children:"Compliance Overview"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"complianceChart"})})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[a.jsxs("div",{className:`p-6 rounded-xl border ${t?"bg-[#0B1220] border-[#1E293B]":"bg-gray-50 border-gray-200"}`,children:[a.jsx("div",{className:`text-sm font-medium mb-4 ${t?"text-gray-400":"text-gray-600"}`,children:"Weather Impact - Detection Count"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"weatherCountsChart"})})]}),a.jsxs("div",{className:`p-6 rounded-xl border ${t?"bg-[#0B1220] border-[#1E293B]":"bg-gray-50 border-gray-200"}`,children:[a.jsx("div",{className:`text-sm font-medium mb-4 ${t?"text-gray-400":"text-gray-600"}`,children:"Weather Impact - Reaction Time"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"weatherReactionChart"})})]})]}),a.jsx("div",{className:"grid grid-cols-1 gap-6",children:a.jsxs("div",{className:`p-6 rounded-xl border ${t?"bg-[#0B1220] border-[#1E293B]":"bg-gray-50 border-gray-200"}`,children:[a.jsx("div",{className:`text-sm font-medium mb-4 ${t?"text-gray-400":"text-gray-600"}`,children:"Weather Impact - Compliance Rate"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"weatherComplianceRateChart"})})]})})]})})]}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx(ze,{className:"w-8 h-8 text-red-400"})}),a.jsx("h3",{className:"text-lg font-medium mb-2",children:"Failed to load analytics"}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Unable to retrieve video analytics data"})]})})]})}),he&&a.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-2xl w-full max-w-6xl mx-auto max-h-[95vh] overflow-auto border shadow-2xl ${t?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200"}`,children:[a.jsxs("div",{className:`flex items-center justify-between p-6 border-b ${t?"border-[#1E293B]":"border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-primary-500/10 rounded-lg",children:a.jsx(is,{className:"w-5 h-5 text-primary-500"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-semibold",children:"Video Player"}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:de})]})]}),a.jsx("button",{onClick:Le,"aria-label":"Close video player",className:`p-2 rounded-lg transition-colors ${t?"hover:bg-[#1E293B] text-gray-300":"hover:bg-gray-100 text-gray-700"}`,children:a.jsx(ze,{className:"w-6 h-6"})})]}),a.jsx("div",{className:"p-6",children:a.jsxs("div",{className:"text-center",children:[a.jsx("video",{ref:R,controls:!0,className:"w-full max-w-5xl h-auto rounded-xl bg-black shadow-2xl",onLoadStart:()=>M("Loading video..."),onCanPlay:()=>M(`Ready to play: ${de}`),onError:()=>M("Error loading video. Please check the URL."),children:"Your browser does not support the video tag."}),a.jsx("div",{className:`mt-4 text-sm font-medium ${Q.includes("Error")?"text-red-400":Q.includes("Ready")?"text-green-400":t?"text-gray-400":"text-gray-600"}`,children:Q}),a.jsxs("div",{className:`mt-2 text-xs ${t?"text-yellow-300/90":"text-yellow-700"} flex items-center justify-center gap-2`,children:[a.jsx(Pt,{className:`w-4 h-4 ${t?"text-yellow-300/90":"text-yellow-600"}`}),a.jsx("span",{children:"Large videos may take a few seconds to start buffering on first play."})]})]})})]})}),ae&&D.id&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:`relative rounded-xl w-full max-w-md backdrop-blur-sm ${t?"bg-[#151F32]/95 border border-[#1E293B]":"bg-white/95 shadow-2xl border border-gray-200"}`,children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[a.jsx("div",{className:"p-3 rounded-full bg-red-500/10",children:a.jsx(Je,{className:"w-6 h-6 text-red-500"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Confirm Deletion"}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"This action cannot be undone"})]})]}),a.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-[#1E293B]":"bg-gray-50"}`,children:[a.jsxs("p",{className:`text-sm ${t?"text-gray-300":"text-gray-700"}`,children:["Are you sure you want to delete ",a.jsxs("strong",{children:['"',D.name,'"']}),"?"]}),a.jsx("p",{className:`text-xs mt-2 ${t?"text-gray-400":"text-gray-600"}`,children:"This will permanently delete the video and all associated tracking data and vehicle counts."})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:wn,className:`flex-1 px-4 py-2.5 rounded-lg font-medium transition-all duration-200 ${t?"bg-[#1E293B] hover:bg-[#2D3B4E] text-gray-300 border border-[#334155]":"bg-gray-100 hover:bg-gray-200 text-gray-700 border border-gray-300"}`,children:"Cancel"}),a.jsxs("button",{onClick:ur,className:"flex-1 px-4 py-2.5 rounded-lg bg-red-500 hover:bg-red-600 text-white font-medium transition-all duration-200 flex items-center justify-center gap-2",children:[a.jsx(us,{className:"w-4 h-4"}),"Delete Video"]})]})]})})})]})}const ba="https://alxrkajk60i0df-8000.proxy.runpod.net";function bu(){const[r,e]=y.useState(!1),[t,s]=y.useState(()=>Ne()==="dark"),[n,i]=y.useState(!0),[o,l]=y.useState({total:0,used:0,free:0,temp_files:0,temp_size:0}),[d,c]=y.useState([]),[u,h]=y.useState([]),[f,x]=y.useState(!1),[b,N]=y.useState(!1),[_,I]=y.useState(!1),[k,E]=y.useState(null),[P,W]=y.useState(null),[V,A]=y.useState(null),[g,m]=y.useState(null),[p,C]=y.useState(null);y.useEffect(()=>{v();const S=()=>{s(Ne()==="dark")};return window.addEventListener("themeChanged",S),()=>window.removeEventListener("themeChanged",S)},[]);const v=async()=>{try{i(!0);const S=await Ue("/storage/info");S.status==="success"&&l(S.data);const F=await Ue("/storage/videos");F.status==="success"&&c(F.data),m(null)}catch(S){m("Failed to load storage data. Please try again."),console.error("Storage loading error:",S)}finally{i(!1)}},U=S=>{if(S===0)return"0 Bytes";const F=1024,X=["Bytes","KB","MB","GB","TB"],B=Math.floor(Math.log(S)/Math.log(F));return parseFloat((S/Math.pow(F,B)).toFixed(2))+" "+X[B]},Y=S=>{const F=Math.floor(S/3600),X=Math.floor(S%3600/60),B=Math.floor(S%60);return F>0?`${F}:${X.toString().padStart(2,"0")}:${B.toString().padStart(2,"0")}`:`${X}:${B.toString().padStart(2,"0")}`},ve=S=>{switch(S){case"processed":return a.jsx(Qe,{className:"w-4 h-4 text-green-500"});case"processing":return a.jsx(tr,{className:"w-4 h-4 text-yellow-500"});case"failed":return a.jsx(Je,{className:"w-4 h-4 text-red-500"});case"interrupted":return a.jsx(Je,{className:"w-4 h-4 text-orange-500"});case"temp":return a.jsx(lt,{className:"w-4 h-4 text-orange-500"});default:return a.jsx(lt,{className:"w-4 h-4 text-gray-500"})}},de=S=>{const F={processed:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",processing:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",failed:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",temp:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",interrupted:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200"};return a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${F[S]}`,children:S.charAt(0).toUpperCase()+S.slice(1)})},re=S=>S.name.toLowerCase().includes("interrupted")?"interrupted":S.status,he=S=>{h(F=>F.includes(S)?F.filter(X=>X!==S):[...F,S])},G=()=>{u.length===d.length?h([]):h(d.map(S=>S.id))},me=async()=>{var S;try{const F=d.filter(B=>u.includes(B.id)).map(B=>B.name),X=await Ue("/storage/videos/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({video_ids:F})});X.status==="success"?(c(B=>B.filter(j=>!u.includes(j.id))),h([]),x(!1),await v(),w(`Successfully deleted ${((S=X.deleted_files)==null?void 0:S.length)||u.length} video(s)`,"success")):(m(X.error||"Failed to delete videos"),w("Failed to delete videos","error"))}catch{m("Failed to delete videos. Please try again.")}},te=async()=>{var S;try{const F=await Ue("/storage/cleanup",{method:"POST",headers:{"Content-Type":"application/json"}});F.status==="success"?(N(!1),await v(),w(`Successfully cleaned up ${((S=F.cleaned_files)==null?void 0:S.length)||0} temporary files`,"success")):(m(F.error||"Failed to cleanup temporary files"),w("Failed to cleanup temporary files","error"))}catch{m("Failed to cleanup temporary files. Please try again.")}},Q=async S=>{try{const F=new Headers;try{const{data:{session:R}}=await ge.auth.getSession(),H=R==null?void 0:R.access_token;H&&F.set("Authorization",`Bearer ${H}`)}catch{}const X=await fetch(`${ba}/storage/video/${encodeURIComponent(S.name)}/download`,{headers:F});if(!X.ok)throw new Error("Download failed");const B=await X.blob(),j=URL.createObjectURL(B),O=document.createElement("a");O.href=j,O.download=S.name,document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(j)}catch{w("Failed to download video","error")}},M=S=>{E(S),I(!0)};y.useEffect(()=>{let S=!1;return(async()=>{if(!(!_||!k))try{const X=await Ue(`/storage/video/${encodeURIComponent(k.name)}/signed?expires_in=300`);if((X==null?void 0:X.status)==="success"&&X.url){if(S)return;A(X.url),W(null);return}const B=new Headers;try{const{data:{session:H}}=await ge.auth.getSession(),Z=H==null?void 0:H.access_token;Z&&B.set("Authorization",`Bearer ${Z}`)}catch{}const j=await fetch(`${ba}/storage/video/${encodeURIComponent(k.name)}`,{headers:B});if(!j.ok)throw new Error("Failed to load video");const O=await j.blob();if(S)return;const R=URL.createObjectURL(O);A(null),W(R)}catch{A(null),W(null)}})(),()=>{S=!0,P&&URL.revokeObjectURL(P),W(null),A(null)}},[_,k]);const ae=()=>{P&&URL.revokeObjectURL(P),W(null),I(!1)},w=(S,F)=>{C({message:S,type:F}),setTimeout(()=>C(null),3e3)},D=o.total>0?o.used/o.total*100:0,q=o.used>0?o.temp_size/o.used*100:0;return n?a.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[a.jsx(wt,{title:"Storage",onToggleSidebar:()=>e(S=>!S),isSidebarOpen:r}),a.jsx(jt,{activePath:"/storage",isOpen:r,onClose:()=>e(!1)}),a.jsx("div",{className:"flex items-center justify-center h-96",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(rr,{className:"w-6 h-6 animate-spin text-primary-500"}),a.jsx("span",{className:"text-lg font-medium",children:"Loading storage data..."})]})})]}):a.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[a.jsx(wt,{title:"Storage",onToggleSidebar:()=>e(S=>!S),isSidebarOpen:r}),a.jsx(jt,{activePath:"/storage",isOpen:r,onClose:()=>e(!1)}),a.jsx("div",{className:"p-6 ml-0 lg:ml-64",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsx("div",{className:"mb-8",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[a.jsx(os,{className:"w-8 h-8 text-primary-500"}),"Storage Management"]}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Monitor storage usage and manage video files"})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Wt,{}),a.jsxs("button",{onClick:v,className:"flex items-center gap-2 px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[a.jsx(rr,{className:"w-4 h-4"}),"Refresh"]})]})]})}),g&&a.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg dark:bg-red-900/20 dark:border-red-800",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Je,{className:"w-5 h-5 text-red-500"}),a.jsx("span",{className:"text-red-700 dark:text-red-400",children:g}),a.jsx("button",{onClick:()=>m(null),className:"ml-auto text-red-500 hover:text-red-700",children:a.jsx(ze,{className:"w-4 h-4"})})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[a.jsx("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Storage"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:U(o.total)})]}),a.jsx(os,{className:"w-8 h-8 text-blue-500"})]})}),a.jsx("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Used Storage"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:U(o.used)}),a.jsxs("p",{className:"text-xs text-gray-500",children:[D.toFixed(1),"% of total"]})]}),a.jsx(vr,{className:"w-8 h-8 text-orange-500"})]})}),a.jsx("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Free Storage"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:U(o.free)})]}),a.jsx(Qe,{className:"w-8 h-8 text-green-500"})]})}),a.jsx("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Temp Files"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:o.temp_files}),a.jsxs("p",{className:"text-xs text-gray-500",children:[U(o.temp_size)," (",q.toFixed(1),"%)"]})]}),a.jsx(Je,{className:"w-8 h-8 text-red-500"})]})})]}),a.jsxs("div",{className:`p-6 rounded-xl mb-8 ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("h2",{className:"text-lg font-semibold mb-6",children:"Storage Usage"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Overall Usage"}),a.jsxs("span",{className:"text-sm text-gray-500",children:[D.toFixed(1),"%"]})]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 dark:bg-gray-700",children:a.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-3 rounded-full transition-all duration-300",style:{width:`${D}%`}})})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Temporary Files"}),a.jsxs("span",{className:"text-sm text-gray-500",children:[q.toFixed(1),"% of used"]})]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 dark:bg-gray-700",children:a.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 h-2 rounded-full transition-all duration-300",style:{width:`${q}%`}})})]})]})]}),a.jsxs("div",{className:`p-6 rounded-xl mb-8 ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h2",{className:"text-lg font-semibold",children:"Video Files"}),a.jsxs("div",{className:"flex items-center gap-3",children:[u.length>0&&a.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",children:[a.jsx(us,{className:"w-4 h-4"}),"Delete Selected (",u.length,")"]}),o.temp_files>0&&a.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:[a.jsx(Je,{className:"w-4 h-4"}),"Cleanup Temp Files (",o.temp_files,")"]})]})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{children:a.jsxs("tr",{className:`border-b ${t?"border-gray-700":"border-gray-200"}`,children:[a.jsx("th",{className:"text-left px-4 py-3",children:a.jsx("input",{type:"checkbox",checked:u.length===d.length&&d.length>0,onChange:G,className:"rounded border-gray-300"})}),a.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Name"}),a.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Status"}),a.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Size"}),a.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Duration"}),a.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Created"}),a.jsx("th",{className:"text-left px-4 py-3 font-semibold",children:"Actions"})]})}),a.jsx("tbody",{children:d.map(S=>a.jsxs("tr",{className:`border-b hover:bg-opacity-50 transition-colors ${t?"border-gray-700 hover:bg-gray-800":"border-gray-200 hover:bg-gray-50"}`,children:[a.jsx("td",{className:"px-4 py-4",children:a.jsx("input",{type:"checkbox",checked:u.includes(S.id),onChange:()=>he(S.id),className:"rounded border-gray-300"})}),a.jsx("td",{className:"px-4 py-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[ve(re(S)),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-sm",children:S.name}),a.jsx("div",{className:"text-xs text-gray-500",children:S.path})]})]})}),a.jsx("td",{className:"px-4 py-4",children:de(re(S))}),a.jsx("td",{className:"px-4 py-4 text-sm font-mono",children:U(S.size)}),a.jsx("td",{className:"px-4 py-4 text-sm",children:S.duration?Y(S.duration):"-"}),a.jsx("td",{className:"px-4 py-4 text-sm",children:new Date(S.created_at).toLocaleDateString()}),a.jsx("td",{className:"px-4 py-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>M(S),className:"p-1 text-gray-500 hover:text-blue-500 transition-colors",title:"View video",children:a.jsx(jr,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>Q(S),className:"p-1 text-gray-500 hover:text-green-500 transition-colors",title:"Download video",children:a.jsx(cs,{className:"w-4 h-4"})})]})})]},S.id))})]})})]})]})}),f&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:`p-6 rounded-xl max-w-lg w-full mx-4 ${t?"bg-[#151F32]":"bg-white"}`,children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/20 rounded-lg",children:a.jsx(Je,{className:"w-6 h-6 text-red-500"})}),a.jsx("h3",{className:"text-lg font-semibold",children:"Delete Videos"})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:["Are you sure you want to delete ",a.jsxs("strong",{children:[u.length," video(s)"]}),"? This action cannot be undone."]}),a.jsx("div",{className:`p-4 rounded-lg border-l-4 border-yellow-400 ${t?"bg-yellow-900/20":"bg-yellow-50"}`,children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Je,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 mt-0.5 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-yellow-800 dark:text-yellow-200 mb-1",children:"Important Notice"}),a.jsxs("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[a.jsx("strong",{children:"Video files will be permanently deleted"})," and cannot be streamed anymore. However, ",a.jsx("strong",{children:"tracking data and analytics"})," for these videos will remain in the database."]})]})]})})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:()=>x(!1),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700 transition-colors",children:"Cancel"}),a.jsx("button",{onClick:me,className:"flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",children:"Delete Videos"})]})]})}),b&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:`p-6 rounded-xl max-w-md w-full mx-4 ${t?"bg-[#151F32]":"bg-white"}`,children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Cleanup Temporary Files"}),a.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["This will delete ",o.temp_files," temporary files and free up ",U(o.temp_size)," of storage."]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:()=>N(!1),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700",children:"Cancel"}),a.jsx("button",{onClick:te,className:"flex-1 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600",children:"Cleanup"})]})]})}),_&&k&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:a.jsxs("div",{className:`relative w-full max-w-4xl mx-4 ${t?"bg-gray-900":"bg-white"} rounded-xl overflow-hidden`,children:[a.jsxs("div",{className:`flex items-center justify-between p-4 border-b ${t?"border-gray-700":"border-gray-200"}`,children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:k.name}),a.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(k.size/(1024*1024)).toFixed(2)," MB"]})]}),a.jsx("button",{onClick:ae,className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:a.jsx(Zn,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"p-4",children:[a.jsx("video",{controls:!0,className:"w-full h-auto max-h-96 rounded-lg",preload:"metadata",src:V||P||void 0,children:"Your browser does not support the video tag."}),a.jsxs("div",{className:`mt-2 text-xs flex items-center justify-center gap-2 ${t?"text-yellow-300/90":"text-yellow-700"}`,children:[a.jsx(Pt,{className:`w-4 h-4 ${t?"text-yellow-300/90":"text-yellow-600"}`}),a.jsx("span",{children:"Large videos may take a few seconds to start buffering on first play."})]})]}),a.jsxs("div",{className:`flex items-center justify-between p-4 border-t ${t?"border-gray-700":"border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[a.jsx(tr,{className:"w-4 h-4"}),a.jsxs("span",{children:["Created: ",new Date(k.created_at).toLocaleDateString()]})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("button",{onClick:()=>Q(k),className:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:[a.jsx(cs,{className:"w-4 h-4"}),"Download"]})})]})]})}),p&&a.jsx("div",{className:"fixed top-4 right-4 z-50",children:a.jsxs("div",{className:`flex items-center gap-3 px-4 py-3 rounded-lg shadow-lg ${p.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[p.type==="success"?a.jsx(Qe,{className:"w-5 h-5"}):a.jsx(Je,{className:"w-5 h-5"}),a.jsx("span",{className:"font-medium",children:p.message}),a.jsx("button",{onClick:()=>C(null),className:"ml-2 text-white hover:text-gray-200",children:a.jsx(ze,{className:"w-4 h-4"})})]})})]})}function vu(){const r=va(),[e,t]=y.useState(5);return y.useEffect(()=>{const s=setInterval(()=>{t(n=>n<=1?(clearInterval(s),r("/"),0):n-1)},1e3);return()=>clearInterval(s)},[r]),a.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-[#0B1121] relative overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 neural-grid opacity-10"}),a.jsxs("div",{className:"absolute inset-0",children:[a.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 h-64 bg-primary-500/10 rounded-full blur-3xl animate-pulse"}),a.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-64 h-64 bg-primary-500/10 rounded-full blur-3xl animate-pulse animation-delay-2000"})]}),a.jsxs("div",{className:"bg-[#151F32]/50 p-12 rounded-2xl border border-[#1E293B] backdrop-blur-sm text-center max-w-md w-full mx-4 relative",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("div",{className:"mx-auto w-20 h-20 bg-green-500/10 rounded-full flex items-center justify-center mb-6",children:a.jsx(Qe,{className:"w-10 h-10 text-green-400 animate-pulse"})}),a.jsx("h1",{className:"text-3xl font-bold text-white mb-4",children:"Email Confirmed Successfully!"}),a.jsx("p",{className:"text-gray-300 mb-6 leading-relaxed",children:"Thank you for confirming your email address. Your account has been successfully activated and you can now access all features of Project 49."}),a.jsxs("div",{className:"bg-[#1E293B] rounded-lg p-4 mb-6",children:[a.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"Redirecting to home page in:"}),a.jsxs("div",{className:"text-2xl font-bold text-primary-400",children:[e," second",e!==1?"s":""]})]})]}),a.jsxs("button",{onClick:()=>r("/"),className:"w-full py-3 px-4 bg-primary-500 hover:bg-primary-600 text-white font-medium rounded-lg transition-all duration-200 flex items-center justify-center gap-2",children:[a.jsx(ka,{className:"w-5 h-5"}),"Go to Home Page Now"]})]})]})}function wu(){return a.jsx("div",{className:"fixed inset-0 bg-[#0B1121] flex items-center justify-center z-50",children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-0 neural-grid opacity-20"}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("div",{className:"absolute animate-ping h-16 w-16 rounded-full bg-primary-400 opacity-20"}),a.jsx("div",{className:"absolute h-16 w-16 rounded-full bg-primary-400 opacity-10 animate-pulse"}),a.jsx("div",{className:"relative h-12 w-12 rounded-full bg-primary-400 animate-pulse flex items-center justify-center",children:a.jsx("div",{className:"h-8 w-8 rounded-full bg-[#0B1121] flex items-center justify-center",children:a.jsx("div",{className:"h-4 w-4 rounded-full bg-primary-400 animate-pulse"})})})]})}),a.jsx("div",{className:"mt-8 text-center",children:a.jsx("p",{className:"text-primary-400 text-lg font-medium animate-pulse",children:"Loading..."})})]})})}function ju(){const[r,e]=y.useState(null),[t,s]=y.useState(!0),[n,i]=y.useState(!1);return y.useEffect(()=>{Bl(),(async()=>{try{const{data:{session:d},error:c}=await ge.auth.getSession();c?(console.warn("Session retrieval error:",c.message),e(null)):e((d==null?void 0:d.user)??null)}catch(d){console.warn("Failed to get session:",d),e(null)}finally{s(!1)}})();const{data:{subscription:l}}=ge.auth.onAuthStateChange((d,c)=>{e((c==null?void 0:c.user)??null),t&&s(!1)});return()=>l.unsubscribe()},[]),y.useEffect(()=>{const o=()=>i(!0),l=()=>i(!1);return window.addEventListener("beforeunload",o),window.addEventListener("load",l),()=>{window.removeEventListener("beforeunload",o),window.removeEventListener("load",l)}},[]),t||n?a.jsx(wu,{}):a.jsx(On,{children:a.jsxs(Rn,{children:[a.jsx(He,{path:"/",element:a.jsx(Wl,{})}),a.jsx(He,{path:"/dashboard",element:r?a.jsx(Gl,{}):a.jsx(et,{to:"/auth"})}),a.jsx(He,{path:"/upload",element:r?a.jsx(du,{}):a.jsx(et,{to:"/auth"})}),a.jsx(He,{path:"/analytics",element:r?a.jsx(gu,{}):a.jsx(et,{to:"/auth"})}),a.jsx(He,{path:"/playback",element:r?a.jsx(yu,{}):a.jsx(et,{to:"/auth"})}),a.jsx(He,{path:"/storage",element:r?a.jsx(bu,{}):a.jsx(et,{to:"/auth"})}),a.jsx(He,{path:"/settings",element:r?a.jsx(xu,{}):a.jsx(et,{to:"/auth"})}),a.jsx(He,{path:"/auth",element:r?a.jsx(et,{to:"/dashboard"}):a.jsx(wc,{})}),a.jsx(He,{path:"/confirmation-success",element:a.jsx(vu,{})}),a.jsx(He,{path:"*",element:a.jsx(et,{to:"/"})})]})})}$a(document.getElementById("root")).render(a.jsx(ot.StrictMode,{children:a.jsx(ju,{})}));
