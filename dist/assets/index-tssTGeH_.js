const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/auto-1tSkAajP.js","assets/chart-vendor-B-lHHOac.js","assets/react-vendor-Dte2jnjL.js"])))=>i.map(i=>d[i]);
import{r as et,b as ga,a as pa,c as Re,R as _,L as Ke,g as ya,u as fn,d as xa,B as ba,e as va,f as Ve,N as nt}from"./react-vendor-Dte2jnjL.js";import{_ as Rt,G as rr,S as gn,M as pn,X as qe,a as bs,T as wa,b as yn,C as xn,B as _a,E as Qr,c as ja,d as Xr,A as ze,D as Zr,L as Sa,e as Na,f as ka,g as bn,h as es,H as vs,i as vn,U as wn,P as ur,j as _n,k as kt,l as Et,m as Ea,n as As,o as Ta,I as cr,F as Tt,R as ws,p as ts,q as Ca,r as rs,s as $a,K as Oa,t as Ra,u as Aa,v as Lr,w as Ps,x as Pa}from"./ui-vendor-G_vEinyH.js";import{P as Te,C as Xe,r as jn}from"./chart-vendor-B-lHHOac.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var Sn={exports:{}},xr={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Da=et,Ia=Symbol.for("react.element"),Fa=Symbol.for("react.fragment"),La=Object.prototype.hasOwnProperty,Ba=Da.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ma={key:!0,ref:!0,__self:!0,__source:!0};function Nn(r,e,t){var s,n={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)La.call(e,s)&&!Ma.hasOwnProperty(s)&&(n[s]=e[s]);if(r&&r.defaultProps)for(s in e=r.defaultProps,e)n[s]===void 0&&(n[s]=e[s]);return{$$typeof:Ia,type:r,key:i,ref:o,props:n,_owner:Ba.current}}xr.Fragment=Fa;xr.jsx=Nn;xr.jsxs=Nn;Sn.exports=xr;var a=Sn.exports,kn,Ds=ga;kn=Ds.createRoot,Ds.hydrateRoot;const Ua=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Rt(async()=>{const{default:s}=await Promise.resolve().then(()=>At);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class _s extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Is extends _s{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Fs extends _s{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Ls extends _s{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ss;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(ss||(ss={}));var Wa=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,e||[])).next())})};class qa{constructor(e,{headers:t={},customFetch:s,region:n=ss.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=Ua(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return Wa(this,arguments,void 0,function*(t,s={}){var n;try{const{headers:i,method:o,body:l,signal:c}=s;let d={},{region:u}=s;u||(u=this.region);const h=new URL(`${this.url}/${t}`);u&&u!=="any"&&(d["x-region"]=u,h.searchParams.set("forceFunctionRegion",u));let f;l&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&l instanceof Blob||l instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",f=l):typeof l=="string"?(d["Content-Type"]="text/plain",f=l):typeof FormData<"u"&&l instanceof FormData?f=l:(d["Content-Type"]="application/json",f=JSON.stringify(l)));const p=yield this.fetch(h.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),i),body:f,signal:c}).catch(L=>{throw L.name==="AbortError"?L:new Is(L)}),x=p.headers.get("x-relay-error");if(x&&x==="true")throw new Fs(p);if(!p.ok)throw new Ls(p);let j=((n=p.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),N;return j==="application/json"?N=yield p.json():j==="application/octet-stream"?N=yield p.blob():j==="text/event-stream"?N=p:j==="multipart/form-data"?N=yield p.formData():N=yield p.text(),{data:N,error:null,response:p}}catch(i){return i instanceof Error&&i.name==="AbortError"?{data:null,error:new Is(i)}:{data:null,error:i,response:i instanceof Ls||i instanceof Fs?i.context:void 0}}})}}var Ce={},js={},br={},Yt={},vr={},wr={},za=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof globalThis<"u")return globalThis;throw new Error("unable to locate global object")},Ot=za();const Va=Ot.fetch,En=Ot.fetch.bind(Ot),Tn=Ot.Headers,Ha=Ot.Request,Ka=Ot.Response,At=Object.freeze(Object.defineProperty({__proto__:null,Headers:Tn,Request:Ha,Response:Ka,default:En,fetch:Va},Symbol.toStringTag,{value:"Module"})),Ja=pa(At);var _r={};Object.defineProperty(_r,"__esModule",{value:!0});let Ga=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};_r.default=Ga;var Cn=Re&&Re.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(wr,"__esModule",{value:!0});const Ya=Cn(Ja),Qa=Cn(_r);let Xa=class{constructor(e){var t,s;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(s=e.isMaybeSingle)!==null&&s!==void 0?s:!1,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Ya.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const s=this.fetch;let n=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,l,c,d;let u=null,h=null,f=null,p=i.status,x=i.statusText;if(i.ok){if(this.method!=="HEAD"){const T=await i.text();T===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((o=this.headers.get("Accept"))===null||o===void 0)&&o.includes("application/vnd.pgrst.plan+text"))?h=T:h=JSON.parse(T))}const N=(l=this.headers.get("Prefer"))===null||l===void 0?void 0:l.match(/count=(exact|planned|estimated)/),L=(c=i.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");N&&L&&L.length>1&&(f=parseInt(L[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(h)&&(h.length>1?(u={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,f=null,p=406,x="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{const N=await i.text();try{u=JSON.parse(N),Array.isArray(u)&&i.status===404&&(h=[],u=null,p=200,x="OK")}catch{i.status===404&&N===""?(p=204,x="No Content"):u={message:N}}if(u&&this.isMaybeSingle&&(!((d=u==null?void 0:u.details)===null||d===void 0)&&d.includes("0 rows"))&&(u=null,p=200,x="OK"),u&&this.shouldThrowOnError)throw new Qa.default(u)}return{error:u,data:h,count:f,status:p,statusText:x}});return this.shouldThrowOnError||(n=n.catch(i=>{var o,l,c;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(l=i==null?void 0:i.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}};wr.default=Xa;var Za=Re&&Re.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(vr,"__esModule",{value:!0});const ei=Za(wr);let ti=class extends ei.default{select(e){let t=!1;const s=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:n,referencedTable:i=n}={}){const o=i?`${i}.order`:"order",l=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${l?`${l},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const n=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:n=s}={}){const i=typeof n>"u"?"offset":`${n}.offset`,o=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:n=!1,wal:i=!1,format:o="text"}={}){var l;const c=[e?"analyze":null,t?"verbose":null,s?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),d=(l=this.headers.get("Accept"))!==null&&l!==void 0?l:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${o}; for="${d}"; options=${c};`),o==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};vr.default=ti;var ri=Re&&Re.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Yt,"__esModule",{value:!0});const si=ri(vr);let ni=class extends si.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const o=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const n=s?`${s}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};Yt.default=ni;var ai=Re&&Re.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(br,"__esModule",{value:!0});const Lt=ai(Yt);let ii=class{constructor(e,{headers:t={},schema:s,fetch:n}){this.url=e,this.headers=new Headers(t),this.schema=s,this.fetch=n}select(e,t){const{head:s=!1,count:n}=t??{},i=s?"HEAD":"GET";let o=!1;const l=(e??"*").split("").map(c=>/\s/.test(c)&&!o?"":(c==='"'&&(o=!o),c)).join("");return this.url.searchParams.set("select",l),n&&this.headers.append("Prefer",`count=${n}`),new Lt.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:s=!0}={}){var n;const i="POST";if(t&&this.headers.append("Prefer",`count=${t}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const o=e.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(o.length>0){const l=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new Lt.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:n,defaultToNull:i=!0}={}){var o;const l="POST";if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),n&&this.headers.append("Prefer",`count=${n}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const c=e.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",d.join(","))}}return new Lt.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}update(e,{count:t}={}){var s;const n="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new Lt.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}delete({count:e}={}){var t;const s="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new Lt.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}};br.default=ii;var $n=Re&&Re.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(js,"__esModule",{value:!0});const oi=$n(br),li=$n(Yt);let ci=class On{constructor(e,{headers:t={},schema:s,fetch:n}={}){this.url=e,this.headers=new Headers(t),this.schemaName=s,this.fetch=n}from(e){const t=new URL(`${this.url}/${e}`);return new oi.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new On(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:n=!1,count:i}={}){var o;let l;const c=new URL(`${this.url}/rpc/${e}`);let d;s||n?(l=s?"HEAD":"GET",Object.entries(t).filter(([h,f])=>f!==void 0).map(([h,f])=>[h,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([h,f])=>{c.searchParams.append(h,f)})):(l="POST",d=t);const u=new Headers(this.headers);return i&&u.set("Prefer",`count=${i}`),new li.default({method:l,url:c,headers:u,schema:this.schemaName,body:d,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};js.default=ci;var Pt=Re&&Re.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ce,"__esModule",{value:!0});Ce.PostgrestError=Ce.PostgrestBuilder=Ce.PostgrestTransformBuilder=Ce.PostgrestFilterBuilder=Ce.PostgrestQueryBuilder=Ce.PostgrestClient=void 0;const Rn=Pt(js);Ce.PostgrestClient=Rn.default;const An=Pt(br);Ce.PostgrestQueryBuilder=An.default;const Pn=Pt(Yt);Ce.PostgrestFilterBuilder=Pn.default;const Dn=Pt(vr);Ce.PostgrestTransformBuilder=Dn.default;const In=Pt(wr);Ce.PostgrestBuilder=In.default;const Fn=Pt(_r);Ce.PostgrestError=Fn.default;var di=Ce.default={PostgrestClient:Rn.default,PostgrestQueryBuilder:An.default,PostgrestFilterBuilder:Pn.default,PostgrestTransformBuilder:Dn.default,PostgrestBuilder:In.default,PostgrestError:Fn.default};const{PostgrestClient:ui,PostgrestQueryBuilder:du,PostgrestFilterBuilder:uu,PostgrestTransformBuilder:hu,PostgrestBuilder:mu,PostgrestError:fu}=di;class hi{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const s=t.node,n=parseInt(s.replace(/^v/,"").split(".")[0]);return n>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const s=this.getWebSocketConstructor();return new s(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const mi="2.75.1",fi=`realtime-js/${mi}`,gi="1.0.0",ns=1e4,pi=1e3,yi=100;var qt;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(qt||(qt={}));var be;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(be||(be={}));var Be;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(Be||(Be={}));var as;(function(r){r.websocket="websocket"})(as||(as={}));var dt;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(dt||(dt={}));class xi{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const n=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const l=s.decode(e.slice(o,o+n));o=o+n;const c=s.decode(e.slice(o,o+i));o=o+i;const d=JSON.parse(s.decode(e.slice(o,e.byteLength)));return{ref:null,topic:l,event:c,payload:d}}}class Ln{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var me;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(me||(me={}));const Bs=(r,e,t={})=>{var s;const n=(s=t.skipTypes)!==null&&s!==void 0?s:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=bi(o,r,e,n),i),{}):{}},bi=(r,e,t,s)=>{const n=e.find(l=>l.name===r),i=n==null?void 0:n.type,o=t[r];return i&&!s.includes(i)?Bn(i,o):is(o)},Bn=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return ji(e,t)}switch(r){case me.bool:return vi(e);case me.float4:case me.float8:case me.int2:case me.int4:case me.int8:case me.numeric:case me.oid:return wi(e);case me.json:case me.jsonb:return _i(e);case me.timestamp:return Si(e);case me.abstime:case me.date:case me.daterange:case me.int4range:case me.int8range:case me.money:case me.reltime:case me.text:case me.time:case me.timestamptz:case me.timetz:case me.tsrange:case me.tstzrange:return is(e);default:return is(e)}},is=r=>r,vi=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},wi=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},_i=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},ji=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i;const o=r.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>Bn(e,l))}return r},Si=r=>typeof r=="string"?r.replace(" ","T"):r,Mn=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Br{constructor(e,t,s={},n=ns){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ms;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Ms||(Ms={}));class zt{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=zt.syncState(this.state,n,i,o),this.pendingDiffs.forEach(c=>{this.state=zt.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(s.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=zt.syncDiff(this.state,n,i,o),l())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){const i=this.cloneDeep(e),o=this.transformState(t),l={},c={};return this.map(i,(d,u)=>{o[d]||(c[d]=u)}),this.map(o,(d,u)=>{const h=i[d];if(h){const f=u.map(N=>N.presence_ref),p=h.map(N=>N.presence_ref),x=u.filter(N=>p.indexOf(N.presence_ref)<0),j=h.filter(N=>f.indexOf(N.presence_ref)<0);x.length>0&&(l[d]=x),j.length>0&&(c[d]=j)}else l[d]=u}),this.syncDiff(i,{joins:l,leaves:c},s,n)}static syncDiff(e,t,s,n){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(l,c)=>{var d;const u=(d=e[l])!==null&&d!==void 0?d:[];if(e[l]=this.cloneDeep(c),u.length>0){const h=e[l].map(p=>p.presence_ref),f=u.filter(p=>h.indexOf(p.presence_ref)<0);e[l].unshift(...f)}s(l,u,c)}),this.map(o,(l,c)=>{let d=e[l];if(!d)return;const u=c.map(h=>h.presence_ref);d=d.filter(h=>u.indexOf(h.presence_ref)<0),e[l]=d,n(l,d,c),d.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const n=e[s];return"metas"in n?t[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Us;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Us||(Us={}));var Vt;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(Vt||(Vt={}));var He;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(He||(He={}));class Ss{constructor(e,t={config:{}},s){var n,i;if(this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=be.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Br(this,Be.join,this.params,this.timeout),this.rejoinTimer=new Ln(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=be.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=be.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=be.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=be.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=be.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Be.reply,{},(o,l)=>{this._trigger(this._replyEventName(l),o)}),this.presence=new zt(this),this.broadcastEndpointURL=Mn(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(n=this.params.config)===null||n===void 0?void 0:n.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var s,n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==be.closed){const{config:{broadcast:o,presence:l,private:c}}=this.params,d=(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(p=>p.filter))!==null&&n!==void 0?n:[],u=!!this.bindings[Vt.PRESENCE]&&this.bindings[Vt.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,h={},f={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:u}),postgres_changes:d,private:c};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(p=>e==null?void 0:e(He.CHANNEL_ERROR,p)),this._onClose(()=>e==null?void 0:e(He.CLOSED)),this.updateJoinPayload(Object.assign({config:f},h)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:p})=>{var x;if(this.socket.setAuth(),p===void 0){e==null||e(He.SUBSCRIBED);return}else{const j=this.bindings.postgres_changes,N=(x=j==null?void 0:j.length)!==null&&x!==void 0?x:0,L=[];for(let T=0;T<N;T++){const $=j[T],{filter:{event:D,schema:V,table:U,filter:A}}=$,m=p&&p[T];if(m&&m.event===D&&m.schema===V&&m.table===U&&m.filter===A)L.push(Object.assign(Object.assign({},$),{id:m.id}));else{this.unsubscribe(),this.state=be.errored,e==null||e(He.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=L,e&&e(He.SUBSCRIBED);return}}).receive("error",p=>{this.state=be.errored,e==null||e(He.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(He.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===be.joined&&e===Vt.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}async send(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=d.body)===null||n===void 0?void 0:n.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,c;const d=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=be.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Be.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(n=>{s=new Br(this,Be.leave,{},e),s.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=be.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){const n=new AbortController,i=setTimeout(()=>n.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Br(this,e,t,s);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>yi){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,i;const o=e.toLocaleLowerCase(),{close:l,error:c,leave:d,join:u}=Be;if(s&&[l,c,d,u].indexOf(o)>=0&&s!==this._joinRef())return;let f=this._onMessage(o,t,s);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(p=>{var x,j,N;return((x=p.filter)===null||x===void 0?void 0:x.event)==="*"||((N=(j=p.filter)===null||j===void 0?void 0:j.event)===null||N===void 0?void 0:N.toLocaleLowerCase())===o}).map(p=>p.callback(f,s)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var x,j,N,L,T,$;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const D=p.id,V=(x=p.filter)===null||x===void 0?void 0:x.event;return D&&((j=t.ids)===null||j===void 0?void 0:j.includes(D))&&(V==="*"||(V==null?void 0:V.toLocaleLowerCase())===((N=t.data)===null||N===void 0?void 0:N.type.toLocaleLowerCase()))}else{const D=(T=(L=p==null?void 0:p.filter)===null||L===void 0?void 0:L.event)===null||T===void 0?void 0:T.toLocaleLowerCase();return D==="*"||D===(($=t==null?void 0:t.event)===null||$===void 0?void 0:$.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof f=="object"&&"ids"in f){const x=f.data,{schema:j,table:N,commit_timestamp:L,type:T,errors:$}=x;f=Object.assign(Object.assign({},{schema:j,table:N,commit_timestamp:L,eventType:T,new:{},old:{},errors:$}),this._getPayloadRecords(x))}p.callback(f,s)})}_isClosed(){return this.state===be.closed}_isJoined(){return this.state===be.joined}_isJoining(){return this.state===be.joining}_isLeaving(){return this.state===be.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&Ss.isEqual(n.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Be.close,{},e)}_onError(e){this._on(Be.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=be.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Bs(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Bs(e.columns,e.old_record)),t}}const Mr=()=>{},sr={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Ni=[1e3,2e3,5e3,1e4],ki=1e4,Ei=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Ti{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ns,this.transport=null,this.heartbeatIntervalMs=sr.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Mr,this.ref=0,this.reconnectTimer=null,this.logger=Mr,this.conn=null,this.sendBuffer=[],this.serializer=new xi,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>{let i;return n?i=n:typeof fetch>"u"?i=(...o)=>Rt(async()=>{const{default:l}=await Promise.resolve().then(()=>At);return{default:l}},void 0).then(({default:l})=>l(...o)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):i=fetch,(...o)=>i(...o)},!(!((s=t==null?void 0:t.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${as.websocket}`,this.httpEndpoint=Mn(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=hi.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:gi}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case qt.connecting:return dt.Connecting;case qt.open:return dt.Open;case qt.closing:return dt.Closing;default:return dt.Closed}}isConnected(){return this.connectionState()===dt.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const s=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===s);if(n)return n;{const i=new Ss(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:s,payload:n,ref:i}=e,o=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${t} ${s} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(pi,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},sr.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(d){this.log("error","error in heartbeat callback",d)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:s,event:n,payload:i,ref:o}=t,l=o?`(${o})`:"",c=i.status||"";this.log("receive",`${c} ${s} ${n} ${l}`.trim(),i),this.channels.filter(d=>d._isMember(s)).forEach(d=>d._trigger(n,i,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Be.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${s}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([Ei],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const n={access_token:t,version:fi};t&&s.updateJoinPayload(n),s.joinedOnce&&s._isJoined()&&s._push(Be.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new Ln(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},sr.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,n,i,o,l,c,d,u;if(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(s=e==null?void 0:e.timeout)!==null&&s!==void 0?s:ns,this.heartbeatIntervalMs=(n=e==null?void 0:e.heartbeatIntervalMs)!==null&&n!==void 0?n:sr.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=e==null?void 0:e.heartbeatCallback)!==null&&l!==void 0?l:Mr,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e==null?void 0:e.reconnectAfterMs)!==null&&c!==void 0?c:h=>Ni[h-1]||ki,this.encode=(d=e==null?void 0:e.encode)!==null&&d!==void 0?d:(h,f)=>f(JSON.stringify(h)),this.decode=(u=e==null?void 0:e.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class Ns extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function xe(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Ci extends Ns{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class os extends Ns{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var $i=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,e||[])).next())})};const Un=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Rt(async()=>{const{default:s}=await Promise.resolve().then(()=>At);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Oi=()=>$i(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Rt(()=>Promise.resolve().then(()=>At),void 0)).Response:Response}),ls=r=>{if(Array.isArray(r))return r.map(t=>ls(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=ls(s)}),e},Ri=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};var mt=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,e||[])).next())})};const Ur=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Ai=(r,e,t)=>mt(void 0,void 0,void 0,function*(){const s=yield Oi();r instanceof s&&!(t!=null&&t.noResolveJson)?r.json().then(n=>{const i=r.status||500,o=(n==null?void 0:n.statusCode)||i+"";e(new Ci(Ur(n),i,o))}).catch(n=>{e(new os(Ur(n),n))}):e(new os(Ur(r),r))}),Pi=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"||!s?n:(Ri(s)?(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),n.body=JSON.stringify(s)):n.body=s,e!=null&&e.duplex&&(n.duplex=e.duplex),Object.assign(Object.assign({},n),t))};function Qt(r,e,t,s,n,i){return mt(this,void 0,void 0,function*(){return new Promise((o,l)=>{r(t,Pi(e,s,n,i)).then(c=>{if(!c.ok)throw c;return s!=null&&s.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>Ai(c,l,s))})})}function hr(r,e,t,s){return mt(this,void 0,void 0,function*(){return Qt(r,"GET",e,t,s)})}function We(r,e,t,s,n){return mt(this,void 0,void 0,function*(){return Qt(r,"POST",e,s,n,t)})}function cs(r,e,t,s,n){return mt(this,void 0,void 0,function*(){return Qt(r,"PUT",e,s,n,t)})}function Di(r,e,t,s){return mt(this,void 0,void 0,function*(){return Qt(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function Wn(r,e,t,s,n){return mt(this,void 0,void 0,function*(){return Qt(r,"DELETE",e,s,n,t)})}var Ii=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,e||[])).next())})};class Fi{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return Ii(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(xe(e))return{data:null,error:e};throw e}})}}var Li=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,e||[])).next())})},qn;class Bi{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[qn]="BlobDownloadBuilder",this.promise=null}asStream(){return new Fi(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return Li(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(xe(e))return{data:null,error:e};throw e}})}}qn=Symbol.toStringTag;var Ee=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,e||[])).next())})};const Mi={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ws={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Ui{constructor(e,t={},s,n){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=s,this.fetch=Un(n)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,s,n){return Ee(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Ws),n);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=s,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),n!=null&&n.headers&&(l=Object.assign(Object.assign({},l),n.headers));const d=this._removeEmptyFolders(t),u=this._getFinalPath(d),h=yield(e=="PUT"?cs:We)(this.fetch,`${this.url}/object/${u}`,i,Object.assign({headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:d,id:h.Id,fullPath:h.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(xe(i))return{data:null,error:i};throw i}})}upload(e,t,s){return Ee(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,n){return Ee(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",t);try{let c;const d=Object.assign({upsert:Ws.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",d.cacheControl)):(c=s,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const h=yield cs(this.fetch,l.toString(),c,{headers:u});return{data:{path:i,fullPath:h.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(xe(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return Ee(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield We(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:n}),o=new URL(this.url+i.url),l=o.searchParams.get("token");if(!l)throw new Ns("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:l},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(xe(s))return{data:null,error:s};throw s}})}update(e,t,s){return Ee(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return Ee(this,void 0,void 0,function*(){try{return{data:yield We(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(xe(n))return{data:null,error:n};throw n}})}copy(e,t,s){return Ee(this,void 0,void 0,function*(){try{return{data:{path:(yield We(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(xe(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,s){return Ee(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield We(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const o=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(xe(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,s){return Ee(this,void 0,void 0,function*(){try{const n=yield We(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(xe(n))return{data:null,error:n};throw n}})}download(e,t){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"",l=this._getFinalPath(e),c=()=>hr(this.fetch,`${this.url}/${n}/${l}${o}`,{headers:this.headers,noResolveJson:!0});return new Bi(c,this.shouldThrowOnError)}info(e){return Ee(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield hr(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ls(s),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(xe(s))return{data:null,error:s};throw s}})}exists(e){return Ee(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Di(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(xe(s)&&s instanceof os){const n=s.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const l=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&n.push(c);let d=n.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${s}${d}`)}}}remove(e){return Ee(this,void 0,void 0,function*(){try{return{data:yield Wn(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(xe(t))return{data:null,error:t};throw t}})}list(e,t,s){return Ee(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Mi),t),{prefix:e||""});return{data:yield We(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(xe(n))return{data:null,error:n};throw n}})}listV2(e,t){return Ee(this,void 0,void 0,function*(){try{const s=Object.assign({},e);return{data:yield We(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(xe(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Wi="2.75.1",qi={"X-Client-Info":`storage-js/${Wi}`};var yt=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,e||[])).next())})};class zi{constructor(e,t={},s,n){this.shouldThrowOnError=!1;const i=new URL(e);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},qi),t),this.fetch=Un(s)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return yt(this,void 0,void 0,function*(){try{return{data:yield hr(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(xe(e))return{data:null,error:e};throw e}})}getBucket(e){return yt(this,void 0,void 0,function*(){try{return{data:yield hr(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(xe(t))return{data:null,error:t};throw t}})}createBucket(e){return yt(this,arguments,void 0,function*(t,s={public:!1}){try{return{data:yield We(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(xe(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return yt(this,void 0,void 0,function*(){try{return{data:yield cs(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(xe(s))return{data:null,error:s};throw s}})}emptyBucket(e){return yt(this,void 0,void 0,function*(){try{return{data:yield We(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(xe(t))return{data:null,error:t};throw t}})}deleteBucket(e){return yt(this,void 0,void 0,function*(){try{return{data:yield Wn(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(xe(t))return{data:null,error:t};throw t}})}}class Vi extends zi{constructor(e,t={},s,n){super(e,t,s,n)}from(e){return new Ui(this.url,this.headers,e,this.fetch)}}const Hi="2.75.1";let Wt="";typeof Deno<"u"?Wt="deno":typeof document<"u"?Wt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Wt="react-native":Wt="node";const Ki={"X-Client-Info":`supabase-js-${Wt}/${Hi}`},Ji={headers:Ki},Gi={schema:"public"},Yi={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Qi={};var Xi=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,e||[])).next())})};const Zi=r=>{let e;return r?e=r:typeof fetch>"u"?e=En:e=fetch,(...t)=>e(...t)},eo=()=>typeof Headers>"u"?Tn:Headers,to=(r,e,t)=>{const s=Zi(t),n=eo();return(i,o)=>Xi(void 0,void 0,void 0,function*(){var l;const c=(l=yield e())!==null&&l!==void 0?l:r;let d=new n(o==null?void 0:o.headers);return d.has("apikey")||d.set("apikey",r),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),s(i,Object.assign(Object.assign({},o),{headers:d}))})};var ro=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,[])).next())})};function so(r){return r.endsWith("/")?r:r+"/"}function no(r,e){var t,s;const{db:n,auth:i,realtime:o,global:l}=r,{db:c,auth:d,realtime:u,global:h}=e,f={db:Object.assign(Object.assign({},c),n),auth:Object.assign(Object.assign({},d),i),realtime:Object.assign(Object.assign({},u),o),storage:{},global:Object.assign(Object.assign(Object.assign({},h),l),{headers:Object.assign(Object.assign({},(t=h==null?void 0:h.headers)!==null&&t!==void 0?t:{}),(s=l==null?void 0:l.headers)!==null&&s!==void 0?s:{})}),accessToken:()=>ro(this,void 0,void 0,function*(){return""})};return r.accessToken?f.accessToken=r.accessToken:delete f.accessToken,f}function ao(r){const e=r==null?void 0:r.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(so(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const zn="2.75.1",St=30*1e3,ds=3,Wr=ds*St,io="http://localhost:9999",oo="supabase.auth.token",lo={"X-Client-Info":`gotrue-js/${zn}`},us="X-Supabase-Api-Version",Vn={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},co=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,uo=10*60*1e3;class Kt extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function Y(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class ho extends Kt{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function mo(r){return Y(r)&&r.name==="AuthApiError"}class ut extends Kt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class rt extends Kt{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}}class Qe extends rt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function fo(r){return Y(r)&&r.name==="AuthSessionMissingError"}class xt extends rt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class nr extends rt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ar extends rt{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function go(r){return Y(r)&&r.name==="AuthImplicitGrantRedirectError"}class qs extends rt{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class hs extends rt{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function qr(r){return Y(r)&&r.name==="AuthRetryableFetchError"}class zs extends rt{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class ms extends rt{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const mr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Vs=` 	
\r=`.split(""),po=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<Vs.length;e+=1)r[Vs[e].charCodeAt(0)]=-2;for(let e=0;e<mr.length;e+=1)r[mr[e].charCodeAt(0)]=e;return r})();function Hs(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(mr[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(mr[s]),e.queuedBits-=6}}function Hn(r,e,t){const s=po[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Ks(r){const e=[],t=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{bo(o,s,t)};for(let o=0;o<r.length;o+=1)Hn(r.charCodeAt(o),n,i);return e.join("")}function yo(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function xo(r,e){for(let t=0;t<r.length;t+=1){let s=r.charCodeAt(t);if(s>55295&&s<=56319){const n=(s-55296)*1024&65535;s=(r.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}yo(s,e)}}function bo(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let s=1;s<6;s+=1)if(!(r>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Ct(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};for(let n=0;n<r.length;n+=1)Hn(r.charCodeAt(n),t,s);return new Uint8Array(e)}function vo(r){const e=[];return xo(r,t=>e.push(t)),new Uint8Array(e)}function ht(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};return r.forEach(n=>Hs(n,t,s)),Hs(null,t,s),e.join("")}function wo(r){return Math.round(Date.now()/1e3)+r}function _o(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const Oe=()=>typeof window<"u"&&typeof document<"u",at={tested:!1,writable:!1},Kn=()=>{if(!Oe())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(at.tested)return at.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),at.tested=!0,at.writable=!0}catch{at.tested=!0,at.writable=!1}return at.writable};function jo(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((s,n)=>{e[n]=s}),e}const Jn=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Rt(async()=>{const{default:s}=await Promise.resolve().then(()=>At);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},So=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Nt=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},it=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Ge=async(r,e)=>{await r.removeItem(e)};class jr{constructor(){this.promise=new jr.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}jr.promiseConstructor=Promise;function zr(r){const e=r.split(".");if(e.length!==3)throw new ms("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!co.test(e[s]))throw new ms("JWT not in base64url format");return{header:JSON.parse(Ks(e[0])),payload:JSON.parse(Ks(e[1])),signature:Ct(e[2]),raw:{header:e[0],payload:e[1]}}}async function No(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function ko(r,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await r(i);if(!e(i,null,o)){s(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function Eo(r){return("0"+r.toString(16)).substr(-2)}function To(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,Eo).join("")}async function Co(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function $o(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await Co(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function bt(r,e,t=!1){const s=To();let n=s;t&&(n+="/PASSWORD_RECOVERY"),await Nt(r,`${e}-code-verifier`,n);const i=await $o(s);return[i,s===i?"plain":"s256"]}const Oo=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Ro(r){const e=r.headers.get(us);if(!e||!e.match(Oo))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Ao(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function Po(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Do=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function vt(r){if(!Do.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Vr(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const s=t.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Js(r){return JSON.parse(JSON.stringify(r))}var Io=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};const lt=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Fo=[502,503,504];async function Gs(r){var e;if(!So(r))throw new hs(lt(r),0);if(Fo.includes(r.status))throw new hs(lt(r),r.status);let t;try{t=await r.json()}catch(i){throw new ut(lt(i),i)}let s;const n=Ro(r);if(n&&n.getTime()>=Vn["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new zs(lt(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new Qe}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new zs(lt(t),r.status,t.weak_password.reasons);throw new ho(lt(t),r.status||500,s)}const Lo=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),t))};async function te(r,e,t,s){var n;const i=Object.assign({},s==null?void 0:s.headers);i[us]||(i[us]=Vn["2024-01-01"].name),s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const o=(n=s==null?void 0:s.query)!==null&&n!==void 0?n:{};s!=null&&s.redirectTo&&(o.redirect_to=s.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await Bo(r,e,t+l,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(c):{data:Object.assign({},c),error:null}}async function Bo(r,e,t,s,n,i){const o=Lo(e,s,n,i);let l;try{l=await r(t,Object.assign({},o))}catch(c){throw console.error(c),new hs(lt(c),0)}if(l.ok||await Gs(l),s!=null&&s.noResolveJson)return l;try{return await l.json()}catch(c){await Gs(c)}}function Le(r){var e;let t=null;Wo(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=wo(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function Ys(r){const e=Le(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function Ze(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function Mo(r){return{data:r,error:null}}function Uo(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i}=r,o=Io(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function Qs(r){return r}function Wo(r){return r.access_token&&r.refresh_token&&r.expires_in}const Hr=["global","local","others"];var qo=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};class zo{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Jn(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Hr[0]){if(Hr.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Hr.join(", ")}`);try{return await te(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Y(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await te(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ze})}catch(s){if(Y(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=qo(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=s==null?void 0:s.newEmail,delete n.newEmail),await te(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Uo,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(Y(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await te(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ze})}catch(t){if(Y(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,n,i,o,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await te(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Qs});if(u.error)throw u.error;const h=await u.json(),f=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(x=>{const j=parseInt(x.split(";")[0].split("=")[1].substring(0,1)),N=JSON.parse(x.split(";")[1].split("=")[1]);d[`${N}Page`]=j}),d.total=parseInt(f)),{data:Object.assign(Object.assign({},h),d),error:null}}catch(d){if(Y(d))return{data:{users:[]},error:d};throw d}}async getUserById(e){vt(e);try{return await te(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ze})}catch(t){if(Y(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){vt(e);try{return await te(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ze})}catch(s){if(Y(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){vt(e);try{return await te(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ze})}catch(s){if(Y(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){vt(e.userId);try{const{data:t,error:s}=await te(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:s}}catch(t){if(Y(t))return{data:null,error:t};throw t}}async _deleteFactor(e){vt(e.userId),vt(e.id);try{return{data:await te(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Y(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,s,n,i,o,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await te(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Qs});if(u.error)throw u.error;const h=await u.json(),f=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(x=>{const j=parseInt(x.split(";")[0].split("=")[1].substring(0,1)),N=JSON.parse(x.split(";")[1].split("=")[1]);d[`${N}Page`]=j}),d.total=parseInt(f)),{data:Object.assign(Object.assign({},h),d),error:null}}catch(d){if(Y(d))return{data:{clients:[]},error:d};throw d}}async _createOAuthClient(e){try{return await te(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(Y(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await te(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(Y(t))return{data:null,error:t};throw t}}async _deleteOAuthClient(e){try{return await te(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(Y(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await te(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(Y(t))return{data:null,error:t};throw t}}}function Xs(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}const wt={debug:!!(globalThis&&Kn()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Gn extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Vo extends Gn{}async function Ho(r,e,t){wt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),wt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){wt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{wt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw wt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new Vo(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(wt.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function Ko(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Yn(r){if(!/^0x[a-fA-F0-9]{40}$/.test(r))throw new Error(`@supabase/auth-js: Address "${r}" is invalid.`);return r.toLowerCase()}function Jo(r){return parseInt(r,16)}function Go(r){const e=new TextEncoder().encode(r);return"0x"+Array.from(e,s=>s.toString(16).padStart(2,"0")).join("")}function Yo(r){var e;const{chainId:t,domain:s,expirationTime:n,issuedAt:i=new Date,nonce:o,notBefore:l,requestId:c,resources:d,scheme:u,uri:h,version:f}=r;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(f!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${f}`);if(!((e=r.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${r.statement}`)}const p=Yn(r.address),x=u?`${u}://${s}`:s,j=r.statement?`${r.statement}
`:"",N=`${x} wants you to sign in with your Ethereum account:
${p}

${j}`;let L=`URI: ${h}
Version: ${f}
Chain ID: ${t}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(n&&(L+=`
Expiration Time: ${n.toISOString()}`),l&&(L+=`
Not Before: ${l.toISOString()}`),c&&(L+=`
Request ID: ${c}`),d){let T=`
Resources:`;for(const $ of d){if(!$||typeof $!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${$}`);T+=`
- ${$}`}L+=T}return`${N}
${L}`}class ye extends Error{constructor({message:e,code:t,cause:s,name:n}){var i;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=(i=n??(s instanceof Error?s.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=t}}class fr extends ye{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Qo({error:r,options:e}){var t,s,n;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new ye({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else if(r.name==="ConstraintError"){if(((t=i.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new ye({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:r});if(e.mediation==="conditional"&&((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new ye({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:r});if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new ye({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:r})}else{if(r.name==="InvalidStateError")return new ye({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:r});if(r.name==="NotAllowedError")return new ye({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="NotSupportedError")return i.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?new ye({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:r}):new ye({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:r});if(r.name==="SecurityError"){const o=window.location.hostname;if(Xn(o)){if(i.rp.id!==o)return new ye({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new ye({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new ye({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:r})}else if(r.name==="UnknownError")return new ye({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new ye({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}function Xo({error:r,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new ye({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else{if(r.name==="NotAllowedError")return new ye({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="SecurityError"){const s=window.location.hostname;if(Xn(s)){if(t.rpId!==s)return new ye({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new ye({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="UnknownError")return new ye({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new ye({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}var Qn=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};class Zo{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const el=new Zo;function tl(r){if(!r)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(r);const{challenge:e,user:t,excludeCredentials:s}=r,n=Qn(r,["challenge","user","excludeCredentials"]),i=Ct(e).buffer,o=Object.assign(Object.assign({},t),{id:Ct(t.id).buffer}),l=Object.assign(Object.assign({},n),{challenge:i,user:o});if(s&&s.length>0){l.excludeCredentials=new Array(s.length);for(let c=0;c<s.length;c++){const d=s[c];l.excludeCredentials[c]=Object.assign(Object.assign({},d),{id:Ct(d.id).buffer,type:d.type||"public-key",transports:d.transports})}}return l}function rl(r){if(!r)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(r);const{challenge:e,allowCredentials:t}=r,s=Qn(r,["challenge","allowCredentials"]),n=Ct(e).buffer,i=Object.assign(Object.assign({},s),{challenge:n});if(t&&t.length>0){i.allowCredentials=new Array(t.length);for(let o=0;o<t.length;o++){const l=t[o];i.allowCredentials[o]=Object.assign(Object.assign({},l),{id:Ct(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return i}function sl(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r;return{id:r.id,rawId:r.id,response:{attestationObject:ht(new Uint8Array(r.response.attestationObject)),clientDataJSON:ht(new Uint8Array(r.response.clientDataJSON))},type:"public-key",clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function nl(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r,s=r.getClientExtensionResults(),n=r.response;return{id:r.id,rawId:r.id,response:{authenticatorData:ht(new Uint8Array(n.authenticatorData)),clientDataJSON:ht(new Uint8Array(n.clientDataJSON)),signature:ht(new Uint8Array(n.signature)),userHandle:n.userHandle?ht(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Xn(r){return r==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(r)}function Zs(){var r,e;return!!(Oe()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((r=navigator==null?void 0:navigator.credentials)===null||r===void 0?void 0:r.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function al(r){try{const e=await navigator.credentials.create(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new fr("Browser returned unexpected credential type",e)}:{data:null,error:new fr("Empty credential response",e)}}catch(e){return{data:null,error:Qo({error:e,options:r})}}}async function il(r){try{const e=await navigator.credentials.get(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new fr("Browser returned unexpected credential type",e)}:{data:null,error:new fr("Empty credential response",e)}}catch(e){return{data:null,error:Xo({error:e,options:r})}}}const ol={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},ll={userVerification:"preferred",hints:["security-key"]};function gr(...r){const e=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),t=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),s={};for(const n of r)if(n)for(const i in n){const o=n[i];if(o!==void 0)if(Array.isArray(o))s[i]=o;else if(t(o))s[i]=o;else if(e(o)){const l=s[i];e(l)?s[i]=gr(l,o):s[i]=gr(o)}else s[i]=o}return s}function cl(r,e){return gr(ol,r,e||{})}function dl(r,e){return gr(ll,r,e||{})}class ul{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:s,signal:n},i){try{const{data:o,error:l}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!o)return{data:null,error:l};const c=n??el.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:d}=o.webauthn.credential_options.publicKey;d.name||(d.name=`${d.id}:${s}`),d.displayName||(d.displayName=d.name)}switch(o.webauthn.type){case"create":{const d=cl(o.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:u,error:h}=await al({publicKey:d,signal:c});return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}case"request":{const d=dl(o.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:u,error:h}=await il(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:d,signal:c}));return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}}}catch(o){return Y(o)?{data:null,error:o}:{data:null,error:new ut("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:t,webauthn:s}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}},i){if(!t)return{data:null,error:new Kt("rpId is required for WebAuthn authentication")};try{if(!Zs())return{data:null,error:new ut("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:s},signal:n},{request:i});if(!o)return{data:null,error:l};const{webauthn:c}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:c.type,rpId:t,rpOrigins:s,credential_response:c.credential_response}})}catch(o){return Y(o)?{data:null,error:o}:{data:null,error:new ut("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n},i){if(!t)return{data:null,error:new Kt("rpId is required for WebAuthn registration")};try{if(!Zs())return{data:null,error:new ut("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(u=>{var h;return(h=u.data)===null||h===void 0?void 0:h.all.find(f=>f.factor_type==="webauthn"&&f.friendly_name===e&&f.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u==null?void 0:u.id}):void 0),{data:null,error:l};const{data:c,error:d}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:t,rpOrigins:s},signal:n},{create:i});return c?this._verify({factorId:o.id,challengeId:c.challengeId,webauthn:{rpId:t,rpOrigins:s,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:d}}catch(o){return Y(o)?{data:null,error:o}:{data:null,error:new ut("Unexpected error in register",o)}}}}Ko();const hl={url:io,storageKey:oo,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:lo,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function en(r,e,t){return await t()}const _t={};class Jt{get jwks(){var e,t;return(t=(e=_t[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){_t[this.storageKey]=Object.assign(Object.assign({},_t[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=_t[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){_t[this.storageKey]=Object.assign(Object.assign({},_t[this.storageKey]),{cachedAt:e})}constructor(e){var t,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Jt.nextInstanceID,Jt.nextInstanceID+=1,this.instanceID>0&&Oe()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},hl),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new zo({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Jn(n.fetch),this.lock=n.lock||en,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:Oe()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Ho:this.lock=en,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new ul(this)},this.persistSession?(n.storage?this.storage=n.storage:Kn()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Xs(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=Xs(this.memoryStorage)),Oe()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${zn}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=jo(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),Oe()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),go(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:l}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Y(t)?{error:t}:{error:new ut("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,n;try{const i=await te(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:Le}),{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(Y(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,n;try{let i;if("email"in e){const{email:u,password:h,options:f}=e;let p=null,x=null;this.flowType==="pkce"&&([p,x]=await bt(this.storage,this.storageKey)),i=await te(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:u,password:h,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:p,code_challenge_method:x},xform:Le})}else if("phone"in e){const{phone:u,password:h,options:f}=e;i=await te(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(s=f==null?void 0:f.data)!==null&&s!==void 0?s:{},channel:(n=f==null?void 0:f.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:Le})}else throw new nr("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(Y(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:l}=e;t=await te(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Ys})}else if("phone"in e){const{phone:i,password:o,options:l}=e;t=await te(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Ys})}else throw new nr("You must provide either an email or phone number and a password");const{data:s,error:n}=t;return n?{data:{user:null,session:null},error:n}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new xt}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(t){if(Y(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,s,n,i,o,l,c,d,u,h,f;let p,x;if("message"in e)p=e.message,x=e.signature;else{const{chain:j,wallet:N,statement:L,options:T}=e;let $;if(Oe())if(typeof N=="object")$=N;else{const g=window;if("ethereum"in g&&typeof g.ethereum=="object"&&"request"in g.ethereum&&typeof g.ethereum.request=="function")$=g.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof N!="object"||!(T!=null&&T.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");$=N}const D=new URL((t=T==null?void 0:T.url)!==null&&t!==void 0?t:window.location.href),V=await $.request({method:"eth_requestAccounts"}).then(g=>g).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!V||V.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const U=Yn(V[0]);let A=(s=T==null?void 0:T.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!A){const g=await $.request({method:"eth_chainId"});A=Jo(g)}const m={domain:D.host,address:U,statement:L,uri:D.href,version:"1",chainId:A,nonce:(n=T==null?void 0:T.signInWithEthereum)===null||n===void 0?void 0:n.nonce,issuedAt:(o=(i=T==null?void 0:T.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(l=T==null?void 0:T.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(c=T==null?void 0:T.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(d=T==null?void 0:T.signInWithEthereum)===null||d===void 0?void 0:d.requestId,resources:(u=T==null?void 0:T.signInWithEthereum)===null||u===void 0?void 0:u.resources};p=Yo(m),x=await $.request({method:"personal_sign",params:[Go(p),U]})}try{const{data:j,error:N}=await te(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:x},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:Le});if(N)throw N;return!j||!j.session||!j.user?{data:{user:null,session:null},error:new xt}:(j.session&&(await this._saveSession(j.session),await this._notifyAllSubscribers("SIGNED_IN",j.session)),{data:Object.assign({},j),error:N})}catch(j){if(Y(j))return{data:{user:null,session:null},error:j};throw j}}async signInWithSolana(e){var t,s,n,i,o,l,c,d,u,h,f,p;let x,j;if("message"in e)x=e.message,j=e.signature;else{const{chain:N,wallet:L,statement:T,options:$}=e;let D;if(Oe())if(typeof L=="object")D=L;else{const U=window;if("solana"in U&&typeof U.solana=="object"&&("signIn"in U.solana&&typeof U.solana.signIn=="function"||"signMessage"in U.solana&&typeof U.solana.signMessage=="function"))D=U.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof L!="object"||!($!=null&&$.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");D=L}const V=new URL((t=$==null?void 0:$.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in D&&D.signIn){const U=await D.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},$==null?void 0:$.signInWithSolana),{version:"1",domain:V.host,uri:V.href}),T?{statement:T}:null));let A;if(Array.isArray(U)&&U[0]&&typeof U[0]=="object")A=U[0];else if(U&&typeof U=="object"&&"signedMessage"in U&&"signature"in U)A=U;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in A&&"signature"in A&&(typeof A.signedMessage=="string"||A.signedMessage instanceof Uint8Array)&&A.signature instanceof Uint8Array)x=typeof A.signedMessage=="string"?A.signedMessage:new TextDecoder().decode(A.signedMessage),j=A.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in D)||typeof D.signMessage!="function"||!("publicKey"in D)||typeof D!="object"||!D.publicKey||!("toBase58"in D.publicKey)||typeof D.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");x=[`${V.host} wants you to sign in with your Solana account:`,D.publicKey.toBase58(),...T?["",T,""]:[""],"Version: 1",`URI: ${V.href}`,`Issued At: ${(n=(s=$==null?void 0:$.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=$==null?void 0:$.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${$.signInWithSolana.notBefore}`]:[],...!((o=$==null?void 0:$.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${$.signInWithSolana.expirationTime}`]:[],...!((l=$==null?void 0:$.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${$.signInWithSolana.chainId}`]:[],...!((c=$==null?void 0:$.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${$.signInWithSolana.nonce}`]:[],...!((d=$==null?void 0:$.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${$.signInWithSolana.requestId}`]:[],...!((h=(u=$==null?void 0:$.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...$.signInWithSolana.resources.map(A=>`- ${A}`)]:[]].join(`
`);const U=await D.signMessage(new TextEncoder().encode(x),"utf8");if(!U||!(U instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");j=U}}try{const{data:N,error:L}=await te(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:x,signature:ht(j)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Le});if(L)throw L;return!N||!N.session||!N.user?{data:{user:null,session:null},error:new xt}:(N.session&&(await this._saveSession(N.session),await this._notifyAllSubscribers("SIGNED_IN",N.session)),{data:Object.assign({},N),error:L})}catch(N){if(Y(N))return{data:{user:null,session:null},error:N};throw N}}async _exchangeCodeForSession(e){const t=await it(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(t??"").split("/");try{const{data:i,error:o}=await te(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Le});if(await Ge(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new xt}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(Y(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:n,access_token:i,nonce:o}=e,l=await te(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Le}),{data:c,error:d}=l;return d?{data:{user:null,session:null},error:d}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new xt}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:d})}catch(t){if(Y(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,n,i,o;try{if("email"in e){const{email:l,options:c}=e;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await bt(this.storage,this.storageKey));const{error:h}=await te(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(s=c==null?void 0:c.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:l,options:c}=e,{data:d,error:u}=await te(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:u}}throw new nr("You must provide either an email or phone number.")}catch(l){if(Y(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var t,s;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:l}=await te(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:Le});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,d=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(n){if(Y(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,s,n;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await bt(this.storage,this.storageKey)),await te(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:Mo})}catch(i){if(Y(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new Qe;const{error:n}=await te(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(Y(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:i}=e,{error:o}=await te(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:s,type:n,options:i}=e,{data:o,error:l}=await te(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l}}throw new nr("You must provide either an email or phone number and a type")}catch(t){if(Y(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await it(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Wr:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const o=await it(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=Vr()}if(this.storage.isServer&&e.user){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,d,u)=>(!o&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,d,u))})}return{data:{session:e},error:null}}const{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await te(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ze}):await this._useSession(async t=>{var s,n,i;const{data:o,error:l}=t;if(l)throw l;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Qe}:await te(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:Ze})})}catch(t){if(Y(t))return fo(t)&&(await this._removeSession(),await Ge(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new Qe;const o=n.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await bt(this.storage,this.storageKey));const{data:d,error:u}=await te(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:Ze});if(u)throw u;return o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(s){if(Y(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Qe;const t=Date.now()/1e3;let s=t,n=!0,i=null;const{payload:o}=zr(e.access_token);if(o.exp&&(s=o.exp,n=s<=t),n){const{data:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(Y(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:o,error:l}=t;if(l)throw l;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new Qe;const{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Y(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Oe())throw new ar("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ar(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new qs("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ar("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new qs("No code detected.");const{data:T,error:$}=await this._exchangeCodeForSession(e.code);if($)throw $;const D=new URL(window.location.href);return D.searchParams.delete("code"),window.history.replaceState(window.history.state,"",D.toString()),{data:{session:T.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:l,expires_at:c,token_type:d}=e;if(!i||!l||!o||!d)throw new ar("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(l);let f=u+h;c&&(f=parseInt(c));const p=f-u;p*1e3<=St&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${h}s`);const x=f-h;u-x>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",x,f,u):u-x<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",x,f,u);const{data:j,error:N}=await this._getUser(i);if(N)throw N;const L={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:f,refresh_token:o,token_type:d,user:j.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:L,redirectType:e.type},error:null}}catch(s){if(Y(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await it(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{error:i};const o=(s=n.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(mo(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await Ge(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=_o(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,n;try{const{data:{session:i},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await bt(this.storage,this.storageKey,!0));try{return await te(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(Y(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(Y(t))return{data:null,error:t};throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:s,error:n}=await this._useSession(async i=>{var o,l,c,d,u;const{data:h,error:f}=i;if(f)throw f;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await te(this.fetch,"GET",p,{headers:this.headers,jwt:(u=(d=h.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return Oe()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(Y(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var s;try{const{error:n,data:{session:i}}=t;if(n)throw n;const{options:o,provider:l,token:c,access_token:d,nonce:u}=e,h=await te(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=i==null?void 0:i.access_token)!==null&&s!==void 0?s:void 0,body:{provider:l,id_token:c,access_token:d,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Le}),{data:f,error:p}=h;return p?{data:{user:null,session:null},error:p}:!f||!f.session||!f.user?{data:{user:null,session:null},error:new xt}:(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("USER_UPDATED",f.session)),{data:f,error:p})}catch(n){if(Y(n))return{data:{user:null,session:null},error:n};throw n}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)throw o;return await te(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(Y(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await ko(async n=>(n>0&&await No(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await te(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Le})),(n,i)=>{const o=200*Math.pow(2,n);return i&&qr(i)&&Date.now()+o-s<St})}catch(s){if(this._debug(t,"error",s),Y(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Oe()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const n=await it(this.storage,this.storageKey);if(n&&this.userStorage){let o=await it(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},await Nt(this.userStorage,this.storageKey+"-user",o)),n.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:Vr()}else if(n&&!n.user&&!n.user){const o=await it(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(n.user=o.user,await Ge(this.storage,this.storageKey+"-user"),await Nt(this.storage,this.storageKey,n)):n.user=Vr()}if(this._debug(s,"session from storage",n),!this._isValidSession(n)){this._debug(s,"session is not valid"),n!==null&&await this._removeSession();return}const i=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Wr;if(this._debug(s,`session has${i?"":" not"} expired with margin of ${Wr}s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),qr(o)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(n.access_token);!l&&(o!=null&&o.user)?(n.user=o.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(s,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(s,"error",n),console.error(n);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new Qe;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new jr;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Qe;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={data:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(n,"error",i),Y(i)){const o={data:null,error:i};return qr(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&t.user&&await Nt(this.userStorage,this.storageKey+"-user",{user:t.user});const n=Object.assign({},t);delete n.user;const i=Js(n);await Nt(this.storage,this.storageKey,i)}else{const n=Js(t);await Nt(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),await Ge(this.storage,this.storageKey),await Ge(this.storage,this.storageKey+"-code-verifier"),await Ge(this.storage,this.storageKey+"-user"),this.userStorage&&await Ge(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Oe()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),St);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/St);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${St}ms, refresh threshold is ${ds} ticks`),n<=ds&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Gn)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Oe()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const n=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,o]=await bt(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(l.toString())}if(s!=null&&s.queryParams){const i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s!=null&&s.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await te(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(Y(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:c,error:d}=await te(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return d?{data:null,error:d}:(e.factorType==="totp"&&c.type==="totp"&&(!((n=c==null?void 0:c.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(Y(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?sl(e.webauthn.credential_response):nl(e.webauthn.credential_response)})}:{code:e.code}),{data:l,error:c}=await te(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return c?{data:null,error:c}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),{data:l,error:c})})}catch(t){if(Y(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const o=await te(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});if(o.error)return o;const{data:l}=o;if(l.type!=="webauthn")return{data:l,error:null};switch(l.webauthn.type){case"create":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:tl(l.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:rl(l.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(Y(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};const n={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=t==null?void 0:t.factors)!==null&&e!==void 0?e:[])n.all.push(i),i.status==="verified"&&n[i.factor_type].push(i);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=zr(n.access_token);let l=null;o.aal&&(l=o.aal);let c=l;((s=(t=n.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(c="aal2");const u=o.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(l=>l.kid===e);if(s)return s;const n=Date.now();if(s=this.jwks.keys.find(l=>l.kid===e),s&&this.jwks_cached_at+uo>n)return s;const{data:i,error:o}=await te(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=n,s=i.keys.find(l=>l.kid===e),!s)?null:s}async getClaims(e,t={}){try{let s=e;if(!s){const{data:p,error:x}=await this.getSession();if(x||!p.session)return{data:null,error:x};s=p.session.access_token}const{header:n,payload:i,signature:o,raw:{header:l,payload:c}}=zr(s);t!=null&&t.allowExpired||Ao(i.exp);const d=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!d){const{error:p}=await this.getUser(s);if(p)throw p;return{data:{claims:i,header:n,signature:o},error:null}}const u=Po(n.alg),h=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,o,vo(`${l}.${c}`)))throw new ms("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(s){if(Y(s))return{data:null,error:s};throw s}}}Jt.nextInstanceID=0;const ml=Jt;class fl extends ml{constructor(e){super(e)}}var gl=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,[])).next())})};class pl{constructor(e,t,s){var n,i,o;this.supabaseUrl=e,this.supabaseKey=t;const l=ao(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d={db:Gi,realtime:Qi,auth:Object.assign(Object.assign({},Yi),{storageKey:c}),global:Ji},u=no(s??{},d);this.storageKey=(n=u.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(h,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=u.auth)!==null&&o!==void 0?o:{},this.headers,u.global.fetch),this.fetch=to(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new ui(new URL("rest/v1",l).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new Vi(this.storageUrl.href,this.headers,this.fetch,s==null?void 0:s.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new qa(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return gl(this,void 0,void 0,function*(){var e,t;if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,userStorage:i,storageKey:o,flowType:l,lock:c,debug:d},u,h){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new fl({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),u),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,userStorage:i,flowType:l,lock:c,debug:d,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new Ti(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const yl=(r,e,t)=>new pl(r,e,t);function xl(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}xl()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const bl="https://iqehkneolpesaqznkqjm.supabase.co",vl="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlxZWhrbmVvbHBlc2Fxem5rcWptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA5MzkxNjgsImV4cCI6MjA2NjUxNTE2OH0.4N69aEfiQdcwW0Jw7061fRlSTF6QtPQQiQybUDFZsIg",fe=yl(bl,vl),Zn="app-theme",ve=()=>{const r=localStorage.getItem(Zn);return r==="light"||r==="dark"?r:"dark"},wl=r=>{localStorage.setItem(Zn,r)},ea=r=>{const e=document.documentElement,t=document.body;r==="dark"?(e.classList.add("dark"),t.className="bg-[#0B1121] text-white"):(e.classList.remove("dark"),t.className="bg-white text-gray-900")},_l=()=>{const r=ve();return ea(r),r},ta=r=>{const e=r==="dark"?"light":"dark";return wl(e),ea(e),window.dispatchEvent(new CustomEvent("themeChanged")),e};function jl(){const[r,e]=_.useState(()=>ve()==="dark"),[t,s]=_.useState(null),[n,i]=_.useState(!1);_.useEffect(()=>{fe.auth.getUser().then(({data:{user:p}})=>{s(p)});const{data:{subscription:f}}=fe.auth.onAuthStateChange((p,x)=>{s((x==null?void 0:x.user)??null)});return()=>f.unsubscribe()},[]);const o=()=>{const f=ta(r?"dark":"light");e(f==="dark")},l=t!==null,c=[{icon:a.jsx(xn,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"Video Analysis",description:"Advanced vehicle detection and tracking at level crossings using YOLOv8 and computer vision"},{icon:a.jsx(_a,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"Behavior Analysis",description:"Monitor and analyze driver compliance with safety measures and signage"},{icon:a.jsx(Qr,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"Real-time Monitoring",description:"Process and analyze traffic footage in real-time for immediate insights"},{icon:a.jsx(ja,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"Privacy Protection",description:"Ensure data privacy through automated anonymization of sensitive information"}],d=[{icon:a.jsx(Xr,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"YOLOv8 Integration",description:"State-of-the-art object detection for accurate vehicle tracking"},{icon:a.jsx(ze,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"Statistical Analysis",description:"Advanced analytics for traffic patterns and behavior"},{icon:a.jsx(Zr,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"Edge Processing",description:"Local processing for enhanced privacy and reduced latency"},{icon:a.jsx(Sa,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"Data Security",description:"Robust security measures for sensitive information"},{icon:a.jsx(Na,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"Interactive Dashboard",description:"Real-time visualization of traffic analytics"},{icon:a.jsx(ka,{className:"w-5 h-5 sm:w-6 sm:h-6"}),title:"API Integration",description:"Seamless integration with external systems"}],u=[{name:"Sasindu Dilshan Ranwadana",role:"Team Leader, Scrum Master, Developer",id:"104509653",github:"https://github.com/sasindudilshanranwadana"},{name:"Quang Vinh Le",role:"QA, Developer, Documentation",id:"104097488",github:"https://github.com/quangvinhlee"},{name:"Franco Octavio Jimenez Perez",role:"QA, Developer, Documentation, Communications",id:"104173896",github:"https://github.com/Osovich"},{name:"Janith Athuluwage",role:"Developer, Documentation, QA",id:"104798312",github:"https://github.com/janith14"},{name:"Thiviru Thejan",role:"Developer, Documentation, QA",id:"104321637",github:"https://github.com/tthejan"},{name:"Risinu Cooray",role:"Developer, Documentation, QA",id:"104333137",github:"https://github.com/risinu-c"}],h=[{quarter:"Sprint 1",title:"Project Setup & Planning",status:"Completed",tasks:"Repository setup, requirements gathering, and team organization"},{quarter:"Sprint 2",title:"Data Collection & Processing",status:"Completed",tasks:"Video data collection, preprocessing, and initial model training"},{quarter:"Sprint 3",title:"Core Development",status:"Completed",tasks:"YOLOv8 integration, dashboard development, and API implementation"},{quarter:"Sprint 4",title:"Testing & Optimization",status:"Completed",tasks:"System testing, performance optimization, and stakeholder feedback"},{quarter:"Sprint 5",title:"Deployment",status:"In Progress",tasks:"Production deployment, final testing, and system go-live"}];return a.jsxs("div",{className:`min-h-screen ${r?"bg-neural-900 text-white":"bg-neural-100 text-gray-900"}`,children:[a.jsxs("nav",{className:`fixed w-full z-50 backdrop-blur-sm border-b ${r?"bg-neural-900/80 border-primary-500/10":"bg-white/80 border-gray-200"}`,children:[a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"flex items-center justify-between h-16",children:[a.jsxs("div",{className:"flex items-center space-x-4 sm:space-x-8",children:[a.jsx("span",{className:`text-lg sm:text-xl font-bold ${r?"text-primary-400":"text-primary-600"} animate-float`,children:"Project 49"}),a.jsxs("div",{className:"hidden md:flex space-x-4 lg:space-x-6",children:[a.jsx("a",{href:"#about",className:`text-sm lg:text-base ${r?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-900"} transition-colors duration-300`,children:"About"}),a.jsx("a",{href:"#objectives",className:`text-sm lg:text-base ${r?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-900"} transition-colors duration-300`,children:"Objectives"}),a.jsx("a",{href:"#features",className:`text-sm lg:text-base ${r?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-900"} transition-colors duration-300`,children:"Features"}),a.jsx("a",{href:"#team",className:`text-sm lg:text-base ${r?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-900"} transition-colors duration-300`,children:"Team"}),a.jsx("a",{href:"#timeline",className:`text-sm lg:text-base ${r?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-900"} transition-colors duration-300`,children:"Timeline"})]})]}),a.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[a.jsx("a",{href:"https://github.com/sasindudilshanranwadana/SynerX",target:"_blank",rel:"noopener noreferrer",className:`hidden sm:block p-2 rounded-lg transition-all duration-300 ${r?"text-gray-300 hover:text-white hover:bg-neural-800":"text-gray-600 hover:text-gray-900 hover:bg-gray-200"}`,children:a.jsx(rr,{className:"w-5 h-5"})}),a.jsx("button",{onClick:o,className:`p-2 rounded-lg transition-all duration-300 ${r?"bg-neural-800 text-gray-200 hover:bg-neural-700":"bg-gray-200 text-gray-800 hover:bg-gray-300"}`,children:r?a.jsx(gn,{className:"w-5 h-5 animate-pulse-glow"}):a.jsx(pn,{className:"w-5 h-5 animate-pulse-glow"})}),l?a.jsx(Ke,{to:"/dashboard",className:`hidden sm:inline-block px-4 lg:px-6 py-2 rounded-lg text-sm lg:text-base font-medium transition-all duration-300 animate-glow ${r?"bg-primary-500 hover:bg-primary-600 text-white":"bg-primary-600 hover:bg-primary-700 text-white"}`,children:"Dashboard"}):a.jsx(Ke,{to:"/auth",className:`hidden sm:inline-block px-4 lg:px-6 py-2 rounded-lg text-sm lg:text-base font-medium transition-all duration-300 animate-glow ${r?"bg-primary-500 hover:bg-primary-600 text-white":"bg-primary-600 hover:bg-primary-700 text-white"}`,children:"Sign In"}),a.jsx("button",{onClick:()=>i(!n),className:`md:hidden p-2 rounded-lg transition-all duration-300 ${r?"text-gray-300 hover:text-white hover:bg-neural-800":"text-gray-600 hover:text-gray-900 hover:bg-gray-200"}`,children:n?a.jsx(qe,{className:"w-6 h-6"}):a.jsx(bs,{className:"w-6 h-6"})})]})]})}),n&&a.jsx("div",{className:`md:hidden border-t ${r?"border-primary-500/10 bg-neural-900":"border-gray-200 bg-white"}`,children:a.jsxs("div",{className:"px-4 py-4 space-y-3",children:[a.jsx("a",{href:"#about",onClick:()=>i(!1),className:`block px-4 py-3 rounded-lg text-base font-medium transition-colors ${r?"text-gray-300 hover:text-white hover:bg-neural-800":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"About"}),a.jsx("a",{href:"#objectives",onClick:()=>i(!1),className:`block px-4 py-3 rounded-lg text-base font-medium transition-colors ${r?"text-gray-300 hover:text-white hover:bg-neural-800":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"Objectives"}),a.jsx("a",{href:"#features",onClick:()=>i(!1),className:`block px-4 py-3 rounded-lg text-base font-medium transition-colors ${r?"text-gray-300 hover:text-white hover:bg-neural-800":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"Features"}),a.jsx("a",{href:"#team",onClick:()=>i(!1),className:`block px-4 py-3 rounded-lg text-base font-medium transition-colors ${r?"text-gray-300 hover:text-white hover:bg-neural-800":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"Team"}),a.jsx("a",{href:"#timeline",onClick:()=>i(!1),className:`block px-4 py-3 rounded-lg text-base font-medium transition-colors ${r?"text-gray-300 hover:text-white hover:bg-neural-800":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"Timeline"}),a.jsxs("a",{href:"https://github.com/sasindudilshanranwadana/SynerX",target:"_blank",rel:"noopener noreferrer",onClick:()=>i(!1),className:`flex items-center gap-2 px-4 py-3 rounded-lg text-base font-medium transition-colors ${r?"text-gray-300 hover:text-white hover:bg-neural-800":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:[a.jsx(rr,{className:"w-5 h-5"}),"GitHub"]}),l?a.jsx(Ke,{to:"/dashboard",onClick:()=>i(!1),className:`block text-center px-4 py-3 rounded-lg text-base font-medium transition-all duration-300 ${r?"bg-primary-500 hover:bg-primary-600 text-white":"bg-primary-600 hover:bg-primary-700 text-white"}`,children:"Dashboard"}):a.jsx(Ke,{to:"/auth",onClick:()=>i(!1),className:`block text-center px-4 py-3 rounded-lg text-base font-medium transition-all duration-300 ${r?"bg-primary-500 hover:bg-primary-600 text-white":"bg-primary-600 hover:bg-primary-700 text-white"}`,children:"Sign In"})]})})]}),a.jsxs("section",{className:"relative pt-20 sm:pt-24 md:pt-32 pb-16 sm:pb-20 md:pb-24 neural-background",children:[a.jsx("div",{className:"absolute inset-0 grid-pattern opacity-20"}),a.jsx("div",{className:"absolute inset-0 neural-grid"}),a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative",children:[a.jsx("div",{className:`inline-block px-4 sm:px-6 py-2 rounded-full text-xs sm:text-sm font-medium mb-6 sm:mb-8 animate-float ${r?"bg-primary-500/10 text-primary-400":"bg-primary-600/10 text-primary-600"}`,children:"AI-Powered Road Safety Analysis"}),a.jsx("h1",{className:"text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold mb-4 sm:mb-6 animate-float leading-tight",children:"Project 49"}),a.jsx("h2",{className:`text-lg sm:text-xl md:text-2xl lg:text-3xl font-semibold mb-4 sm:mb-6 animate-float animation-delay-2000 ${r?"text-primary-400":"text-primary-600"} leading-tight px-2`,children:"Road-User Behaviour Analysis Using AI & Computer Vision"}),a.jsx("p",{className:`text-base sm:text-lg md:text-xl mb-6 sm:mb-8 md:mb-10 max-w-3xl mx-auto animate-float animation-delay-4000 ${r?"text-gray-400":"text-gray-600"} px-4`,children:"Enhancing road safety through intelligent video analytics at level crossings"}),a.jsx("div",{className:"flex justify-center px-4",children:l?a.jsx(Ke,{to:"/dashboard",className:`w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-3 rounded-lg text-base sm:text-lg font-medium transition-all duration-300 animate-glow ${r?"bg-primary-500 hover:bg-primary-600 text-white":"bg-primary-600 hover:bg-primary-700 text-white"}`,children:"Go to Dashboard"}):a.jsx(Ke,{to:"/auth",className:`w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-3 rounded-lg text-base sm:text-lg font-medium transition-all duration-300 animate-glow ${r?"bg-primary-500 hover:bg-primary-600 text-white":"bg-primary-600 hover:bg-primary-700 text-white"}`,children:"Get Started"})})]})]}),a.jsx("section",{id:"about",className:"py-12 sm:py-16 md:py-20 lg:py-24",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8 md:gap-12 items-center",children:[a.jsxs("div",{children:[a.jsx("div",{className:`inline-block px-4 py-1 rounded-full text-xs sm:text-sm font-medium mb-4 sm:mb-6 animate-float ${r?"bg-primary-500/10 text-primary-400":"bg-primary-600/10 text-primary-600"}`,children:"About the Project"}),a.jsx("h2",{className:"text-2xl sm:text-3xl font-bold mb-4 sm:mb-6 animate-float animation-delay-2000",children:"Revolutionizing Road Safety with AI"}),a.jsx("p",{className:`mb-4 sm:mb-6 text-sm sm:text-base animate-float animation-delay-4000 ${r?"text-gray-400":"text-gray-600"}`,children:"Project 49 addresses the critical need for effective analysis of driver behavior at level crossings. Working with key stakeholders like VicRoads, Department of Transport, and V/Line, we're developing an innovative solution that provides meaningful insights from real-world traffic footage."}),a.jsx("p",{className:`text-sm sm:text-base animate-float animation-delay-4000 ${r?"text-gray-400":"text-gray-600"}`,children:"Our system processes traffic camera footage to detect vehicles, measure speed profiles, assess compliance behavior, and visualize data through an interactive dashboard, enabling data-driven decisions for road safety improvements."})]}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:`absolute inset-0 rounded-xl ${r?"bg-primary-500/10":"bg-primary-600/10"} blur-3xl -z-10 animate-pulse-glow`}),a.jsx("img",{src:"https://iqehkneolpesaqznkqjm.supabase.co/storage/v1/object/sign/assets/m6-motorway-trim-result.gif?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV83YmM1YjM5OS00ZDQwLTRiMDktOGE3Yi1kOWMxNzlkNjcyM2UiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJhc3NldHMvbTYtbW90b3J3YXktdHJpbS1yZXN1bHQuZ2lmIiwiaWF0IjoxNzU4NzMwMDYyLCJleHAiOjMxNTUzNTg3MzAwNjJ9.pKZVb8o3SVRrZ_N5WGWNcrRI59hyZ-tcNongThzTQs4",alt:"Traffic Analysis with AI Detection",className:"rounded-xl shadow-2xl relative z-10 animate-float object-cover h-[250px] sm:h-[300px] md:h-[400px] w-full max-w-full"}),a.jsxs("div",{className:"mt-4 sm:mt-6 md:mt-8 text-center relative z-10 text-gray-300",children:[a.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-2 sm:mb-4",children:"Project 49"}),a.jsx("p",{className:"text-sm sm:text-base text-gray-400",children:"Road-User Behaviour Analysis Using AI & Computer Vision"})]})]})]})})}),a.jsx("section",{id:"objectives",className:`py-12 sm:py-16 md:py-20 lg:py-24 ${r?"bg-neural-800/50":"bg-gray-100"}`,children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"text-center mb-8 sm:mb-12 md:mb-16",children:[a.jsx("div",{className:`inline-block px-4 py-1 rounded-full text-xs sm:text-sm font-medium mb-4 sm:mb-6 animate-float ${r?"bg-primary-500/10 text-primary-400":"bg-primary-600/10 text-primary-600"}`,children:"Project Goals"}),a.jsx("h2",{className:"text-2xl sm:text-3xl font-bold animate-float animation-delay-2000",children:"Key Objectives"})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 lg:gap-8",children:c.map((f,p)=>a.jsxs("div",{className:`p-4 sm:p-6 rounded-xl transition-all duration-300 hover:scale-105 animate-float ${r?"bg-neural-800/50 hover:bg-neural-700/50":"bg-white hover:bg-gray-50 shadow-lg"}`,style:{animationDelay:`${p*200}ms`},children:[a.jsx("div",{className:`p-3 rounded-lg inline-block mb-4 animate-pulse-glow ${r?"bg-primary-500/10 text-primary-400":"bg-primary-600/10 text-primary-600"}`,children:f.icon}),a.jsx("h3",{className:"text-base sm:text-lg lg:text-xl font-semibold mb-2",children:f.title}),a.jsx("p",{className:`text-sm sm:text-base ${r?"text-gray-400":"text-gray-600"}`,children:f.description})]},p))})]})}),a.jsx("section",{id:"features",className:"py-12 sm:py-16 md:py-20 lg:py-24 neural-background",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"text-center mb-8 sm:mb-12 md:mb-16",children:[a.jsx("div",{className:`inline-block px-4 py-1 rounded-full text-xs sm:text-sm font-medium mb-4 sm:mb-6 animate-float ${r?"bg-primary-500/10 text-primary-400":"bg-primary-600/10 text-primary-600"}`,children:"System Features"}),a.jsx("h2",{className:"text-2xl sm:text-3xl font-bold animate-float animation-delay-2000",children:"Technical Capabilities"})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8",children:d.map((f,p)=>a.jsxs("div",{className:`p-4 sm:p-6 rounded-xl transition-all duration-300 hover:scale-105 animate-float ${r?"bg-neural-800/50 hover:bg-neural-700/50":"bg-white hover:bg-gray-50 shadow-lg"}`,style:{animationDelay:`${p*200}ms`},children:[a.jsx("div",{className:`p-3 rounded-lg inline-block mb-4 animate-pulse-glow ${r?"bg-primary-500/10 text-primary-400":"bg-primary-600/10 text-primary-600"}`,children:f.icon}),a.jsx("h3",{className:"text-base sm:text-lg lg:text-xl font-semibold mb-2",children:f.title}),a.jsx("p",{className:`text-sm sm:text-base ${r?"text-gray-400":"text-gray-600"}`,children:f.description})]},p))})]})}),a.jsx("section",{id:"team",className:`py-12 sm:py-16 md:py-20 lg:py-24 ${r?"bg-neural-800/50":"bg-gray-100"}`,children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"text-center mb-8 sm:mb-12 md:mb-16",children:[a.jsx("div",{className:`inline-block px-4 py-1 rounded-full text-xs sm:text-sm font-medium mb-4 sm:mb-6 animate-float ${r?"bg-primary-500/10 text-primary-400":"bg-primary-600/10 text-primary-600"}`,children:"Meet SynerX"}),a.jsx("h2",{className:"text-2xl sm:text-3xl font-bold animate-float animation-delay-2000",children:"Our Team"})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8",children:u.map((f,p)=>a.jsxs("div",{className:`text-center p-4 sm:p-6 rounded-xl transition-all duration-300 hover:scale-105 animate-float ${r?"bg-neural-800/50 hover:bg-neural-700/50":"bg-white hover:bg-gray-50 shadow-lg"}`,style:{animationDelay:`${p*200}ms`},children:[a.jsxs("div",{className:"relative mx-auto w-20 h-20 sm:w-24 sm:h-24 lg:w-32 lg:h-32 mb-4",children:[a.jsx("div",{className:`absolute inset-0 rounded-full blur-xl animate-pulse-glow ${r?"bg-primary-500/20":"bg-primary-600/20"}`}),a.jsx("div",{className:`w-full h-full rounded-full bg-gradient-to-br ${r?"from-neural-700 to-neural-800":"from-gray-100 to-gray-200"} flex items-center justify-center text-2xl sm:text-3xl font-bold relative z-10`,children:f.name.charAt(0)}),a.jsx("div",{className:`absolute inset-0 rounded-full ring-2 animate-glow ${r?"ring-primary-500":"ring-primary-600"}`})]}),a.jsx("h3",{className:"text-sm sm:text-base lg:text-lg font-semibold",children:f.name}),a.jsx("p",{className:`text-xs sm:text-sm mb-2 ${r?"text-primary-400":"text-primary-600"}`,children:f.id}),a.jsx("p",{className:`text-xs sm:text-sm mb-4 ${r?"text-gray-400":"text-gray-600"}`,children:f.role}),a.jsx("div",{className:"flex justify-center",children:a.jsx("a",{href:f.github,target:"_blank",rel:"noopener noreferrer",className:`transition-colors duration-300 ${r?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"}`,children:a.jsx(rr,{className:"w-5 h-5"})})})]},p))})]})}),a.jsx("section",{id:"timeline",className:"py-12 sm:py-16 md:py-20 lg:py-24 neural-background",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"text-center mb-8 sm:mb-12 md:mb-16",children:[a.jsx("div",{className:`inline-block px-4 py-1 rounded-full text-xs sm:text-sm font-medium mb-4 sm:mb-6 animate-float ${r?"bg-primary-500/10 text-primary-400":"bg-primary-600/10 text-primary-600"}`,children:"Development Progress"}),a.jsx("h2",{className:"text-2xl sm:text-3xl font-bold animate-float animation-delay-2000",children:"Project Timeline"})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 sm:gap-6 lg:gap-8",children:h.map((f,p)=>a.jsxs("div",{className:`p-4 sm:p-6 rounded-xl transition-all duration-300 hover:scale-105 animate-float ${r?"bg-neural-800/50 hover:bg-neural-700/50":"bg-white hover:bg-gray-50 shadow-lg"}`,style:{animationDelay:`${p*200}ms`},children:[a.jsx("div",{className:`text-base sm:text-lg font-semibold mb-2 ${r?"text-primary-400":"text-primary-600"}`,children:f.quarter}),a.jsx("h3",{className:"text-base sm:text-lg lg:text-xl font-semibold mb-2",children:f.title}),a.jsx("p",{className:`text-xs sm:text-sm mb-3 ${r?"text-gray-400":"text-gray-600"}`,children:f.tasks}),a.jsx("p",{className:`text-xs sm:text-sm font-medium ${f.status==="Completed"?"text-green-500":f.status==="In Progress"?r?"text-primary-400":"text-primary-600":r?"text-gray-400":"text-gray-600"}`,children:f.status})]},p))})]})}),a.jsx("footer",{className:`py-8 sm:py-10 md:py-12 ${r?"bg-neural-800/50":"bg-gray-100"}`,children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 sm:gap-8 md:gap-12",children:[a.jsxs("div",{className:"animate-float",children:[a.jsx("h3",{className:"text-lg sm:text-xl font-bold mb-3 sm:mb-4",children:"Swinburne"}),a.jsx("p",{className:`text-sm sm:text-base ${r?"text-gray-400":"text-gray-600"}`,children:"A research project by Swinburne University of Technology"})]}),a.jsxs("div",{className:"animate-float animation-delay-2000",children:[a.jsx("h3",{className:"text-lg sm:text-xl font-bold mb-3 sm:mb-4",children:"Quick Links"}),a.jsxs("ul",{className:"space-y-2",children:[a.jsx("li",{children:a.jsx("a",{href:"#about",className:`text-sm sm:text-base transition-colors duration-300 ${r?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"}`,children:"About"})}),a.jsx("li",{children:a.jsx("a",{href:"#objectives",className:`text-sm sm:text-base transition-colors duration-300 ${r?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"}`,children:"Objectives"})}),a.jsx("li",{children:a.jsx("a",{href:"#features",className:`text-sm sm:text-base transition-colors duration-300 ${r?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"}`,children:"Features"})}),a.jsx("li",{children:a.jsx("a",{href:"#team",className:`text-sm sm:text-base transition-colors duration-300 ${r?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"}`,children:"Team"})})]})]}),a.jsxs("div",{className:"animate-float animation-delay-4000",children:[a.jsx("h3",{className:"text-lg sm:text-xl font-bold mb-3 sm:mb-4",children:"Contact"}),a.jsx("p",{className:`mb-4 text-sm sm:text-base ${r?"text-gray-400":"text-gray-600"}`,children:"For inquiries, please contact our team at Swinburne University"}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsx("a",{href:"#",className:`transition-colors duration-300 ${r?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"}`,children:a.jsx(wa,{className:"w-5 h-5"})}),a.jsx("a",{href:"#",className:`transition-colors duration-300 ${r?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"}`,children:a.jsx(yn,{className:"w-5 h-5"})}),a.jsx("a",{href:"https://github.com/sasindudilshanranwadana/SynerX",target:"_blank",rel:"noopener noreferrer",className:`transition-colors duration-300 ${r?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"}`,children:a.jsx(rr,{className:"w-5 h-5"})})]})]})]}),a.jsx("div",{className:`mt-6 sm:mt-8 md:mt-12 pt-6 sm:pt-8 border-t ${r?"border-neural-700":"border-gray-200"} text-center ${r?"text-gray-400":"text-gray-600"}`,children:a.jsx("p",{className:"text-sm sm:text-base",children:" 2024 Project 49. All rights reserved."})})]})})]})}const Sl=async r=>{try{const{data:e,error:t}=await fe.from("videos").insert([r]).select().single();if(t)throw t;return e}catch(e){throw console.error("Error inserting video:",e),e}},Nl=async()=>{try{const{data:r,error:e}=await fe.from("videos").select("*").order("created_at",{ascending:!1});if(e)throw e;return r||[]}catch(r){throw console.error("Error fetching videos:",r),r}},ra=async()=>{try{const{data:r,error:e}=await fe.from("tracking_results").select("*").order("created_at",{ascending:!1});if(e)throw e;return r||[]}catch(r){throw console.error("Error fetching all tracking results:",r),r}},kl=async()=>{try{const{data:r,error:e}=await fe.from("vehicle_counts").select("*").order("created_at",{ascending:!1});if(e)throw e;return r||[]}catch(r){throw console.error("Error fetching all vehicle counts:",r),r}},El=async()=>{try{const[r,e,t]=await Promise.all([Nl(),ra(),kl()]),s=r.length,n=r.filter(h=>h.status==="completed").length,i=e.length,o=e.filter(h=>h.compliance===0).length,l=e.filter(h=>h.compliance===1),c=i>0?l.length/i*100:0,d=l.map(h=>h.reaction_time).filter(h=>h!=null&&h>0),u=d.length>0?d.reduce((h,f)=>h+f,0)/d.length:0;return{totalVideos:s,processedVideos:n,totalVehicles:i,violations:o,complianceRate:c,avgReactionTime:u,trackingResults:e,vehicleCounts:t,videos:r}}catch(r){throw console.error("Error getting overall analytics:",r),r}};function Xt({className:r=""}){const[e,t]=_.useState(()=>ve()==="dark"),[s,n]=_.useState("connecting"),[i,o]=_.useState(0);_.useEffect(()=>{const h=()=>{t(ve()==="dark")};window.addEventListener("themeChanged",h),l();const f=setInterval(l,3e4);return()=>{window.removeEventListener("themeChanged",h),clearInterval(f)}},[]);const l=async(h=0)=>{var p;h===0&&(n("connecting"),o(0));try{const x="https://alxrkajk60i0df-8000.proxy.runpod.net",j={"Content-Type":"application/json"};j.Authorization="Bearer rpa_1K6BW22JFGU3D3AI8XRSQ7YBSPE7XHDKTMBR2Q211nzdtd";const N=h===0?1e4:3e4+h*5e3,L=await fetch(`${x}/`,{method:"GET",headers:j,signal:AbortSignal.timeout(N)}),T=await L.text();if(L.ok)try{const $=JSON.parse(T);if($.message==="SynerX API is running!"&&$.status==="ok"){n("connected"),o(0),console.log("[ServerStatus] Successfully connected to RunPod!");return}}catch($){console.error("[ServerStatus] Failed to parse response:",$)}if((T.includes("no workers available")||T.includes("worker")||L.status===503)&&h<5){n("warming"),o(h+1);const $=Math.min(3e3*Math.pow(2,h),48e3);console.log(`[ServerStatus] Cold start detected, retrying in ${$}ms (attempt ${h+1}/5)`),setTimeout(()=>l(h+1),$);return}console.error(`[ServerStatus] Connection failed: ${L.status} - ${T}`),n("error")}catch(x){if((x.name==="TimeoutError"||(p=x.message)!=null&&p.includes("timeout"))&&h<5){n("warming"),o(h+1);const j=Math.min(3e3*Math.pow(2,h),48e3);console.log(`[ServerStatus] Timeout during warm-up, retrying in ${j}ms (attempt ${h+1}/5)`),setTimeout(()=>l(h+1),j);return}n("error")}},c=h=>{switch(h){case"connected":return"bg-green-500";case"connecting":return"bg-yellow-500";case"warming":return"bg-orange-500";case"error":return"bg-red-500";case"disconnected":return"bg-gray-500";default:return"bg-gray-500"}},d=h=>{switch(h){case"connected":return"animate-ping";case"connecting":return"animate-pulse";case"warming":return"animate-pulse";default:return""}},u=h=>{switch(h){case"connected":return"RunPod Connected";case"connecting":return"Connecting...";case"warming":return i>0?`Warming up... (${i}/5)`:"Warming up...";case"error":return"RunPod Disconnected";case"disconnected":return"RunPod Disconnected";default:return"Unknown Status"}};return a.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-2 px-3 py-2 rounded-lg backdrop-blur-sm ${e?"bg-[#151F32]/90 border border-[#1E293B]":"bg-white/90 border border-gray-200"} ${r}`,children:[a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:`w-3 h-3 rounded-full ${c(s)}`}),s==="connected"&&a.jsx("div",{className:`absolute inset-0 w-3 h-3 rounded-full ${c(s)} ${d(s)} opacity-75`}),(s==="connecting"||s==="warming")&&a.jsx("div",{className:`absolute inset-0 w-3 h-3 rounded-full ${c(s)} ${d(s)}`})]}),a.jsx("span",{className:`text-xs font-medium ${e?"text-gray-300":"text-gray-700"}`,children:u(s)})]})}function Tl(){var W,re,le,ie,Q;const[r,e]=_.useState(!1),[t,s]=_.useState(null),[n,i]=_.useState(()=>ve()==="dark"),[o,l]=_.useState({videosProcessed:0,violations:0,complianceRate:0,avgReactionTime:0}),[c,d]=_.useState(!0),[u,h]=_.useState([{name:"YOLOv8 Model",status:"Down",icon:a.jsx(Xr,{className:"w-5 h-5"})},{name:"Video Processing",status:"Down",icon:a.jsx(ze,{className:"w-5 h-5"})},{name:"Database Sync",status:"Down",icon:a.jsx(Zr,{className:"w-5 h-5"})}]),[f,p]=_.useState([{event:"Loading recent activity...",time:"Just now",type:"info"}]),[x,j]=_.useState(!1),[N,L]=_.useState(0);_.useEffect(()=>{(async()=>{const{data:{user:J}}=await fe.auth.getUser();s(J)})(),T();const O=setInterval(T,3e4);return()=>clearInterval(O)},[]),_.useEffect(()=>{const P=()=>{i(ve()==="dark")};return window.addEventListener("themeChanged",P),()=>window.removeEventListener("themeChanged",P)},[]);const T=async()=>{try{await Promise.all([$(),V(),m()])}catch(P){console.error("Error loading dashboard data:",P)}finally{d(!1)}},$=async()=>{try{const P="https://alxrkajk60i0df-8000.proxy.runpod.net",O={"Content-Type":"application/json"};O.Authorization="Bearer rpa_1K6BW22JFGU3D3AI8XRSQ7YBSPE7XHDKTMBR2Q211nzdtd";const y=(await fetch(`${P}/`,{method:"GET",headers:O,signal:AbortSignal.timeout(1e4)})).ok,k=y,C=await D();h([{name:"YOLOv8 Model",status:y?"Operational":"Down",icon:a.jsx(Xr,{className:"w-5 h-5"}),lastChecked:new Date().toLocaleTimeString()},{name:"Video Processing",status:k?"Operational":"Down",icon:a.jsx(ze,{className:"w-5 h-5"}),lastChecked:new Date().toLocaleTimeString()},{name:"Database Sync",status:C?"Operational":"Down",icon:a.jsx(Zr,{className:"w-5 h-5"}),lastChecked:new Date().toLocaleTimeString()}])}catch(P){console.error("Error checking system status:",P),h(O=>O.map(J=>({...J,status:"Down"})))}},D=async()=>{try{const{data:P,error:O}=await fe.from("videos").select("count").limit(1);return!O}catch{return!1}},V=async()=>{try{try{const J="https://alxrkajk60i0df-8000.proxy.runpod.net",y={"Content-Type":"application/json"};y.Authorization="Bearer rpa_1K6BW22JFGU3D3AI8XRSQ7YBSPE7XHDKTMBR2Q211nzdtd";const k=await fetch(`${J}/recent-activity`,{method:"GET",headers:y,signal:AbortSignal.timeout(1e4)});if(k.ok){const C=await k.json();if(C.activities&&Array.isArray(C.activities)){p(C.activities);return}}}catch{console.log("Backend recent activity not available, using database fallback")}const{data:P}=await fe.from("videos").select("*").order("created_at",{ascending:!1}).limit(5),O=[];P==null||P.forEach(J=>{const y=U(J.created_at);O.push({event:`New video uploaded: ${J.video_name}`,time:y,type:"info"})}),O.sort((J,y)=>{const k=A(J.time),C=A(y.time);return k-C}),p(O.slice(0,5))}catch(P){console.error("Error loading recent activity:",P),p([{event:"Unable to load recent activity",time:"Just now",type:"error"}])}},U=P=>{const O=new Date,J=new Date(P),y=Math.floor((O.getTime()-J.getTime())/(1e3*60));if(y<1)return"Just now";if(y<60)return`${y} minute${y>1?"s":""} ago`;const k=Math.floor(y/60);if(k<24)return`${k} hour${k>1?"s":""} ago`;const C=Math.floor(k/24);return`${C} day${C>1?"s":""} ago`},A=P=>{if(P==="Just now")return 0;const O=P.match(/(\d+)\s+(minute|hour|day)/);if(!O)return 0;const J=parseInt(O[1]);switch(O[2]){case"minute":return J;case"hour":return J*60;case"day":return J*60*24;default:return 0}},m=async()=>{try{try{const J=await fetch("https://alxrkajk60i0df-8000.proxy.runpod.net/analytics/summary",{method:"GET",headers:{"Content-Type":"application/json"},signal:AbortSignal.timeout(1e4)});if(J.ok){const y=await J.json();if(y.stats){l({videosProcessed:y.stats.videosProcessed||0,violations:y.stats.violations||0,complianceRate:y.stats.complianceRate||0,avgReactionTime:y.stats.avgReactionTime||0});return}}}catch{console.log("Backend analytics not available, using database fallback")}const P=await El();l({videosProcessed:P.processedVideos,violations:P.violations,complianceRate:P.complianceRate,avgReactionTime:P.avgReactionTime})}catch(P){console.error("Error loading analytics:",P),l({videosProcessed:0,violations:0,complianceRate:0,avgReactionTime:0})}finally{d(!1)}},g=P=>{switch(P){case"Operational":return"text-green-400";case"Degraded":return"text-yellow-400";case"Down":return"text-red-400";default:return"text-gray-400"}},v=P=>{switch(P){case"success":return"bg-green-500";case"warning":return"bg-yellow-500";case"error":return"bg-red-500";default:return"bg-primary-500"}},I=[{icon:a.jsx(vs,{className:"w-5 h-5"}),label:"Home",path:"/"},{icon:a.jsx(vn,{className:"w-5 h-5"}),label:"Dashboard",path:"/dashboard",active:!0},{icon:a.jsx(wn,{className:"w-5 h-5"}),label:"Video Upload",path:"/upload"},{icon:a.jsx(ze,{className:"w-5 h-5"}),label:"Analytics",path:"/analytics"},{icon:a.jsx(ur,{className:"w-5 h-5"}),label:"Video Playback",path:"/playback"},{icon:a.jsx(_n,{className:"w-5 h-5"}),label:"Settings",path:"/settings"}],R=async()=>{try{await fe.auth.signOut()}catch(P){console.error("Error signing out:",P)}};return a.jsxs("div",{className:`min-h-screen ${n?"bg-[#0B1121] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx(Xt,{}),a.jsx("div",{className:`lg:hidden fixed top-0 left-0 right-0 z-50 p-4 border-b ${n?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200"}`,children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("button",{onClick:()=>e(!r),className:"p-2",children:r?a.jsx(qe,{className:"w-6 h-6"}):a.jsx(bs,{className:"w-6 h-6"})}),a.jsx("span",{className:"text-xl font-bold",children:"Project 49"}),a.jsx("img",{src:((W=t==null?void 0:t.user_metadata)==null?void 0:W.avatar_url)||`https://ui-avatars.com/api/?name=${(t==null?void 0:t.email)||"User"}&background=0B1121&color=fff`,alt:"Profile",className:"w-8 h-8 rounded-full border-2 border-primary-500"})]})}),a.jsxs("aside",{className:`fixed top-0 left-0 h-full w-64 transform transition-transform duration-300 ease-in-out z-40 border-r ${n?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200"} ${r?"translate-x-0":"-translate-x-full"} lg:translate-x-0`,children:[a.jsx("div",{className:`p-6 mt-14 lg:mt-0 border-b ${n?"border-[#1E293B]":"border-gray-200"}`,children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("img",{src:((re=t==null?void 0:t.user_metadata)==null?void 0:re.avatar_url)||`https://ui-avatars.com/api/?name=${(t==null?void 0:t.email)||"User"}&background=0B1121&color=fff`,alt:"Profile",className:"w-12 h-12 rounded-full border-2 border-primary-500"}),a.jsxs("div",{children:[a.jsx("h2",{className:"font-semibold",children:((le=t==null?void 0:t.user_metadata)==null?void 0:le.full_name)||"User"}),a.jsx("p",{className:`text-sm truncate max-w-[150px] ${n?"text-gray-400":"text-gray-600"}`,children:t==null?void 0:t.email})]})]})}),a.jsx("nav",{className:"p-4 overflow-y-auto h-[calc(100vh-200px)]",children:I.map((P,O)=>a.jsxs(Ke,{to:P.path,onClick:()=>e(!1),className:`flex items-center gap-3 px-4 py-3 rounded-lg mb-1 transition-colors ${P.active?"bg-primary-500/20 text-primary-500":n?"hover:bg-[#1E293B] text-gray-400 hover:text-white":"hover:bg-gray-100 text-gray-600 hover:text-gray-900"}`,children:[P.icon,P.label]},O))}),a.jsx("div",{className:"absolute bottom-0 w-full p-4",children:a.jsxs("button",{onClick:R,className:`flex items-center gap-2 w-full px-4 py-2 rounded-lg text-red-500 transition-colors ${n?"hover:bg-red-500/10":"hover:bg-red-50"}`,children:[a.jsx(bn,{className:"w-5 h-5"}),"Sign Out"]})})]}),r&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:()=>e(!1)}),a.jsxs("main",{className:"lg:ml-64 p-4 lg:p-8 mt-16 lg:mt-0",children:[a.jsxs("div",{className:"mb-8",children:[a.jsxs("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-2",children:["Welcome back, ",((Q=(ie=t==null?void 0:t.user_metadata)==null?void 0:ie.full_name)==null?void 0:Q.split(" ")[0])||"User"]}),a.jsx("p",{className:`text-sm lg:text-base ${n?"text-gray-400":"text-gray-600"}`,children:"Here's what's happening with your monitoring system"})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 lg:gap-6 mb-8",children:c?Array(4).fill(null).map((P,O)=>a.jsxs("div",{className:`p-6 rounded-xl animate-pulse border ${n?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200 shadow-lg"}`,children:[a.jsx("div",{className:"h-10 w-10 bg-primary-500/10 rounded-lg mb-4"}),a.jsx("div",{className:`h-8 w-24 rounded mb-2 ${n?"bg-gray-700":"bg-gray-300"}`}),a.jsx("div",{className:`h-4 w-32 rounded ${n?"bg-gray-700":"bg-gray-300"}`})]},O)):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:`p-4 lg:p-6 rounded-xl border ${n?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200 shadow-lg"}`,children:[a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-2 sm:gap-0",children:[a.jsx("div",{className:"p-2 lg:p-3 bg-primary-500/10 rounded-lg text-primary-500",children:a.jsx(xn,{className:"w-6 h-6"})}),a.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-blue-500/10 text-blue-400 whitespace-nowrap",children:"Active"})]}),a.jsx("h3",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-1",children:o.videosProcessed}),a.jsx("p",{className:`text-sm ${n?"text-gray-400":"text-gray-600"}`,children:"Videos Processed"})]}),a.jsxs("div",{className:`p-4 lg:p-6 rounded-xl border ${n?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200 shadow-lg"}`,children:[a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-2 sm:gap-0",children:[a.jsx("div",{className:"p-2 lg:p-3 bg-primary-500/10 rounded-lg text-primary-500",children:a.jsx(ze,{className:"w-6 h-6"})}),a.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-orange-500/10 text-orange-400 whitespace-nowrap",children:"Alert"})]}),a.jsx("h3",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-1",children:o.violations}),a.jsx("p",{className:`text-sm ${n?"text-gray-400":"text-gray-600"}`,children:"Violations Detected"})]}),a.jsxs("div",{className:`p-4 lg:p-6 rounded-xl border ${n?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200 shadow-lg"}`,children:[a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-2 sm:gap-0",children:[a.jsx("div",{className:"p-2 lg:p-3 bg-primary-500/10 rounded-lg text-primary-500",children:a.jsx(ze,{className:"w-6 h-6"})}),a.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-green-500/10 text-green-400 whitespace-nowrap",children:"Stable"})]}),a.jsxs("h3",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-1",children:[o.complianceRate.toFixed(1),"%"]}),a.jsx("p",{className:`text-sm ${n?"text-gray-400":"text-gray-600"}`,children:"Compliance Rate"})]}),a.jsxs("div",{className:`p-4 lg:p-6 rounded-xl border ${n?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200 shadow-lg"}`,children:[a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-2 sm:gap-0",children:[a.jsx("div",{className:"p-2 lg:p-3 bg-primary-500/10 rounded-lg text-primary-500",children:a.jsx(es,{className:"w-6 h-6"})}),a.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-blue-500/10 text-blue-400 whitespace-nowrap",children:"per vehicle"})]}),a.jsxs("h3",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-1",children:[o.avgReactionTime.toFixed(2),"s"]}),a.jsx("p",{className:`text-sm ${n?"text-gray-400":"text-gray-600"}`,children:"Avg. Reaction Time"})]})]})}),a.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4 lg:gap-6",children:[a.jsxs("div",{className:`p-4 lg:p-6 rounded-xl border ${n?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200 shadow-lg"}`,children:[a.jsx("h2",{className:"text-lg lg:text-xl font-semibold mb-4 lg:mb-6",children:"System Status"}),a.jsxs("div",{className:"space-y-3 lg:space-y-4",children:[a.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2 sm:gap-0",children:a.jsxs("span",{className:`text-sm ${n?"text-gray-400":"text-gray-600"}`,children:["Last updated: ",new Date().toLocaleTimeString()]})}),u.map((P,O)=>a.jsxs("div",{className:`flex items-center justify-between p-3 lg:p-4 rounded-lg ${n?"bg-[#1E293B]":"bg-gray-50"}`,children:[a.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[a.jsx("div",{className:"text-primary-500",children:P.icon}),a.jsx("span",{className:"text-sm lg:text-base truncate",children:P.name})]}),a.jsxs("div",{className:"text-right flex-shrink-0",children:[a.jsx("span",{className:`text-sm lg:text-base ${g(P.status)}`,children:P.status}),P.lastChecked&&a.jsx("div",{className:`text-xs ${n?"text-gray-500":"text-gray-400"}`,children:P.lastChecked})]})]},O))]})]}),a.jsxs("div",{className:`p-4 lg:p-6 rounded-xl border ${n?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200 shadow-lg"}`,children:[a.jsx("h2",{className:"text-lg lg:text-xl font-semibold mb-4 lg:mb-6",children:"Recent Activity"}),a.jsx("div",{className:"space-y-3 lg:space-y-4",children:f.map((P,O)=>a.jsxs("div",{className:`flex items-center gap-3 lg:gap-4 p-3 lg:p-4 rounded-lg ${n?"bg-[#1E293B]":"bg-gray-50"}`,children:[a.jsx("div",{className:`w-2 h-2 rounded-full flex-shrink-0 ${v(P.type)}`}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("p",{className:"text-sm lg:text-base truncate",children:P.event}),a.jsx("p",{className:`text-xs mt-1 ${n?"text-gray-400":"text-gray-600"}`,children:P.time})]})]},O))})]})]})]})]})}var Cl=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function fs(){return fs=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},fs.apply(this,arguments)}function $l(r,e){if(r==null)return{};var t={},s=Object.keys(r),n,i;for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&(t[n]=r[n]);return t}function ir(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function Ol(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,gs(r,e)}function gs(r,e){return gs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,n){return s.__proto__=n,s},gs(r,e)}var Sr=function(r){Ol(e,r);function e(){var s;return s=r.call(this)||this,s.handleExpired=s.handleExpired.bind(ir(s)),s.handleErrored=s.handleErrored.bind(ir(s)),s.handleChange=s.handleChange.bind(ir(s)),s.handleRecaptchaRef=s.handleRecaptchaRef.bind(ir(s)),s}var t=e.prototype;return t.getCaptchaFunction=function(n){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[n]:this.props.grecaptcha[n]:null},t.getValue=function(){var n=this.getCaptchaFunction("getResponse");return n&&this._widgetId!==void 0?n(this._widgetId):null},t.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},t.execute=function(){var n=this.getCaptchaFunction("execute");if(n&&this._widgetId!==void 0)return n(this._widgetId);this._executeRequested=!0},t.executeAsync=function(){var n=this;return new Promise(function(i,o){n.executionResolve=i,n.executionReject=o,n.execute()})},t.reset=function(){var n=this.getCaptchaFunction("reset");n&&this._widgetId!==void 0&&n(this._widgetId)},t.forceReset=function(){var n=this.getCaptchaFunction("reset");n&&n()},t.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},t.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},t.handleChange=function(n){this.props.onChange&&this.props.onChange(n),this.executionResolve&&(this.executionResolve(n),delete this.executionReject,delete this.executionResolve)},t.explicitRender=function(){var n=this.getCaptchaFunction("render");if(n&&this._widgetId===void 0){var i=document.createElement("div");this._widgetId=n(i,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(i)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},t.componentDidMount=function(){this.explicitRender()},t.componentDidUpdate=function(){this.explicitRender()},t.handleRecaptchaRef=function(n){this.captcha=n},t.render=function(){var n=this.props;n.sitekey,n.onChange,n.theme,n.type,n.tabindex,n.onExpired,n.onErrored,n.size,n.stoken,n.grecaptcha,n.badge,n.hl,n.isolated;var i=$l(n,Cl);return et.createElement("div",fs({},i,{ref:this.handleRecaptchaRef}))},e}(et.Component);Sr.displayName="ReCAPTCHA";Sr.propTypes={sitekey:Te.string.isRequired,onChange:Te.func,grecaptcha:Te.object,theme:Te.oneOf(["dark","light"]),type:Te.oneOf(["image","audio"]),tabindex:Te.number,onExpired:Te.func,onErrored:Te.func,size:Te.oneOf(["compact","normal","invisible"]),stoken:Te.string,hl:Te.string,badge:Te.oneOf(["bottomright","bottomleft","inline"]),isolated:Te.bool};Sr.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};var sa={exports:{}},de={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var je=typeof Symbol=="function"&&Symbol.for,ks=je?Symbol.for("react.element"):60103,Es=je?Symbol.for("react.portal"):60106,Nr=je?Symbol.for("react.fragment"):60107,kr=je?Symbol.for("react.strict_mode"):60108,Er=je?Symbol.for("react.profiler"):60114,Tr=je?Symbol.for("react.provider"):60109,Cr=je?Symbol.for("react.context"):60110,Ts=je?Symbol.for("react.async_mode"):60111,$r=je?Symbol.for("react.concurrent_mode"):60111,Or=je?Symbol.for("react.forward_ref"):60112,Rr=je?Symbol.for("react.suspense"):60113,Rl=je?Symbol.for("react.suspense_list"):60120,Ar=je?Symbol.for("react.memo"):60115,Pr=je?Symbol.for("react.lazy"):60116,Al=je?Symbol.for("react.block"):60121,Pl=je?Symbol.for("react.fundamental"):60117,Dl=je?Symbol.for("react.responder"):60118,Il=je?Symbol.for("react.scope"):60119;function Ae(r){if(typeof r=="object"&&r!==null){var e=r.$$typeof;switch(e){case ks:switch(r=r.type,r){case Ts:case $r:case Nr:case Er:case kr:case Rr:return r;default:switch(r=r&&r.$$typeof,r){case Cr:case Or:case Pr:case Ar:case Tr:return r;default:return e}}case Es:return e}}}function na(r){return Ae(r)===$r}de.AsyncMode=Ts;de.ConcurrentMode=$r;de.ContextConsumer=Cr;de.ContextProvider=Tr;de.Element=ks;de.ForwardRef=Or;de.Fragment=Nr;de.Lazy=Pr;de.Memo=Ar;de.Portal=Es;de.Profiler=Er;de.StrictMode=kr;de.Suspense=Rr;de.isAsyncMode=function(r){return na(r)||Ae(r)===Ts};de.isConcurrentMode=na;de.isContextConsumer=function(r){return Ae(r)===Cr};de.isContextProvider=function(r){return Ae(r)===Tr};de.isElement=function(r){return typeof r=="object"&&r!==null&&r.$$typeof===ks};de.isForwardRef=function(r){return Ae(r)===Or};de.isFragment=function(r){return Ae(r)===Nr};de.isLazy=function(r){return Ae(r)===Pr};de.isMemo=function(r){return Ae(r)===Ar};de.isPortal=function(r){return Ae(r)===Es};de.isProfiler=function(r){return Ae(r)===Er};de.isStrictMode=function(r){return Ae(r)===kr};de.isSuspense=function(r){return Ae(r)===Rr};de.isValidElementType=function(r){return typeof r=="string"||typeof r=="function"||r===Nr||r===$r||r===Er||r===kr||r===Rr||r===Rl||typeof r=="object"&&r!==null&&(r.$$typeof===Pr||r.$$typeof===Ar||r.$$typeof===Tr||r.$$typeof===Cr||r.$$typeof===Or||r.$$typeof===Pl||r.$$typeof===Dl||r.$$typeof===Il||r.$$typeof===Al)};de.typeOf=Ae;sa.exports=de;var Fl=sa.exports,Cs=Fl,Ll={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},Bl={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},Ml={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},aa={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},$s={};$s[Cs.ForwardRef]=Ml;$s[Cs.Memo]=aa;function tn(r){return Cs.isMemo(r)?aa:$s[r.$$typeof]||Ll}var Ul=Object.defineProperty,Wl=Object.getOwnPropertyNames,rn=Object.getOwnPropertySymbols,ql=Object.getOwnPropertyDescriptor,zl=Object.getPrototypeOf,sn=Object.prototype;function ia(r,e,t){if(typeof e!="string"){if(sn){var s=zl(e);s&&s!==sn&&ia(r,s,t)}var n=Wl(e);rn&&(n=n.concat(rn(e)));for(var i=tn(r),o=tn(e),l=0;l<n.length;++l){var c=n[l];if(!Bl[c]&&!(t&&t[c])&&!(o&&o[c])&&!(i&&i[c])){var d=ql(e,c);try{Ul(r,c,d)}catch{}}}}return r}var Vl=ia;const Hl=ya(Vl);function ps(){return ps=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},ps.apply(this,arguments)}function Kl(r,e){if(r==null)return{};var t={},s=Object.keys(r),n,i;for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&(t[n]=r[n]);return t}function Jl(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.__proto__=e}var Fe={},Gl=0;function Yl(r,e){return e=e||{},function(s){var n=s.displayName||s.name||"Component",i=function(l){Jl(c,l);function c(u,h){var f;return f=l.call(this,u,h)||this,f.state={},f.__scriptURL="",f}var d=c.prototype;return d.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+Gl++),this.__scriptLoaderID},d.setupScriptURL=function(){return this.__scriptURL=typeof r=="function"?r():r,this.__scriptURL},d.asyncScriptLoaderHandleLoad=function(h){var f=this;this.setState(h,function(){return f.props.asyncScriptOnLoad&&f.props.asyncScriptOnLoad(f.state)})},d.asyncScriptLoaderTriggerOnScriptLoaded=function(){var h=Fe[this.__scriptURL];if(!h||!h.loaded)throw new Error("Script is not loaded.");for(var f in h.observers)h.observers[f](h);delete window[e.callbackName]},d.componentDidMount=function(){var h=this,f=this.setupScriptURL(),p=this.asyncScriptLoaderGetScriptLoaderID(),x=e,j=x.globalName,N=x.callbackName,L=x.scriptId;if(j&&typeof window[j]<"u"&&(Fe[f]={loaded:!0,observers:{}}),Fe[f]){var T=Fe[f];if(T&&(T.loaded||T.errored)){this.asyncScriptLoaderHandleLoad(T);return}T.observers[p]=function(A){return h.asyncScriptLoaderHandleLoad(A)};return}var $={};$[p]=function(A){return h.asyncScriptLoaderHandleLoad(A)},Fe[f]={loaded:!1,observers:$};var D=document.createElement("script");D.src=f,D.async=!0;for(var V in e.attributes)D.setAttribute(V,e.attributes[V]);L&&(D.id=L);var U=function(m){if(Fe[f]){var g=Fe[f],v=g.observers;for(var I in v)m(v[I])&&delete v[I]}};N&&typeof window<"u"&&(window[N]=function(){return h.asyncScriptLoaderTriggerOnScriptLoaded()}),D.onload=function(){var A=Fe[f];A&&(A.loaded=!0,U(function(m){return N?!1:(m(A),!0)}))},D.onerror=function(){var A=Fe[f];A&&(A.errored=!0,U(function(m){return m(A),!0}))},document.body.appendChild(D)},d.componentWillUnmount=function(){var h=this.__scriptURL;if(e.removeOnUnmount===!0)for(var f=document.getElementsByTagName("script"),p=0;p<f.length;p+=1)f[p].src.indexOf(h)>-1&&f[p].parentNode&&f[p].parentNode.removeChild(f[p]);var x=Fe[h];x&&(delete x.observers[this.asyncScriptLoaderGetScriptLoaderID()],e.removeOnUnmount===!0&&delete Fe[h])},d.render=function(){var h=e.globalName,f=this.props;f.asyncScriptOnLoad;var p=f.forwardedRef,x=Kl(f,["asyncScriptOnLoad","forwardedRef"]);return h&&typeof window<"u"&&(x[h]=typeof window[h]<"u"?window[h]:void 0),x.ref=p,et.createElement(s,x)},c}(et.Component),o=et.forwardRef(function(l,c){return et.createElement(i,ps({},l,{forwardedRef:c}))});return o.displayName="AsyncScriptLoader("+n+")",o.propTypes={asyncScriptOnLoad:Te.func},Hl(o,s)}}var ys="onloadcallback",Ql="grecaptcha";function xs(){return typeof window<"u"&&window.recaptchaOptions||{}}function Xl(){var r=xs(),e=r.useRecaptchaNet?"recaptcha.net":"www.google.com";return r.enterprise?"https://"+e+"/recaptcha/enterprise.js?onload="+ys+"&render=explicit":"https://"+e+"/recaptcha/api.js?onload="+ys+"&render=explicit"}const Zl=Yl(Xl,{callbackName:ys,globalName:Ql,attributes:xs().nonce?{nonce:xs().nonce}:{}})(Sr);function ec(){const r=fn(),[e]=xa(),[t,s]=_.useState(!1),[n,i]=_.useState(!1),[o,l]=_.useState(!1),[c,d]=_.useState(!1),[u,h]=_.useState(null),[f,p]=_.useState(!1),[x,j]=_.useState(""),[N,L]=_.useState(null),[T,$]=_.useState({email:"",password:"",confirmPassword:""}),D=_.useRef(null);_.useEffect(()=>{const{data:{subscription:g}}=fe.auth.onAuthStateChange((R,W)=>{R==="SIGNED_UP"&&console.log("User signed up, waiting for email confirmation"),R==="SIGNED_IN"&&W&&(V("success","Welcome! You have successfully signed in to your account."),setTimeout(()=>r("/dashboard"),2e3))}),v=e.get("access_token"),I=e.get("refresh_token");return v&&I&&r("/dashboard"),()=>g.unsubscribe()},[r,e]);const V=(g,v)=>{L({type:g,message:v}),setTimeout(()=>L(null),5e3)},U=async()=>{if(!x){V("error","No email address found. Please try signing up again.");return}i(!0);try{const{error:g}=await fe.auth.resend({type:"signup",email:x,options:{emailRedirectTo:`${window.location.origin}/dashboard`}});if(g)throw g;V("success","Confirmation email has been resent. Please check your inbox.")}catch(g){V("error",g.message)}finally{i(!1)}},A=async g=>{var v,I;if(g.preventDefault(),!u){V("error","Please complete the reCAPTCHA verification.");return}if(t&&T.password!==T.confirmPassword){V("error","Passwords do not match. Please ensure both password fields are identical.");return}if(T.password.length<6){V("error","Password must be at least 6 characters long for security purposes.");return}i(!0);try{if(t){const{error:R}=await fe.auth.signUp({email:T.email,password:T.password,options:{emailRedirectTo:`${window.location.origin}/dashboard`}});if(R)throw R;j(T.email),p(!0),V("success","Account created successfully! We've sent a confirmation email to your inbox. Please check your email and click the confirmation link to activate your account."),$({email:"",password:"",confirmPassword:""}),(v=D.current)==null||v.reset(),h(null)}else{const{error:R}=await fe.auth.signInWithPassword({email:T.email,password:T.password});if(R)throw R.message.includes("Invalid login credentials")?new Error("The email or password you entered is incorrect. Please check your credentials and try again."):R.message.includes("Email not confirmed")?new Error("Please check your email and click the confirmation link to activate your account before signing in."):R}}catch(R){V("error",R.message),(I=D.current)==null||I.reset(),h(null)}finally{i(!1)}},m=g=>{$({...T,[g.target.name]:g.target.value})};return f?a.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-[#0B1121] relative overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 neural-grid opacity-10"}),a.jsxs("div",{className:"absolute inset-0",children:[a.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 h-64 bg-primary-500/10 rounded-full blur-3xl animate-pulse"}),a.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-64 h-64 bg-primary-500/10 rounded-full blur-3xl animate-pulse animation-delay-2000"})]}),N&&a.jsxs("div",{className:`fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg flex items-center space-x-3 max-w-md ${N.type==="success"?"bg-green-500":N.type==="error"?"bg-red-500":"bg-blue-500"}`,children:[N.type==="success"?a.jsx(kt,{className:"w-5 h-5 flex-shrink-0"}):a.jsx(Et,{className:"w-5 h-5 flex-shrink-0"}),a.jsx("span",{className:"text-white text-sm",children:N.message})]}),a.jsxs("div",{className:"bg-[#151F32]/50 p-8 rounded-2xl border border-[#1E293B] backdrop-blur-sm max-w-md w-full mx-4 relative",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("div",{className:"mx-auto w-16 h-16 bg-primary-500/10 rounded-full flex items-center justify-center mb-4",children:a.jsx(kt,{className:"w-8 h-8 text-primary-500"})}),a.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Check Your Email"}),a.jsx("p",{className:"text-gray-300 mb-4 leading-relaxed",children:"We've sent a confirmation email to:"}),a.jsx("div",{className:"bg-[#1E293B] rounded-lg p-3 mb-4",children:a.jsx("p",{className:"text-primary-400 font-medium",children:x})}),a.jsx("p",{className:"text-gray-400 text-sm mb-6",children:"Click the confirmation link in the email to activate your account. The link will expire in 24 hours for security."})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("button",{onClick:U,disabled:n,className:"w-full py-3 px-4 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-all duration-200",children:n?"Sending...":"Resend Confirmation Email"}),a.jsx("button",{onClick:()=>{p(!1),j(""),s(!1)},className:"w-full py-3 px-4 bg-[#1E293B] hover:bg-[#2D3B4E] text-gray-300 font-medium rounded-lg transition-all duration-200",children:"Back to Sign In"})]}),a.jsx("div",{className:"mt-6 text-center",children:a.jsx("p",{className:"text-gray-400 text-sm",children:"Didn't receive the email? Check your spam folder or try resending."})})]})]}):a.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-[#0B1121] relative overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 neural-grid opacity-10"}),a.jsxs("div",{className:"absolute inset-0",children:[a.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 h-64 bg-primary-500/10 rounded-full blur-3xl animate-pulse"}),a.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-64 h-64 bg-primary-500/10 rounded-full blur-3xl animate-pulse animation-delay-2000"})]}),N&&a.jsxs("div",{className:`fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg flex items-center space-x-3 max-w-md ${N.type==="success"?"bg-green-500":N.type==="error"?"bg-red-500":"bg-blue-500"}`,children:[N.type==="success"?a.jsx(kt,{className:"w-5 h-5 flex-shrink-0"}):a.jsx(Et,{className:"w-5 h-5 flex-shrink-0"}),a.jsx("span",{className:"text-white text-sm",children:N.message})]}),a.jsxs("div",{className:"w-full max-w-6xl grid grid-cols-1 md:grid-cols-2 gap-8 p-4 relative",children:[a.jsxs("div",{className:"hidden md:flex flex-col items-center justify-center p-6 lg:p-8 relative overflow-hidden bg-[#151F32]/50 rounded-2xl border border-[#1E293B]",children:[a.jsx("div",{className:"absolute inset-0 neural-grid opacity-20"}),a.jsx("img",{src:"https://iqehkneolpesaqznkqjm.supabase.co/storage/v1/object/sign/assets/m6-motorway-trim-result.gif?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV83YmM1YjM5OS00ZDQwLTRiMDktOGE3Yi1kOWMxNzlkNjcyM2UiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJhc3NldHMvbTYtbW90b3J3YXktdHJpbS1yZXN1bHQuZ2lmIiwiaWF0IjoxNzU4NzMwMDYyLCJleHAiOjMxNTUzNTg3MzAwNjJ9.pKZVb8o3SVRrZ_N5WGWNcrRI59hyZ-tcNongThzTQs4",alt:"AI Traffic Analysis",className:"rounded-xl shadow-2xl relative z-10 animate-float object-cover h-[300px] lg:h-[400px] w-full max-w-full"}),a.jsxs("div",{className:"mt-6 lg:mt-8 text-center relative z-10 text-gray-300",children:[a.jsx("h2",{className:"text-xl lg:text-2xl font-bold mb-2 lg:mb-4",children:"Project 49"}),a.jsx("p",{className:"text-sm lg:text-base text-gray-400",children:"Road-User Behaviour Analysis Using AI & Computer Vision"})]})]}),a.jsxs("div",{className:"bg-[#151F32]/50 p-6 sm:p-8 rounded-2xl border border-[#1E293B] backdrop-blur-sm",children:[a.jsx("div",{className:"flex justify-between items-center mb-8",children:a.jsxs(Ke,{to:"/",className:"flex items-center text-gray-300 hover:text-white transition-colors",children:[a.jsx(Ea,{className:"w-5 h-5 mr-2"}),"Back to Home"]})}),a.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-2 text-white",children:t?"Create Account":"Welcome Back"}),a.jsx("p",{className:"text-sm sm:text-base text-gray-400 mb-6 sm:mb-8",children:t?"Join Project 49 to access advanced traffic analysis tools":"Sign in to your account to continue"}),a.jsxs("form",{onSubmit:A,className:"space-y-4 sm:space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email Address"}),a.jsx("input",{type:"email",name:"email",value:T.email,onChange:m,required:!0,className:"w-full px-3 sm:px-4 py-2 sm:py-3 bg-[#1E293B] border border-[#334155] rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-primary-400 focus:ring-2 focus:ring-primary-400/20 transition-all text-sm sm:text-base",placeholder:"Enter your email address"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:o?"text":"password",name:"password",value:T.password,onChange:m,required:!0,minLength:6,className:"w-full px-3 sm:px-4 py-2 sm:py-3 bg-[#1E293B] border border-[#334155] rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-primary-400 focus:ring-2 focus:ring-primary-400/20 transition-all pr-10 sm:pr-12 text-sm sm:text-base",placeholder:"Enter your password"}),a.jsx("button",{type:"button",onClick:()=>l(!o),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white transition-colors",children:o?a.jsx(As,{className:"w-5 h-5"}):a.jsx(Qr,{className:"w-5 h-5"})})]})]}),t&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Confirm Password"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:c?"text":"password",name:"confirmPassword",value:T.confirmPassword,onChange:m,required:!0,minLength:6,className:"w-full px-3 sm:px-4 py-2 sm:py-3 bg-[#1E293B] border border-[#334155] rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-primary-400 focus:ring-2 focus:ring-primary-400/20 transition-all pr-10 sm:pr-12 text-sm sm:text-base",placeholder:"Confirm your password"}),a.jsx("button",{type:"button",onClick:()=>d(!c),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white transition-colors",children:c?a.jsx(As,{className:"w-5 h-5"}):a.jsx(Qr,{className:"w-5 h-5"})})]})]}),a.jsx("div",{className:"flex justify-center",children:a.jsx(Zl,{ref:D,sitekey:"6Le0Q7wrAAAAAABAh2pXfgRl2nCAWyhvY40ns4Ye",onChange:h,theme:"dark"})}),a.jsx("button",{type:"submit",disabled:n||!u,className:"w-full py-2 sm:py-3 px-4 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-400/20 text-sm sm:text-base",children:n?a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),t?"Creating Account...":"Signing In..."]}):t?"Create Account":"Sign In"}),a.jsx("div",{className:"text-center",children:a.jsx("button",{type:"button",onClick:()=>{var g;s(!t),$({email:"",password:"",confirmPassword:""}),L(null),(g=D.current)==null||g.reset(),h(null)},className:"text-sm sm:text-base text-primary-400 hover:text-primary-300 transition-colors",children:t?"Already have an account? Sign in here":"Need an account? Create one here"})})]})]})]})]})}function Dr({title:r,onToggleSidebar:e,isSidebarOpen:t}){var l;const[s,n]=_.useState(null),[i,o]=_.useState(()=>ve()==="dark");return _.useEffect(()=>{fe.auth.getUser().then(({data:{user:d}})=>{n(d)});const{data:{subscription:c}}=fe.auth.onAuthStateChange((d,u)=>{n((u==null?void 0:u.user)??null)});return()=>c.unsubscribe()},[]),_.useEffect(()=>{const c=()=>{o(ve()==="dark")};return window.addEventListener("themeChanged",c),()=>window.removeEventListener("themeChanged",c)},[]),a.jsx("div",{className:`lg:hidden fixed top-0 left-0 right-0 z-50 px-4 py-3 border-b ${i?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200"}`,children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("button",{onClick:e,className:"p-1 sm:p-2",children:t?a.jsx(qe,{className:"w-6 h-6"}):a.jsx(bs,{className:"w-6 h-6"})}),a.jsx("span",{className:"text-lg sm:text-xl font-bold truncate px-4",children:r}),a.jsx("img",{src:((l=s==null?void 0:s.user_metadata)==null?void 0:l.avatar_url)||`https://ui-avatars.com/api/?name=${(s==null?void 0:s.email)||"User"}&background=0B1121&color=fff`,alt:"Profile",className:"w-8 h-8 sm:w-10 sm:h-10 rounded-full border-2 border-primary-500 flex-shrink-0"})]})})}const tc=[{icon:a.jsx(vs,{className:"w-5 h-5"}),label:"Home",path:"/"},{icon:a.jsx(vn,{className:"w-5 h-5"}),label:"Dashboard",path:"/dashboard"},{icon:a.jsx(wn,{className:"w-5 h-5"}),label:"Video Upload",path:"/upload"},{icon:a.jsx(ze,{className:"w-5 h-5"}),label:"Analytics",path:"/analytics"},{icon:a.jsx(ur,{className:"w-5 h-5"}),label:"Video Playback",path:"/playback"},{icon:a.jsx(_n,{className:"w-5 h-5"}),label:"Settings",path:"/settings"}];function rc({activePath:r,onCloseSidebar:e}){var l,c;const[t,s]=_.useState(null),[n,i]=_.useState(()=>ve()==="dark");_.useEffect(()=>{fe.auth.getUser().then(({data:{user:u}})=>{s(u)});const{data:{subscription:d}}=fe.auth.onAuthStateChange((u,h)=>{s((h==null?void 0:h.user)??null)});return()=>d.unsubscribe()},[]),_.useEffect(()=>{const d=()=>{i(ve()==="dark")};return window.addEventListener("themeChanged",d),()=>window.removeEventListener("themeChanged",d)},[]);const o=async()=>{try{await fe.auth.signOut()}catch(d){console.error("Error signing out:",d)}};return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:`p-4 sm:p-6 mt-14 lg:mt-0 border-b ${n?"border-[#1E293B]":"border-gray-200"}`,children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("img",{src:((l=t==null?void 0:t.user_metadata)==null?void 0:l.avatar_url)||`https://ui-avatars.com/api/?name=${(t==null?void 0:t.email)||"User"}&background=0B1121&color=fff`,alt:"Profile",className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full border-2 border-primary-500 flex-shrink-0"}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("h2",{className:"font-semibold text-sm sm:text-base truncate",children:((c=t==null?void 0:t.user_metadata)==null?void 0:c.full_name)||"User"}),a.jsx("p",{className:`text-xs sm:text-sm truncate ${n?"text-gray-400":"text-gray-600"}`,children:t==null?void 0:t.email})]})]})}),a.jsx("nav",{className:"p-3 sm:p-4 overflow-y-auto h-[calc(100vh-180px)] sm:h-[calc(100vh-200px)]",children:tc.map((d,u)=>a.jsxs(Ke,{to:d.path,onClick:e,className:`flex items-center gap-2 sm:gap-3 px-3 sm:px-4 py-2 sm:py-3 rounded-lg mb-1 transition-colors text-sm sm:text-base ${d.path===r?"bg-primary-500/20 text-primary-500":n?"hover:bg-[#1E293B] text-gray-400 hover:text-white":"hover:bg-gray-100 text-gray-600 hover:text-gray-900"}`,children:[d.icon,d.label]},u))}),a.jsx("div",{className:"absolute bottom-0 w-full p-3 sm:p-4",children:a.jsxs("button",{onClick:o,className:`flex items-center gap-2 w-full px-3 sm:px-4 py-2 rounded-lg text-red-500 transition-colors text-sm sm:text-base ${n?"hover:bg-red-500/10":"hover:bg-red-50"}`,children:[a.jsx(bn,{className:"w-5 h-5"}),"Sign Out"]})})]})}function Ir({activePath:r,isOpen:e,onClose:t}){const[s,n]=_.useState(()=>ve()==="dark");return _.useEffect(()=>{const i=()=>{n(ve()==="dark")};return window.addEventListener("themeChanged",i),()=>window.removeEventListener("themeChanged",i)},[]),a.jsxs(a.Fragment,{children:[a.jsx("aside",{className:`fixed top-0 left-0 h-full w-64 transform transition-transform duration-300 ease-in-out z-40 border-r ${s?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200"} ${e?"translate-x-0":"-translate-x-full"} lg:translate-x-0`,children:a.jsx(rc,{activePath:r,onCloseSidebar:t})}),e&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:t})]})}function he(r){const e=Object.prototype.toString.call(r);return r instanceof Date||typeof r=="object"&&e==="[object Date]"?new r.constructor(+r):typeof r=="number"||e==="[object Number]"||typeof r=="string"||e==="[object String]"?new Date(r):new Date(NaN)}function tt(r,e){return r instanceof Date?new r.constructor(e):new Date(e)}const oa=6048e5,sc=864e5,la=6e4,ca=36e5,or=43200,nn=1440;let nc={};function Zt(){return nc}function Gt(r,e){var l,c,d,u;const t=Zt(),s=(e==null?void 0:e.weekStartsOn)??((c=(l=e==null?void 0:e.locale)==null?void 0:l.options)==null?void 0:c.weekStartsOn)??t.weekStartsOn??((u=(d=t.locale)==null?void 0:d.options)==null?void 0:u.weekStartsOn)??0,n=he(r),i=n.getDay(),o=(i<s?7:0)+i-s;return n.setDate(n.getDate()-o),n.setHours(0,0,0,0),n}function pr(r){return Gt(r,{weekStartsOn:1})}function da(r){const e=he(r),t=e.getFullYear(),s=tt(r,0);s.setFullYear(t+1,0,4),s.setHours(0,0,0,0);const n=pr(s),i=tt(r,0);i.setFullYear(t,0,4),i.setHours(0,0,0,0);const o=pr(i);return e.getTime()>=n.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function an(r){const e=he(r);return e.setHours(0,0,0,0),e}function yr(r){const e=he(r),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+r-+t}function ac(r,e){const t=an(r),s=an(e),n=+t-yr(t),i=+s-yr(s);return Math.round((n-i)/sc)}function ic(r){const e=da(r),t=tt(r,0);return t.setFullYear(e,0,4),t.setHours(0,0,0,0),pr(t)}function dr(r,e){const t=he(r),s=he(e),n=t.getTime()-s.getTime();return n<0?-1:n>0?1:n}function oc(r){return tt(r,Date.now())}function lc(r){return r instanceof Date||typeof r=="object"&&Object.prototype.toString.call(r)==="[object Date]"}function cc(r){if(!lc(r)&&typeof r!="number")return!1;const e=he(r);return!isNaN(Number(e))}function dc(r,e){const t=he(r),s=he(e),n=t.getFullYear()-s.getFullYear(),i=t.getMonth()-s.getMonth();return n*12+i}function uc(r){return e=>{const s=(r?Math[r]:Math.trunc)(e);return s===0?0:s}}function hc(r,e){return+he(r)-+he(e)}function mc(r){const e=he(r);return e.setHours(23,59,59,999),e}function fc(r){const e=he(r),t=e.getMonth();return e.setFullYear(e.getFullYear(),t+1,0),e.setHours(23,59,59,999),e}function gc(r){const e=he(r);return+mc(e)==+fc(e)}function pc(r,e){const t=he(r),s=he(e),n=dr(t,s),i=Math.abs(dc(t,s));let o;if(i<1)o=0;else{t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-n*i);let l=dr(t,s)===-n;gc(he(r))&&i===1&&dr(r,s)===1&&(l=!1),o=n*(i-Number(l))}return o===0?0:o}function yc(r,e,t){const s=hc(r,e)/1e3;return uc(t==null?void 0:t.roundingMethod)(s)}function xc(r){const e=he(r),t=tt(r,0);return t.setFullYear(e.getFullYear(),0,1),t.setHours(0,0,0,0),t}const bc={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},vc=(r,e,t)=>{let s;const n=bc[r];return typeof n=="string"?s=n:e===1?s=n.one:s=n.other.replace("{{count}}",e.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+s:s+" ago":s};function Kr(r){return(e={})=>{const t=e.width?String(e.width):r.defaultWidth;return r.formats[t]||r.formats[r.defaultWidth]}}const wc={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},_c={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},jc={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Sc={date:Kr({formats:wc,defaultWidth:"full"}),time:Kr({formats:_c,defaultWidth:"full"}),dateTime:Kr({formats:jc,defaultWidth:"full"})},Nc={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},kc=(r,e,t,s)=>Nc[r];function Bt(r){return(e,t)=>{const s=t!=null&&t.context?String(t.context):"standalone";let n;if(s==="formatting"&&r.formattingValues){const o=r.defaultFormattingWidth||r.defaultWidth,l=t!=null&&t.width?String(t.width):o;n=r.formattingValues[l]||r.formattingValues[o]}else{const o=r.defaultWidth,l=t!=null&&t.width?String(t.width):r.defaultWidth;n=r.values[l]||r.values[o]}const i=r.argumentCallback?r.argumentCallback(e):e;return n[i]}}const Ec={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Tc={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Cc={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},$c={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Oc={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Rc={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Ac=(r,e)=>{const t=Number(r),s=t%100;if(s>20||s<10)switch(s%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},Pc={ordinalNumber:Ac,era:Bt({values:Ec,defaultWidth:"wide"}),quarter:Bt({values:Tc,defaultWidth:"wide",argumentCallback:r=>r-1}),month:Bt({values:Cc,defaultWidth:"wide"}),day:Bt({values:$c,defaultWidth:"wide"}),dayPeriod:Bt({values:Oc,defaultWidth:"wide",formattingValues:Rc,defaultFormattingWidth:"wide"})};function Mt(r){return(e,t={})=>{const s=t.width,n=s&&r.matchPatterns[s]||r.matchPatterns[r.defaultMatchWidth],i=e.match(n);if(!i)return null;const o=i[0],l=s&&r.parsePatterns[s]||r.parsePatterns[r.defaultParseWidth],c=Array.isArray(l)?Ic(l,h=>h.test(o)):Dc(l,h=>h.test(o));let d;d=r.valueCallback?r.valueCallback(c):c,d=t.valueCallback?t.valueCallback(d):d;const u=e.slice(o.length);return{value:d,rest:u}}}function Dc(r,e){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&e(r[t]))return t}function Ic(r,e){for(let t=0;t<r.length;t++)if(e(r[t]))return t}function Fc(r){return(e,t={})=>{const s=e.match(r.matchPattern);if(!s)return null;const n=s[0],i=e.match(r.parsePattern);if(!i)return null;let o=r.valueCallback?r.valueCallback(i[0]):i[0];o=t.valueCallback?t.valueCallback(o):o;const l=e.slice(n.length);return{value:o,rest:l}}}const Lc=/^(\d+)(th|st|nd|rd)?/i,Bc=/\d+/i,Mc={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Uc={any:[/^b/i,/^(a|c)/i]},Wc={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},qc={any:[/1/i,/2/i,/3/i,/4/i]},zc={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Vc={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Hc={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Kc={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Jc={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Gc={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Yc={ordinalNumber:Fc({matchPattern:Lc,parsePattern:Bc,valueCallback:r=>parseInt(r,10)}),era:Mt({matchPatterns:Mc,defaultMatchWidth:"wide",parsePatterns:Uc,defaultParseWidth:"any"}),quarter:Mt({matchPatterns:Wc,defaultMatchWidth:"wide",parsePatterns:qc,defaultParseWidth:"any",valueCallback:r=>r+1}),month:Mt({matchPatterns:zc,defaultMatchWidth:"wide",parsePatterns:Vc,defaultParseWidth:"any"}),day:Mt({matchPatterns:Hc,defaultMatchWidth:"wide",parsePatterns:Kc,defaultParseWidth:"any"}),dayPeriod:Mt({matchPatterns:Jc,defaultMatchWidth:"any",parsePatterns:Gc,defaultParseWidth:"any"})},ua={code:"en-US",formatDistance:vc,formatLong:Sc,formatRelative:kc,localize:Pc,match:Yc,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Qc(r){const e=he(r);return ac(e,xc(e))+1}function Xc(r){const e=he(r),t=+pr(e)-+ic(e);return Math.round(t/oa)+1}function ha(r,e){var u,h,f,p;const t=he(r),s=t.getFullYear(),n=Zt(),i=(e==null?void 0:e.firstWeekContainsDate)??((h=(u=e==null?void 0:e.locale)==null?void 0:u.options)==null?void 0:h.firstWeekContainsDate)??n.firstWeekContainsDate??((p=(f=n.locale)==null?void 0:f.options)==null?void 0:p.firstWeekContainsDate)??1,o=tt(r,0);o.setFullYear(s+1,0,i),o.setHours(0,0,0,0);const l=Gt(o,e),c=tt(r,0);c.setFullYear(s,0,i),c.setHours(0,0,0,0);const d=Gt(c,e);return t.getTime()>=l.getTime()?s+1:t.getTime()>=d.getTime()?s:s-1}function Zc(r,e){var l,c,d,u;const t=Zt(),s=(e==null?void 0:e.firstWeekContainsDate)??((c=(l=e==null?void 0:e.locale)==null?void 0:l.options)==null?void 0:c.firstWeekContainsDate)??t.firstWeekContainsDate??((u=(d=t.locale)==null?void 0:d.options)==null?void 0:u.firstWeekContainsDate)??1,n=ha(r,e),i=tt(r,0);return i.setFullYear(n,0,s),i.setHours(0,0,0,0),Gt(i,e)}function ed(r,e){const t=he(r),s=+Gt(t,e)-+Zc(t,e);return Math.round(s/oa)+1}function ce(r,e){const t=r<0?"-":"",s=Math.abs(r).toString().padStart(e,"0");return t+s}const Ye={y(r,e){const t=r.getFullYear(),s=t>0?t:1-t;return ce(e==="yy"?s%100:s,e.length)},M(r,e){const t=r.getMonth();return e==="M"?String(t+1):ce(t+1,2)},d(r,e){return ce(r.getDate(),e.length)},a(r,e){const t=r.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(r,e){return ce(r.getHours()%12||12,e.length)},H(r,e){return ce(r.getHours(),e.length)},m(r,e){return ce(r.getMinutes(),e.length)},s(r,e){return ce(r.getSeconds(),e.length)},S(r,e){const t=e.length,s=r.getMilliseconds(),n=Math.trunc(s*Math.pow(10,t-3));return ce(n,e.length)}},jt={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},on={G:function(r,e,t){const s=r.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(s,{width:"abbreviated"});case"GGGGG":return t.era(s,{width:"narrow"});case"GGGG":default:return t.era(s,{width:"wide"})}},y:function(r,e,t){if(e==="yo"){const s=r.getFullYear(),n=s>0?s:1-s;return t.ordinalNumber(n,{unit:"year"})}return Ye.y(r,e)},Y:function(r,e,t,s){const n=ha(r,s),i=n>0?n:1-n;if(e==="YY"){const o=i%100;return ce(o,2)}return e==="Yo"?t.ordinalNumber(i,{unit:"year"}):ce(i,e.length)},R:function(r,e){const t=da(r);return ce(t,e.length)},u:function(r,e){const t=r.getFullYear();return ce(t,e.length)},Q:function(r,e,t){const s=Math.ceil((r.getMonth()+1)/3);switch(e){case"Q":return String(s);case"QQ":return ce(s,2);case"Qo":return t.ordinalNumber(s,{unit:"quarter"});case"QQQ":return t.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(s,{width:"wide",context:"formatting"})}},q:function(r,e,t){const s=Math.ceil((r.getMonth()+1)/3);switch(e){case"q":return String(s);case"qq":return ce(s,2);case"qo":return t.ordinalNumber(s,{unit:"quarter"});case"qqq":return t.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(s,{width:"wide",context:"standalone"})}},M:function(r,e,t){const s=r.getMonth();switch(e){case"M":case"MM":return Ye.M(r,e);case"Mo":return t.ordinalNumber(s+1,{unit:"month"});case"MMM":return t.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(s,{width:"wide",context:"formatting"})}},L:function(r,e,t){const s=r.getMonth();switch(e){case"L":return String(s+1);case"LL":return ce(s+1,2);case"Lo":return t.ordinalNumber(s+1,{unit:"month"});case"LLL":return t.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(s,{width:"wide",context:"standalone"})}},w:function(r,e,t,s){const n=ed(r,s);return e==="wo"?t.ordinalNumber(n,{unit:"week"}):ce(n,e.length)},I:function(r,e,t){const s=Xc(r);return e==="Io"?t.ordinalNumber(s,{unit:"week"}):ce(s,e.length)},d:function(r,e,t){return e==="do"?t.ordinalNumber(r.getDate(),{unit:"date"}):Ye.d(r,e)},D:function(r,e,t){const s=Qc(r);return e==="Do"?t.ordinalNumber(s,{unit:"dayOfYear"}):ce(s,e.length)},E:function(r,e,t){const s=r.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(s,{width:"short",context:"formatting"});case"EEEE":default:return t.day(s,{width:"wide",context:"formatting"})}},e:function(r,e,t,s){const n=r.getDay(),i=(n-s.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return ce(i,2);case"eo":return t.ordinalNumber(i,{unit:"day"});case"eee":return t.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(n,{width:"short",context:"formatting"});case"eeee":default:return t.day(n,{width:"wide",context:"formatting"})}},c:function(r,e,t,s){const n=r.getDay(),i=(n-s.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return ce(i,e.length);case"co":return t.ordinalNumber(i,{unit:"day"});case"ccc":return t.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(n,{width:"narrow",context:"standalone"});case"cccccc":return t.day(n,{width:"short",context:"standalone"});case"cccc":default:return t.day(n,{width:"wide",context:"standalone"})}},i:function(r,e,t){const s=r.getDay(),n=s===0?7:s;switch(e){case"i":return String(n);case"ii":return ce(n,e.length);case"io":return t.ordinalNumber(n,{unit:"day"});case"iii":return t.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(s,{width:"short",context:"formatting"});case"iiii":default:return t.day(s,{width:"wide",context:"formatting"})}},a:function(r,e,t){const n=r.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(r,e,t){const s=r.getHours();let n;switch(s===12?n=jt.noon:s===0?n=jt.midnight:n=s/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(r,e,t){const s=r.getHours();let n;switch(s>=17?n=jt.evening:s>=12?n=jt.afternoon:s>=4?n=jt.morning:n=jt.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(r,e,t){if(e==="ho"){let s=r.getHours()%12;return s===0&&(s=12),t.ordinalNumber(s,{unit:"hour"})}return Ye.h(r,e)},H:function(r,e,t){return e==="Ho"?t.ordinalNumber(r.getHours(),{unit:"hour"}):Ye.H(r,e)},K:function(r,e,t){const s=r.getHours()%12;return e==="Ko"?t.ordinalNumber(s,{unit:"hour"}):ce(s,e.length)},k:function(r,e,t){let s=r.getHours();return s===0&&(s=24),e==="ko"?t.ordinalNumber(s,{unit:"hour"}):ce(s,e.length)},m:function(r,e,t){return e==="mo"?t.ordinalNumber(r.getMinutes(),{unit:"minute"}):Ye.m(r,e)},s:function(r,e,t){return e==="so"?t.ordinalNumber(r.getSeconds(),{unit:"second"}):Ye.s(r,e)},S:function(r,e){return Ye.S(r,e)},X:function(r,e,t){const s=r.getTimezoneOffset();if(s===0)return"Z";switch(e){case"X":return cn(s);case"XXXX":case"XX":return ct(s);case"XXXXX":case"XXX":default:return ct(s,":")}},x:function(r,e,t){const s=r.getTimezoneOffset();switch(e){case"x":return cn(s);case"xxxx":case"xx":return ct(s);case"xxxxx":case"xxx":default:return ct(s,":")}},O:function(r,e,t){const s=r.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+ln(s,":");case"OOOO":default:return"GMT"+ct(s,":")}},z:function(r,e,t){const s=r.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+ln(s,":");case"zzzz":default:return"GMT"+ct(s,":")}},t:function(r,e,t){const s=Math.trunc(r.getTime()/1e3);return ce(s,e.length)},T:function(r,e,t){const s=r.getTime();return ce(s,e.length)}};function ln(r,e=""){const t=r>0?"-":"+",s=Math.abs(r),n=Math.trunc(s/60),i=s%60;return i===0?t+String(n):t+String(n)+e+ce(i,2)}function cn(r,e){return r%60===0?(r>0?"-":"+")+ce(Math.abs(r)/60,2):ct(r,e)}function ct(r,e=""){const t=r>0?"-":"+",s=Math.abs(r),n=ce(Math.trunc(s/60),2),i=ce(s%60,2);return t+n+e+i}const dn=(r,e)=>{switch(r){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},ma=(r,e)=>{switch(r){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},td=(r,e)=>{const t=r.match(/(P+)(p+)?/)||[],s=t[1],n=t[2];if(!n)return dn(r,e);let i;switch(s){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",dn(s,e)).replace("{{time}}",ma(n,e))},rd={p:ma,P:td},sd=/^D+$/,nd=/^Y+$/,ad=["D","DD","YY","YYYY"];function id(r){return sd.test(r)}function od(r){return nd.test(r)}function ld(r,e,t){const s=cd(r,e,t);if(console.warn(s),ad.includes(r))throw new RangeError(s)}function cd(r,e,t){const s=r[0]==="Y"?"years":"days of the month";return`Use \`${r.toLowerCase()}\` instead of \`${r}\` (in \`${e}\`) for formatting ${s} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const dd=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ud=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,hd=/^'([^]*?)'?$/,md=/''/g,fd=/[a-zA-Z]/;function Ht(r,e,t){var u,h,f,p;const s=Zt(),n=s.locale??ua,i=s.firstWeekContainsDate??((h=(u=s.locale)==null?void 0:u.options)==null?void 0:h.firstWeekContainsDate)??1,o=s.weekStartsOn??((p=(f=s.locale)==null?void 0:f.options)==null?void 0:p.weekStartsOn)??0,l=he(r);if(!cc(l))throw new RangeError("Invalid time value");let c=e.match(ud).map(x=>{const j=x[0];if(j==="p"||j==="P"){const N=rd[j];return N(x,n.formatLong)}return x}).join("").match(dd).map(x=>{if(x==="''")return{isToken:!1,value:"'"};const j=x[0];if(j==="'")return{isToken:!1,value:gd(x)};if(on[j])return{isToken:!0,value:x};if(j.match(fd))throw new RangeError("Format string contains an unescaped latin alphabet character `"+j+"`");return{isToken:!1,value:x}});n.localize.preprocessor&&(c=n.localize.preprocessor(l,c));const d={firstWeekContainsDate:i,weekStartsOn:o,locale:n};return c.map(x=>{if(!x.isToken)return x.value;const j=x.value;(od(j)||id(j))&&ld(j,e,String(r));const N=on[j[0]];return N(l,j,n.localize,d)}).join("")}function gd(r){const e=r.match(hd);return e?e[1].replace(md,"'"):r}function pd(r,e,t){const s=Zt(),n=(t==null?void 0:t.locale)??s.locale??ua,i=2520,o=dr(r,e);if(isNaN(o))throw new RangeError("Invalid time value");const l=Object.assign({},t,{addSuffix:t==null?void 0:t.addSuffix,comparison:o});let c,d;o>0?(c=he(e),d=he(r)):(c=he(r),d=he(e));const u=yc(d,c),h=(yr(d)-yr(c))/1e3,f=Math.round((u-h)/60);let p;if(f<2)return t!=null&&t.includeSeconds?u<5?n.formatDistance("lessThanXSeconds",5,l):u<10?n.formatDistance("lessThanXSeconds",10,l):u<20?n.formatDistance("lessThanXSeconds",20,l):u<40?n.formatDistance("halfAMinute",0,l):u<60?n.formatDistance("lessThanXMinutes",1,l):n.formatDistance("xMinutes",1,l):f===0?n.formatDistance("lessThanXMinutes",1,l):n.formatDistance("xMinutes",f,l);if(f<45)return n.formatDistance("xMinutes",f,l);if(f<90)return n.formatDistance("aboutXHours",1,l);if(f<nn){const x=Math.round(f/60);return n.formatDistance("aboutXHours",x,l)}else{if(f<i)return n.formatDistance("xDays",1,l);if(f<or){const x=Math.round(f/nn);return n.formatDistance("xDays",x,l)}else if(f<or*2)return p=Math.round(f/or),n.formatDistance("aboutXMonths",p,l)}if(p=pc(d,c),p<12){const x=Math.round(f/or);return n.formatDistance("xMonths",x,l)}else{const x=p%12,j=Math.trunc(p/12);return x<3?n.formatDistance("aboutXYears",j,l):x<9?n.formatDistance("overXYears",j,l):n.formatDistance("almostXYears",j+1,l)}}function yd(r,e){return pd(r,oc(r),e)}function $t(r,e){const s=wd(r);let n;if(s.date){const c=_d(s.date,2);n=jd(c.restDateString,c.year)}if(!n||isNaN(n.getTime()))return new Date(NaN);const i=n.getTime();let o=0,l;if(s.time&&(o=Sd(s.time),isNaN(o)))return new Date(NaN);if(s.timezone){if(l=Nd(s.timezone),isNaN(l))return new Date(NaN)}else{const c=new Date(i+o),d=new Date(0);return d.setFullYear(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),d.setHours(c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds(),c.getUTCMilliseconds()),d}return new Date(i+o+l)}const lr={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},xd=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,bd=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,vd=/^([+-])(\d{2})(?::?(\d{2}))?$/;function wd(r){const e={},t=r.split(lr.dateTimeDelimiter);let s;if(t.length>2)return e;if(/:/.test(t[0])?s=t[0]:(e.date=t[0],s=t[1],lr.timeZoneDelimiter.test(e.date)&&(e.date=r.split(lr.timeZoneDelimiter)[0],s=r.substr(e.date.length,r.length))),s){const n=lr.timezone.exec(s);n?(e.time=s.replace(n[1],""),e.timezone=n[1]):e.time=s}return e}function _d(r,e){const t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),s=r.match(t);if(!s)return{year:NaN,restDateString:""};const n=s[1]?parseInt(s[1]):null,i=s[2]?parseInt(s[2]):null;return{year:i===null?n:i*100,restDateString:r.slice((s[1]||s[2]).length)}}function jd(r,e){if(e===null)return new Date(NaN);const t=r.match(xd);if(!t)return new Date(NaN);const s=!!t[4],n=Ut(t[1]),i=Ut(t[2])-1,o=Ut(t[3]),l=Ut(t[4]),c=Ut(t[5])-1;if(s)return $d(e,l,c)?kd(e,l,c):new Date(NaN);{const d=new Date(0);return!Td(e,i,o)||!Cd(e,n)?new Date(NaN):(d.setUTCFullYear(e,i,Math.max(n,o)),d)}}function Ut(r){return r?parseInt(r):1}function Sd(r){const e=r.match(bd);if(!e)return NaN;const t=Jr(e[1]),s=Jr(e[2]),n=Jr(e[3]);return Od(t,s,n)?t*ca+s*la+n*1e3:NaN}function Jr(r){return r&&parseFloat(r.replace(",","."))||0}function Nd(r){if(r==="Z")return 0;const e=r.match(vd);if(!e)return 0;const t=e[1]==="+"?-1:1,s=parseInt(e[2]),n=e[3]&&parseInt(e[3])||0;return Rd(s,n)?t*(s*ca+n*la):NaN}function kd(r,e,t){const s=new Date(0);s.setUTCFullYear(r,0,4);const n=s.getUTCDay()||7,i=(e-1)*7+t+1-n;return s.setUTCDate(s.getUTCDate()+i),s}const Ed=[31,null,31,30,31,30,31,31,30,31,30,31];function fa(r){return r%400===0||r%4===0&&r%100!==0}function Td(r,e,t){return e>=0&&e<=11&&t>=1&&t<=(Ed[e]||(fa(r)?29:28))}function Cd(r,e){return e>=1&&e<=(fa(r)?366:365)}function $d(r,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function Od(r,e,t){return r===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&r>=0&&r<25}function Rd(r,e){return e>=0&&e<=59}var Ad={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/(function(r,e){((t,s)=>{r.exports=s()})(Re,function t(){var s=typeof self<"u"?self:typeof window<"u"?window:s!==void 0?s:{},n,i=!s.document&&!!s.postMessage,o=s.IS_PAPA_WORKER||!1,l={},c=0,d={};function u(m){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(g){var v=V(g);v.chunkSize=parseInt(v.chunkSize),g.step||g.chunk||(v.chunkSize=null),this._handle=new j(v),(this._handle.streamer=this)._config=v}).call(this,m),this.parseChunk=function(g,v){var I=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<I){let W=this._config.newline;W||(R=this._config.quoteChar||'"',W=this._handle.guessLineEndings(g,R)),g=[...g.split(W).slice(I)].join(W)}this.isFirstChunk&&A(this._config.beforeFirstChunk)&&(R=this._config.beforeFirstChunk(g))!==void 0&&(g=R),this.isFirstChunk=!1,this._halted=!1;var I=this._partialLine+g,R=(this._partialLine="",this._handle.parse(I,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(g=R.meta.cursor,I=(this._finished||(this._partialLine=I.substring(g-this._baseIndex),this._baseIndex=g),R&&R.data&&(this._rowCount+=R.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),o)s.postMessage({results:R,workerId:d.WORKER_ID,finished:I});else if(A(this._config.chunk)&&!v){if(this._config.chunk(R,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=R=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(R.data),this._completeResults.errors=this._completeResults.errors.concat(R.errors),this._completeResults.meta=R.meta),this._completed||!I||!A(this._config.complete)||R&&R.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),I||R&&R.meta.paused||this._nextChunk(),R}this._halted=!0},this._sendError=function(g){A(this._config.error)?this._config.error(g):o&&this._config.error&&s.postMessage({workerId:d.WORKER_ID,error:g,finished:!1})}}function h(m){var g;(m=m||{}).chunkSize||(m.chunkSize=d.RemoteChunkSize),u.call(this,m),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(v){this._input=v,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(g=new XMLHttpRequest,this._config.withCredentials&&(g.withCredentials=this._config.withCredentials),i||(g.onload=U(this._chunkLoaded,this),g.onerror=U(this._chunkError,this)),g.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var v,I=this._config.downloadRequestHeaders;for(v in I)g.setRequestHeader(v,I[v])}var R;this._config.chunkSize&&(R=this._start+this._config.chunkSize-1,g.setRequestHeader("Range","bytes="+this._start+"-"+R));try{g.send(this._config.downloadRequestBody)}catch(W){this._chunkError(W.message)}i&&g.status===0&&this._chunkError()}},this._chunkLoaded=function(){g.readyState===4&&(g.status<200||400<=g.status?this._chunkError():(this._start+=this._config.chunkSize||g.responseText.length,this._finished=!this._config.chunkSize||this._start>=(v=>(v=v.getResponseHeader("Content-Range"))!==null?parseInt(v.substring(v.lastIndexOf("/")+1)):-1)(g),this.parseChunk(g.responseText)))},this._chunkError=function(v){v=g.statusText||v,this._sendError(new Error(v))}}function f(m){(m=m||{}).chunkSize||(m.chunkSize=d.LocalChunkSize),u.call(this,m);var g,v,I=typeof FileReader<"u";this.stream=function(R){this._input=R,v=R.slice||R.webkitSlice||R.mozSlice,I?((g=new FileReader).onload=U(this._chunkLoaded,this),g.onerror=U(this._chunkError,this)):g=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var R=this._input,W=(this._config.chunkSize&&(W=Math.min(this._start+this._config.chunkSize,this._input.size),R=v.call(R,this._start,W)),g.readAsText(R,this._config.encoding));I||this._chunkLoaded({target:{result:W}})},this._chunkLoaded=function(R){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(R.target.result)},this._chunkError=function(){this._sendError(g.error)}}function p(m){var g;u.call(this,m=m||{}),this.stream=function(v){return g=v,this._nextChunk()},this._nextChunk=function(){var v,I;if(!this._finished)return v=this._config.chunkSize,g=v?(I=g.substring(0,v),g.substring(v)):(I=g,""),this._finished=!g,this.parseChunk(I)}}function x(m){u.call(this,m=m||{});var g=[],v=!0,I=!1;this.pause=function(){u.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){u.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(R){this._input=R,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){I&&g.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),g.length?this.parseChunk(g.shift()):v=!0},this._streamData=U(function(R){try{g.push(typeof R=="string"?R:R.toString(this._config.encoding)),v&&(v=!1,this._checkIsFinished(),this.parseChunk(g.shift()))}catch(W){this._streamError(W)}},this),this._streamError=U(function(R){this._streamCleanUp(),this._sendError(R)},this),this._streamEnd=U(function(){this._streamCleanUp(),I=!0,this._streamData("")},this),this._streamCleanUp=U(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function j(m){var g,v,I,R,W=Math.pow(2,53),re=-W,le=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,ie=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,Q=this,P=0,O=0,J=!1,y=!1,k=[],C={data:[],errors:[],meta:{}};function Z(H){return m.skipEmptyLines==="greedy"?H.join("").trim()==="":H.length===1&&H[0].length===0}function b(){if(C&&I&&(F("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+d.DefaultDelimiter+"'"),I=!1),m.skipEmptyLines&&(C.data=C.data.filter(function(q){return!Z(q)})),w()){let q=function(ae,z){A(m.transformHeader)&&(ae=m.transformHeader(ae,z)),k.push(ae)};if(C)if(Array.isArray(C.data[0])){for(var H=0;w()&&H<C.data.length;H++)C.data[H].forEach(q);C.data.splice(0,1)}else C.data.forEach(q)}function G(q,ae){for(var z=m.header?{}:[],K=0;K<q.length;K++){var B=K,se=q[K],se=((we,S)=>(M=>(m.dynamicTypingFunction&&m.dynamicTyping[M]===void 0&&(m.dynamicTyping[M]=m.dynamicTypingFunction(M)),(m.dynamicTyping[M]||m.dynamicTyping)===!0))(we)?S==="true"||S==="TRUE"||S!=="false"&&S!=="FALSE"&&((M=>{if(le.test(M)&&(M=parseFloat(M),re<M&&M<W))return 1})(S)?parseFloat(S):ie.test(S)?new Date(S):S===""?null:S):S)(B=m.header?K>=k.length?"__parsed_extra":k[K]:B,se=m.transform?m.transform(se,B):se);B==="__parsed_extra"?(z[B]=z[B]||[],z[B].push(se)):z[B]=se}return m.header&&(K>k.length?F("FieldMismatch","TooManyFields","Too many fields: expected "+k.length+" fields but parsed "+K,O+ae):K<k.length&&F("FieldMismatch","TooFewFields","Too few fields: expected "+k.length+" fields but parsed "+K,O+ae)),z}var ee;C&&(m.header||m.dynamicTyping||m.transform)&&(ee=1,!C.data.length||Array.isArray(C.data[0])?(C.data=C.data.map(G),ee=C.data.length):C.data=G(C.data,0),m.header&&C.meta&&(C.meta.fields=k),O+=ee)}function w(){return m.header&&k.length===0}function F(H,G,ee,q){H={type:H,code:G,message:ee},q!==void 0&&(H.row=q),C.errors.push(H)}A(m.step)&&(R=m.step,m.step=function(H){C=H,w()?b():(b(),C.data.length!==0&&(P+=H.data.length,m.preview&&P>m.preview?v.abort():(C.data=C.data[0],R(C,Q))))}),this.parse=function(H,G,ee){var q=m.quoteChar||'"',q=(m.newline||(m.newline=this.guessLineEndings(H,q)),I=!1,m.delimiter?A(m.delimiter)&&(m.delimiter=m.delimiter(H),C.meta.delimiter=m.delimiter):((q=((ae,z,K,B,se)=>{var we,S,M,ne;se=se||[",","	","|",";",d.RECORD_SEP,d.UNIT_SEP];for(var ue=0;ue<se.length;ue++){for(var ke,Pe=se[ue],_e=0,$e=0,pe=0,Se=(M=void 0,new L({comments:B,delimiter:Pe,newline:z,preview:10}).parse(ae)),Ie=0;Ie<Se.data.length;Ie++)K&&Z(Se.data[Ie])?pe++:(ke=Se.data[Ie].length,$e+=ke,M===void 0?M=ke:0<ke&&(_e+=Math.abs(ke-M),M=ke));0<Se.data.length&&($e/=Se.data.length-pe),(S===void 0||_e<=S)&&(ne===void 0||ne<$e)&&1.99<$e&&(S=_e,we=Pe,ne=$e)}return{successful:!!(m.delimiter=we),bestDelimiter:we}})(H,m.newline,m.skipEmptyLines,m.comments,m.delimitersToGuess)).successful?m.delimiter=q.bestDelimiter:(I=!0,m.delimiter=d.DefaultDelimiter),C.meta.delimiter=m.delimiter),V(m));return m.preview&&m.header&&q.preview++,g=H,v=new L(q),C=v.parse(g,G,ee),b(),J?{meta:{paused:!0}}:C||{meta:{paused:!1}}},this.paused=function(){return J},this.pause=function(){J=!0,v.abort(),g=A(m.chunk)?"":g.substring(v.getCharIndex())},this.resume=function(){Q.streamer._halted?(J=!1,Q.streamer.parseChunk(g,!0)):setTimeout(Q.resume,3)},this.aborted=function(){return y},this.abort=function(){y=!0,v.abort(),C.meta.aborted=!0,A(m.complete)&&m.complete(C),g=""},this.guessLineEndings=function(ae,q){ae=ae.substring(0,1048576);var q=new RegExp(N(q)+"([^]*?)"+N(q),"gm"),ee=(ae=ae.replace(q,"")).split("\r"),q=ae.split(`
`),ae=1<q.length&&q[0].length<ee[0].length;if(ee.length===1||ae)return`
`;for(var z=0,K=0;K<ee.length;K++)ee[K][0]===`
`&&z++;return z>=ee.length/2?`\r
`:"\r"}}function N(m){return m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function L(m){var g=(m=m||{}).delimiter,v=m.newline,I=m.comments,R=m.step,W=m.preview,re=m.fastMode,le=null,ie=!1,Q=m.quoteChar==null?'"':m.quoteChar,P=Q;if(m.escapeChar!==void 0&&(P=m.escapeChar),(typeof g!="string"||-1<d.BAD_DELIMITERS.indexOf(g))&&(g=","),I===g)throw new Error("Comment character same as delimiter");I===!0?I="#":(typeof I!="string"||-1<d.BAD_DELIMITERS.indexOf(I))&&(I=!1),v!==`
`&&v!=="\r"&&v!==`\r
`&&(v=`
`);var O=0,J=!1;this.parse=function(y,k,C){if(typeof y!="string")throw new Error("Input must be a string");var Z=y.length,b=g.length,w=v.length,F=I.length,H=A(R),G=[],ee=[],q=[],ae=O=0;if(!y)return _e();if(re||re!==!1&&y.indexOf(Q)===-1){for(var z=y.split(v),K=0;K<z.length;K++){if(q=z[K],O+=q.length,K!==z.length-1)O+=v.length;else if(C)return _e();if(!I||q.substring(0,F)!==I){if(H){if(G=[],ne(q.split(g)),$e(),J)return _e()}else ne(q.split(g));if(W&&W<=K)return G=G.slice(0,W),_e(!0)}}return _e()}for(var B=y.indexOf(g,O),se=y.indexOf(v,O),we=new RegExp(N(P)+N(Q),"g"),S=y.indexOf(Q,O);;)if(y[O]===Q)for(S=O,O++;;){if((S=y.indexOf(Q,S+1))===-1)return C||ee.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:G.length,index:O}),ke();if(S===Z-1)return ke(y.substring(O,S).replace(we,Q));if(Q===P&&y[S+1]===P)S++;else if(Q===P||S===0||y[S-1]!==P){B!==-1&&B<S+1&&(B=y.indexOf(g,S+1));var M=ue((se=se!==-1&&se<S+1?y.indexOf(v,S+1):se)===-1?B:Math.min(B,se));if(y.substr(S+1+M,b)===g){q.push(y.substring(O,S).replace(we,Q)),y[O=S+1+M+b]!==Q&&(S=y.indexOf(Q,O)),B=y.indexOf(g,O),se=y.indexOf(v,O);break}if(M=ue(se),y.substring(S+1+M,S+1+M+w)===v){if(q.push(y.substring(O,S).replace(we,Q)),Pe(S+1+M+w),B=y.indexOf(g,O),S=y.indexOf(Q,O),H&&($e(),J))return _e();if(W&&G.length>=W)return _e(!0);break}ee.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:G.length,index:O}),S++}}else if(I&&q.length===0&&y.substring(O,O+F)===I){if(se===-1)return _e();O=se+w,se=y.indexOf(v,O),B=y.indexOf(g,O)}else if(B!==-1&&(B<se||se===-1))q.push(y.substring(O,B)),O=B+b,B=y.indexOf(g,O);else{if(se===-1)break;if(q.push(y.substring(O,se)),Pe(se+w),H&&($e(),J))return _e();if(W&&G.length>=W)return _e(!0)}return ke();function ne(pe){G.push(pe),ae=O}function ue(pe){var Se=0;return Se=pe!==-1&&(pe=y.substring(S+1,pe))&&pe.trim()===""?pe.length:Se}function ke(pe){return C||(pe===void 0&&(pe=y.substring(O)),q.push(pe),O=Z,ne(q),H&&$e()),_e()}function Pe(pe){O=pe,ne(q),q=[],se=y.indexOf(v,O)}function _e(pe){if(m.header&&!k&&G.length&&!ie){var Se=G[0],Ie=Object.create(null),ft=new Set(Se);let Dt=!1;for(let Me=0;Me<Se.length;Me++){let E=Se[Me];if(Ie[E=A(m.transformHeader)?m.transformHeader(E,Me):E]){let X,oe=Ie[E];for(;X=E+"_"+oe,oe++,ft.has(X););ft.add(X),Se[Me]=X,Ie[E]++,Dt=!0,(le=le===null?{}:le)[X]=E}else Ie[E]=1,Se[Me]=E;ft.add(E)}Dt&&console.warn("Duplicate headers found and renamed."),ie=!0}return{data:G,errors:ee,meta:{delimiter:g,linebreak:v,aborted:J,truncated:!!pe,cursor:ae+(k||0),renamedHeaders:le}}}function $e(){R(_e()),G=[],ee=[]}},this.abort=function(){J=!0},this.getCharIndex=function(){return O}}function T(m){var g=m.data,v=l[g.workerId],I=!1;if(g.error)v.userError(g.error,g.file);else if(g.results&&g.results.data){var R={abort:function(){I=!0,$(g.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:D,resume:D};if(A(v.userStep)){for(var W=0;W<g.results.data.length&&(v.userStep({data:g.results.data[W],errors:g.results.errors,meta:g.results.meta},R),!I);W++);delete g.results}else A(v.userChunk)&&(v.userChunk(g.results,R,g.file),delete g.results)}g.finished&&!I&&$(g.workerId,g.results)}function $(m,g){var v=l[m];A(v.userComplete)&&v.userComplete(g),v.terminate(),delete l[m]}function D(){throw new Error("Not implemented.")}function V(m){if(typeof m!="object"||m===null)return m;var g,v=Array.isArray(m)?[]:{};for(g in m)v[g]=V(m[g]);return v}function U(m,g){return function(){m.apply(g,arguments)}}function A(m){return typeof m=="function"}return d.parse=function(m,g){var v=(g=g||{}).dynamicTyping||!1;if(A(v)&&(g.dynamicTypingFunction=v,v={}),g.dynamicTyping=v,g.transform=!!A(g.transform)&&g.transform,!g.worker||!d.WORKERS_SUPPORTED)return v=null,d.NODE_STREAM_INPUT,typeof m=="string"?(m=(I=>I.charCodeAt(0)!==65279?I:I.slice(1))(m),v=new(g.download?h:p)(g)):m.readable===!0&&A(m.read)&&A(m.on)?v=new x(g):(s.File&&m instanceof File||m instanceof Object)&&(v=new f(g)),v.stream(m);(v=(()=>{var I;return!!d.WORKERS_SUPPORTED&&(I=(()=>{var R=s.URL||s.webkitURL||null,W=t.toString();return d.BLOB_URL||(d.BLOB_URL=R.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",W,")();"],{type:"text/javascript"})))})(),(I=new s.Worker(I)).onmessage=T,I.id=c++,l[I.id]=I)})()).userStep=g.step,v.userChunk=g.chunk,v.userComplete=g.complete,v.userError=g.error,g.step=A(g.step),g.chunk=A(g.chunk),g.complete=A(g.complete),g.error=A(g.error),delete g.worker,v.postMessage({input:m,config:g,workerId:v.id})},d.unparse=function(m,g){var v=!1,I=!0,R=",",W=`\r
`,re='"',le=re+re,ie=!1,Q=null,P=!1,O=((()=>{if(typeof g=="object"){if(typeof g.delimiter!="string"||d.BAD_DELIMITERS.filter(function(k){return g.delimiter.indexOf(k)!==-1}).length||(R=g.delimiter),typeof g.quotes!="boolean"&&typeof g.quotes!="function"&&!Array.isArray(g.quotes)||(v=g.quotes),typeof g.skipEmptyLines!="boolean"&&typeof g.skipEmptyLines!="string"||(ie=g.skipEmptyLines),typeof g.newline=="string"&&(W=g.newline),typeof g.quoteChar=="string"&&(re=g.quoteChar),typeof g.header=="boolean"&&(I=g.header),Array.isArray(g.columns)){if(g.columns.length===0)throw new Error("Option columns is empty");Q=g.columns}g.escapeChar!==void 0&&(le=g.escapeChar+re),g.escapeFormulae instanceof RegExp?P=g.escapeFormulae:typeof g.escapeFormulae=="boolean"&&g.escapeFormulae&&(P=/^[=+\-@\t\r].*$/)}})(),new RegExp(N(re),"g"));if(typeof m=="string"&&(m=JSON.parse(m)),Array.isArray(m)){if(!m.length||Array.isArray(m[0]))return J(null,m,ie);if(typeof m[0]=="object")return J(Q||Object.keys(m[0]),m,ie)}else if(typeof m=="object")return typeof m.data=="string"&&(m.data=JSON.parse(m.data)),Array.isArray(m.data)&&(m.fields||(m.fields=m.meta&&m.meta.fields||Q),m.fields||(m.fields=Array.isArray(m.data[0])?m.fields:typeof m.data[0]=="object"?Object.keys(m.data[0]):[]),Array.isArray(m.data[0])||typeof m.data[0]=="object"||(m.data=[m.data])),J(m.fields||[],m.data||[],ie);throw new Error("Unable to serialize unrecognized input");function J(k,C,Z){var b="",w=(typeof k=="string"&&(k=JSON.parse(k)),typeof C=="string"&&(C=JSON.parse(C)),Array.isArray(k)&&0<k.length),F=!Array.isArray(C[0]);if(w&&I){for(var H=0;H<k.length;H++)0<H&&(b+=R),b+=y(k[H],H);0<C.length&&(b+=W)}for(var G=0;G<C.length;G++){var ee=(w?k:C[G]).length,q=!1,ae=w?Object.keys(C[G]).length===0:C[G].length===0;if(Z&&!w&&(q=Z==="greedy"?C[G].join("").trim()==="":C[G].length===1&&C[G][0].length===0),Z==="greedy"&&w){for(var z=[],K=0;K<ee;K++){var B=F?k[K]:K;z.push(C[G][B])}q=z.join("").trim()===""}if(!q){for(var se=0;se<ee;se++){0<se&&!ae&&(b+=R);var we=w&&F?k[se]:se;b+=y(C[G][we],se)}G<C.length-1&&(!Z||0<ee&&!ae)&&(b+=W)}}return b}function y(k,C){var Z,b;return k==null?"":k.constructor===Date?JSON.stringify(k).slice(1,25):(b=!1,P&&typeof k=="string"&&P.test(k)&&(k="'"+k,b=!0),Z=k.toString().replace(O,le),(b=b||v===!0||typeof v=="function"&&v(k,C)||Array.isArray(v)&&v[C]||((w,F)=>{for(var H=0;H<F.length;H++)if(-1<w.indexOf(F[H]))return!0;return!1})(Z,d.BAD_DELIMITERS)||-1<Z.indexOf(R)||Z.charAt(0)===" "||Z.charAt(Z.length-1)===" ")?re+Z+re:Z)}},d.RECORD_SEP="",d.UNIT_SEP="",d.BYTE_ORDER_MARK="\uFEFF",d.BAD_DELIMITERS=["\r",`
`,'"',d.BYTE_ORDER_MARK],d.WORKERS_SUPPORTED=!i&&!!s.Worker,d.NODE_STREAM_INPUT=1,d.LocalChunkSize=10485760,d.RemoteChunkSize=5242880,d.DefaultDelimiter=",",d.Parser=L,d.ParserHandle=j,d.NetworkStreamer=h,d.FileStreamer=f,d.StringStreamer=p,d.ReadableStreamStreamer=x,s.jQuery&&((n=s.jQuery).fn.parse=function(m){var g=m.config||{},v=[];return this.each(function(W){if(!(n(this).prop("tagName").toUpperCase()==="INPUT"&&n(this).attr("type").toLowerCase()==="file"&&s.FileReader)||!this.files||this.files.length===0)return!0;for(var re=0;re<this.files.length;re++)v.push({file:this.files[re],inputElem:this,instanceConfig:n.extend({},g)})}),I(),this;function I(){if(v.length===0)A(m.complete)&&m.complete();else{var W,re,le,ie,Q=v[0];if(A(m.before)){var P=m.before(Q.file,Q.inputElem);if(typeof P=="object"){if(P.action==="abort")return W="AbortError",re=Q.file,le=Q.inputElem,ie=P.reason,void(A(m.error)&&m.error({name:W},re,le,ie));if(P.action==="skip")return void R();typeof P.config=="object"&&(Q.instanceConfig=n.extend(Q.instanceConfig,P.config))}else if(P==="skip")return void R()}var O=Q.instanceConfig.complete;Q.instanceConfig.complete=function(J){A(O)&&O(J,Q.file,Q.inputElem),R()},d.parse(Q.file,Q.instanceConfig)}}function R(){v.splice(0,1),I()}}),o&&(s.onmessage=function(m){m=m.data,d.WORKER_ID===void 0&&m&&(d.WORKER_ID=m.workerId),typeof m.input=="string"?s.postMessage({workerId:d.WORKER_ID,results:d.parse(m.input,m.config),finished:!0}):(s.File&&m.input instanceof File||m.input instanceof Object)&&(m=d.parse(m.input,m.config))&&s.postMessage({workerId:d.WORKER_ID,results:m,finished:!0})}),(h.prototype=Object.create(u.prototype)).constructor=h,(f.prototype=Object.create(u.prototype)).constructor=f,(p.prototype=Object.create(p.prototype)).constructor=p,(x.prototype=Object.create(u.prototype)).constructor=x,d})})(Ad);Xe.register(...jn);const un=async(r={})=>{try{let e="/data/videos/filter";const t=new URLSearchParams;return r.dateFrom&&t.set("date_from",r.dateFrom),r.dateTo&&t.set("date_to",r.dateTo),r.orderBy&&t.set("order_by",r.orderBy),r.orderDesc&&t.set("order_desc",r.orderDesc),t.toString()&&(e+="?"+t.toString()),await Os(e)}catch(e){throw console.error("Error fetching filtered videos:",e),e}},Pd=async r=>{try{return await Os(`/data/summary/by-video/${r}`)}catch(e){throw console.error("Error fetching video summary:",e),e}},Dd=async r=>{try{const e=await fetch(`${er}/data/videos/${r}`,{method:"DELETE"}),t=await e.text(),s=t?JSON.parse(t):{};if(!e.ok||s.status!=="success")throw new Error(s.error||e.statusText);return s}catch(e){throw console.error("Error deleting video:",e),e}},Id=r=>`${er}/data/video/${r}`,ot=async(r,e,t={},s=400,n=400)=>new Promise(i=>{var o;try{const l=document.createElement("canvas");l.width=s,l.height=n;const c=l.getContext("2d");if(!c){console.warn("Could not get canvas context for chart"),i(null);return}const d=new Xe(c,{type:r,data:e,options:{...t,animation:!1,responsive:!1,maintainAspectRatio:!1,plugins:{...t.plugins,legend:{...(o=t.plugins)==null?void 0:o.legend,display:!0}}}});setTimeout(()=>{try{const u=d.toBase64Image();d.destroy(),i(u)}catch(u){console.warn("Could not capture chart image:",u),d.destroy(),i(null)}},100)}catch(l){console.warn("Error creating chart:",l),i(null)}}),er="https://alxrkajk60i0df-8000.proxy.runpod.net",Fd=(r,e="")=>{var n;const t=((n=r==null?void 0:r.message)==null?void 0:n.toLowerCase())||"",s=e.toLowerCase();return s.includes("no workers available")||s.includes("worker")||t.includes("503")||t.includes("timeout")||t.includes("timed out")},Ld=async(r,e=5,t)=>{let s;for(let n=0;n<=e;n++)try{return await r()}catch(i){s=i;const o=(i==null?void 0:i.response)||(i==null?void 0:i.message)||"";if(Fd(i,o)&&n<e){const c=Math.min(3e3*Math.pow(2,n),48e3);console.log(`[API Retry] Cold start detected, retrying in ${c}ms (attempt ${n+1}/${e})`),await new Promise(d=>setTimeout(d,c));continue}throw s}throw s},Os=async(r,e,t=!0)=>{const s=r.startsWith("http")?r:`${er}${r.startsWith("/")?r:"/"+r}`,n=async()=>{const i={...e==null?void 0:e.headers};i.Authorization="Bearer rpa_1K6BW22JFGU3D3AI8XRSQ7YBSPE7XHDKTMBR2Q211nzdtd";const o=await fetch(s,{...e,headers:i}),l=await o.text();o.ok||(console.error(`HTTP ${o.status} Error for ${s}:`),console.error("Response headers:",Object.fromEntries(o.headers.entries())),console.error("Raw response text:",l));try{const c=l?JSON.parse(l):{};if(!o.ok){const d=new Error(`${o.status} ${c.detail||c.error||o.statusText}`);throw d.response=l,d.status=o.status,d}return c}catch(c){if(!o.ok){const d=new Error(`${o.status} ${o.statusText}`);throw d.response=l,d.status=o.status,d}throw c}};return t?Ld(n):n()},Bd=async(r,e,t)=>{try{const s=new FormData;s.append("file",r),s.append("video_name",e);const n=`${er}/video/upload`,i=await new Promise((l,c)=>{const d=new XMLHttpRequest;d.upload.addEventListener("progress",u=>{if(u.lengthComputable&&t){const h=u.loaded/u.total*100;t(h)}}),d.addEventListener("load",()=>{if(d.status>=200&&d.status<300)try{const u=JSON.parse(d.responseText);l(u)}catch{c(new Error("Failed to parse server response"))}else c(new Error(`Upload failed with status ${d.status}`))}),d.addEventListener("error",()=>{c(new Error("Network error during upload"))}),d.addEventListener("abort",()=>{c(new Error("Upload cancelled"))}),d.open("POST",n),d.setRequestHeader("Authorization","Bearer rpa_1K6BW22JFGU3D3AI8XRSQ7YBSPE7XHDKTMBR2Q211nzdtd"),d.send(s)});t&&t(100);const o=await Os(`/video/process/${i.job_id}`,{method:"POST"});return{job_id:i.job_id,video_id:i.video_id,queue_position:o.queue_position??i.queue_position??0,original_url:i.original_url||i.video_url||""}}catch(s){throw console.error("Error starting RunPod processing:",s),s}},Md=async(r,e,t)=>{try{const s={video_name:e,original_filename:r.name,original_url:t,file_size:r.size,status:"uploaded"};return await Sl(s)}catch(s){throw console.error("Error creating video metadata record:",s),s}},Ud=async()=>{try{await fetch(`${er}/jobs/clear-completed`,{method:"POST"})}catch(r){throw console.error("Error clearing completed jobs:",r),r}},Wd=async(r,e)=>{var Q,P,O,J,y,k,C,Z;const t=new Ta,s=t.internal.pageSize.width,n=t.internal.pageSize.height,i="Traffic Analysis Report",o=new Date().toLocaleDateString();t.setFontSize(24),t.setTextColor(6,182,212),t.text(i,s/2,40,{align:"center"}),t.setFontSize(14),t.setTextColor(100,100,100),t.text(`Generated on: ${o}`,s/2,55,{align:"center"}),t.setFontSize(12),t.setTextColor(6,182,212),t.text("Project 49 - Road Safety Analysis Platform",s/2,70,{align:"center"}),t.addPage(),t.setFontSize(20),t.setTextColor(0,0,0),t.text("Executive Summary",20,20),t.setFontSize(12),t.setTextColor(60,60,60);const l=Number(e.complianceRate)||0,c=Number(e.avgReactionTime)||0,d=Number(e.totalVehicles)||0,u=Number(e.violations)||0,h=l>=85?"Excellent":l>=70?"Good":l>=50?"Fair":"Poor",f=c<=2?"Excellent":c<=3?"Good":c<=4?"Fair":"Needs Improvement",p=["Analysis Overview:",`This comprehensive traffic analysis report examines ${d} vehicles across multiple`,"monitoring sessions, providing insights into road user behavior and compliance patterns.","","Key Findings:",` Overall Compliance Rate: ${l.toFixed(1)}% (${h})`,` Average Reaction Time: ${c.toFixed(2)}s (${f})`,` Total Violations Detected: ${u}`,` Peak Violation Period: ${e.peakViolationHour||"Not determined"}`,` Analysis Period: ${e.analysisStartDate||"N/A"} to ${e.analysisEndDate||"N/A"}`,"","Performance Assessment:",l>=85?`The compliance rate of ${l.toFixed(1)}% indicates excellent road safety performance,`:l>=70?`The compliance rate of ${l.toFixed(1)}% shows good safety performance with room for improvement.`:`The compliance rate of ${l.toFixed(1)}% indicates significant safety concerns requiring immediate attention.`,"",c<=3?"Average reaction times are within acceptable safety parameters.":"Reaction times exceed recommended thresholds, suggesting potential safety risks."];let x=40;p.forEach(b=>{b.startsWith("")?(t.setFontSize(11),t.text(b,25,x)):b.includes(":")&&!b.includes("")?(t.setFontSize(12),t.setTextColor(6,182,212),t.text(b,20,x),t.setTextColor(60,60,60)):(t.setFontSize(11),t.text(b,20,x)),x+=b===""?5:7}),t.addPage(),t.setFontSize(20),t.text("Traffic Flow Patterns",20,20);const j=r.reduce((b,w)=>{if(!w.date)return b;const F=Ht($t(w.date),"EEEE");return b[F]||(b[F]={total:0,violations:0}),b[F].total++,w.compliance===0&&b[F].violations++,b},{});if(Object.keys(j).length>0){const b=await ot("bar",{labels:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],datasets:[{label:"Total Traffic Volume",data:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(w=>{var F;return((F=j[w])==null?void 0:F.total)||0}),backgroundColor:"#06B6D4",borderColor:"#0891B2",borderWidth:1},{label:"Violations",data:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(w=>{var F;return((F=j[w])==null?void 0:F.violations)||0}),backgroundColor:"#EF4444",borderColor:"#DC2626",borderWidth:1}]},{plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Weekly Traffic Flow and Violations"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Vehicles"}},x:{title:{display:!0,text:"Day of Week"}}}},700,400);b&&t.addImage(b,"PNG",10,40,190,110)}t.setFontSize(12),t.setTextColor(60,60,60);let N=160;const L=Object.keys(j).reduce((b,w)=>{var F,H;return(((F=j[b])==null?void 0:F.total)||0)>(((H=j[w])==null?void 0:H.total)||0)?b:w},"Monday"),T=Object.keys(j).reduce((b,w)=>{var F,H;return(((F=j[b])==null?void 0:F.total)||0)<(((H=j[w])==null?void 0:H.total)||0)?b:w},"Monday");["Traffic Flow Analysis:",` Peak Traffic Day: ${L} (${((Q=j[L])==null?void 0:Q.total)||0} vehicles)`,` Lowest Traffic Day: ${T} (${((P=j[T])==null?void 0:P.total)||0} vehicles)`,` Weekend vs Weekday Pattern: ${(((O=j.Saturday)==null?void 0:O.total)||0)+(((J=j.Sunday)==null?void 0:J.total)||0)>(((y=j.Monday)==null?void 0:y.total)||0)+(((k=j.Tuesday)==null?void 0:k.total)||0)?"Higher weekend traffic observed":"Higher weekday traffic observed"}`].forEach(b=>{b.includes(":")&&!b.includes("")?(t.setFontSize(12),t.setTextColor(6,182,212),t.text(b,20,N),t.setTextColor(60,60,60)):(t.setFontSize(11),t.text(b,20,N)),N+=8}),t.addPage(),t.setFontSize(20),t.text("Compliance Overview",20,20);const D=await ot("pie",{labels:["Compliant","Violations"],datasets:[{data:[e.totalVehicles-e.violations,e.violations],backgroundColor:["#10B981","#EF4444"],borderWidth:2,borderColor:"#ffffff"}]},{plugins:{legend:{display:!0,position:"bottom"},title:{display:!0,text:"Overall Compliance Rate"}}});D&&t.addImage(D,"PNG",20,40,100,100),t.setFontSize(12),t.setTextColor(60,60,60);const V=d>0?((d-u)/d*100).toFixed(1):"0.0";if(t.text(`Compliance Rate: ${V}%`,130,60),t.text(`Total Compliant: ${d-u}`,130,75),t.text(`Total Violations: ${u}`,130,90),t.text(`Sample Size: ${d} vehicles`,130,105),t.addPage(),t.setFontSize(20),t.text("Vehicle Type Analysis",20,20),e.vehicleTypeStats&&e.vehicleTypeStats.length>0){const b=await ot("bar",{labels:e.vehicleTypeStats.map(w=>w.type),datasets:[{label:"Total Vehicles",data:e.vehicleTypeStats.map(w=>w.total),backgroundColor:"#06B6D4",borderColor:"#0891B2",borderWidth:1},{label:"Violations",data:e.vehicleTypeStats.map(w=>w.violations),backgroundColor:"#EF4444",borderColor:"#DC2626",borderWidth:1}]},{plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Vehicle Types: Total vs Violations"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Vehicles"}},x:{title:{display:!0,text:"Vehicle Type"}}}},700,400);b&&t.addImage(b,"PNG",10,40,190,110)}if(t.addPage(),t.setFontSize(20),t.text("Reaction Time Analysis",20,20),e.vehicleTypeStats&&e.vehicleTypeStats.length>0){const b=await ot("bar",{labels:e.vehicleTypeStats.map(w=>w.type),datasets:[{label:"Average Reaction Time (seconds)",data:e.vehicleTypeStats.map(w=>w.avgReactionTime),backgroundColor:"#8B5CF6",borderColor:"#7C3AED",borderWidth:1}]},{plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Average Reaction Time by Vehicle Type"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Reaction Time (seconds)"}},x:{title:{display:!0,text:"Vehicle Type"}}}},700,400);b&&t.addImage(b,"PNG",10,40,190,110)}t.addPage(),t.setFontSize(20),t.text("Hourly Analysis",20,20);const U=r.reduce((b,w)=>{if(!w.date)return b;const F=Ht($t(w.date),"HH:00");return b[F]||(b[F]={total:0,violations:0}),b[F].total++,w.compliance===0&&b[F].violations++,b},{});if(Object.keys(U).length>0){const b=await ot("line",{labels:Object.keys(U),datasets:[{label:"Total Vehicles",data:Object.values(U).map(w=>w.total),borderColor:"#06B6D4",backgroundColor:"rgba(6, 182, 212, 0.1)",fill:!1,tension:.4},{label:"Violations",data:Object.values(U).map(w=>w.violations),borderColor:"#EF4444",backgroundColor:"rgba(239, 68, 68, 0.1)",fill:!1,tension:.4}]},{plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Traffic Volume and Violations by Hour"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Vehicles"}},x:{title:{display:!0,text:"Hour of Day"}}}},700,400);b&&t.addImage(b,"PNG",10,40,190,110)}const A=r.filter(b=>b.weather_condition);if(A.length>0){t.addPage(),t.setFontSize(20),t.text("Weather Impact Analysis",20,20);const b=A.reduce((F,H)=>{const G=H.weather_condition;return F[G]||(F[G]={total:0,violations:0}),F[G].total++,H.compliance===0&&F[G].violations++,F},{}),w=await ot("bar",{labels:Object.keys(b),datasets:[{label:"Total Vehicles",data:Object.values(b).map(F=>F.total),backgroundColor:"#06B6D4",borderWidth:1},{label:"Violations",data:Object.values(b).map(F=>F.violations),backgroundColor:"#EF4444",borderWidth:1}]},{plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Traffic Behavior by Weather Condition"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Vehicles"}},x:{title:{display:!0,text:"Weather Condition"}}}},700,400);w&&t.addImage(w,"PNG",10,40,190,110)}const m=r.reduce((b,w)=>{if(!w.date)return b;const F=Ht($t(w.date),"MMM yyyy");return b[F]||(b[F]={total:0,violations:0}),b[F].total++,w.compliance===0&&b[F].violations++,b},{});if(Object.keys(m).length>1){t.addPage(),t.setFontSize(20),t.text("Monthly Trend Analysis",20,20);const b=await ot("line",{labels:Object.keys(m),datasets:[{label:"Compliance Rate (%)",data:Object.values(m).map(w=>((w.total-w.violations)/w.total*100).toFixed(1)),borderColor:"#10B981",backgroundColor:"rgba(16, 185, 129, 0.1)",fill:!0,tension:.4}]},{plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Compliance Rate Trend Over Time"}},scales:{y:{beginAtZero:!0,max:100,title:{display:!0,text:"Compliance Rate (%)"}},x:{title:{display:!0,text:"Month"}}}},700,400);b&&t.addImage(b,"PNG",10,40,190,110)}t.addPage(),t.setFontSize(20),t.text("Methodology and Data Sources",20,20),t.setFontSize(12),t.setTextColor(60,60,60);const g=["Data Collection Methodology:","","This analysis is based on advanced computer vision technology and artificial intelligence","algorithms designed to monitor and analyze road user behavior at level crossings.","","Key Technologies:"," YOLOv8 (You Only Look Once) - State-of-the-art object detection algorithm"," Computer Vision Processing - Real-time video analysis and tracking"," Machine Learning Classification - Automated behavior pattern recognition"," Statistical Analysis - Comprehensive data processing and trend identification","","Data Sources:"," High-definition traffic monitoring cameras"," Continuous 24/7 video surveillance systems"," Weather monitoring stations (when available)"," Automated vehicle detection and classification systems","","Analysis Parameters:"," Vehicle Detection: Automated identification of cars, trucks, motorcycles, and other vehicles"," Compliance Monitoring: Real-time assessment of traffic rule adherence"," Reaction Time Measurement: Precise calculation of driver response times"," Behavioral Classification: Categorization of compliant vs. non-compliant behavior","","Quality Assurance:"," Multi-stage validation of detection accuracy"," Statistical significance testing for all reported metrics"," Continuous calibration of detection algorithms"," Regular validation against manual observation samples"];let v=40;g.forEach(b=>{b.includes(":")&&!b.includes("")?(t.setFontSize(12),t.setTextColor(6,182,212),t.text(b,20,v),t.setTextColor(60,60,60)):b.startsWith("")?(t.setFontSize(11),t.text(b,25,v)):(t.setFontSize(11),t.text(b,20,v)),v+=b===""?5:7}),t.addPage(),t.setFontSize(20),t.text("Detailed Statistics",20,20);const I=e.vehicleTypeStats&&e.vehicleTypeStats.length>0?e.vehicleTypeStats.map(b=>[b.type,b.total,b.compliant,b.violations,`${b.avgReactionTime.toFixed(2)}s`,`${(b.compliant/b.total*100).toFixed(1)}%`]):[["No data","0","0","0","0s","0%"]];t.autoTable({startY:30,head:[["Vehicle Type","Total","Compliant","Violations","Avg RT","Compliance"]],body:I,theme:"grid",headStyles:{fillColor:[6,182,212]},styles:{fontSize:10},columnStyles:{0:{cellWidth:30},1:{cellWidth:20},2:{cellWidth:25},3:{cellWidth:25},4:{cellWidth:25},5:{cellWidth:25}}}),t.addPage(),t.setFontSize(20),t.text("Key Performance Indicators",20,20);const R=[{metric:"Overall Compliance Rate",value:`${l.toFixed(1)}%`,target:"85%",status:l>=85?"Good":"Needs Improvement"},{metric:"Average Reaction Time",value:`${c.toFixed(2)}s`,target:"3.0s",status:c<=3?"Good":"Needs Improvement"},{metric:"Total Violations",value:u.toString(),target:"Minimize",status:"Monitor"},{metric:"Sample Size",value:d.toString(),target:"1000",status:d>=1e3?"Adequate":"Limited"}];t.autoTable({startY:40,head:[["KPI","Current Value","Target","Status"]],body:R.map(b=>[b.metric,b.value,b.target,b.status]),theme:"grid",headStyles:{fillColor:[6,182,212]},styles:{fontSize:11},columnStyles:{3:{cellWidth:30,fontStyle:"bold"}}}),t.addPage(),t.setFontSize(20),t.text("Analysis & Recommendations",20,20);const W=e.vehicleTypeStats&&e.vehicleTypeStats.length>0?e.vehicleTypeStats.reduce((b,w)=>w.complianceRate<b.complianceRate?w:b):null,re=e.vehicleTypeStats&&e.vehicleTypeStats.length>0?e.vehicleTypeStats.reduce((b,w)=>w.complianceRate>b.complianceRate?w:b):null,le=[{finding:"Overall Safety Performance Assessment",description:`Current compliance rate of ${l.toFixed(1)}% ${l>=85?"exceeds industry safety standards":l>=70?"meets basic safety requirements but has room for improvement":"falls below recommended safety thresholds and requires immediate attention"}. Average reaction time of ${c.toFixed(2)}s ${c<=3?"is within acceptable parameters":"exceeds recommended response times"}.`,recommendation:l>=85?"Maintain current safety protocols and continue regular monitoring to sustain high performance levels.":l>=70?"Implement targeted safety improvements focusing on the identified risk areas. Consider enhanced signage and driver education programs.":"Urgent intervention required. Implement comprehensive safety measures including enhanced enforcement, improved signage, and immediate driver awareness campaigns."},{finding:"Vehicle Type Performance Analysis",description:W&&re?`${W.type} vehicles show the lowest compliance rate at ${(W.complianceRate||0).toFixed(1)}%, while ${re.type} vehicles demonstrate the highest compliance at ${(re.complianceRate||0).toFixed(1)}%. This ${((re.complianceRate||0)-(W.complianceRate||0)).toFixed(1)}% difference indicates significant behavioral variations between vehicle types.`:"Vehicle type analysis requires additional data for comprehensive assessment.",recommendation:W?`Develop targeted safety interventions specifically for ${W.type} operators. Consider vehicle-specific signage, enhanced training programs, and focused enforcement during peak ${W.type} traffic periods. Study successful compliance strategies used for ${(re==null?void 0:re.type)||"high-performing"} vehicles and adapt them for ${W.type} operators.`:"Collect additional vehicle type data to enable targeted safety interventions."},{finding:"Peak Risk Period Identification",description:`Analysis reveals ${e.peakViolationHour?`peak violation activity at ${e.peakViolationHour}`:"distributed violation patterns throughout monitoring periods"}. ${Object.keys(j).length>0?`Weekly patterns show ${L} as the highest risk day with ${((C=j[L])==null?void 0:C.violations)||0} violations out of ${((Z=j[L])==null?void 0:Z.total)||0} total vehicles.`:"Additional temporal data needed for comprehensive risk period analysis."}`,recommendation:e.peakViolationHour?`Implement enhanced monitoring and enforcement protocols during ${e.peakViolationHour} and surrounding peak periods. Deploy additional safety personnel and consider dynamic warning systems that activate during high-risk timeframes. Analyze traffic flow patterns to understand underlying causes of increased violations during these periods.`:"Establish continuous monitoring to identify peak risk periods and develop time-specific safety interventions."},{finding:"Reaction Time and Warning System Effectiveness",description:`Current average reaction time of ${c.toFixed(2)}s ${c<=2?"demonstrates excellent driver responsiveness to warning systems":c<=3?"indicates adequate but improvable driver response times":"suggests potential issues with warning system visibility, timing, or driver awareness"}. ${W?`${W.type} vehicles show the slowest average reaction time of ${(W.avgReactionTime||0).toFixed(2)}s.`:""}`,recommendation:c<=3?"Current warning systems are performing effectively. Continue regular maintenance and consider minor optimizations based on vehicle-specific response patterns.":`Warning system requires immediate evaluation and enhancement. Consider: 1) Increasing warning signal visibility and audibility, 2) Implementing earlier warning activation, 3) Adding redundant warning methods, 4) Conducting driver education on proper response procedures. ${W?`Special attention needed for ${W.type} vehicle operators.`:""}`},{finding:"Data Quality and Monitoring Coverage",description:`Analysis based on ${d} vehicle observations ${d>=1e3?"provides statistically significant insights":d>=500?"offers meaningful trends but would benefit from larger sample size":"represents limited data that may not capture full behavioral patterns"}. ${A.length>0?"Weather impact data available for enhanced analysis.":"Weather correlation data not available for this period."}`,recommendation:d>=1e3?"Current monitoring coverage is adequate. Maintain consistent data collection protocols and consider expanding analysis to include seasonal variations and weather impact studies.":"Expand monitoring duration and coverage to achieve statistically robust sample sizes (target: >1000 observations). Implement weather monitoring integration to understand environmental impact on driver behavior. Consider additional monitoring locations for comprehensive area coverage."}];let ie=40;return le.forEach(b=>{t.setFontSize(14),t.setTextColor(6,182,212),t.text(b.finding,20,ie),t.setFontSize(12),t.setTextColor(60,60,60);const w=t.splitTextToSize(b.description,s-40);t.text(w,20,ie+7),t.setFontSize(11),t.setTextColor(40,40,40),t.text("Recommended Actions:",20,ie+7+w.length*5+5);const F=t.splitTextToSize(b.recommendation,s-40);t.text(F,20,ie+7+w.length*5+12),ie+=40+w.length*5+F.length*5,ie>n-40&&(t.addPage(),ie=20)}),t.setFontSize(10),t.setTextColor(100,100,100),t.text("Generated by Project 49 - Road Safety Analysis Platform",s/2,n-10,{align:"center"}),t.text(`Report generated on ${new Date().toLocaleString()}`,s/2,n-5,{align:"center"}),t},hn=["video/mp4","video/quicktime","video/x-msvideo","video/x-matroska","video/webm"],Gr=r=>{if(!r)return"An unexpected error occurred";const e=r.message||r.toString();return e.includes("Failed to fetch")||e.includes("NetworkError")?"Unable to connect to the processing server. Please check your internet connection and try again.":e.includes("timeout")||e.includes("TIMEOUT")?"The request took too long to complete. Please try again.":e.includes("500")||e.includes("Internal Server Error")?"The processing server is experiencing issues. Please try again in a few minutes.":e.includes("404")||e.includes("Not Found")?"The requested service is not available. Please contact support if this continues.":e.includes("403")||e.includes("Forbidden")?"Access denied. Please check your permissions or contact support.":e.includes("WebSocket")?"Connection to the processing server was lost. Attempting to reconnect...":e.includes("file")||e.includes("upload")?"Failed to upload the file. Please check the file format and try again.":"Something went wrong. Please try again or contact support if the problem continues."};function qd(){const[r,e]=_.useState(!1),[t,s]=_.useState(!1),[n,i]=_.useState(()=>ve()==="dark"),[o,l]=_.useState([]),[c,d]=_.useState(!1),[u,h]=_.useState({show:!1,message:"",type:"info"}),[f,p]=_.useState([]),[x,j]=_.useState({total_jobs:0,queue_length:0,queue_processor_running:!1}),[N,L]=_.useState(""),[T,$]=_.useState(""),[D,V]=_.useState(0),[U,A]=_.useState(!1),[m,g]=_.useState(null),[v,I]=_.useState(null),[R,W]=_.useState("Connecting..."),[re,le]=_.useState(!1),[ie,Q]=_.useState("connecting"),[P,O]=_.useState(""),J=_.useRef(null),y=_.useRef(null),k=_.useRef(!0),C=_.useRef(null);_.useEffect(()=>{const S=()=>{i(ve()==="dark")},M=ne=>{if(c)return ne.preventDefault(),ne.returnValue="Your video is still uploading. Are you sure you want to leave? The upload will be cancelled.",ne.returnValue};return window.addEventListener("themeChanged",S),window.addEventListener("beforeunload",M),F(),()=>{window.removeEventListener("themeChanged",S),window.removeEventListener("beforeunload",M),k.current=!1,b(),J.current&&J.current.close(),y.current&&y.current.close()}},[c]);const Z=_.useRef(),b=()=>{Z.current&&clearTimeout(Z.current)},w=(S,M="info",ne=5e3)=>{b(),h({show:!0,message:S,type:M,duration:ne}),Z.current=setTimeout(()=>{h(ue=>({...ue,show:!1}))},ne)},F=()=>{Q("connecting"),le(!1),O("");try{J.current&&(J.current.close(),J.current=null)}catch(ne){console.error("Error closing existing WebSocket:",ne)}const M="https://alxrkajk60i0df-8000.proxy.runpod.net".replace(/^http/,"ws")+"/ws/jobs";J.current=new WebSocket(M),J.current.onopen=()=>{console.log("Jobs WebSocket connected"),Q("connected"),le(!0),O(""),w("Successfully connected to processing server","success",3e3)},J.current.onmessage=ne=>{try{const ue=JSON.parse(ne.data);ue&&ue.status==="success"&&(j(ue.summary),p(ue.all_jobs||[]))}catch(ue){console.error("Error parsing WebSocket message:",ue)}},J.current.onerror=ne=>{const ue=Gr(ne);Q("error"),le(!1),O(ue),k.current&&setTimeout(()=>{k.current&&(console.log("Attempting to reconnect to jobs WebSocket..."),F())},3e3)},J.current.onclose=()=>{console.log("Jobs WebSocket closed"),Q("disconnected"),le(!1),k.current&&O("Connection lost. Attempting to reconnect..."),k.current&&setTimeout(()=>{k.current&&(console.log("Attempting to reconnect to jobs WebSocket..."),F())},3e3)}},H=()=>{A(!1),g(null),I(null);try{y.current&&(y.current.close(),y.current=null)}catch(S){console.error("Error closing stream WebSocket:",S)}},G=async()=>{try{await Ud(),w("Completed jobs cleared successfully","success")}catch(S){const M=Gr(S);console.error("Error clearing completed jobs:",M),w(M,"error")}},ee=S=>{const M=Math.floor(S%60),ne=Math.floor(S/60)%60,ue=Math.floor(S/3600);return`${ue>0?ue+":":""}${String(ne).padStart(2,"0")}:${String(M).padStart(2,"0")}`},q=(S,M)=>S&&S.length>M?S.slice(0,M-1)+"":S||"",ae=S=>{if(S===0)return"0 Bytes";const M=1024,ne=["Bytes","KB","MB","GB"],ue=Math.floor(Math.log(S)/Math.log(M));return Math.round(S/Math.pow(M,ue)*100)/100+" "+ne[ue]},z=S=>{const M={queued:"bg-blue-500/10 text-blue-400",processing:"bg-yellow-500/10 text-yellow-400",completed:"bg-green-500/10 text-green-400",failed:"bg-red-500/10 text-red-400",cancelled:"bg-gray-500/10 text-gray-400"};return M[S]||M.queued},K=async S=>{if(S.length!==0){if(!re){w("Cannot upload files because the processing server is not connected. Please wait for the connection to be restored or refresh the page.","error");return}d(!0),L("Preparing upload..."),$(""),V(0);try{for(const M of S){if(!hn.includes(M.type)){const Pe=`The file "${M.name}" is not a supported video format. Please use MP4, MOV, AVI, MKV, or WebM files.`;w(Pe,"error"),L(Pe);continue}const ne=M.name.replace(/\.[^/.]+$/,"");$(M.name),V(M.size),L("Uploading video to server...");const ue=await Bd(M,ne,()=>{}),ke=await Md(M,ne,ue.original_url);l(Pe=>[ke,...Pe]),L(`Successfully queued job ${ue.job_id}`),w(`Successfully uploaded "${M.name}" and added to processing queue`,"success",5e3),$(""),V(0)}}catch(M){const ne=Gr(M);console.error("Processing error:",ne),w(`Upload failed: ${ne}`,"error",8e3),L(`Upload failed: ${ne}`)}finally{d(!1),$(""),V(0),L("")}}},B=S=>{S.preventDefault(),e(!0)},se=S=>{S.preventDefault(),e(!1)},we=S=>{S.preventDefault(),e(!1);const M=Array.from(S.dataTransfer.files);K(M)};return a.jsxs("div",{className:`min-h-screen ${n?"bg-[#0B1121] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx(Xt,{}),u.show&&a.jsxs("div",{className:`fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg flex items-start space-x-3 max-w-md ${u.type==="success"?"bg-green-500":u.type==="error"?"bg-red-500":u.type==="warning"?"bg-yellow-500":"bg-blue-500"}`,children:[a.jsx("div",{className:"flex-shrink-0 mt-0.5",children:u.type==="success"?a.jsx(kt,{className:"w-5 h-5"}):u.type==="error"?a.jsx(Et,{className:"w-5 h-5"}):u.type==="warning"?a.jsx(Et,{className:"w-5 h-5"}):a.jsx(cr,{className:"w-5 h-5"})}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{className:"text-white text-sm leading-relaxed",children:u.message})}),a.jsx("button",{onClick:()=>h(S=>({...S,show:!1})),className:"flex-shrink-0 text-white hover:text-gray-200 transition-colors",children:a.jsx(qe,{className:"w-4 h-4"})})]}),a.jsx(Dr,{title:"Video Upload",onToggleSidebar:()=>s(!t),isSidebarOpen:t}),a.jsx(Ir,{activePath:"/upload",isOpen:t,onClose:()=>s(!1)}),c&&a.jsx("div",{className:"lg:ml-64 mt-16 lg:mt-0",children:a.jsx("div",{className:`px-4 py-3 ${n?"bg-yellow-500/20 border-yellow-500/40":"bg-yellow-100 border-yellow-300"} border-b`,children:a.jsxs("div",{className:"max-w-6xl mx-auto flex items-center gap-3",children:[a.jsx(Et,{className:"w-5 h-5 text-yellow-600 flex-shrink-0"}),a.jsx("div",{className:"flex-1",children:a.jsx("p",{className:`text-sm font-medium ${n?"text-yellow-300":"text-yellow-800"}`,children:"Upload in Progress - Please do not close or refresh this page"})})]})})}),a.jsx("main",{className:"lg:ml-64 p-4 lg:p-8 mt-16 lg:mt-0",children:a.jsxs("div",{className:"max-w-6xl mx-auto",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-2",children:"Upload Video for Analysis"}),a.jsx("p",{className:n?"text-gray-400":"text-gray-600",children:"Supported formats: MP4, MOV, AVI, MKV, WebM"})]}),a.jsxs("div",{className:`border-2 border-dashed rounded-xl p-6 sm:p-8 md:p-12 mb-8 text-center transition-colors ${r?"border-primary-500 bg-primary-500/10":c?"border-yellow-400 bg-yellow-400/10":n?"border-gray-600 bg-gray-800/20 hover:border-gray-500":"border-gray-300 bg-gray-100/50 hover:border-gray-400"}`,onDragOver:B,onDragLeave:se,onDrop:we,children:[a.jsx("input",{ref:C,type:"file",accept:hn.join(","),multiple:!0,onChange:S=>{K(S.target.files?Array.from(S.target.files):[])},disabled:c,hidden:!0}),c?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-t-4 border-yellow-400 mx-auto mb-6"}),a.jsx("h3",{className:"text-xl sm:text-2xl font-bold mb-3 text-yellow-400",children:"Uploading Video..."}),T&&a.jsxs("p",{className:`mb-2 text-sm sm:text-base ${n?"text-gray-400":"text-gray-600"}`,children:[a.jsx("span",{className:"font-medium",children:T}),D>0&&a.jsxs("span",{children:[" (",ae(D),")"]})]}),a.jsx("p",{className:`mb-2 text-base sm:text-lg font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Video is uploading. Please stay tuned!"}),a.jsx("p",{className:`mb-4 text-sm sm:text-base ${n?"text-gray-400":"text-gray-600"}`,children:"Do not close or refresh this page while uploading."}),a.jsx("div",{className:`mt-4 px-4 py-3 rounded-lg ${n?"bg-yellow-500/10":"bg-yellow-50"} border ${n?"border-yellow-500/20":"border-yellow-200"}`,children:a.jsxs("p",{className:`text-sm ${n?"text-yellow-300":"text-yellow-800"}`,children:[a.jsx("strong",{children:"Please wait:"})," Large files may take several minutes to upload. Your video will be automatically added to the processing queue once complete."]})})]}):r?a.jsxs(a.Fragment,{children:[a.jsx(Tt,{className:"w-12 h-12 mx-auto mb-4 text-primary-500"}),a.jsx("h3",{className:"text-lg sm:text-xl font-semibold mb-2 text-primary-500",children:"Drop your videos here"}),a.jsx("p",{className:`mb-4 ${n?"text-gray-400":"text-gray-600"}`,children:"Release to upload your video files"})]}):a.jsxs(a.Fragment,{children:[a.jsx(Tt,{className:`w-12 h-12 mx-auto mb-4 ${n?"text-gray-400":"text-gray-500"}`}),a.jsx("h3",{className:"text-lg sm:text-xl font-semibold mb-2",children:"Upload Videos for Analysis"}),a.jsx("p",{className:`mb-4 ${n?"text-gray-400":"text-gray-600"}`,children:"Drag and drop your video files here, or click to browse"})]}),!c&&a.jsx("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:a.jsx("button",{onClick:()=>{var S;return(S=C.current)==null?void 0:S.click()},className:`px-4 sm:px-6 py-2 rounded-lg transition-colors text-sm sm:text-base ${re?"bg-primary-500 hover:bg-primary-600 text-white":"bg-gray-600 cursor-not-allowed opacity-50"}`,disabled:!re,title:re?"":"RunPod server not connected",children:re?"Select Video to Upload":"Server Disconnected"})})]}),a.jsxs("div",{className:`rounded-xl p-6 mb-8 ${n?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-4 sm:gap-0",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx("h2",{className:"text-lg sm:text-xl font-semibold",children:"Jobs"}),a.jsxs("span",{className:`text-xs sm:text-sm ${n?"text-gray-400":"text-gray-600"}`,children:["Total: ",x.total_jobs," | Queue: ",x.queue_length," | Running: ",x.queue_processor_running?"Yes":"No"]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2",children:[a.jsxs("span",{className:`text-xs sm:text-sm ${n?"text-gray-400":"text-gray-600"}`,children:["Auto-refresh: ",a.jsx("span",{className:"text-green-400",children:"On"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:F,className:`p-2 rounded-lg transition-colors ${n?"bg-[#1E293B] hover:bg-[#2D3B4E] text-gray-300":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,title:"Refresh",children:a.jsx(ws,{className:"w-4 h-4"})}),a.jsx("button",{onClick:G,className:`px-2 sm:px-3 py-2 text-xs sm:text-sm rounded-lg transition-colors ${n?"bg-[#1E293B] hover:bg-[#2D3B4E] text-gray-300":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:"Clear Completed"})]})]})]}),a.jsxs("div",{className:"overflow-x-auto",children:[a.jsxs("table",{className:"w-full min-w-[600px]",children:[a.jsx("thead",{children:a.jsxs("tr",{className:`border-b ${n?"border-gray-700":"border-gray-200"}`,children:[a.jsx("th",{className:`text-left py-2 sm:py-3 px-2 sm:px-4 font-medium text-xs sm:text-sm ${n?"text-gray-300":"text-gray-700"}`,children:"Job ID"}),a.jsx("th",{className:`text-left py-2 sm:py-3 px-2 sm:px-4 font-medium text-xs sm:text-sm ${n?"text-gray-300":"text-gray-700"}`,children:"File"}),a.jsx("th",{className:`text-left py-2 sm:py-3 px-2 sm:px-4 font-medium text-xs sm:text-sm ${n?"text-gray-300":"text-gray-700"}`,children:"Status"}),a.jsx("th",{className:`text-left py-2 sm:py-3 px-2 sm:px-4 font-medium text-xs sm:text-sm ${n?"text-gray-300":"text-gray-700"}`,children:"Progress"}),a.jsx("th",{className:`text-left py-2 sm:py-3 px-2 sm:px-4 font-medium text-xs sm:text-sm ${n?"text-gray-300":"text-gray-700"}`,children:"Message"}),a.jsx("th",{className:`text-left py-2 sm:py-3 px-2 sm:px-4 font-medium text-xs sm:text-sm ${n?"text-gray-300":"text-gray-700"}`,children:"Elapsed"})]})}),a.jsx("tbody",{children:f.sort((S,M)=>S.status==="processing"?-1:1).map(S=>{const M=Math.max(0,Math.min(100,Math.round(S.progress||0)));return a.jsxs("tr",{className:`border-b ${n?"border-gray-700":"border-gray-200"}`,children:[a.jsx("td",{className:`py-2 sm:py-3 px-2 sm:px-4 font-mono text-xs sm:text-sm ${n?"text-gray-300":"text-gray-700"}`,children:S.job_id}),a.jsx("td",{className:`py-2 sm:py-3 px-2 sm:px-4 text-xs sm:text-sm ${n?"text-gray-300":"text-gray-700"}`,title:S.file_name,children:q(S.file_name,36)}),a.jsx("td",{className:"py-2 sm:py-3 px-2 sm:px-4",children:a.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${z(S.status)}`,children:S.status})}),a.jsx("td",{className:"py-2 sm:py-3 px-2 sm:px-4",children:a.jsx("div",{className:`w-full bg-gray-200 rounded-full h-2 ${n?"bg-gray-700":"bg-gray-200"}`,children:a.jsx("div",{className:"bg-primary-500 h-2 rounded-full transition-all duration-300",style:{width:`${M}%`}})})}),a.jsx("td",{className:`py-2 sm:py-3 px-2 sm:px-4 text-xs sm:text-sm ${n?"text-gray-400":"text-gray-600"}`,title:S.message||"",children:q(S.message||"",40)}),a.jsx("td",{className:`py-2 sm:py-3 px-2 sm:px-4 text-xs sm:text-sm ${n?"text-gray-400":"text-gray-600"}`,children:ee(S.elapsed_time)})]},S.job_id)})})]}),f.length===0&&a.jsx("div",{className:`text-center py-6 sm:py-8 text-sm sm:text-base ${n?"text-gray-400":"text-gray-600"}`,children:"No jobs found. Upload a video to get started."})]})]}),U&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-xl p-4 sm:p-6 w-full max-w-4xl ${n?"bg-[#151F32] border border-[#1E293B]":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("h3",{className:"text-base sm:text-lg font-semibold truncate pr-4",children:["Live Stream - Job ",m]}),a.jsx("button",{onClick:H,className:`p-2 rounded-lg transition-colors ${n?"hover:bg-[#1E293B] text-gray-300":"hover:bg-gray-100 text-gray-700"}`,children:a.jsx(qe,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"bg-black rounded-lg flex items-center justify-center min-h-[200px] sm:min-h-[300px] md:min-h-[360px]",children:v?a.jsx("img",{src:`data:image/jpeg;base64,${v}`,alt:"Live stream",className:"max-w-full max-h-full h-auto rounded object-contain"}):a.jsx("div",{className:`text-center text-sm sm:text-base ${n?"text-gray-400":"text-gray-600"}`,children:R})})]})}),o.length>0&&a.jsxs("div",{className:`rounded-xl p-6 ${n?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("h2",{className:"text-lg sm:text-xl font-semibold mb-4",children:"Recently Uploaded Videos"}),a.jsx("div",{className:"space-y-3",children:o.map(S=>{var M,ne;return a.jsxs("div",{className:`flex items-center justify-between p-4 rounded-lg ${n?"bg-[#1E293B]":"bg-gray-50"}`,children:[a.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[a.jsx(Tt,{className:"w-5 h-5 text-primary-500"}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("h3",{className:"font-medium text-sm sm:text-base truncate",children:S.video_name}),a.jsxs("p",{className:`text-xs sm:text-sm ${n?"text-gray-400":"text-gray-600"}`,children:[S.original_filename,"  ",S.file_size?`${(S.file_size/1024/1024).toFixed(1)} MB`:"Unknown size"]})]})]}),a.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:a.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${S.status==="uploaded"?"bg-blue-500/10 text-blue-400":S.status==="processing"?"bg-yellow-500/10 text-yellow-400":S.status==="completed"?"bg-green-500/10 text-green-400":S.status==="failed"?"bg-red-500/10 text-red-400":n?"bg-gray-500/10 text-gray-400":"bg-gray-500/10 text-gray-600"} whitespace-nowrap`,children:((M=S.status)==null?void 0:M.charAt(0).toUpperCase())+((ne=S.status)==null?void 0:ne.slice(1))||"Unknown"})})]},S.id)})})]})]})})]})}const zd=r=>{if(!r)return"-";try{const e=$t(r);return Ht(e,"MMM dd, yyyy h:mm a")}catch(e){return console.error("Error formatting date:",e),"-"}},Vd=r=>{if(!r)return"-";try{const e=$t(r);return Ht(e,"yyyy-MM-dd HH:mm")}catch(e){return console.error("Error formatting date:",e),"-"}},Hd=r=>{if(!r)return"-";try{const e=$t(r);return yd(e,{addSuffix:!0})}catch(e){return console.error("Error formatting relative time:",e),"-"}},Kd=()=>{const r=-new Date().getTimezoneOffset(),e=Math.floor(Math.abs(r)/60),t=Math.abs(r)%60;return`UTC${r>=0?"+":"-"}${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`},Jd=()=>{try{const r=Intl.DateTimeFormat().resolvedOptions().timeZone,e=new Date,s=new Intl.DateTimeFormat("en-US",{timeZone:r,timeZoneName:"short"}).format(e).split(" ");return s[s.length-1]}catch{return Kd()}},mn="https://alxrkajk60i0df-8000.proxy.runpod.net";function Gd(){const[r,e]=_.useState(!1),[t,s]=_.useState(()=>ve()==="dark"),[n,i]=_.useState([]),[o,l]=_.useState(null),[c,d]=_.useState(null),[u,h]=_.useState(!0),[f,p]=_.useState(!1),[x,j]=_.useState("all"),[N,L]=_.useState(""),[T,$]=_.useState(""),[D,V]=_.useState(""),[U,A]=_.useState(""),[m,g]=_.useState(""),[v,I]=_.useState({totalVehicles:0,overallCompliance:0,avgReactionTime:0,weatherConditions:0}),R=y=>{const k=y.reduce((z,K)=>{const B=K.weather_condition||"unknown";return z[B]||(z[B]={compliant:0,total:0,reactionTimes:[]}),z[B].total++,K.compliance===1&&(z[B].compliant++,K.reaction_time&&z[B].reactionTimes.push(K.reaction_time)),z},{}),C=Object.entries(k).reduce((z,[K,B])=>(z[K]={mean:B.total>0?B.compliant/B.total:0,count:B.total},z),{}),Z=Object.entries(k).reduce((z,[K,B])=>(z[K]={mean:B.reactionTimes.length>0?B.reactionTimes.reduce((se,we)=>se+we,0)/B.reactionTimes.length:0,count:B.reactionTimes.length},z),{}),b=y.reduce((z,K)=>{const B=K.vehicle_type||"unknown";return z[B]||(z[B]={compliant:0,total:0}),z[B].total++,K.compliance===1&&z[B].compliant++,z},{}),w=Object.entries(b).reduce((z,[K,B])=>(z[K]={mean:B.total>0?B.compliant/B.total:0,count:B.total},z),{}),F=y.reduce((z,K)=>{if(!K.date)return z;const B=new Date(K.date).getHours().toString();return z[B]||(z[B]={compliant:0,total:0}),z[B].total++,K.compliance===1&&z[B].compliant++,z},{}),H=Object.entries(F).reduce((z,[K,B])=>(z[K]={mean:B.total>0?B.compliant/B.total:0,count:B.total},z),{}),G=[],ee=Object.entries(C).sort(([,z],[,K])=>z.mean-K.mean)[0];ee&&ee[1].mean<.8&&G.push({category:"weather",type:"warning",message:`${ee[0]} weather shows lowest compliance rate at ${(ee[1].mean*100).toFixed(1)}%`,suggestion:"Consider enhanced warning systems during adverse weather conditions"});const q=Object.entries(w).sort(([,z],[,K])=>z.mean-K.mean)[0];q&&q[1].mean<.8&&G.push({category:"vehicle_type",type:"critical",message:`${q[0]} vehicles show lowest compliance rate at ${(q[1].mean*100).toFixed(1)}%`,suggestion:"Target awareness campaigns for specific vehicle types with lower compliance"});const ae=Object.entries(H).sort(([,z],[,K])=>z.mean-K.mean)[0];return ae&&ae[1].mean<.8&&G.push({category:"time",type:"info",message:`Hour ${ae[0]}:00 shows lowest compliance rate at ${(ae[1].mean*100).toFixed(1)}%`,suggestion:"Consider increased monitoring during peak violation hours"}),{weather_analysis:{weather_compliance:C,weather_reaction_time:Z},basic_correlations:{speed_compliance_correlation:0,weather_compliance_correlation:0,vehicle_type_compliance:w,hour_compliance:H},recommendations:G}};_.useEffect(()=>{le();const y=()=>{s(ve()==="dark")};return window.addEventListener("themeChanged",y),()=>window.removeEventListener("themeChanged",y)},[]),_.useEffect(()=>{x!=="all"&&le()},[x,N,T]);const W=()=>{const y=new Date,k=new Date(y.getFullYear(),y.getMonth(),y.getDate());switch(x){case"7days":const C=new Date(k);return C.setDate(k.getDate()-7),{start:C,end:y};case"30days":const Z=new Date(k);return Z.setDate(k.getDate()-30),{start:Z,end:y};case"90days":const b=new Date(k);return b.setDate(k.getDate()-90),{start:b,end:y};case"custom":return N&&T?{start:new Date(N),end:new Date(T+"T23:59:59")}:null;default:return null}},re=y=>{const k=W();return k?y.filter(C=>{if(!C.date)return!1;const Z=new Date(C.date);return Z>=k.start&&Z<=k.end}):y},le=async()=>{try{h(!0);try{const C={};C.Authorization="Bearer rpa_1K6BW22JFGU3D3AI8XRSQ7YBSPE7XHDKTMBR2Q211nzdtd";const b=await(await fetch(`${mn}/analytics/all`,{headers:C})).json();if(b.status==="success"&&b.tracking_results){let w=b.tracking_results;w=re(w),i(w);const H=await(await fetch(`${mn}/correlation-analysis/`,{headers:C})).json();H.status==="success"&&(l(H.analysis),ie(w.length,w,H.analysis)),d(null);return}}catch{console.log("Backend not available, falling back to database")}const y=await ra();let k=re(y);if(i(k),k.length>0){const C=R(k);l(C),ie(k.length,k,C)}else i([]),l(null),ie(0,[],null);d(null)}catch(y){console.error("Error loading analytics:",y),d("Failed to load analytics data. Please try again."),i([]),l(null),ie(0,[])}finally{h(!1)}},ie=(y,k,C)=>{const Z=k.length,b=k.filter(ee=>ee.compliance===1).length,w=Z>0?b/Z*100:0,F=k.filter(ee=>ee.compliance===1&&ee.reaction_time!==null&&ee.reaction_time!==void 0).map(ee=>ee.reaction_time),H=F.length>0?F.reduce((ee,q)=>ee+q,0)/F.length:0,G=new Set(k.map(ee=>ee.weather_condition).filter(Boolean)).size;I({totalVehicles:Z,overallCompliance:w,avgReactionTime:H,weatherConditions:G})},Q=async()=>{if(n.length!==0)try{let y=[...n];if(D&&(y=y.filter(k=>k.weather_condition===D)),U&&(y=y.filter(k=>k.vehicle_type===U)),m!==""&&(y=y.filter(k=>k.compliance===parseInt(m))),i(y),y.length>0){const k=R(y);l(k),ie(y.length,y,k)}else l(null),ie(0,[],null)}catch{d("Unable to apply filters. Please try again.")}},P=()=>{V(""),A(""),g(""),j("all"),L(""),$(""),le()},O=y=>({weather:"",vehicle_type:"",time:""})[y]||"",J=async()=>{try{p(!0);const y=n,k={totalVehicles:v.totalVehicles,complianceRate:v.overallCompliance,avgReactionTime:v.avgReactionTime,violations:v.totalVehicles-Math.round(v.totalVehicles*v.overallCompliance/100),peakViolationHour:"N/A",vehicleTypeStats:n.length>0?[{type:"car",total:n.filter(w=>w.vehicle_type==="car").length,compliant:n.filter(w=>w.vehicle_type==="car"&&w.compliance===1).length,violations:n.filter(w=>w.vehicle_type==="car"&&w.compliance===0).length,avgReactionTime:n.filter(w=>w.vehicle_type==="car"&&w.reaction_time).reduce((w,F)=>w+(F.reaction_time||0),0)/Math.max(1,n.filter(w=>w.vehicle_type==="car"&&w.reaction_time).length)},{type:"truck",total:n.filter(w=>w.vehicle_type==="truck").length,compliant:n.filter(w=>w.vehicle_type==="truck"&&w.compliance===1).length,violations:n.filter(w=>w.vehicle_type==="truck"&&w.compliance===0).length,avgReactionTime:n.filter(w=>w.vehicle_type==="truck"&&w.reaction_time).reduce((w,F)=>w+(F.reaction_time||0),0)/Math.max(1,n.filter(w=>w.vehicle_type==="truck"&&w.reaction_time).length)}].filter(w=>w.total>0):[]};console.log("Generating PDF report with metrics:",k);const C=await Wd(y,k),b=`Project49_Traffic_Analysis_Report_${new Date().toISOString().split("T")[0]}.pdf`;C.save(b)}catch(y){console.error("Error generating report:",y),d(`Failed to generate PDF report: ${y instanceof Error?y.message:"Unknown error"}`)}finally{p(!1)}};return a.jsxs("div",{className:`min-h-screen ${t?"bg-[#0B1121] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx(Xt,{}),a.jsx(Dr,{title:"Analytics",onToggleSidebar:()=>e(!r),isSidebarOpen:r}),a.jsx(Ir,{activePath:"/analytics",isOpen:r,onClose:()=>e(!1)}),a.jsx("main",{className:"lg:ml-64 p-4 lg:p-8 mt-16 lg:mt-0",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-2xl lg:text-3xl font-bold mb-2",children:"Road Safety Analytics Dashboard"}),a.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"Analyze traffic patterns and generate comprehensive safety reports"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 mb-8",children:[a.jsxs("div",{className:`p-6 rounded-xl text-center ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("div",{className:"text-3xl font-bold text-primary-500 mb-2",children:v.totalVehicles}),a.jsx("div",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Total Vehicles"})]}),a.jsxs("div",{className:`p-6 rounded-xl text-center ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsxs("div",{className:"text-3xl font-bold text-green-500 mb-2",children:[v.overallCompliance.toFixed(1),"%"]}),a.jsx("div",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Overall Compliance"})]}),a.jsxs("div",{className:`p-6 rounded-xl text-center ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsxs("div",{className:"text-3xl font-bold text-blue-500 mb-2",children:[v.avgReactionTime.toFixed(1),"s"]}),a.jsx("div",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Avg Reaction Time"})]}),a.jsxs("div",{className:`p-6 rounded-xl text-center ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("div",{className:"text-3xl font-bold text-purple-500 mb-2",children:v.weatherConditions}),a.jsx("div",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Weather Conditions"})]})]}),a.jsxs("div",{className:`p-8 rounded-xl mb-8 ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[a.jsx("div",{className:"p-3 bg-primary-500/10 rounded-lg",children:a.jsx(ts,{className:"w-6 h-6 text-primary-500"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Data Analysis Controls"}),a.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"Filter and analyze traffic data by date range and conditions"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Date Range:"}),a.jsxs("select",{value:x,onChange:y=>j(y.target.value),className:`w-full px-3 py-2 rounded-lg border ${t?"bg-[#1E293B] border-[#334155] text-white":"bg-white border-gray-300 text-gray-900"}`,children:[a.jsx("option",{value:"all",children:"All Time"}),a.jsx("option",{value:"7days",children:"Last 7 Days"}),a.jsx("option",{value:"30days",children:"Last 30 Days"}),a.jsx("option",{value:"90days",children:"Last 90 Days"}),a.jsx("option",{value:"custom",children:"Custom Range"})]})]}),x==="custom"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Start Date:"}),a.jsx("input",{type:"date",value:N,onChange:y=>L(y.target.value),className:`w-full px-3 py-2 rounded-lg border ${t?"bg-[#1E293B] border-[#334155] text-white":"bg-white border-gray-300 text-gray-900"}`})]}),a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"End Date:"}),a.jsx("input",{type:"date",value:T,onChange:y=>$(y.target.value),className:`w-full px-3 py-2 rounded-lg border ${t?"bg-[#1E293B] border-[#334155] text-white":"bg-white border-gray-300 text-gray-900"}`})]})]})]}),a.jsxs("div",{className:"flex flex-wrap gap-4",children:[a.jsxs("button",{onClick:le,className:"flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg transition-colors",disabled:u,children:[a.jsx(ws,{className:"w-5 h-5"}),u?"Loading...":"Refresh Data"]}),a.jsx("button",{onClick:P,className:`px-4 py-2 rounded-lg border ${t?"bg-[#1E293B] border-[#334155] text-white":"bg-white border-gray-300 text-gray-900"} hover:bg-opacity-80 transition-colors`,disabled:u,children:"Reset All Filters"}),n.length>0&&a.jsxs("button",{onClick:J,className:"flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 rounded-lg transition-colors",disabled:u||f,children:[a.jsx(Ca,{className:"w-5 h-5"}),f?"Generating...":"Generate Report"]})]}),c&&a.jsx("div",{className:`mt-4 p-4 rounded-lg ${t?"bg-red-500/10 text-red-400":"bg-red-50 text-red-600"}`,children:c})]}),u?a.jsxs("div",{className:`p-8 rounded-xl text-center ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Loading Data"}),a.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"Loading job analytics..."})]}):n.length>0&&o?a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx(rs,{className:"w-5 h-5 text-primary-500"}),a.jsx("h2",{className:"text-lg font-semibold",children:"Advanced Filters"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Weather Condition:"}),a.jsxs("select",{value:D,onChange:y=>V(y.target.value),className:`w-full px-3 py-2 rounded-lg border ${t?"bg-[#1E293B] border-[#334155] text-white":"bg-white border-gray-300 text-gray-900"}`,children:[a.jsx("option",{value:"",children:"All Weather"}),a.jsx("option",{value:"clear",children:"Clear"}),a.jsx("option",{value:"cloudy",children:"Cloudy"}),a.jsx("option",{value:"foggy",children:"Foggy"}),a.jsx("option",{value:"rainy",children:"Rainy"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Vehicle Type:"}),a.jsxs("select",{value:U,onChange:y=>A(y.target.value),className:`w-full px-3 py-2 rounded-lg border ${t?"bg-[#1E293B] border-[#334155] text-white":"bg-white border-gray-300 text-gray-900"}`,children:[a.jsx("option",{value:"",children:"All Vehicles"}),a.jsx("option",{value:"car",children:"Car"}),a.jsx("option",{value:"truck",children:"Truck"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Compliance:"}),a.jsxs("select",{value:m,onChange:y=>g(y.target.value),className:`w-full px-3 py-2 rounded-lg border ${t?"bg-[#1E293B] border-[#334155] text-white":"bg-white border-gray-300 text-gray-900"}`,children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"1",children:"Compliant"}),a.jsx("option",{value:"0",children:"Non-Compliant"})]})]}),a.jsx("div",{className:"flex items-end",children:a.jsx("button",{onClick:Q,className:"w-full px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg transition-colors",children:"Apply Filters"})})]})]}),a.jsxs("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("h2",{className:"text-lg font-semibold mb-6",children:" Weather Impact Analysis"}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-md font-medium mb-4",children:"Weather Compliance Rates"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"weatherComplianceChart"})})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-md font-medium mb-4",children:"Weather Reaction Times"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"weatherReactionChart"})})]})]})]}),a.jsxs("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("h2",{className:"text-lg font-semibold mb-6",children:" Vehicle Type Analysis"}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-md font-medium mb-4",children:"Vehicle Compliance Comparison"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"vehicleChart"})})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-md font-medium mb-4",children:"Vehicle Distribution"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"vehicleDistributionChart"})})]})]})]}),a.jsxs("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("h2",{className:"text-lg font-semibold mb-6",children:" Time-based Analysis"}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-md font-medium mb-4",children:"Hourly Compliance Rates"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"hourlyChart"})})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-md font-medium mb-4",children:"Traffic Volume by Hour"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"trafficVolumeChart"})})]})]})]}),a.jsxs("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("h2",{className:"text-lg font-semibold mb-6",children:" Correlation Heatmap"}),a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-md font-medium mb-4",children:"Weather vs Vehicle Type Heatmap"}),a.jsx("div",{className:"overflow-x-auto",children:a.jsx("div",{id:"weatherVehicleHeatmap",className:"min-h-[200px] min-w-[400px] border rounded-lg p-4"})})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-md font-medium mb-4",children:"Time vs Weather Heatmap"}),a.jsx("div",{className:"overflow-x-auto",children:a.jsx("div",{id:"timeWeatherHeatmap",className:"min-h-[200px] min-w-[600px] border rounded-lg p-4"})})]})]})]}),o.recommendations&&a.jsxs("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("h2",{className:"text-lg font-semibold mb-6",children:" Actionable Insights"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.recommendations.map((y,k)=>a.jsxs("div",{className:`p-4 rounded-lg border-l-4 ${y.type==="warning"?"border-yellow-500 bg-yellow-500/10":y.type==="critical"?"border-red-500 bg-red-500/10":"border-blue-500 bg-blue-500/10"}`,children:[a.jsxs("div",{className:"font-semibold mb-2",children:[O(y.category)," ",y.category.toUpperCase()]}),a.jsx("div",{className:`text-sm mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:y.message}),a.jsxs("div",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:[" ",y.suggestion]})]},k))})]}),a.jsxs("div",{className:`p-6 rounded-xl ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx("h2",{className:"text-lg font-semibold mb-6",children:" Raw Data"}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{children:a.jsxs("tr",{className:`border-b ${t?"border-gray-700":"border-gray-200"}`,children:[a.jsx("th",{className:`text-left py-3 px-4 font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"ID"}),a.jsx("th",{className:`text-left py-3 px-4 font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Vehicle Type"}),a.jsx("th",{className:`text-left py-3 px-4 font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Status"}),a.jsx("th",{className:`text-left py-3 px-4 font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Compliance"}),a.jsx("th",{className:`text-left py-3 px-4 font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Reaction Time"}),a.jsx("th",{className:`text-left py-3 px-4 font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Weather"}),a.jsx("th",{className:`text-left py-3 px-4 font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Temperature"}),a.jsx("th",{className:`text-left py-3 px-4 font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Date"})]})}),a.jsx("tbody",{children:n.slice(0,50).map((y,k)=>a.jsxs("tr",{className:`border-b ${t?"border-gray-700":"border-gray-200"}`,children:[a.jsx("td",{className:`py-3 px-4 ${t?"text-gray-300":"text-gray-700"}`,children:y.tracker_id}),a.jsx("td",{className:`py-3 px-4 ${t?"text-gray-300":"text-gray-700"}`,children:y.vehicle_type}),a.jsx("td",{className:`py-3 px-4 ${t?"text-gray-300":"text-gray-700"}`,children:y.status}),a.jsx("td",{className:`py-3 px-4 ${t?"text-gray-300":"text-gray-700"}`,children:y.compliance===1?"":""}),a.jsx("td",{className:`py-3 px-4 ${t?"text-gray-300":"text-gray-700"}`,children:y.reaction_time||"-"}),a.jsx("td",{className:`py-3 px-4 ${t?"text-gray-300":"text-gray-700"}`,children:y.weather_condition||"-"}),a.jsx("td",{className:`py-3 px-4 ${t?"text-gray-300":"text-gray-700"}`,children:y.temperature?`${y.temperature}C`:"-"}),a.jsx("td",{className:`py-3 px-4 ${t?"text-gray-300":"text-gray-700"}`,children:zd(y.date)})]},k))})]})})]})]}):a.jsxs("div",{className:`p-8 rounded-xl text-center ${t?"bg-[#151F32]":"bg-white shadow-lg border border-gray-200"}`,children:[a.jsx(ze,{className:`w-12 h-12 mx-auto mb-4 ${t?"text-gray-400":"text-gray-500"}`}),a.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No Data Available"}),a.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"No tracking data found for the selected date range. Try adjusting your filters or upload some videos for analysis."})]})]})}),n.length>0&&o&&a.jsx(Yd,{analysisData:o,isDark:t})]})}function Yd({analysisData:r,isDark:e}){return _.useEffect(()=>{(async()=>{const s=(await Rt(async()=>{const{default:u}=await import("./auto-1tSkAajP.js");return{default:u}},__vite__mapDeps([0,1,2]))).default,n=document.getElementById("weatherComplianceChart");if(n){const u=s.getChart(n);u&&u.destroy(),new s(n,{type:"bar",data:{labels:Object.keys(r.weather_analysis.weather_compliance),datasets:[{label:"Compliance Rate (%)",data:Object.values(r.weather_analysis.weather_compliance).map(h=>h.mean*100),backgroundColor:["#4CAF50","#FF9800","#9C27B0","#2196F3"],borderColor:["#388E3C","#F57C00","#7B1FA2","#1976D2"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,max:100,ticks:{callback:function(h){return h+"%"},color:e?"#9CA3AF":"#6B7280"},grid:{color:e?"#374151":"#E5E7EB"}},x:{ticks:{color:e?"#9CA3AF":"#6B7280"},grid:{color:e?"#374151":"#E5E7EB"}}}}})}const i=document.getElementById("weatherReactionChart");if(i){const u=s.getChart(i);u&&u.destroy(),new s(i,{type:"line",data:{labels:Object.keys(r.weather_analysis.weather_reaction_time),datasets:[{label:"Average Reaction Time (seconds)",data:Object.values(r.weather_analysis.weather_reaction_time).map(h=>h.mean),borderColor:"#FF5722",backgroundColor:"rgba(255, 87, 34, 0.1)",borderWidth:3,fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Seconds",color:e?"#9CA3AF":"#6B7280"},ticks:{color:e?"#9CA3AF":"#6B7280"},grid:{color:e?"#374151":"#E5E7EB"}},x:{ticks:{color:e?"#9CA3AF":"#6B7280"},grid:{color:e?"#374151":"#E5E7EB"}}}}})}const o=document.getElementById("vehicleChart");if(o){const u=s.getChart(o);u&&u.destroy(),new s(o,{type:"doughnut",data:{labels:Object.keys(r.basic_correlations.vehicle_type_compliance).map(h=>`${h.charAt(0).toUpperCase()+h.slice(1)} (${(r.basic_correlations.vehicle_type_compliance[h].mean*100).toFixed(1)}%)`),datasets:[{data:Object.values(r.basic_correlations.vehicle_type_compliance).map(h=>h.mean*100),backgroundColor:["#4CAF50","#F44336"],borderWidth:2,borderColor:e?"#1F2937":"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:e?"#9CA3AF":"#6B7280"}}}}})}const l=document.getElementById("vehicleDistributionChart");if(l){const u=s.getChart(l);u&&u.destroy(),new s(l,{type:"pie",data:{labels:Object.keys(r.basic_correlations.vehicle_type_compliance),datasets:[{data:Object.values(r.basic_correlations.vehicle_type_compliance).map(h=>h.count),backgroundColor:["#2196F3","#FF9800"],borderWidth:2,borderColor:e?"#1F2937":"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:e?"#9CA3AF":"#6B7280"}}}}})}const c=document.getElementById("hourlyChart");if(c){const u=s.getChart(c);u&&u.destroy(),new s(c,{type:"bar",data:{labels:Object.keys(r.basic_correlations.hour_compliance),datasets:[{label:"Compliance Rate (%)",data:Object.values(r.basic_correlations.hour_compliance).map(h=>h.mean*100),backgroundColor:"rgba(52, 152, 219, 0.8)",borderColor:"#3498db",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,max:100,ticks:{callback:function(h){return h+"%"},color:e?"#9CA3AF":"#6B7280"},grid:{color:e?"#374151":"#E5E7EB"}},x:{title:{display:!0,text:"Hour of Day",color:e?"#9CA3AF":"#6B7280"},ticks:{color:e?"#9CA3AF":"#6B7280"},grid:{color:e?"#374151":"#E5E7EB"}}}}})}const d=document.getElementById("trafficVolumeChart");if(d){const u=s.getChart(d);u&&u.destroy(),new s(d,{type:"line",data:{labels:Object.keys(r.basic_correlations.hour_compliance),datasets:[{label:"Traffic Volume",data:Object.values(r.basic_correlations.hour_compliance).map(h=>h.count),borderColor:"#27AE60",backgroundColor:"rgba(39, 174, 96, 0.1)",borderWidth:3,fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Vehicles",color:e?"#9CA3AF":"#6B7280"},ticks:{color:e?"#9CA3AF":"#6B7280"},grid:{color:e?"#374151":"#E5E7EB"}},x:{title:{display:!0,text:"Hour of Day",color:e?"#9CA3AF":"#6B7280"},ticks:{color:e?"#9CA3AF":"#6B7280"},grid:{color:e?"#374151":"#E5E7EB"}}}}})}})()},[r,e]),_.useEffect(()=>{const t=document.getElementById("weatherVehicleHeatmap");if(t&&r){t.innerHTML="";const n=Object.keys(r.weather_analysis.weather_compliance),i=Object.keys(r.basic_correlations.vehicle_type_compliance),o=document.createElement("div");o.className="grid gap-1",o.style.gridTemplateColumns=`repeat(${n.length+1}, minmax(80px, 1fr))`,o.appendChild(document.createElement("div")),n.forEach(l=>{const c=document.createElement("div");c.className=`text-xs font-medium p-2 text-center break-words ${e?"text-gray-300":"text-gray-700"}`,c.textContent=l,o.appendChild(c)}),i.forEach(l=>{const c=document.createElement("div");c.className=`text-xs font-medium p-2 break-words ${e?"text-gray-300":"text-gray-700"}`,c.textContent=l,o.appendChild(c),n.forEach(d=>{const u=r.weather_analysis.weather_compliance[d].mean,h=r.basic_correlations.vehicle_type_compliance[l].mean,f=(u+h)/2,p=document.createElement("div");p.className="text-xs p-2 text-center text-white rounded min-w-[60px]",p.style.backgroundColor=`rgba(52, 152, 219, ${f})`,p.textContent=`${(f*100).toFixed(0)}%`,p.title=`Weather: ${d}, Vehicle: ${l}, Correlation: ${(f*100).toFixed(1)}%`,o.appendChild(p)})}),t.appendChild(o)}const s=document.getElementById("timeWeatherHeatmap");if(s&&r){s.innerHTML="";const n=Object.keys(r.basic_correlations.hour_compliance),i=Object.keys(r.weather_analysis.weather_compliance),o=document.createElement("div");o.className="grid gap-1",o.style.gridTemplateColumns=`repeat(${Math.min(n.length+1,13)}, minmax(50px, 1fr))`,o.appendChild(document.createElement("div")),n.slice(0,12).forEach(l=>{const c=document.createElement("div");c.className=`text-xs font-medium p-1 text-center ${e?"text-gray-300":"text-gray-700"}`,c.textContent=`${l}:00`,o.appendChild(c)}),i.forEach(l=>{const c=document.createElement("div");c.className=`text-xs font-medium p-1 break-words ${e?"text-gray-300":"text-gray-700"}`,c.textContent=l,o.appendChild(c),n.slice(0,12).forEach(d=>{const u=r.basic_correlations.hour_compliance[d].mean,h=r.weather_analysis.weather_compliance[l].mean,f=(u+h)/2,p=document.createElement("div");p.className="text-xs p-1 text-center text-white rounded min-w-[40px]",p.style.backgroundColor=`rgba(231, 76, 60, ${f})`,p.textContent=`${(f*100).toFixed(0)}%`,p.title=`Hour: ${d}:00, Weather: ${l}, Correlation: ${(f*100).toFixed(1)}%`,o.appendChild(p)})}),s.appendChild(o)}},[r,e]),null}function Qd(){const[r,e]=_.useState(null),[t,s]=_.useState(()=>ve()==="dark"),[n,i]=_.useState(!1),[o,l]=_.useState(""),[c,d]=_.useState("success"),[u,h]=_.useState(!1),[f,p]=_.useState(!1),[x,j]=_.useState({displayName:"",email:""});_.useEffect(()=>{fe.auth.getUser().then(({data:{user:V}})=>{e(V),j(U=>{var A;return{...U,displayName:((A=V==null?void 0:V.user_metadata)==null?void 0:A.full_name)||"",email:(V==null?void 0:V.email)||""}})});const{data:{subscription:D}}=fe.auth.onAuthStateChange((V,U)=>{const A=U==null?void 0:U.user;e(A),A&&j(m=>{var g;return{...m,displayName:((g=A.user_metadata)==null?void 0:g.full_name)||"",email:A.email||""}})});return()=>D.unsubscribe()},[]);const N=(D,V)=>{l(D),d(V),i(!0),setTimeout(()=>i(!1),3e3)},L=async D=>{D.preventDefault(),h(!0);try{const{error:V}=await fe.auth.updateUser({email:x.email,data:{full_name:x.displayName}});if(V)throw V;N("Profile updated successfully","success")}catch(V){N(V.message,"error")}finally{h(!1)}},T=async()=>{if(!x.email){N("Please enter your email address first","error");return}h(!0);try{const{error:D}=await fe.auth.resetPasswordForEmail(x.email,{redirectTo:`${window.location.origin}/auth`});if(D)throw D;N("Password reset email sent successfully","success")}catch(D){N(D.message,"error")}finally{h(!1)}},$=()=>{const D=ta(t?"dark":"light");s(D==="dark")};return a.jsxs("div",{className:`min-h-screen ${t?"bg-[#0B1121] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx(Xt,{}),n&&a.jsxs("div",{className:`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg flex items-center space-x-2 ${c==="success"?"bg-green-500":"bg-red-500"}`,children:[c==="success"?a.jsx(kt,{className:"w-5 h-5 text-white"}):a.jsx(Et,{className:"w-5 h-5 text-white"}),a.jsx("span",{className:"text-white",children:o})]}),a.jsx(Dr,{title:"Settings",onToggleSidebar:()=>p(!f),isSidebarOpen:f}),a.jsx(Ir,{activePath:"/settings",isOpen:f,onClose:()=>p(!1)}),a.jsx("main",{className:"lg:ml-64 p-4 lg:p-8 mt-16 lg:mt-0",children:a.jsxs("div",{className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-2",children:"Settings"}),a.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"Manage your account and preferences"})]}),a.jsxs("form",{onSubmit:L,className:"space-y-6",children:[a.jsxs("div",{className:`${t?"bg-[#151F32]":"bg-white"} rounded-xl p-4 sm:p-6 ${t?"":"shadow-lg border border-gray-200"}`,children:[a.jsxs("h2",{className:"text-lg sm:text-xl font-semibold mb-4 sm:mb-6 flex items-center gap-2",children:[a.jsx($a,{className:"w-5 h-5"}),"Profile Information"]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-400":"text-gray-700"} mb-2`,children:"Display Name"}),a.jsx("input",{type:"text",value:x.displayName,onChange:D=>j({...x,displayName:D.target.value}),className:`w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base ${t?"bg-[#1E293B] border-[#2D3B4E] text-white":"bg-gray-50 border-gray-300 text-gray-900"} border rounded-lg focus:outline-none focus:border-primary-400`,placeholder:"Enter your display name"})]}),a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-400":"text-gray-700"} mb-2`,children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(yn,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${t?"text-gray-400":"text-gray-500"}`}),a.jsx("input",{type:"email",value:x.email,onChange:D=>j({...x,email:D.target.value}),className:`w-full pl-10 sm:pl-12 pr-3 sm:pr-4 py-2 sm:py-3 text-sm sm:text-base ${t?"bg-[#1E293B] border-[#2D3B4E] text-white":"bg-gray-50 border-gray-300 text-gray-900"} border rounded-lg focus:outline-none focus:border-primary-400`,placeholder:"Enter your email address"})]})]})]})]}),a.jsxs("div",{className:`${t?"bg-[#151F32]":"bg-white"} rounded-xl p-4 sm:p-6 ${t?"":"shadow-lg border border-gray-200"}`,children:[a.jsxs("h2",{className:"text-lg sm:text-xl font-semibold mb-4 sm:mb-6 flex items-center gap-2",children:[t?a.jsx(pn,{className:"w-5 h-5"}):a.jsx(gn,{className:"w-5 h-5"}),"Appearance"]}),a.jsxs("div",{className:`flex items-center justify-between p-4 ${t?"bg-[#1E293B]":"bg-gray-50"} rounded-lg`,children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-sm sm:text-base",children:"Dark Mode"}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Use dark theme for better viewing experience"})]}),a.jsx("button",{type:"button",onClick:$,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${t?"bg-primary-500":"bg-gray-300"}`,children:a.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${t?"translate-x-6":"translate-x-1"}`})})]})]}),a.jsxs("div",{className:`${t?"bg-[#151F32]":"bg-white"} rounded-xl p-4 sm:p-6 ${t?"":"shadow-lg border border-gray-200"}`,children:[a.jsxs("h2",{className:"text-lg sm:text-xl font-semibold mb-4 sm:mb-6 flex items-center gap-2",children:[a.jsx(Oa,{className:"w-5 h-5"}),"Password"]}),a.jsx("div",{className:`p-4 ${t?"bg-[#1E293B]":"bg-gray-50"} rounded-lg`,children:a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 sm:gap-0",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-sm sm:text-base",children:"Reset Password"}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Send a password reset email to your registered email address"})]}),a.jsx("button",{type:"button",onClick:T,disabled:u,className:"bg-red-500 hover:bg-red-600 disabled:bg-gray-600 disabled:cursor-not-allowed text-white px-3 sm:px-4 py-2 rounded-lg transition-colors text-xs sm:text-sm font-medium whitespace-nowrap",children:u?"Sending...":"Reset Password"})]})})]}),a.jsx("div",{className:"flex justify-center sm:justify-end",children:a.jsxs("button",{type:"submit",disabled:u,className:"bg-primary-500 hover:bg-primary-600 disabled:bg-gray-600 disabled:cursor-not-allowed text-white px-6 sm:px-8 py-2 sm:py-3 rounded-lg transition-colors flex items-center gap-2 font-medium text-sm sm:text-base",children:[a.jsx(Ra,{className:"w-5 h-5"}),u?"Saving...":"Save Changes"]})})]})]})})]})}Xe.register(...jn);const Yr=r=>{if(!r)return"An unexpected error occurred";const e=r.message||r.toString();return e.includes("Failed to fetch")||e.includes("NetworkError")?"Unable to connect to the processing server. Please check your internet connection and try again.":e.includes("timeout")||e.includes("TIMEOUT")?"The request took too long to complete. Please try again.":e.includes("500")||e.includes("Internal Server Error")?"The processing server is experiencing issues. Please try again in a few minutes.":e.includes("404")||e.includes("Not Found")?"The requested service is not available. Please contact support if this continues.":e.includes("403")||e.includes("Forbidden")?"Access denied. Please check your permissions or contact support.":"Something went wrong. Please try again or contact support if the problem continues."};function Xd(){const[r,e]=_.useState(!1),[t,s]=_.useState(()=>ve()==="dark"),[n,i]=_.useState([]),[o,l]=_.useState(!1),[c,d]=_.useState(""),[u,h]=_.useState(0),[f,p]=_.useState(""),[x,j]=_.useState(""),[N,L]=_.useState("created_at"),[T,$]=_.useState("true"),[D,V]=_.useState(""),[U,A]=_.useState(!1),[m,g]=_.useState(null),[v,I]=_.useState(!1),[R,W]=_.useState(""),[re,le]=_.useState(!1),[ie,Q]=_.useState(null),[P,O]=_.useState(""),[J,y]=_.useState(!1),[k,C]=_.useState({id:null,name:null}),Z=_.useRef(null),b=_.useRef(null),w=_.useRef(null),F=_.useRef(null),H=_.useRef(null),G=_.useRef(null),ee=_.useRef(null),[q,ae]=_.useState({show:!1,message:"",type:"info"}),z=_.useRef();_.useEffect(()=>{const E=()=>{s(ve()==="dark")};return window.addEventListener("themeChanged",E),se(7),we(),()=>{window.removeEventListener("themeChanged",E),K(),$e()}},[]);const K=()=>{z.current&&clearTimeout(z.current)},B=(E,X="info",oe=5e3)=>{K(),ae({show:!0,message:E,type:X}),z.current=setTimeout(()=>{ae(ge=>({...ge,show:!1}))},oe)},se=E=>{const X=new Date,oe=X.toISOString().slice(0,10),gt=new Date(X.getTime()-E*24*60*60*1e3).toISOString().slice(0,10);j(oe),p(gt)},we=async()=>{l(!0),d("Loading videos...");try{const E=await un();if(E.status!=="success")throw new Error(E.error||"Failed to load videos");i(E.data||[]),h(E.count||0),d("")}catch(E){const X=Yr(E);d(`Error: ${X}`),B(X,"error")}finally{l(!1)}},S=async()=>{l(!0),d("Applying filters...");try{const X=await un({dateFrom:f||void 0,dateTo:x||void 0,orderBy:N||void 0,orderDesc:T||void 0});if(X.status!=="success")throw new Error(X.error||"Failed to apply filters");i(X.data||[]),h(X.count||0),d(""),B("Filters applied successfully","success",3e3)}catch(E){const X=Yr(E);d(`Error: ${X}`),B(X,"error")}finally{l(!1)}},M=async(E,X)=>{A(!0),I(!0),W(X),g(null);try{const oe=await Pd(E);if(oe.status!=="success")throw new Error(oe.error||"Failed to load video summary");g(oe),setTimeout(()=>{G.current&&(G.current.src=Id(E))},100)}catch(oe){const ge=Yr(oe);B(ge,"error")}finally{I(!1)}},ne=()=>{A(!1),g(null),W(""),$e(),G.current&&(G.current.pause(),G.current.src="")},ue=()=>{le(!1),Q(null),W(""),O(""),ee.current&&(ee.current.pause(),ee.current.src="")},ke=(E,X)=>{C({id:E,name:X}),y(!0)},Pe=async()=>{if(k.id!==null){d("Deleting..."),y(!1);try{const E=await Dd(k.id);if(E.status!=="success")throw new Error(E.error||"Failed to delete video");d("Video deleted successfully"),B("Video deleted successfully","success"),await S(),setTimeout(()=>{d("")},2e3)}catch(E){d(`Error: ${E.message}`),console.error("Error deleting video:",E)}finally{C({id:null,name:null})}}},_e=()=>{y(!1),C({id:null,name:null})},$e=()=>{Z.current&&(Z.current.destroy(),Z.current=null),b.current&&(b.current.destroy(),b.current=null),w.current&&(w.current.destroy(),w.current=null),F.current&&(F.current.destroy(),F.current=null),H.current&&(H.current.destroy(),H.current=null)},pe=(E,X)=>{if(!X||X.length===0)return;const oe={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:t?"#E5E7EB":"#374151",font:{family:"Inter, system-ui, sans-serif"}}}},scales:{x:{ticks:{color:t?"#9CA3AF":"#6B7280"},grid:{color:t?"#374151":"#E5E7EB"}},y:{ticks:{color:t?"#9CA3AF":"#6B7280"},grid:{color:t?"#374151":"#E5E7EB"}}}},ge={};for(const Je of X){const pt=Je.vehicle_type||"unknown";ge[pt]=(ge[pt]||0)+(Je.count||0)}const gt=Object.keys(ge),It=gt.map(Je=>ge[Je]),De=document.getElementById("vcChart");De&&Z.current&&Z.current.destroy(),De&&(Z.current=new Xe(De.getContext("2d"),{type:"bar",data:{labels:gt,datasets:[{label:"Vehicle Count",data:It,backgroundColor:"#06B6D4",borderColor:"#0891B2",borderWidth:1,borderRadius:4}]},options:{...oe,plugins:{...oe.plugins,legend:{display:!1}}}}));let Ft=0,tr=0;for(const Je of E||[])Je.compliance===1?Ft++:tr++;const st=document.getElementById("complianceChart");st&&b.current&&b.current.destroy(),st&&(b.current=new Xe(st.getContext("2d"),{type:"doughnut",data:{labels:["Compliant","Non-Compliant"],datasets:[{data:[Ft,tr],backgroundColor:["#10B981","#EF4444"],borderWidth:2,borderColor:t?"#1F2937":"#FFFFFF"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:t?"#E5E7EB":"#374151",font:{family:"Inter, system-ui, sans-serif"},padding:20}}}}}))},Se=E=>{var Rs;const X={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:t?"#9CA3AF":"#6B7280"},grid:{color:t?"#374151":"#E5E7EB"}},y:{ticks:{color:t?"#9CA3AF":"#6B7280"},grid:{color:t?"#374151":"#E5E7EB"}}}},oe={};for(const Ne of E||[]){const Ue=(Ne.weather_condition||"unknown").toLowerCase();oe[Ue]||(oe[Ue]={count:0,compliant:0,non:0}),oe[Ue].count+=1,Ne.compliance===1?oe[Ue].compliant+=1:oe[Ue].non+=1}const ge=Object.keys(oe);if(ge.length===0)return;const gt=ge.map(Ne=>oe[Ne].count),It=document.getElementById("weatherCountsChart");It&&w.current&&w.current.destroy(),It&&(w.current=new Xe(It.getContext("2d"),{type:"bar",data:{labels:ge,datasets:[{label:"Detections",data:gt,backgroundColor:"#38BDF8",borderColor:"#0EA5E9",borderWidth:1,borderRadius:4}]},options:X}));const De={};for(const Ne of E||[]){const Ue=(Ne.weather_condition||"unknown").toLowerCase(),Fr=parseFloat(((Rs=Ne.reaction_time)==null?void 0:Rs.toString())||"0");!isNaN(Fr)&&Fr>0&&(De[Ue]||(De[Ue]={sum:0,n:0}),De[Ue].sum+=Fr,De[Ue].n+=1)}const Ft=Object.keys(De),tr=Ft.map(Ne=>De[Ne].n>0?De[Ne].sum/De[Ne].n:0),st=document.getElementById("weatherReactionChart");st&&F.current&&F.current.destroy(),st&&(F.current=new Xe(st.getContext("2d"),{type:"bar",data:{labels:Ft,datasets:[{label:"Avg Reaction Time (s)",data:tr,backgroundColor:"#F59E0B",borderColor:"#D97706",borderWidth:1,borderRadius:4}]},options:X}));const Je=ge.map(Ne=>oe[Ne].count>0?oe[Ne].compliant/oe[Ne].count*100:0),pt=document.getElementById("weatherComplianceRateChart");pt&&H.current&&H.current.destroy(),pt&&(H.current=new Xe(pt.getContext("2d"),{type:"bar",data:{labels:ge,datasets:[{label:"Compliance Rate (%)",data:Je,backgroundColor:"#10B981",borderColor:"#059669",borderWidth:1,borderRadius:4}]},options:{...X,scales:{...X.scales,y:{...X.scales.y,beginAtZero:!0,max:100}}}}))};_.useEffect(()=>{m&&U&&setTimeout(()=>{try{pe(m.tracking_data,m.vehicle_counts),Se(m.tracking_data)}catch(E){console.error("Error building charts:",E)}},100)},[m,U,t]);const Ie=(E,X)=>E&&E.length>X?E.slice(0,X-1)+"":E||"",ft=E=>{const X=Math.floor(E%60),oe=Math.floor(E/60)%60,ge=Math.floor(E/3600);return`${ge>0?ge+":":""}${String(oe).padStart(2,"0")}:${String(X).padStart(2,"0")}`},Dt=E=>{const X={uploaded:"bg-blue-500/10 text-blue-400 border border-blue-500/20",processing:"bg-yellow-500/10 text-yellow-400 border border-yellow-500/20",completed:"bg-green-500/10 text-green-400 border border-green-500/20",failed:"bg-red-500/10 text-red-400 border border-red-500/20",cancelled:"bg-gray-500/10 text-gray-400 border border-gray-500/20"};return X[E]||X.uploaded},Me=n.filter(E=>E.video_name.toLowerCase().includes(D.toLowerCase()));return a.jsxs("div",{className:`min-h-screen ${t?"bg-[#0B1121] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx(Xt,{}),q.show&&a.jsxs("div",{className:`fixed top-4 right-4 z-50 px-6 py-4 rounded-xl shadow-2xl flex items-start space-x-3 max-w-md backdrop-blur-sm border ${q.type==="success"?"bg-green-500/90 border-green-400/20":q.type==="error"?"bg-red-500/90 border-red-400/20":q.type==="warning"?"bg-yellow-500/90 border-yellow-400/20":"bg-blue-500/90 border-blue-400/20"}`,children:[a.jsx("div",{className:"flex-shrink-0 mt-0.5",children:q.type==="success"?a.jsx(ze,{className:"w-5 h-5"}):q.type==="error"?a.jsx(qe,{className:"w-5 h-5"}):q.type==="warning"?a.jsx(cr,{className:"w-5 h-5"}):a.jsx(cr,{className:"w-5 h-5"})}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{className:"text-white text-sm leading-relaxed font-medium",children:q.message})}),a.jsx("button",{onClick:()=>ae(E=>({...E,show:!1})),className:"flex-shrink-0 text-white/80 hover:text-white transition-colors",children:a.jsx(qe,{className:"w-4 h-4"})})]}),a.jsx(Dr,{title:"Video Playback",onToggleSidebar:()=>e(!r),isSidebarOpen:r}),a.jsx(Ir,{activePath:"/playback",isOpen:r,onClose:()=>e(!1)}),a.jsx("main",{className:"lg:ml-64 p-4 lg:p-8 mt-16 lg:mt-0",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-2xl font-bold mb-2 text-white",children:"Video Playback & Analytics"}),a.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"Browse and analyze your processed videos"})]}),a.jsxs("div",{className:`rounded-2xl p-6 mb-8 backdrop-blur-sm border ${t?"bg-[#151F32]/80 border-[#1E293B]":"bg-white/80 shadow-xl border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-primary-500/10 rounded-lg",children:a.jsx(rs,{className:"w-5 h-5 text-primary-500"})}),a.jsx("h2",{className:"text-xl font-semibold",children:"Advanced Filters"})]}),a.jsxs("div",{className:`text-xs px-3 py-1.5 rounded-lg ${t?"bg-[#1E293B] text-gray-400":"bg-gray-100 text-gray-600"}`,children:[a.jsx(es,{className:"w-3 h-3 inline mr-1"}),"Timezone: ",Jd()]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 mb-4",children:[a.jsxs("div",{className:"lg:col-span-2",children:[a.jsxs("label",{className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:[a.jsx(Aa,{className:"w-4 h-4 inline mr-2"}),"Search Videos"]}),a.jsx("input",{type:"text",value:D,onChange:E=>V(E.target.value),placeholder:"Search by video name...",className:`w-full px-4 py-3 rounded-lg border transition-all duration-200 ${t?"bg-[#1E293B] border-[#2D3B4E] text-white placeholder-gray-400 focus:border-primary-400 focus:ring-2 focus:ring-primary-400/20":"bg-gray-50 border-gray-300 text-gray-900 placeholder-gray-500 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20"}`})]}),a.jsxs("div",{children:[a.jsxs("label",{className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:[a.jsx(ts,{className:"w-4 h-4 inline mr-2"}),"From Date"]}),a.jsx("input",{type:"date",value:f,onChange:E=>p(E.target.value),className:`w-full px-4 py-3 rounded-lg border transition-all duration-200 ${t?"bg-[#1E293B] border-[#2D3B4E] text-white focus:border-primary-400 focus:ring-2 focus:ring-primary-400/20":"bg-gray-50 border-gray-300 text-gray-900 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20"}`})]}),a.jsxs("div",{children:[a.jsxs("label",{className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:[a.jsx(ts,{className:"w-4 h-4 inline mr-2"}),"To Date"]}),a.jsx("input",{type:"date",value:x,onChange:E=>j(E.target.value),className:`w-full px-4 py-3 rounded-lg border transition-all duration-200 ${t?"bg-[#1E293B] border-[#2D3B4E] text-white focus:border-primary-400 focus:ring-2 focus:ring-primary-400/20":"bg-gray-50 border-gray-300 text-gray-900 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20"}`})]}),a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Sort By"}),a.jsxs("select",{value:N,onChange:E=>L(E.target.value),className:`w-full px-4 py-3 rounded-lg border transition-all duration-200 ${t?"bg-[#1E293B] border-[#2D3B4E] text-white focus:border-primary-400 focus:ring-2 focus:ring-primary-400/20":"bg-gray-50 border-gray-300 text-gray-900 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20"}`,children:[a.jsx("option",{value:"created_at",children:"Created Date"}),a.jsx("option",{value:"upload_date",children:"Upload Date"}),a.jsx("option",{value:"duration_seconds",children:"Duration"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:`block text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Order"}),a.jsxs("select",{value:T,onChange:E=>$(E.target.value),className:`w-full px-4 py-3 rounded-lg border transition-all duration-200 ${t?"bg-[#1E293B] border-[#2D3B4E] text-white focus:border-primary-400 focus:ring-2 focus:ring-primary-400/20":"bg-gray-50 border-gray-300 text-gray-900 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20"}`,children:[a.jsx("option",{value:"true",children:"Newest First"}),a.jsx("option",{value:"false",children:"Oldest First"})]})]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("button",{onClick:S,disabled:o,className:"px-6 py-3 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-600 text-white rounded-lg transition-all duration-200 flex items-center gap-2 font-medium shadow-lg hover:shadow-xl",children:[a.jsx(rs,{className:"w-4 h-4"}),"Apply Filters"]}),a.jsxs("button",{onClick:we,disabled:o,className:`px-6 py-3 rounded-lg transition-all duration-200 flex items-center gap-2 font-medium ${t?"bg-[#1E293B] hover:bg-[#2D3B4E] text-gray-300 border border-[#2D3B4E]":"bg-gray-100 hover:bg-gray-200 text-gray-700 border border-gray-300"}`,children:[a.jsx(ws,{className:`w-4 h-4 ${o?"animate-spin":""}`}),"Refresh"]})]}),c&&a.jsx("div",{className:`text-sm font-medium ${c.includes("Error")?"text-red-400":c.includes("success")?"text-green-400":t?"text-gray-400":"text-gray-600"}`,children:c})]})]}),a.jsxs("div",{className:`rounded-2xl backdrop-blur-sm border overflow-hidden ${t?"bg-[#151F32]/80 border-[#1E293B]":"bg-white/80 shadow-xl border-gray-200"}`,children:[a.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-primary-500/10 rounded-lg",children:a.jsx(Tt,{className:"w-5 h-5 text-primary-500"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Video Library"}),a.jsxs("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:[Me.length," of ",u," videos ",D&&`matching "${D}"`]})]})]}),o&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary-500"}),a.jsx("span",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Loading..."})]})]})}),a.jsxs("div",{className:"overflow-x-auto",children:[a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:`${t?"bg-[#1E293B]":"bg-gray-50"}`,children:a.jsxs("tr",{children:[a.jsx("th",{className:`text-left py-4 px-6 font-semibold ${t?"text-gray-300":"text-gray-700"}`,children:"Video Details"}),a.jsx("th",{className:`text-left py-4 px-6 font-semibold ${t?"text-gray-300":"text-gray-700"}`,children:"Status"}),a.jsx("th",{className:`text-left py-4 px-6 font-semibold ${t?"text-gray-300":"text-gray-700"}`,children:"Duration"}),a.jsx("th",{className:`text-left py-4 px-6 font-semibold ${t?"text-gray-300":"text-gray-700"}`,children:"Analytics"}),a.jsx("th",{className:`text-left py-4 px-6 font-semibold ${t?"text-gray-300":"text-gray-700"}`,children:"Created"}),a.jsx("th",{className:`text-left py-4 px-6 font-semibold ${t?"text-gray-300":"text-gray-700"}`,children:"Actions"})]})}),a.jsx("tbody",{children:Me.map((E,X)=>{var oe,ge;return a.jsxs("tr",{className:`border-b transition-colors hover:bg-opacity-50 ${t?"border-gray-700 hover:bg-[#1E293B]":"border-gray-200 hover:bg-gray-50"}`,children:[a.jsx("td",{className:"py-4 px-6",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${t?"bg-[#1E293B]":"bg-gray-100"}`,children:a.jsx(Tt,{className:"w-6 h-6 text-primary-500"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",title:E.video_name,children:Ie(E.video_name||"Untitled Video",40)}),a.jsxs("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:["ID: ",E.id]})]})]})}),a.jsx("td",{className:"py-4 px-6",children:a.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${Dt(E.status)}`,children:((oe=E.status)==null?void 0:oe.charAt(0).toUpperCase())+((ge=E.status)==null?void 0:ge.slice(1))})}),a.jsx("td",{className:"py-4 px-6",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(es,{className:"w-4 h-4 text-gray-400"}),a.jsx("span",{className:`font-medium ${t?"text-gray-300":"text-gray-700"}`,children:E.duration_seconds!=null?ft(E.duration_seconds):"-"})]})}),a.jsx("td",{className:"py-4 px-6",children:a.jsxs("div",{className:"space-y-1",children:[E.total_vehicles!=null&&a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("span",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:["Vehicles: ",a.jsx("span",{className:"font-medium text-primary-500",children:E.total_vehicles})]})}),E.compliance_rate!=null&&a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("span",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:["Compliance: ",a.jsxs("span",{className:`font-medium ${E.compliance_rate>=80?"text-green-400":E.compliance_rate>=60?"text-yellow-400":"text-red-400"}`,children:[E.compliance_rate,"%"]})]})})]})}),a.jsx("td",{className:"py-4 px-6",children:a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{className:`text-sm ${t?"text-gray-300":"text-gray-700"}`,children:Vd(E.created_at)}),a.jsx("span",{className:"text-xs text-gray-500",children:Hd(E.created_at)})]})}),a.jsx("td",{className:"py-4 px-6",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>M(E.id,E.video_name),className:"px-3 py-2 text-xs bg-primary-500 hover:bg-primary-600 text-white rounded-lg transition-all duration-200 flex items-center gap-1 font-medium shadow-sm hover:shadow-md",children:[a.jsx(Lr,{className:"w-3 h-3"}),"Analytics"]}),a.jsxs("button",{onClick:()=>ke(E.id,E.video_name),className:"px-3 py-2 text-xs bg-red-500 hover:bg-red-600 text-white rounded-lg transition-all duration-200 flex items-center gap-1 font-medium shadow-sm hover:shadow-md",children:[a.jsx(Ps,{className:"w-3 h-3"}),"Delete"]})]})})]},E.id)})})]}),Me.length===0&&!o&&a.jsxs("div",{className:`text-center py-12 ${t?"text-gray-400":"text-gray-600"}`,children:[a.jsx(Tt,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),a.jsx("h3",{className:"text-lg font-medium mb-2",children:"No videos found"}),a.jsx("p",{className:"text-sm",children:D?`No videos match "${D}"`:"Upload a video to get started"})]})]})]})]})}),U&&a.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-2xl w-full max-w-7xl mx-auto max-h-[95vh] overflow-auto border shadow-2xl ${t?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200"}`,children:[a.jsxs("div",{className:`flex items-center justify-between p-6 border-b sticky top-0 backdrop-blur-sm ${t?"border-[#1E293B] bg-[#151F32]/95":"border-gray-200 bg-white/95"}`,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-primary-500/10 rounded-lg",children:a.jsx(Lr,{className:"w-5 h-5 text-primary-500"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-semibold",children:"Video Analytics Dashboard"}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:R})]})]}),a.jsx("button",{onClick:ne,className:`p-2 rounded-lg transition-colors ${t?"hover:bg-[#1E293B] text-gray-300":"hover:bg-gray-100 text-gray-700"}`,children:a.jsx(qe,{className:"w-6 h-6"})})]}),a.jsx("div",{className:"p-6",children:v?a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),a.jsx("p",{className:"text-lg font-medium",children:"Loading analytics..."}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Processing video data and generating insights"})]}):m?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mb-8",children:a.jsxs("div",{className:`rounded-xl p-6 ${t?"bg-[#1E293B]":"bg-gray-50"}`,children:[a.jsxs("h4",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[a.jsx(ur,{className:"w-5 h-5 text-primary-500"}),"Video Playback"]}),a.jsx("div",{className:"text-center",children:a.jsx("video",{ref:G,controls:!0,autoPlay:!0,className:"w-full max-w-4xl h-auto rounded-xl bg-black shadow-2xl",children:"Your browser does not support the video tag."})})]})}),a.jsxs("div",{className:`mb-8 p-6 rounded-xl ${t?"bg-[#1E293B]":"bg-gray-50"}`,children:[a.jsxs("h4",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[a.jsx(cr,{className:"w-5 h-5 text-primary-500"}),"Video Information"]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-[#0B1220]":"bg-white"} border ${t?"border-[#2D3B4E]":"border-gray-200"}`,children:[a.jsx("div",{className:`text-xs font-medium mb-2 uppercase tracking-wide ${t?"text-gray-400":"text-gray-600"}`,children:"Status"}),a.jsx("div",{className:"font-semibold text-lg",children:a.jsx("span",{className:`px-3 py-1 rounded-full text-sm ${Dt(m.video.status||"unknown")}`,children:m.video.status||"-"})})]}),a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-[#0B1220]":"bg-white"} border ${t?"border-[#2D3B4E]":"border-gray-200"}`,children:[a.jsx("div",{className:`text-xs font-medium mb-2 uppercase tracking-wide ${t?"text-gray-400":"text-gray-600"}`,children:"Duration"}),a.jsx("div",{className:"font-semibold text-lg",children:m.video.duration_seconds!=null?ft(m.video.duration_seconds):"-"})]}),a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-[#0B1220]":"bg-white"} border ${t?"border-[#2D3B4E]":"border-gray-200"}`,children:[a.jsx("div",{className:`text-xs font-medium mb-2 uppercase tracking-wide ${t?"text-gray-400":"text-gray-600"}`,children:"Total Vehicles"}),a.jsx("div",{className:"font-semibold text-lg text-primary-500",children:m.video.total_vehicles||"-"})]}),a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-[#0B1220]":"bg-white"} border ${t?"border-[#2D3B4E]":"border-gray-200"}`,children:[a.jsx("div",{className:`text-xs font-medium mb-2 uppercase tracking-wide ${t?"text-gray-400":"text-gray-600"}`,children:"Compliance Rate"}),a.jsx("div",{className:`font-semibold text-lg ${(m.video.compliance_rate||0)>=80?"text-green-400":(m.video.compliance_rate||0)>=60?"text-yellow-400":"text-red-400"}`,children:m.video.compliance_rate!=null?m.video.compliance_rate+"%":"-"})]})]})]}),a.jsxs("div",{className:"mb-8",children:[a.jsxs("h4",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[a.jsx(ze,{className:"w-5 h-5 text-primary-500"}),"Raw Data Analysis"]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{className:`rounded-xl border ${t?"bg-[#1E293B] border-[#2D3B4E]":"bg-white border-gray-200"}`,children:[a.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:a.jsxs("h5",{className:"font-semibold flex items-center gap-2",children:["Tracking Data (",m.tracking_data.length,")"]})}),a.jsxs("div",{className:"max-h-80 overflow-y-auto",children:[a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:`sticky top-0 ${t?"bg-[#1E293B]":"bg-gray-50"}`,children:a.jsxs("tr",{children:[a.jsx("th",{className:"p-3 text-left font-medium",children:"ID"}),a.jsx("th",{className:"p-3 text-left font-medium",children:"Type"}),a.jsx("th",{className:"p-3 text-left font-medium",children:"Status"}),a.jsx("th",{className:"p-3 text-left font-medium",children:"Compliance"})]})}),a.jsx("tbody",{children:m.tracking_data.slice(0,100).map((E,X)=>a.jsxs("tr",{className:`border-b ${t?"border-gray-700":"border-gray-200"}`,children:[a.jsx("td",{className:"p-3 font-mono text-xs",children:E.tracker_id}),a.jsx("td",{className:"p-3",children:E.vehicle_type}),a.jsx("td",{className:"p-3",children:a.jsx("span",{className:`px-2 py-1 rounded text-xs ${E.status==="moving"?"bg-blue-500/10 text-blue-400":"bg-gray-500/10 text-gray-400"}`,children:E.status})}),a.jsx("td",{className:"p-3",children:a.jsx("span",{className:`text-lg ${E.compliance===1?"text-green-400":"text-red-400"}`,children:E.compliance===1?"":""})})]},X))})]}),m.tracking_data.length>100&&a.jsxs("div",{className:`p-3 text-center text-xs border-t ${t?"bg-[#1E293B] text-gray-400 border-gray-700":"bg-gray-50 text-gray-600 border-gray-200"}`,children:["Showing first 100 of ",m.tracking_data.length," records"]})]})]}),a.jsxs("div",{className:`rounded-xl border ${t?"bg-[#1E293B] border-[#2D3B4E]":"bg-white border-gray-200"}`,children:[a.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:a.jsxs("h5",{className:"font-semibold flex items-center gap-2",children:["Vehicle Counts (",m.vehicle_counts.length,")"]})}),a.jsxs("div",{className:"max-h-80 overflow-y-auto",children:[a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:`sticky top-0 ${t?"bg-[#1E293B]":"bg-gray-50"}`,children:a.jsxs("tr",{children:[a.jsx("th",{className:"p-3 text-left font-medium",children:"Type"}),a.jsx("th",{className:"p-3 text-left font-medium",children:"Count"}),a.jsx("th",{className:"p-3 text-left font-medium",children:"Date"})]})}),a.jsx("tbody",{children:m.vehicle_counts.slice(0,100).map((E,X)=>a.jsxs("tr",{className:`border-b ${t?"border-gray-700":"border-gray-200"}`,children:[a.jsx("td",{className:"p-3 font-medium",children:E.vehicle_type}),a.jsx("td",{className:"p-3",children:a.jsx("span",{className:"px-2 py-1 bg-primary-500/10 text-primary-400 rounded text-xs font-medium",children:E.count})}),a.jsx("td",{className:"p-3 text-xs font-mono",children:E.date})]},X))})]}),m.vehicle_counts.length>100&&a.jsxs("div",{className:`p-3 text-center text-xs border-t ${t?"bg-[#1E293B] text-gray-400 border-gray-700":"bg-gray-50 text-gray-600 border-gray-200"}`,children:["Showing first 100 of ",m.vehicle_counts.length," records"]})]})]})]})]}),m.vehicle_counts.length>0&&a.jsx("div",{className:"space-y-8",children:a.jsxs("div",{children:[a.jsxs("h4",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[a.jsx(Lr,{className:"w-5 h-5 text-primary-500"}),"Visual Analytics"]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[a.jsxs("div",{className:`p-6 rounded-xl border ${t?"bg-[#0B1220] border-[#1E293B]":"bg-gray-50 border-gray-200"}`,children:[a.jsx("div",{className:`text-sm font-medium mb-4 ${t?"text-gray-400":"text-gray-600"}`,children:"Vehicle Distribution"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"vcChart"})})]}),a.jsxs("div",{className:`p-6 rounded-xl border ${t?"bg-[#0B1220] border-[#1E293B]":"bg-gray-50 border-gray-200"}`,children:[a.jsx("div",{className:`text-sm font-medium mb-4 ${t?"text-gray-400":"text-gray-600"}`,children:"Compliance Overview"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"complianceChart"})})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[a.jsxs("div",{className:`p-6 rounded-xl border ${t?"bg-[#0B1220] border-[#1E293B]":"bg-gray-50 border-gray-200"}`,children:[a.jsx("div",{className:`text-sm font-medium mb-4 ${t?"text-gray-400":"text-gray-600"}`,children:"Weather Impact - Detection Count"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"weatherCountsChart"})})]}),a.jsxs("div",{className:`p-6 rounded-xl border ${t?"bg-[#0B1220] border-[#1E293B]":"bg-gray-50 border-gray-200"}`,children:[a.jsx("div",{className:`text-sm font-medium mb-4 ${t?"text-gray-400":"text-gray-600"}`,children:"Weather Impact - Reaction Time"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"weatherReactionChart"})})]})]}),a.jsx("div",{className:"grid grid-cols-1 gap-6",children:a.jsxs("div",{className:`p-6 rounded-xl border ${t?"bg-[#0B1220] border-[#1E293B]":"bg-gray-50 border-gray-200"}`,children:[a.jsx("div",{className:`text-sm font-medium mb-4 ${t?"text-gray-400":"text-gray-600"}`,children:"Weather Impact - Compliance Rate"}),a.jsx("div",{className:"h-64",children:a.jsx("canvas",{id:"weatherComplianceRateChart"})})]})})]})})]}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx(qe,{className:"w-8 h-8 text-red-400"})}),a.jsx("h3",{className:"text-lg font-medium mb-2",children:"Failed to load analytics"}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Unable to retrieve video analytics data"})]})})]})}),re&&a.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-2xl w-full max-w-6xl mx-auto max-h-[95vh] overflow-auto border shadow-2xl ${t?"bg-[#151F32] border-[#1E293B]":"bg-white border-gray-200"}`,children:[a.jsxs("div",{className:`flex items-center justify-between p-6 border-b ${t?"border-[#1E293B]":"border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-primary-500/10 rounded-lg",children:a.jsx(ur,{className:"w-5 h-5 text-primary-500"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-semibold",children:"Video Player"}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:R})]})]}),a.jsx("button",{onClick:ue,className:`p-2 rounded-lg transition-colors ${t?"hover:bg-[#1E293B] text-gray-300":"hover:bg-gray-100 text-gray-700"}`,children:a.jsx(qe,{className:"w-6 h-6"})})]}),a.jsx("div",{className:"p-6",children:a.jsxs("div",{className:"text-center",children:[a.jsx("video",{ref:ee,controls:!0,className:"w-full max-w-5xl h-auto rounded-xl bg-black shadow-2xl",onLoadStart:()=>O("Loading video..."),onCanPlay:()=>O(`Ready to play: ${R}`),onError:()=>O("Error loading video. Please check the URL."),children:"Your browser does not support the video tag."}),a.jsx("div",{className:`mt-4 text-sm font-medium ${P.includes("Error")?"text-red-400":P.includes("Ready")?"text-green-400":t?"text-gray-400":"text-gray-600"}`,children:P})]})})]})}),J&&k.id&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:`relative rounded-xl w-full max-w-md backdrop-blur-sm ${t?"bg-[#151F32]/95 border border-[#1E293B]":"bg-white/95 shadow-2xl border border-gray-200"}`,children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[a.jsx("div",{className:"p-3 rounded-full bg-red-500/10",children:a.jsx(Pa,{className:"w-6 h-6 text-red-500"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Confirm Deletion"}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"This action cannot be undone"})]})]}),a.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-[#1E293B]":"bg-gray-50"}`,children:[a.jsxs("p",{className:`text-sm ${t?"text-gray-300":"text-gray-700"}`,children:["Are you sure you want to delete ",a.jsxs("strong",{children:['"',k.name,'"']}),"?"]}),a.jsx("p",{className:`text-xs mt-2 ${t?"text-gray-400":"text-gray-600"}`,children:"This will permanently delete the video and all associated tracking data and vehicle counts."})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:_e,className:`flex-1 px-4 py-2.5 rounded-lg font-medium transition-all duration-200 ${t?"bg-[#1E293B] hover:bg-[#2D3B4E] text-gray-300 border border-[#334155]":"bg-gray-100 hover:bg-gray-200 text-gray-700 border border-gray-300"}`,children:"Cancel"}),a.jsxs("button",{onClick:Pe,className:"flex-1 px-4 py-2.5 rounded-lg bg-red-500 hover:bg-red-600 text-white font-medium transition-all duration-200 flex items-center justify-center gap-2",children:[a.jsx(Ps,{className:"w-4 h-4"}),"Delete Video"]})]})]})})})]})}function Zd(){const r=fn(),[e,t]=_.useState(5);return _.useEffect(()=>{const s=setInterval(()=>{t(n=>n<=1?(clearInterval(s),r("/"),0):n-1)},1e3);return()=>clearInterval(s)},[r]),a.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-[#0B1121] relative overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 neural-grid opacity-10"}),a.jsxs("div",{className:"absolute inset-0",children:[a.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 h-64 bg-primary-500/10 rounded-full blur-3xl animate-pulse"}),a.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-64 h-64 bg-primary-500/10 rounded-full blur-3xl animate-pulse animation-delay-2000"})]}),a.jsxs("div",{className:"bg-[#151F32]/50 p-12 rounded-2xl border border-[#1E293B] backdrop-blur-sm text-center max-w-md w-full mx-4 relative",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("div",{className:"mx-auto w-20 h-20 bg-green-500/10 rounded-full flex items-center justify-center mb-6",children:a.jsx(kt,{className:"w-10 h-10 text-green-400 animate-pulse"})}),a.jsx("h1",{className:"text-3xl font-bold text-white mb-4",children:"Email Confirmed Successfully!"}),a.jsx("p",{className:"text-gray-300 mb-6 leading-relaxed",children:"Thank you for confirming your email address. Your account has been successfully activated and you can now access all features of Project 49."}),a.jsxs("div",{className:"bg-[#1E293B] rounded-lg p-4 mb-6",children:[a.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"Redirecting to home page in:"}),a.jsxs("div",{className:"text-2xl font-bold text-primary-400",children:[e," second",e!==1?"s":""]})]})]}),a.jsxs("button",{onClick:()=>r("/"),className:"w-full py-3 px-4 bg-primary-500 hover:bg-primary-600 text-white font-medium rounded-lg transition-all duration-200 flex items-center justify-center gap-2",children:[a.jsx(vs,{className:"w-5 h-5"}),"Go to Home Page Now"]})]})]})}function eu(){return a.jsx("div",{className:"fixed inset-0 bg-[#0B1121] flex items-center justify-center z-50",children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-0 neural-grid opacity-20"}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("div",{className:"absolute animate-ping h-16 w-16 rounded-full bg-primary-400 opacity-20"}),a.jsx("div",{className:"absolute h-16 w-16 rounded-full bg-primary-400 opacity-10 animate-pulse"}),a.jsx("div",{className:"relative h-12 w-12 rounded-full bg-primary-400 animate-pulse flex items-center justify-center",children:a.jsx("div",{className:"h-8 w-8 rounded-full bg-[#0B1121] flex items-center justify-center",children:a.jsx("div",{className:"h-4 w-4 rounded-full bg-primary-400 animate-pulse"})})})]})}),a.jsx("div",{className:"mt-8 text-center",children:a.jsx("p",{className:"text-primary-400 text-lg font-medium animate-pulse",children:"Loading..."})})]})})}function tu(){const[r,e]=_.useState(null),[t,s]=_.useState(!0),[n,i]=_.useState(!1);return _.useEffect(()=>{_l(),(async()=>{try{const{data:{session:c},error:d}=await fe.auth.getSession();d?(console.warn("Session retrieval error:",d.message),e(null)):e((c==null?void 0:c.user)??null)}catch(c){console.warn("Failed to get session:",c),e(null)}finally{s(!1)}})();const{data:{subscription:l}}=fe.auth.onAuthStateChange((c,d)=>{e((d==null?void 0:d.user)??null),t&&s(!1)});return()=>l.unsubscribe()},[]),_.useEffect(()=>{const o=()=>i(!0),l=()=>i(!1);return window.addEventListener("beforeunload",o),window.addEventListener("load",l),()=>{window.removeEventListener("beforeunload",o),window.removeEventListener("load",l)}},[]),t||n?a.jsx(eu,{}):a.jsx(ba,{children:a.jsxs(va,{children:[a.jsx(Ve,{path:"/",element:a.jsx(jl,{})}),a.jsx(Ve,{path:"/dashboard",element:r?a.jsx(Tl,{}):a.jsx(nt,{to:"/auth"})}),a.jsx(Ve,{path:"/upload",element:r?a.jsx(qd,{}):a.jsx(nt,{to:"/auth"})}),a.jsx(Ve,{path:"/analytics",element:r?a.jsx(Gd,{}):a.jsx(nt,{to:"/auth"})}),a.jsx(Ve,{path:"/playback",element:r?a.jsx(Xd,{}):a.jsx(nt,{to:"/auth"})}),a.jsx(Ve,{path:"/settings",element:r?a.jsx(Qd,{}):a.jsx(nt,{to:"/auth"})}),a.jsx(Ve,{path:"/auth",element:r?a.jsx(nt,{to:"/dashboard"}):a.jsx(ec,{})}),a.jsx(Ve,{path:"/confirmation-success",element:a.jsx(Zd,{})}),a.jsx(Ve,{path:"*",element:a.jsx(nt,{to:"/"})})]})})}kn(document.getElementById("root")).render(a.jsx(et.StrictMode,{children:a.jsx(tu,{})}));
